var Eu=Object.defineProperty;var Ru=(t,e,n)=>e in t?Eu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Yt=(t,e,n)=>Ru(t,typeof e!="symbol"?e+"":e,n);import{i as hl,n as $o,j as u,a as Jr,c as $u,d as or,b as jt,G as Nn,C as bi,t as He,u as Vs,p as yt,F as cr,T as Ou,e as fl,f as Ht,g as an,h as Rn,k as Ln,l as ur,m as Oo,o as zu,q as dr,s as us,L as Du,r as Hs,_ as Nu,v as pl,w as ml,x as Lu,y as Fu,z as Bu,A as Vu,B as Hu,D as Wu,E as Xu,H as Yu,I as Uu,J as qu,K as Gu,M as In,N as gl,O as Ku,P as Zu,Q as Qu,R as xl,S as Ju,U as Ws,V as yl,W as vl,X as td,Y as ed,Z as nd,$ as bl,a0 as rd,a1 as id,a2 as sd,a3 as od,a4 as ad,a5 as ld,a6 as cd,a7 as ud}from"./index-aczn_LpH.js";import*as vt from"https://esm.sh/react@^19.0.0";import Xs,{useRef as at,useCallback as tt,useEffect as St,useState as ct,useLayoutEffect as dd,memo as rt,forwardRef as _t,useMemo as L,Fragment as hd,startTransition as Ys,useDeferredValue as Gt,useTransition as fd}from"https://esm.sh/react@^19.0.0";import{s as zr,v as wl,p as jl,u as hr,_ as _l,a as mt,b as O,c as Us,d as pd,r as md,e as gd,f as xd,g as yd,h as zo,i as vd,j as bd,k as wd,l as Do,m as jd,n as _d,o as Sd}from"./import-files-C321XgFq.js";import{Tooltip as vn,Portal as pn,useEditable as wi,Editable as ne,VStack as jr,Flex as lt,Box as At,Checkbox as Xn,IconButton as mn,Popover as dt,HStack as ji,Text as Ft,Spinner as Ue,Dialog as Wt,EditableRootProvider as Cd,EditablePreview as kd,EditableTextarea as Id,For as No,Span as le,Button as _r,AbsoluteCenter as qs,Alert as Kt,Select as It,Fieldset as We,Input as ln,useDialog as ye,DialogRootProvider as Ge,Link as _i,createListCollection as Sl,useSelect as Cl,SelectRootProvider as kl,SelectControl as Pd,SelectTrigger as Td,SelectValueText as Md,Separator as cn,CheckboxGroup as Sr,Stack as dn,Field as Yn,FieldLabel as Ad,FieldErrorText as Cn,usePopover as Lo,Card as De,Tag as bn,ActionBar as $n,Menu as U,MenuItemGroupLabel as Il,Clipboard as Ke,DataList as Nt,Heading as ds,List as Qt,Switch as Je,Group as ti,FieldRoot as Ed,Textarea as Rd,FieldHelperText as $d,Icon as Cr,EmptyState as Un,Center as kr,Container as Fn,Tabs as Ee,useFileUpload as Od,ListItem as Fo,useTabs as zd}from"https://esm.sh/@chakra-ui/react@^3.14.2?bundle=true";import Gs from"https://esm.sh/axios@^1.8.4";import{Global as ei}from"https://esm.sh/@emotion/react@^11.14.0";import{Chart as ve,LineController as Dd,BarController as Nd,CategoryScale as Ks,LinearScale as Si,BarElement as Zs,Tooltip as Ze,Legend as Ld,Element as gn,DoughnutController as Fd,Animations as Bd,defaults as Vd,LineElement as Hd,PointElement as Wd}from"https://esm.sh/chart.js@^4.4.8";import"https://esm.sh/core-js-bundle@^3.41.0";import"https://esm.sh/react-dom@^19.0.0/client";var ni=function(){return ni=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ni.apply(this,arguments)};function Xd(){var t=at(!1),e=tt(function(){return t.current},[]);return St(function(){return t.current=!0,function(){t.current=!1}},[]),e}function Pl(t,e,n){e===void 0&&(e=[]),n===void 0&&(n={loading:!1});var r=at(0),i=Xd(),s=ct(n),o=s[0],a=s[1],c=tt(function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];var h=++r.current;return o.loading||a(function(f){return ni(ni({},f),{loading:!0})}),t.apply(void 0,l).then(function(f){return i()&&h===r.current&&a({value:f,loading:!1}),f},function(f){return i()&&h===r.current&&a({error:f,loading:!1}),f})},e);return[o,c]}var Yd=function(t,e,n){if(!hl)return[e,$o,$o];var r=JSON.parse,i=at(function(d){try{var h=n?n.raw?String:n.serializer:JSON.stringify,f=localStorage.getItem(d);return f!==null?r(f):(e&&localStorage.setItem(d,h(e)),e)}catch{return e}}),s=ct(function(){return i.current(t)}),o=s[0],a=s[1];dd(function(){return a(i.current(t))},[t]);var c=tt(function(d){try{var h=typeof d=="function"?d(o):d;if(typeof h>"u")return;var f=void 0;n||(f=JSON.stringify(h)),localStorage.setItem(t,f),a(r(f))}catch{}},[t,a]),l=tt(function(){try{localStorage.removeItem(t),a(void 0)}catch{}},[t,a]);return[o,c,l]},Ud=function(t,e,n){if(!hl)return[e,function(){}];var r=ct(function(){try{var o=sessionStorage.getItem(t);return typeof o!="string"?(sessionStorage.setItem(t,n?String(e):JSON.stringify(e)),e):n?o:JSON.parse(o||"null")}catch{return e}}),i=r[0],s=r[1];return St(function(){try{var o=n?String(i):JSON.stringify(i);sessionStorage.setItem(t,o)}catch{}}),[i,s]};const Oe=vt.forwardRef(function(e,n){const{showArrow:r,children:i,disabled:s,portalled:o,content:a,contentProps:c,portalRef:l,...d}=e;return s?i:u.jsxs(vn.Root,{...d,children:[u.jsx(vn.Trigger,{asChild:!0,children:i}),u.jsx(pn,{disabled:!o,container:l,children:u.jsx(vn.Positioner,{children:u.jsxs(vn.Content,{ref:n,...c,children:[r&&u.jsx(vn.Arrow,{children:u.jsx(vn.ArrowTip,{})}),a]})})})]})}),qd=t=>{const e=Number.parseFloat(t);if(!(Number.isNaN(e)||!Number.isFinite(e)))return e},Bo=rt(({value:t,onChange:e,ref:n,...r})=>{const i=wi({defaultValue:t==null?void 0:t.toString(),placeholder:{preview:"---",edit:""},onValueCommit:({value:s})=>{const o=e(qd(s));o!==void 0?i.setValue(o.toString()):i.clearValue()}});return u.jsxs(ne.RootProvider,{value:i,justifyContent:"center",size:"sm",ref:n,...r,children:[u.jsx(ne.Preview,{justifyContent:"center",w:"100%",_placeholderShown:{color:"fg.subtle"},whiteSpace:"nowrap",children:i.value?`${i.value} Å`:i.valueText}),u.jsx(ne.Input,{inputMode:"decimal",textAlign:"center",focusRing:"none",borderBottomWidth:"1px",borderBottomColor:"border",borderRadius:0,_focusVisible:{borderColor:"var(--focus-color)",boxShadow:"0px 1px 0px 0px var(--focus-color)"}}),i.editing&&"Å"]})});function tr(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24}class fr{constructor(e,n){this.length=e,this.t=new Uint32Array(e+32>>>5),n===!0&&this.i()}get(e){return(this.t[e>>>5]&1<<e)!=0}set(e){this.t[e>>>5]|=1<<e}clear(e){this.t[e>>>5]&=~(1<<e)}o(e){this.t[e>>>5]^=1<<e}h(e,n,r){if(n<e)return;const i=this.t,s=r===!0?4294967295:0,o=e>>>5,a=n>>>5;for(let d=o;d<a;++d)i[d]=s;const c=o<<5,l=a<<5;if(r===!0)if(n-e<32)for(let d=e,h=n+1;d<h;++d)i[d>>>5]|=1<<d;else{for(let d=e,h=c;d<h;++d)i[d>>>5]|=1<<d;for(let d=l,h=n+1;d<h;++d)i[d>>>5]|=1<<d}else if(n-e<32)for(let d=e,h=n+1;d<h;++d)i[d>>>5]&=~(1<<d);else{for(let d=e,h=c;d<h;++d)i[d>>>5]&=~(1<<d);for(let d=l,h=n+1;d<h;++d)i[d>>>5]&=~(1<<d)}return this}l(e,n){return this.h(e,n,!0)}u(e,n){return this.h(e,n,!1)}A(...e){const n=this.t,r=e.length;for(let i=0;i<r;++i){const s=e[i];n[s>>>5]|=1<<s}return this}p(...e){const n=this.t,r=e.length;for(let i=0;i<r;++i){const s=e[i];n[s>>>5]&=~(1<<s)}return this}i(){return this.h(0,this.length-1,!0)}M(){return this.h(0,this.length-1,!1)}m(){const e=this.t.length,n=this.t,r=32-this.length%32;for(let i=0;i<e-1;++i)n[i]=~n[i];return n[e-1]=~(n[e-1]<<r)>>>r,this}S(e,n,r){if(n<e)return;const i=this.t,s=r===!0?4294967295:0,o=e>>>5,a=n>>>5;for(let c=o;c<a;++c)if(i[c]!==s)return!1;if(n-e<32){for(let c=e,l=n+1;c<l;++c)if(!!(i[c>>>5]&1<<c)!==r)return!1}else{const c=a<<5;for(let l=e,d=o<<5<<5;l<d;++l)if(!!(i[l>>>5]&1<<l)!==r)return!1;for(let l=c,d=n+1;l<d;++l)if(!!(i[l>>>5]&1<<l)!==r)return!1}return!0}U(e,n){return this.S(e,n,!0)}_(e,n){return this.S(e,n,!1)}q(){return this.S(0,this.length-1,!0)}v(){return this.S(0,this.length-1,!1)}O(...e){const n=this.t,r=e.length;for(let i=0;i<r;++i){const s=e[i];if((n[s>>>5]&1<<s)==0)return!1}return!0}C(...e){const n=this.t,r=e.length;for(let i=0;i<r;++i){const s=e[i];if((n[s>>>5]&1<<s)!=0)return!1}return!0}G(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length);for(let s=0;s<i;++s)if(n[s]!==r[s])return!1;return!0}P(){const e=this.t.length,n=this.t;let r=0;for(let i=0;i<e;++i)r+=tr(n[i]);return r}R(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length);for(let s=0;s<i;++s)n[s]=n[s]&~r[s];for(let s=n.length;s<i;++s)n[s]=0;return this}I(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length);for(let s=0;s<i;++s)n[s]|=r[s];for(let s=n.length;s<i;++s)n[s]=0;return this}T(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length);for(let s=0;s<i;++s)n[s]&=r[s];for(let s=n.length;s<i;++s)n[s]=0;return this}F(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length);for(let s=0;s<i;++s)if((n[s]&r[s])!=0)return!0;return!1}D(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length);let s=0;for(let o=0;o<i;++o)s+=tr(n[o]&r[o]);return s}B(e){const n=this.t,r=e.t,i=Math.min(n.length,r.length),s=new Uint32Array(i),o=Object.create(fr.prototype);o.t=s,o.length=Math.min(this.length,e.length);for(let a=0;a<i;++a)s[a]=n[a]&r[a];return o}forEach(e){const n=this.t.length,r=this.t;let i=0;for(let s=0;s<n;++s){let o=r[s];for(;o!==0;){const a=o&-o;e((s<<5)+tr(a-1),i),o^=a,++i}}}toArray(){const e=this.t,n=Array(this.P()),r=this.t.length;let i=0;for(let s=0;s<r;++s){let o=e[s];for(;o!==0;){const a=o&-o;n[i++]=(s<<5)+tr(a-1),o^=a}}return n}toString(){return"{"+this.toArray().join(",")+"}"}N(){const e=this.toArray().join(",");return e?"@"+e:"NONE"}clone(){const e=Object.create(fr.prototype);return e.length=this.length,e.t=new Uint32Array(this.t),e}}const Gd={matrix:[[58,23,-12,-7,-44,10,-23,-14,-14,-27,-17,-8,1,-9,-22,23,15,5,-74,-45,0],[23,224,-67,-63,-50,-30,-29,1,-56,-41,-6,-33,-44,-53,-43,15,2,18,-93,-6,0],[-12,-67,111,59,-104,-4,4,-84,6,-88,-65,48,-13,18,-29,5,-7,-63,-105,-73,0],[-7,-63,59,85,-83,-17,-1,-63,25,-60,-47,15,-12,40,-8,1,-7,-47,-108,-51,0],[-44,-50,-104,-83,144,-93,4,12,-74,36,30,-64,-67,-56,-65,-43,-41,-3,63,104,0],[10,-30,-4,-17,-93,140,-32,-95,-27,-91,-75,4,-36,-29,-32,5,-26,-68,-80,-79,0],[-23,-29,4,-1,4,-32,137,-50,6,-37,-42,21,-23,27,19,-4,-12,-44,-13,48,0],[-14,1,-84,-63,12,-95,-50,86,-53,53,47,-62,-60,-47,-55,-43,-8,69,-27,-24,0],[-14,-56,6,25,-74,-27,6,-53,75,-48,-30,13,-12,34,68,-3,-4,-44,-71,-49,0],[-27,-41,-88,-60,36,-91,-37,53,-48,88,62,-63,-48,-36,-48,-47,-25,36,-11,-4,0],[-17,-6,-65,-47,30,-75,-42,47,-30,62,103,-45,-54,-21,-31,-35,-9,31,-46,-20,0],[-8,-33,48,15,-64,4,21,-62,13,-63,-45,89,-25,12,2,22,10,-51,-79,-29,0],[1,-44,-13,-12,-67,-36,-23,-60,-12,-48,-54,-25,160,-6,-20,5,-12,-42,-76,-83,0],[-9,-53,18,40,-56,-29,27,-47,34,-36,-21,12,-6,75,34,1,-4,-37,-92,-48,0],[-22,-43,-29,-8,-65,-32,19,-55,68,-48,-31,2,-20,34,113,-10,-14,-49,-58,-39,0],[23,15,5,1,-43,5,-4,-43,-3,-47,-35,22,5,1,-10,53,32,-28,-62,-31,0],[15,2,-7,-7,-41,-26,-12,-8,-4,-25,-9,10,-12,-4,-14,32,68,0,-87,-40,0],[5,18,-63,-47,-3,-68,-44,69,-44,36,31,-51,-42,-37,-49,-28,0,74,-61,-32,0],[-74,-93,-105,-108,63,-80,-13,-27,-71,-11,-46,-79,-76,-92,-58,-62,-87,-61,289,81,0],[-45,-6,-73,-51,104,-79,48,-24,-49,-4,-20,-29,-83,-48,-39,-31,-40,-32,81,162,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],H:22,$:-300},Kd={matrix:[[91,-114,-31,-123],[-114,100,-125,-31],[-31,-125,100,-114],[-123,-31,-114,91]],$:-400,H:120},Zd=/^[ACGTRNDEQHILKMFPSWYV]+$/,Qd=/^[ABCDGHKMNRSTUVWY]+$/i,Jd=/^[ABCGTRNDEQHIJLKMFPSWYUVXZ]+$/i,th=/[^ACGU]/i,eh=/[^ACGT]/i;function Vo(t){if(!th.test(t)||!eh.test(t))return 1;const e=Qd.test(t),n=Zd.test(t);if(n&&!e)return 0;if(n&&e||Jd.test(t))return Ho(t);throw Error("Unrecognized sequence type: "+t)}function Ho(t){let e=0;const n=Math.min(t.length,100);for(let r=0;r<n;r++)switch(t[r]){case"A":case"T":case"U":case"G":case"C":case"N":e++}return e/n>Math.SQRT1_2?1:0}const pt=new Uint8Array(96);pt.fill(255),pt[65]=0,pt[67]=1,pt[68]=2,pt[69]=3,pt[70]=4,pt[71]=5,pt[72]=6,pt[73]=7,pt[75]=8,pt[76]=9,pt[77]=10,pt[78]=11,pt[80]=12,pt[81]=13,pt[82]=14,pt[83]=15,pt[84]=16,pt[86]=17,pt[87]=18,pt[89]=19,pt[95]=20;const tn=new Uint8Array(96);function nh(t,e){const n=Math.floor(100*Math.random());if(e===1)switch(t){case"M":return[0,1][n%2];case"R":return[0,2][n%2];case"W":return[0,3][n%2];case"S":return[1,2][n%2];case"Y":return[1,3][n%2];case"K":return[2,3][n%2];case"V":return[0,1,2][n%3];case"H":return[0,1,3][n%3];case"D":return[0,2,3][n%3];case"B":return[1,2,3][n%3];default:return n%4}switch(t){case"B":return[2,11][n%2];case"Z":return[3,13][n%2];case"J":return[7,9][n%2];default:return n%20}}function rh(t){return t.map(e=>ih[e])}tn.fill(255),tn[65]=0,tn[67]=1,tn[71]=2,tn[84]=3,tn[85]=3;const ih=[0,1,2,2,3,0,4,5,4,5,5,2,0,2,4,0,0,5,3,3];function sh(t,e,n){const r=[],i=n.gapchar;let s=0;for(let o=0;o<e.length;o++){let a=e[o];a<0?r.push(i.repeat(-a)):(r.push(t.substr(s,a)),s+=a)}return r.join("")}function Dr(t,e){const n=[0];let r=0;const i=e.slice();function s(o){(o^n[n.length-1])>=0?n[n.length-1]+=o:n.push(o)}for(let o=0;o<t.length;o++){let a=t[o];if(a<0)s(a);else for(;a>0&&r<i.length;){let c=i[r];c<0?a<-c?(i[r]+=a,s(-a),a=0):(s(c),a+=c,r++):a<c?(i[r]-=a,s(a),a=0):(s(c),a-=c,r++)}}return n}function oh(t,e){const n=[];let r=0,i=0,s=t[0],o=e[0];for(;r<t.length||i<e.length;)s!==o?Math.sign(s)!==Math.sign(o)?s<0||o===void 0?(n.push(s),s=t[++r]):(n.push(o),o=e[++i]):s>0?s>o?(n.push(o),s-=o,o=e[++i]):(n.push(s),o-=s,s=t[++r]):(n.push(Math.min(s,o)),s=t[++r],o=e[++i]):(n.push(o),s=t[++r],o=e[++i]);return n}function ah(t,e){const n=[];let r=0,i=0,s=e[0],o=t[0],a=0;for(;r<e.length||i<t.length;)if(a=n[n.length-1],s!==o){if(Math.sign(s)===Math.sign(o)){if(s>0){if(o>s)return;a>0?n[n.length-1]=a+o:n.push(o),s-=o,o=t[++i];continue}if(s>o){a>0?n[n.length-1]=a-s:n.push(Math.abs(s)),o-=s,s=e[++r];continue}return}if(!(o<0))return;a<0?n[n.length-1]=a+o:n.push(o),o=t[++i]}else a>0?n[n.length-1]=a+Math.abs(s):n.push(Math.abs(s)),s=e[++r],o=t[++i];return n}function Wo(t,e){if(Math.sign(t[t.length-1])===Math.sign(e[0])){let n=[...t];return n[n.length-1]+=e[0],n.push(...e.slice(1)),n}return[...t,...e]}function Ne(t,e=0){const n=[];let r=0,i=0;for(let s=0;s<t.length;s++)i=t[s],(i^r)>=0?r+=i:(n.push(r),r=i);return n.push(r),n[0]===0&&n.shift(),1&e||n.reverse(),n}function hs(t){let e=0,n=0;for(let r=0;r<t.length;r++)n=t[r],e+=n<0?-n:n;return e}function Xo(t){const e=[];let n=0,r=0;for(let i=0;i<t.length;i++)if(r=t[i],r<0)for(let s=0;s<-r;s++)e.push(-1);else for(let s=0;s<r;s++)e.push(n),n++;return e}function ri(t,e,n,r=0){const i=t.V,s=e.V,o=i.length,a=s.length;let c=0,l=[],d=[],h=0,f=0,p=0,m=0;const x=new Uint8Array(Math.ceil((o+1)*a/2)+1);let y=0,g=0,v=0,w=0,b=0,C=n.W[0];const A=n.$,_=1&r?0:-A/2,S=2&r?0:-A/2;l[0]=0,d[0]=-1/0;for(let $=1;$<=a;$++)l[$]=A+_,d[$]=-1/0;for(let $=1;$<=o;$++){h=_,f=-1/0,C=n.W[i[$-1]];for(let R=1;R<=a;R++)b=0,y=l[R]+A,v=d[R],R===a&&(y+=S),y>=v?d[R]=y:b+=1,g=h+A,w=f,$===o&&(g+=S),g>=w?f=g:b+=2,c=l[R-1]+C[s[R-1]],l[R-1]=h,c>=f?c>=d[R]?h=c:(h=d[R],b+=4):f>=d[R]?(h=f,b+=8):(h=d[R],b+=4),p=$*a+R,m=p%2,p>>>=1,x[p]+=m?b:b<<4;l[a]=h}const T=Math.max(c,f,d[d.length-1]),[P,M]=fs(x,o,a,b);return{j:[Ne(P),Ne(M)],K:T}}function fs(t,e,n,r){let i=e,s=n,o=e*n+n,a=o,c=1;const l=[],d=[];let h=(12&r)>>2,f=0;for(;i>0&&s>0;)o=i*n+s,a=o>>>1,c=o%2,f=t[a],f=c?15&f:f>>>4,h===0?(f>>=2,f===0&&(i--,s--,l.push(1),d.push(1))):h===2?(l.push(-1),d.push(1),f&=2,s--):(l.push(1),d.push(-1),f&=1,i--),h=f;return i>0?(l.push(i),d.push(-i)):s>0&&(l.push(-s),d.push(s)),[l,d]}class Tl{constructor(e,n,r,i=0){this.Y=0,this.length=0,this.weight=0,this.length=e,this.J=new fr(e),this.L=new Uint8Array(n*e),this.Z=new Uint8Array(n*e),this.X=new Float32Array(n*e),this.tt=new Float32Array(n*e),this.et=new Uint8Array(e),this.rt=new Float32Array(e),this.nt=new Float32Array(e),this.it=new Float32Array(e),this.st=new Float32Array(e),this.ot=new Float32Array(e),this.Y=r,this.ht=n,this.weight=i}ct(e=0){return new lh(this,e)}}class lh{constructor(e,n=0){this.lt=0,this.ht=4,this.offset=0,this.ut=e,this.lt=n,this.ht=e.ht,this.offset=this.lt*this.ht}ft(e){this.lt=e,this.offset=e*this.ht}get J(){return this.ut.J.get(this.lt)}set J(e){e?this.ut.J.set(this.lt):this.ut.J.clear(this.lt)}get L(){return this.ut.L.subarray(this.offset,this.offset+this.ht)}set L(e){this.ut.L.set(e,this.offset)}get et(){return this.ut.et[this.lt]}set et(e){this.ut.et[this.lt]=e}get Z(){return this.ut.Z.subarray(this.offset,this.offset+this.ht)}set Z(e){this.ut.Z.set(e,this.offset)}get X(){return this.ut.X.subarray(this.offset,this.offset+this.ht)}set X(e){this.ut.X.set(e,this.offset)}get tt(){return this.ut.tt.subarray(this.offset,this.offset+this.ht)}set tt(e){this.ut.tt.set(e,this.offset)}get rt(){return this.ut.rt[this.lt]}set rt(e){this.ut.rt[this.lt]=e}get nt(){return this.ut.nt[this.lt]}set nt(e){this.ut.nt[this.lt]=e}get it(){return this.ut.it[this.lt]}set it(e){this.ut.it[this.lt]=e}get st(){return this.ut.st[this.lt]}set st(e){this.ut.st[this.lt]=e}get ot(){return this.ut.ot[this.lt]}set ot(e){this.ut.ot[this.lt]=e}}function ch(t,e,n,r=0){const i=t.V,s=i.length,o=new Tl(s,n.dt,1,e);let a=e;const c=n.$;let l=o.ct(),d=0;for(let h=0;h<s;h++){l.ft(h),d=i[h],l.Z[d]=1,l.X[d]=a,l.L[l.et]=d,l.et=1,l.rt=a,l.st=c/2*a,l.ot=c/2*a;for(let f=0;f<n.dt;f++)l.tt[f]=a*n.W[f][d]}return 1&r||(o.st[0]/=2),2&r||(o.st[s-1]/=2),o}function Wi(t,e,n,r,i,s=0){const o=hs(n),a=t.Y+e.Y,c=t.weight+e.weight,l=new Tl(o,i.dt,a,c),d=i.$;let h=l.ct(),f=t.ct(),p=e.ct(),m=Xo(n),x=Xo(r),y=0,g=0,v=1,w=1,b=!1,C=!1,A=!1,_=!1,S=0;for(let T=0;T<o;T++){if(h.ft(T),y=m[T],f.ft(y),y===-1?(b=v>=0,C=T===o-1||m[T+1]>0):(b=!1,C=!1),v=y,g=x[T],p.ft(g),g===-1?(A=w>=0,_=T==o-1||x[T+1]>0):(A=!1,_=!1),w=g,S=0,y!==-1&&g!==-1){h.nt=f.nt+p.nt,h.it=f.it+p.it,h.rt=f.rt+p.rt,h.Z.set(f.Z),h.X.set(f.X);for(let P=0;P<e.ht;P++){let M=p.Z[P];M&&(h.Z[P]+=M,h.X[P]+=p.X[P]),h.Z[P]&&(h.L[S]=P,S++),h.tt[P]=f.tt[P]+p.tt[P]}h.et=S}else y==-1?(h.nt=p.nt+(b?t.weight:0),h.it=p.it+(C?t.weight:0),h.rt=p.rt,h.Z.set(p.Z),h.X.set(p.X),h.L.set(p.L),h.tt.set(p.tt),h.et=p.et):g==-1&&(h.nt=f.nt+(A?e.weight:0),h.it=f.it+(_?e.weight:0),h.rt=f.rt,h.Z.set(f.Z),h.X.set(f.X),h.L.set(f.L),h.tt.set(f.tt),h.et=f.et);h.st=d/2*(1-h.nt)*h.rt,h.ot=d/2*(1-h.it)*h.rt}return 1&s||(l.st[0]/=2),2&s||(l.st[o-1]/=2),l}function wn(t){return"gt"in t}function uh(t,e){let n=1/0,r=0,i=0,s=t.length;for(let o=0;o<s;o++)for(let a=o+1;a<s;a++)t[o][a]<n&&(n=t[o][a],r=o,i=a);return[{profile:null,wt:e[r],At:e[i],Mt:n,yt:[],St:[],Ut:[],type:1,_t:0,id:"",qt:[],parent:-1,weight:0},r,i]}function dh(t,e,n,r){const[i,s]=e>n?[e,n]:[n,e],o=[],a=t.length;for(let c=0;c<a;c++){if(c==e||c==n)continue;const l=.1*(t[c][e]+t[c][n])/2+.9*Math.min(t[c][e],t[c][n]);t[c].push(l),o.push(l),t[c].splice(i,1),t[c].splice(s,1)}return o.push(0),t.push(o),t.splice(i,1),t.splice(s,1),r.splice(i,1),r.splice(s,1),t}class hh{constructor(e){this.bt=e,this.store=Array(e),this.head=0,this.vt=0}get size(){return(this.vt-this.head+this.bt)%this.bt}get Ot(){return this.head===this.vt}Ct(){if(this.Ot)return null;const e=this.store[this.head];return this.head++,this.head>=this.bt&&(this.head=0),e}Et(){return this.Ot?null:(this.vt--,this.vt<0&&(this.vt=this.bt-1),this.store[this.vt])}Gt(e){this.head--,this.head<0&&(this.head=this.bt-1),this.store[this.head]=e,this.head===this.vt&&(this.vt=(this.vt-1+this.bt)%this.bt)}Pt(e){this.store[this.vt]=e,this.vt++,this.vt>=this.bt&&(this.vt=0),this.head===this.vt&&(this.head=(this.head-1+this.bt)%this.bt)}Rt(e=0){const n=e===0?this.head:(this.head+e+this.bt)%this.bt;return this.store[n]}It(e=0){const n=(this.vt-1-e+this.bt)%this.bt;return this.store[n]}}function ps(t,e,n){const r=new Map,i=new hh(n),s=0|e,o=new Uint16Array(t.V.length-s+1);let a=0,c=0;for(let m=0;m<s;m++)a|=t.V[s-m-1]<<2*m;o[c++]=a;for(let m=s,x=t.V.length;m<x;m++)a=(a<<2)+t.V[m],o[c++]=a;const l=t.Tt.length*(2/(n+1))*2|0,d={Ft:new Uint16Array(l),Dt:new Uint16Array(l),xt:new Uint16Array(l),Bt:new Uint16Array(l),count:0};let h=NaN,f=0,p=-17;for(let m=0;m<o.length;m++){const x=o[m];for(p++;!i.Ot&&((f=i.It())<p||o[f]>=x);)i.Et();if(i.Pt(m),p<0)continue;for(;i.Rt()<p;)i.Ct();let y=i.Rt();if(y===h)d.Bt[d.count-1]=m+s;else{const g=o[y],v=d.count;d.count++,d.Ft[v]=g,d.Dt[v]=y,d.xt[v]=p,d.Bt[v]=m+s,h=y,r.has(g)?r.get(g).push(v):r.set(g,[v])}}return[r,d,o]}function Yo(t,e,n,r,i){const[s,o,a]=r??ps(t,8,24),[c,l,d]=i??ps(e,8,24);t.Tt.length,e.Tt.length;const h=new Map;for(let _=0;_<o.count;_++){let S=o.Ft[_];if(!c.has(S))continue;let T=c.get(S);if(T.length>4)continue;let P=t.Tt.substring(o.xt[_],o.Bt[_]);for(let M=0;M<T.length;M++){let $=T[M],R=e.Tt.substring(l.xt[$],l.Bt[$]),j=Math.min(P.length,R.length),I=!1;I=j==P.length?R.indexOf(P)===0:P.indexOf(R)===0;let k,E=0;I?(E=o.xt[_]-l.xt[$],k={Nt:E,Ht:o.xt[_],end:o.xt[_]+j}):(E=o.Dt[_]-l.Dt[$],k={Nt:E,Ht:o.Dt[_],end:o.Dt[_]+8-1}),h.has(E)?h.get(E).push(k):h.set(E,[k])}}let f=[];if(h.forEach(_=>{if(!_.length)return;let S=_[0];f.push(S),_.forEach(T=>{T.Ht<=S.end?S.end=T.end:(S=T,f.push(S))})}),f.length===0)return ri(t,e,n).j;f.sort((_,S)=>{let T=_.Ht+_.Nt-S.Ht-S.Nt;return T===0?_.Nt-S.Nt:T}),f=function(_,S,T){var P;const M=1/Math.max(S,T),$=S-T;let R=[0],j=new Int16Array(_.length);j[0]=-1;let I=_[0],k=I.end-I.Ht,E=I.end-I.Nt,N=I.Ht-I.Nt,V=Math.min(T-E,S-I.end),F=[k],H=[E],K=[V],D=_[0],B=0,Y=_[B],q=k,G=0;for(let ut=1;ut<_.length;ut++){if(I=_[ut],k=I.end-I.Ht,E=I.end-I.Nt,N=I.Ht-I.Nt,V=I.Nt<$?T-E:S-I.end,G===20){G=0;let xt=[],wt=R.length-1,ht=H[wt],Q=S-I.Ht;for(;wt--;)H[wt]>ht?xt.push(wt):(ht=H[wt],F[wt]+Math.min(K[wt],Q)<q&&xt.push(wt));xt.forEach(zt=>{R.splice(zt,1),F.splice(zt,1),H.splice(zt,1),K.splice(zt,1)})}if(I.Nt>=D.Nt&&E<H[0]){if(k+V<q)continue;if(j[ut]=-1,D=_[ut],G++,k<F[0]){R.unshift(ut),F.unshift(k),H.unshift(E),K.unshift(V);continue}k>q&&(q=k),R[0]=ut,F[0]=k,H[0]=E,K[0]=V}else{for(let xt=R.length-1;xt>=0;xt--)if(B=R[xt],Y=_[B],I.Ht>=Y.end&&H[xt]<N){const wt=Math.abs(I.Nt-B)*M,ht=F[xt]+k-wt;if(ht+V<q)continue;let Q=xt;for(;Q<R.length&&F[Q]<ht;)Q++;if(Q===R.length)q=ht,K.push(V),F.push(ht),H.push(E),R.push(ut);else{if(E>=H[H.length-1])continue;K.splice(Q,0,V),F.splice(Q,0,ht),H.splice(Q,0,E),R.splice(Q,0,ut)}j[ut]=B,G++;break}k>q&&(j[ut]=-1,q=k,K.push(V),F.push(k),H.push(E),R.push(ut),G++)}}let Z=[],it=(P=R.pop())!==null&&P!==void 0?P:0,nt=it;for(;it>-1&&nt>-1;)Z.push(it),it=j[it],nt--;let Ot=[];for(let ut=Z.length-1;ut>=0;ut--)Ot.push(_[Z[ut]]);return Ot}(f,t.V.length,e.V.length);let p={Nt:0,Ht:0,end:0},m=[p],x=[];for(let _=0;_<f.length;_++){let S=f[_];if(S.Nt!==p.Nt){let T=p.end,P=T-p.Nt;for(;t.V[T]===e.V[P]&&T<S.Ht&&P<S.Ht-S.Nt;)T++,P++;for(p.end=T,T=S.Ht,P=T-S.Nt;t.V[T]===e.V[P]&&T>p.end&&P>p.end-p.Nt;)T--,P--;S.Ht=T+1,x.push({$t:S.Nt,kt:p.Nt,Ht:p.end,end:S.Ht}),m.push(S),p=S}else{let T=p.end,P=T-S.Nt,M=0;for(;T<S.Ht&&P<S.Ht-S.Nt&&M<2;)T+=8,P+=8,M=qo(a[T],d[P])<=2?0:M+1;for(T>p.end&&(p.end=Math.max(T-2-8,p.end)),T=S.Ht-8,P=T-S.Nt,M=0;T>p.end&&P>p.end-p.Nt&&M<2;)T-=8,P-=8,M=qo(a[T],d[P])<=2?0:M+1;if(T<S.Ht-16&&(S.Ht=T+24+2),S.Ht-p.end<=24){p.end=S.end;continue}x.push({kt:p.Nt,$t:S.Nt,Ht:p.end,end:S.Ht}),m.push(S),p=S}}let y=m[0];const g=[],v=[];for(let _=0;_<m.length;_++){y=m[_],g.push(y.end-y.Ht),v.push(y.end-y.Ht);let S=x[_];if(S){if(S.Ht===S.end){const P=Math.abs(S.$t-S.kt);g.push(-P),v.push(P);continue}if(S.Ht-S.kt==S.end-S.$t){const P=S.end-S.Ht;v.push(-P),g.push(P);continue}let T=ri({Tt:t.Tt.substring(S.Ht,S.end),type:t.type,V:t.V.subarray(S.Ht,S.end)},{Tt:e.Tt.substring(S.Ht-S.kt,S.end-S.$t),type:e.type,V:e.V.subarray(S.Ht-S.kt,S.end-S.$t)},n,3);g.push(...T.j[0]),v.push(...T.j[1])}}Uo(g,t.V.length),Uo(v,e.V.length);let w=Ne(g,1),b=Ne(v,1);const C=hs(w),A=hs(b);return C>A?b=Wo(b,[A-C]):C<A&&(w=Wo(w,[C-A])),[w,b]}function Uo(t,e){let n=e-function(r){let i=0,s=0;for(let o=0;o<r.length;o++)s=r[o],s<0||(i+=s);return i}(t);n>0?t.push(n):n<0&&(t[t.length-1]+=n)}function qo(t,e){let n=t^e;return n=1431655765&n|n>>1&1431655765,tr(n)}const Go={Vt:"auto",gapchar:"-",Wt:"auto",debug:!1},fh=new class{constructor(){this.jt=[],this.Kt=2,this.Yt=Object.assign({},Go)}Jt(t){if(Array.isArray(t))t.forEach(e=>{this.Jt(e)});else{if(typeof t!="string")throw new TypeError("String type expected for sequences to add.");if(t=t.toUpperCase(),this.Yt.Vt==="auto"){const e=Vo(t);if(this.Kt===2)this.Kt=e;else if(this.Kt!==e)throw Error("All sequences must be of same type.")}this.jt.push(function(e,n){const r=n??Vo(e),i=function(s,o){const a=new Uint8Array(s.length),c=o===0?pt:tn;let l=0;for(let d=0,h=s.length;d<h;d++)l=c[s.charCodeAt(d)],l===255&&(l=nh(s[d],o)),a[d]=l;return a}(e,r);return{Tt:e,V:i,zt:r===0?rh(i):i,type:r}}(t,this.Kt))}}reset(){this.jt=[],this.Kt=2,this.Lt()}Lt(){this.Yt=Object.assign({},Go)}Qt(t){var e;function n(r,i){return i.some(s=>s==r)}t.method&&n(t.method,["complete","diag"])&&(this.Yt.Wt=t.method),t.type&&n(t.type,["amino","nucleic"])&&(this.Yt.Vt=t.type,this.Kt=t.type==="amino"?0:1),((e=t.gapchar)===null||e===void 0?void 0:e.length)===1&&(this.Yt.gapchar=t.gapchar),t.debug!==void 0&&(this.Yt.debug=!!t.debug)}align(t,e){return new Promise((r,i)=>{if(!Array.isArray(t)||t.some(l=>typeof l!="string"))return i("Array of sequences expected");if(t.length<2)return i("At least 2 sequences are required.");this.reset(),e&&this.Qt(e),this.Jt(t);const s=function(l,d){var h,f;const p=l===0?Gd:Kd;let m=(h=d==null?void 0:d.matrix)!==null&&h!==void 0?h:p.matrix,x=d!=null&&d.gapextend?2*-d.gapextend:p.H;var y;return{type:l,W:(y=x,m.map(g=>g.map(v=>v+y))),$:(f=d==null?void 0:d.gapopen)!==null&&f!==void 0?f:p.$,dt:l===0?20:4}}(this.Kt,e);let o,a=!1;a=this.Yt.Wt==="auto"?this.jt.some(l=>l.Tt.length>1600):this.Yt.Wt==="diag",o=this.jt.length==2?a?Yo(this.jt[0],this.jt[1],s):ri(this.jt[0],this.jt[1],s).j:a?function(l,d){let h=l.map(x=>ps(x,8,24)),f=[],p=[],m=[];for(let x=0;x<h.length;x++){if(x===0)continue;let y=Yo(l[0],l[x],d,h[0],h[x]);p=p.length===0?y[0]:oh(p,y[0]),m[x]=y[0],f[x]=y[1]}for(let x=0;x<h.length;x++){if(x===0){f[x]=p;continue}let y=ah(p,m[x]);if(!y)throw console.error("An error occured while computing the center diff. for sequence #"+x,p,m[x]),console.dir(f),console.dir(m),new RangeError;f[x]=Dr(y,f[x])}return f}(this.jt,s):function(l,d){const h=(x,y)=>{const g=f[x.wt],v=f[x.At];let w={};if(wn(g)||g.St.length!==0||h(g,y),wn(v)||v.St.length!==0||h(v,y),wn(g))if(wn(v)){const b=ri(g.gt,v.gt,d);w.K=b.K,x.Ut=[g.Ut[0],v.Ut[0]],x.yt=b.j,x.profile=Wi(g.profile,v.profile,b.j[0],b.j[1],d)}else{v.qt=v.Ut.map(C=>y[C]);const b=function(C,A,_,S=0){const T=A.gt,P=A.weight,M=T.Tt.length,$=C.profile.length;let R=0,j=[],I=[];const k=new Uint8Array(Math.ceil(($+1)*(M+1)/2)+1);let E,N,V,F=0,H=0,K=0,D=0,B=0,Y=0,q=0,G=0,Z=0,it=0,nt=0,Ot=0,ut=0;const xt=_.$*P,wt=xt/2,ht=xt/2,Q=1&S?0:-xt/4,zt=2&S?0:-xt/4,Qe=T.V,Pt=C.profile;j[0]=0,I[0]=-1/0;for(let X=1;X<=M;X++)j[X]=wt+ht+Q,I[X]=-1/0;for(let X=1;X<=$;X++){Ot=Pt.st[X-1],ut=Pt.ot[X-1],V=Pt.tt.subarray((X-1)*_.dt,X*_.dt),Z=Q,Y=-1/0,I[0]=Pt.st[0];for(let et=1;et<=M;et++)B=0,F=j[et]+Ot,K=G=I[et],et===M&&(F-=Ot/2),F>=K?I[et]=F:B+=1,H=Z+wt,D=q=Y,X===$&&(H+=zt),H>=D?Y=H:B+=2,it=G+ut,nt=q+ht,R=j[et-1]+V[Qe[et-1]],et===M&&(nt+=zt),j[et-1]=Z,R>=nt?R>=it?Z=R:(Z=it,B+=4):nt>=it?(Z=nt,B+=8):(Z=it,B+=4),E=X*M+et,N=E%2,E>>>=1,k[E]+=N?B:B<<4;j[M]=Z}const se=Math.max(R,Y,I[I.length-2]),[z,W]=fs(k,$,M,B);return{j:[Ne(z),Ne(W)],K:se}}(v,g,d);w.K=b.K,x.Ut=[g.Ut[0],...v.Ut],x.yt=[b.j[1],...v.yt.map(C=>Dr(b.j[0],C))],x.profile=Wi(g.profile,v.profile,b.j[1],b.j[0],d)}else if(!wn(v)){v.qt=v.Ut.map(C=>y[C]),g.qt=g.Ut.map(C=>y[C]);const b=function(C,A,_,S=0){const T=C.profile.length,P=A.profile.length,M=new Uint8Array(Math.ceil((T+1)*(P+1)/2)+1);let $,R,j=[],I=[],k=0,E=0,N=0,V=0,F=0,H=0,K=0,D=0,B=0,Y=0,q=0,G=0,Z=0,it=0,nt=new Float32Array(_.dt),Ot=new Uint8Array(_.dt),ut=0,xt=0,wt=0,ht=0,Q=0,zt=0;const Qe=1&S?1:2,Pt=A.profile,se=C.profile;for(j[0]=0,I[0]=-1/0,Q=1;Q<=P;Q++)j[Q]=Pt.st[0]+Pt.ot[Q-1]/Qe,I[Q]=-1/0;const z=se.st[0];for(ht=1;ht<=T;ht++){for(nt=se.tt.subarray(_.dt*(ht-1),_.dt*ht),Z=se.st[ht-1],it=se.ot[ht-1],B=z+it/Qe,K=-1/0,I[0]=se.st[0],Q=1;Q<=P;Q++){for(H=0,E=j[Q]+Z,V=Y=I[Q],Q!==P||2&S||(E-=Z/2),E>=V?I[Q]=E:H+=1,N=B+Pt.st[Q-1],F=D=K,ht!==T||2&S||(N-=Pt.st[Q-1]/2),N>=F?K=N:H+=2,k=j[Q-1],wt=Pt.et[Q-1],zt=0,xt=(Q-1)*_.dt,Ot=Pt.L.subarray(xt,xt+wt);zt<wt;)ut=Ot[zt],k+=nt[ut],zt++;q=Y+it,G=D+Pt.ot[Q-1],Q!==1||2&S||(q-=it/2),Q!==P||2&S||(q-=it/2,G-=Pt.ot[P-1]/2),j[Q-1]=B,k>=G?k>=q?B=k:(B=q,H+=4):G>=q?(B=G,H+=8):(B=q,H+=4),$=ht*P+Q,R=$%2,$>>>=1,M[$]+=R?H:H<<4}j[P]=B}const W=Math.max(k,K,I[Q-1]),[X,et]=fs(M,T,P,H);return{j:[Ne(X),Ne(et)],K:W}}(g,v,d);w.K=b.K,x.yt=[...g.yt.map(C=>Dr(b.j[0],C)),...v.yt.map(C=>Dr(b.j[1],C))],x.profile=Wi(g.profile,v.profile,b.j[0],b.j[1],d)}return x.Ut=[...g.Ut,...v.Ut],w.K},f=function(x,y){let g,v,w,b=[],C=x.length,A=[];for(let _=0;_<C;_++)b[_]={type:0,gt:y[_],profile:null,wt:_,At:_,Mt:0,Ut:[_],St:[],id:_.toString(),weight:0,parent:-1,_t:0},A[_]=_;for(let _=0,S=C-1;_<S;_++){[g,v,w]=uh(x,A);const T=b[g.wt],P=b[g.At];g.id=T.id<P.id?`|${T.id},${P.id}|`:`|${P.id},${T.id}|`,g._t=Math.max(T._t,P._t)+1,P.parent=T.parent=b.length,A.push(C+_),b.push(g),x=dh(x,v,w,A)}return b[b.length-1].type=2,b}(function(x){const y=x[0].type===0,g=y?6:4,v=Math.pow(g,6),w=x.map(R=>{const j=new fr(v),I=y?R.zt:R.V;let k=0;for(let N=0;N<6;N++)k+=I[N]*Math.pow(g,N);j.set(k);const E=Math.pow(g,5);for(let N=6,V=I.length;N<V;N++)k-=I[N-6],k/=g,k+=I[N]*E,j.set(k);return j}),b=x.length,C=x.map(()=>[]);let A,_,S,T,P,M,$;for(let R=0;R<b;R++){C[R][R]=0,A=w[R],S=A.P(),M=1/(-Math.LN2/Math.log(1-S/v)*2);for(let j=R+1;j<b;j++)T=w[j].P(),P=A.D(w[j]),P+=v-(S+T-P),$=Math.ceil(M*T),P-=$,P=Math.max(P,0),_=1-P/(v-$),C[j][R]=C[R][j]=_}return C}(l),l),p=f[f.length-1],m=function(x){let y=0;return function g(v){let w=0,b=0;switch(v.type){case 2:v.weight=0,g(x[v.wt]),g(x[v.At]);break;case 1:w=x[v.parent].Mt-v.Mt,b=v.id.split(",").length,v.weight=x[v.parent].weight+w/b,g(x[v.wt]),g(x[v.At]);break;case 0:w=x[v.parent].Mt,v.weight=x[v.parent].weight+w,y+=v.weight}}(x[x.length-1]),x.map(g=>g.weight)}(f);return function(x,y,g){let v=0,w=x[v];for(;wn(w)&&v<x.length;)w.profile=ch(w.gt,w.weight,y,void 0),v++,w=x[v]}(f,d),h(p,m),function(x,y){let g=y.slice();return y.forEach((v,w)=>g[v]=w),g.map(v=>x[v])}(p.yt.slice(),p.Ut)}(this.jt,s);const c=function(l,d,h){var f;let p=(f=h==null?void 0:h.gapchar)!==null&&f!==void 0?f:"-",m=[];for(let x=0;x<l.length;x++)m.push(sh(l[x].Tt,d[x],{gapchar:p}));return m}(this.jt,o,{gapchar:this.Yt.gapchar});return r(c)}).catch(r=>Promise.reject(r))}},Ml={A:{A:10,R:-1,N:0,D:-1,C:-1,Q:-1,E:-1,G:1,H:-2,I:0,L:-1,K:-1,M:-1,F:-3,P:1,S:1,T:2,W:-4,Y:-3,V:1,B:0,Z:-1,X:0,"-":0},R:{A:-1,R:10,N:0,D:-1,C:-1,Q:2,E:0,G:0,H:2,I:-3,L:-3,K:4,M:-2,F:-4,P:-1,S:-1,T:-1,W:0,Y:-2,V:-3,B:0,Z:1,X:0,"-":0},N:{A:0,R:0,N:10,D:2,C:-1,Q:0,E:1,G:0,H:1,I:-2,L:-3,K:1,M:-2,F:-3,P:-1,S:1,T:1,W:-4,Y:-1,V:-2,B:2,Z:0,X:0,"-":0},D:{A:-1,R:-1,N:2,D:10,C:-3,Q:0,E:4,G:1,H:0,I:-3,L:-4,K:0,M:-3,F:-5,P:-2,S:0,T:-1,W:-5,Y:-2,V:-3,B:3,Z:2,X:0,"-":0},C:{A:-1,R:-1,N:-1,D:-3,C:10,Q:-3,E:-4,G:-1,H:0,I:-2,L:-3,K:-3,M:-2,F:0,P:-2,S:1,T:-1,W:1,Y:2,V:-2,B:-2,Z:-3,X:0,"-":0},Q:{A:-1,R:2,N:0,D:0,C:-3,Q:10,E:2,G:-1,H:3,I:-3,L:-2,K:2,M:-2,F:-4,P:0,S:-1,T:-1,W:-3,Y:-1,V:-3,B:0,Z:3,X:0,"-":0},E:{A:-1,R:0,N:1,D:4,C:-4,Q:2,E:10,G:1,H:0,I:-3,L:-4,K:1,M:-3,F:-5,P:-2,S:-1,T:-1,W:-5,Y:-4,V:-2,B:2,Z:3,X:0,"-":0},G:{A:1,R:0,N:0,D:1,C:-1,Q:-1,E:1,G:10,H:-2,I:-3,L:-4,K:-1,M:-3,F:-5,P:-1,S:1,T:0,W:-2,Y:-4,V:-2,B:0,Z:0,X:0,"-":0},H:{A:-2,R:2,N:1,D:0,C:0,Q:3,E:0,G:-2,H:10,I:-3,L:-2,K:1,M:-2,F:0,P:0,S:-1,T:-1,W:-3,Y:4,V:-3,B:0,Z:1,X:0,"-":0},I:{A:0,R:-3,N:-2,D:-3,C:-2,Q:-3,E:-3,G:-3,H:-3,I:10,L:2,K:-3,M:3,F:0,P:-2,S:-1,T:1,W:-4,Y:-2,V:4,B:-2,Z:-3,X:0,"-":0},L:{A:-1,R:-3,N:-3,D:-4,C:-3,Q:-2,E:-4,G:-4,H:-2,I:2,L:10,K:-3,M:3,F:2,P:0,S:-2,T:-1,W:-2,Y:-1,V:2,B:-3,Z:-3,X:0,"-":0},K:{A:-1,R:4,N:1,D:0,C:-3,Q:2,E:1,G:-1,H:1,I:-3,L:-3,K:10,M:-2,F:-5,P:-2,S:-1,T:-1,W:-3,Y:-3,V:-3,B:0,Z:1,X:0,"-":0},M:{A:-1,R:-2,N:-2,D:-3,C:-2,Q:-2,E:-3,G:-3,H:-2,I:3,L:3,K:-2,M:10,F:0,P:-2,S:-1,T:0,W:-3,Y:-3,V:2,B:-2,Z:-2,X:0,"-":0},F:{A:-3,R:-4,N:-3,D:-5,C:0,Q:-4,E:-5,G:-5,H:0,I:0,L:2,K:-5,M:0,F:10,P:-2,S:-2,T:-2,W:-1,Y:5,V:0,B:-4,Z:-4,X:0,"-":0},P:{A:1,R:-1,N:-1,D:-2,C:-2,Q:0,E:-2,G:-1,H:0,I:-2,L:0,K:-2,M:-2,F:-2,P:10,S:1,T:1,W:-5,Y:-3,V:-1,B:-1,Z:-1,X:0,"-":0},S:{A:1,R:-1,N:1,D:0,C:1,Q:-1,E:-1,G:1,H:-1,I:-1,L:-2,K:-1,M:-1,F:-2,P:1,S:10,T:1,W:-3,Y:-1,V:-1,B:0,Z:-1,X:0,"-":0},T:{A:2,R:-1,N:1,D:-1,C:-1,Q:-1,E:-1,G:0,H:-1,I:1,L:-1,K:-1,M:0,F:-2,P:1,S:1,T:10,W:-4,Y:-3,V:0,B:0,Z:-1,X:0,"-":0},W:{A:-4,R:0,N:-4,D:-5,C:1,Q:-3,E:-5,G:-2,H:-3,I:-4,L:-2,K:-3,M:-3,F:-1,P:-5,S:-3,T:-4,W:10,Y:0,V:-4,B:-4,Z:-4,X:0,"-":0},Y:{A:-3,R:-2,N:-1,D:-2,C:2,Q:-1,E:-4,G:-4,H:4,I:-2,L:-1,K:-3,M:-3,F:5,P:-3,S:-1,T:-3,W:0,Y:10,V:-3,B:-1,Z:-2,X:0,"-":0},V:{A:1,R:-3,N:-2,D:-3,C:-2,Q:-3,E:-2,G:-2,H:-3,I:4,L:2,K:-3,M:2,F:0,P:-1,S:-1,T:0,W:-4,Y:-3,V:10,B:-2,Z:-2,X:0,"-":0},B:{A:0,R:0,N:2,D:3,C:-2,Q:0,E:2,G:0,H:0,I:-2,L:-3,K:0,M:-2,F:-4,P:-1,S:0,T:0,W:-4,Y:-1,V:-2,B:10,Z:1,X:0,"-":0},Z:{A:-1,R:1,N:0,D:2,C:-3,Q:3,E:3,G:0,H:1,I:-3,L:-3,K:1,M:-2,F:-4,P:-1,S:-1,T:-1,W:-4,Y:-2,V:-2,B:1,Z:10,X:0,"-":0},X:{A:0,R:0,N:0,D:0,C:0,Q:0,E:0,G:0,H:0,I:0,L:0,K:0,M:0,F:0,P:0,S:0,T:0,W:0,Y:0,V:0,B:0,Z:0,X:1,"-":0},"-":{A:0,R:0,N:0,D:0,C:0,Q:0,E:0,G:0,H:0,I:0,L:0,K:0,M:0,F:0,P:0,S:0,T:0,W:0,Y:0,V:0,B:0,Z:0,X:0,"-":1}},Al=Object.values(Ml).map(t=>Object.values(t)),Ko=Math.min(...Al.flat()),ph=Math.max(...Al.flat());function El(t,e){return t==="-"||e==="-"?0:(Ml[t][e]-Ko)/(ph-Ko)}function mh(t,e){const n=Array.from(t),r=Array.from(e),i=[];for(let a=0;a<n.length;a++)n[a]==="-"||r[a]==="-"||i.push(a);const s=i.length;let o=0;for(const a of i)o+=El(n[a],r[a]);return 1-o/s}function Zo(t,e){let n=0;for(const r of e)n+=mh(t,r);return n/(e.length-1)}function gh(t){const e=t[0].length,n=Array.from({length:e},()=>0);let r=0;for(let s=0;s<t.length;s++){const o=Zo(t[s],t);for(let a=s+1;a<t.length;a++){const c=Zo(t[a],t);for(let l=0;l<e;l++)n[l]+=o*c*El(t[s][l],t[a][l]);r+=o*c}}return n.map(s=>s/r)}function*xh(...t){if(t.length===0)return;const e=t.map(r=>r[Symbol.iterator]()),n=e.map(r=>r.next());for(let r=0;;){if(n[r].done){if(e[r]=t[r][Symbol.iterator](),n[r]=e[r].next(),++r>=e.length)return}else yield n.map(({value:i})=>i),r=0;n[r]=e[r].next()}}const yh=t=>t.reduce((e,n)=>e+n,0)/t.length,vh=(...t)=>{const e=Math.max(...t.map(n=>n.length));return Array.from(Array(e)).map((n,r)=>t.map(i=>i[r]))};function bh(t){const e=[],n=[];let r=0;return Array.from(t).forEach((i,s)=>{i==="-"?n.push(-1):(e.push(s),n.push(r),++r)}),{alignedSequence:t,toReference:e,fromReference:n}}function Rl(t,e){let r=gh(t);return r.every(i=>Number.isNaN(i))&&(r=vh(...t.map(i=>Array.from(i))).map(i=>new Set(i).values().map(s=>i.filter(o=>o===s).length).toArray().toSorted((s,o)=>o-s)[0]/i.length)),{consensus:void 0,conservationScores:r,alignments:t.map(i=>bh(i))}}async function wh(t,e){const n=await fh.align(t,{type:"amino"});return Rl(n)}const Qs=(t,e,n=0,r=!1)=>{const i=new Set,s=new Set,o=new Set;for(const[a,c]of t){if(r&&s.size>0)break;const l=(a==="ntd"?1:a)+n-1;if(l<0||l>=e.length){o.add(a);continue}if(e[l]==="-"){o.add(a);continue}a==="ntd"&&n===0||a!=="ntd"&&(c===void 0||e[l]===c)?i.add(a):s.add(a)}return{success:i.size>0&&s.size===0,mappedPositions:i,mismatchedPositions:s,unmappedPositions:o}},$l=t=>{const e=t.keys().map(n=>n==="ntd"?1:n).toArray();return[Math.min(...e),Math.max(...e)]},jh=(t,e)=>{const n=[],[r,i]=$l(t);for(let s=(i-1)*-1;s<=e-r;s+=1)n.push(s);return n},_h=(t,e)=>{let n=new Map;for(const r of jh(e,t.length)){const{success:i,mappedPositions:s}=Qs(e,t,r,!0);i&&n.set(r,s)}return n.entries().map(([r,i])=>({offset:r,mappedPositions:i})).toArray().toSorted((r,i)=>i.mappedPositions.size-r.mappedPositions.size)};async function Ol(t,e,n){const{alignments:r,conservationScores:i}=n?Rl(n):await wh([t,e.replaceAll("-","X")]),s=r[0].toReference,o=r[1].fromReference;return{alignedSequences:r.map(({alignedSequence:a})=>a),alignmentOffsets:s.map(a=>o[a]),scores:i}}const Js=({linkPositionToAminoAcid:t,peptides:e})=>new Map([...Object.entries(t??{}).map(([n,r])=>[n==="ntd"?"ntd":Number.parseInt(n),r]),...(e??[]).flatMap(({position:n,sequence:r})=>Array.from(r).map((i,s)=>[n+s,i]))]);async function Sh(t,{sequence:e,...n},r){if(e){const{alignmentOffsets:i,scores:s,alignedSequences:o}=await Ol(e,t.sequence,r?[r[1],r[0]]:void 0),a=new Map(Array.from(Array(e.length)).map((l,d)=>[d+1,i[d]!==-1?t.startPosition+i[d]:void 0]));a.set("ntd",i[0]===0?t.startPosition:void 0);const c=a.entries().filter(([l,d])=>d!==void 0&&(l==="ntd"?a.get("ntd")!==void 0:e[l]===t.sequence[d-t.startPosition+1])).toArray().length;return{proteinPosToChainPos:a,alignedSequences:{chain:o[1],protein:o[0]},alignmentScore:yh(s),hits:c,relativeHits:c/e.length}}else{const i=Js(n),s=_h(t.sequence,i);if(s.length===0)return;const{mappedPositions:o,offset:a}=s[0],c=new Map(i.keys().map(d=>[d,o.has(d)?d==="ntd"?t.startPosition:t.startPosition+a+d-1:void 0])),l=o.size;return{proteinPosToChainPos:c,hits:l,relativeHits:l/i.size}}}function Ch(t){const e=t.filter(({alignmentScore:n,hits:r,relativeHits:i})=>{if(n&&n<.2||i<.2)return!1;const s=r/i;return!(r<Math.min(s/10,5))}).toSorted((n,r)=>r.relativeHits!==n.relativeHits?r.relativeHits-n.relativeHits:(r.alignmentScore??0)-(n.alignmentScore??0));return e.length>0?e[0]:void 0}const kh={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"};function Ih(t){return kh[t]||"X"}const Ph=(t,e)=>{const n=e.x-t.x,r=e.y-t.y,i=e.z-t.z;return Math.sqrt(n*n+r*r+i*i)};function*Ci(t,e,n,r){const i=a=>{const c=[];for(const{id:l,residues:d}of e)for(const[h,f]of Object.entries(n[l])){if(h!==a.proteinId)continue;const p=f==null?void 0:f.get(a.linkPosition);if(p===void 0||!d[p])continue;const m=Ih(d[p].name);if(r&&a.linkPosition!=="ntd"&&a.aminoAcid!==void 0&&m!==a.aminoAcid)continue;const x=d[p].atoms.CA;if(!x){console.warn(`CA is missing in /${l}:${p}`);continue}c.push({chainId:l,position:p,aminoAcid:m,atom:x})}return c},s=i(t.from),o=i(t.to);if(!(s.length===0||o.length===0))for(const[{atom:a,...c},{atom:l,...d}]of xh(s,o))c.chainId===d.chainId&&(c.position===d.position||t.homoMultimeric)||(yield{from:c,to:d,distance:Ph(a,l)})}const Th=`import json
from collections import defaultdict


def list_models():
    data = json.loads('%%data%%')

    for model in session.models:
        if not hasattr(model, 'find_residue'):
            continue

        groups = defaultdict(list)
        for group, chain1, pos1, chain2, pos2 in data:
            res1 = model.find_residue(chain1, pos1)
            if res1 is None:
                break
            atom1 = res1.find_atom('CA')
            if atom1 is None:
                break

            res2 = model.find_residue(chain2, pos2)
            if res2 is None:
                break
            atom2 = res2.find_atom('CA')
            if atom2 is None:
                break

            groups[group].append((atom1, atom2))
        else:
            yield model, groups


for model, groups in list(list_models()):
    pbond_groups = []
    for group_name, atom_pairs in groups.items():
        group = session.pb_manager.get_group(group_name)
        for atom1, atom2 in atom_pairs:
            bond = group.new_pseudobond(atom1, atom2)
            bond.radius = 0.8
            if group_name == '%%under%%':
                bond.color =  [243, 168, 59, 255]
            elif group_name == '%%ok%%':
                bond.color = [55, 125, 34, 255]
            elif group_name == '%%over%%':
                bond.color = [235, 50, 35, 255]
        pbond_groups.append(group)
    session.models.add_group(pbond_groups, name='%%experiment_name%%', parent=model)
`,Mh=`import json
from collections import defaultdict


EXPERIMENT_NAME = cmd.get_legal_name('%%experiment_name%%')
UNDER_NAME = cmd.get_legal_name('%%under%%')
OK_NAME = cmd.get_legal_name('%%ok%%')
OVER_NAME = cmd.get_legal_name('%%over%%')


def get_atom_id(model, chain, pos):
    try:
        return cmd.id_atom(f'{model}/{chain}//{pos}/CA')
    except:
        return None


def list_models():
    data = json.loads('%%data%%')

    for model in cmd.get_object_list():
        groups = defaultdict(list)
        for group, chain1, pos1, chain2, pos2 in data:
            atom1 = get_atom_id(model, chain1, pos1)
            if atom1 is None:
                break

            atom2 = get_atom_id(model, chain2, pos2)
            if atom2 is None:
                break

            groups[cmd.get_legal_name(group)].append((atom1, atom2))
        else:
            yield model, groups


for model, groups in list(list_models()):
    cmd.group(f'{model}-xlinkup')
    cmd.group(f'{model}-xlinkup.{EXPERIMENT_NAME}')
    for group_name, atom_pairs in groups.items():
        name = f'{model}-xlinkup.{EXPERIMENT_NAME}.{group_name}'
        for atom1, atom2 in atom_pairs:
            cmd.distance(name, f'id {atom1}', f'id {atom2}')

        if group_name == UNDER_NAME:
            cmd.color('brightorange', name)
        elif group_name == OK_NAME:
            cmd.color('green', name)
        elif group_name == OVER_NAME:
            cmd.color('red', name)
`,ms=(t,{startPosition:e,endPosition:n})=>{if(t===void 0)return!1;const r=t==="ntd"?1:t;return e<=r&&r<=n},ii=(t,e)=>t!==void 0?e==null?void 0:e.find(n=>ms(t,n)):void 0,pr=(t,e)=>{const n=d=>{const h=e[d.proteinId].sequence;if(d.linkPosition!=="ntd")return d.linkPosition!==void 0&&h?h[d.linkPosition-1]:d.aminoAcid},r=d=>`${e[d].name}${d}`,i=d=>(d==null?void 0:d.startPosition.toString().padStart(5,"0"))??"XXXXX",s={},o=({from:d,to:h})=>{const f=ii(d.linkPosition,e[d.proteinId].domains),p=ii(h.linkPosition,e[h.proteinId].domains),m=`${r(d.proteinId)}${i(f)}:${r(h.proteinId)}${i(p)}`;return m in s||(s[m]={fromProteinId:d.proteinId,fromProteinName:e[d.proteinId].name,fromDomainName:f==null?void 0:f.name,toProteinId:h.proteinId,toProteinName:e[h.proteinId].name,toDomainName:p==null?void 0:p.name}),m},a={},c=({from:d,to:h})=>{const f=[d,h].map(({linkPosition:p})=>p===void 0?"XXXXX":(p==="ntd"?0:p).toString().padStart(5,"0")).join(";");return f in a||(a[f]={fromProteinId:d.proteinId,fromPosition:d.linkPosition,fromAminoAcid:n(d),toProteinId:h.proteinId,toPosition:h.linkPosition,toAminoAcid:n(h)}),f},l={};return t.forEach((d,h)=>d.forEach(f=>{const p=o(f),m=c(f);p in l?m in l[p]?h in l[p][m]||(l[p][m][h]=[]):l[p][m]={[h]:[]}:l[p]={[m]:{[h]:[]}},l[p][m][h].push(f)})),Object.entries(l).toSorted(([d,h],[f,p])=>d.localeCompare(f)).map(([d,h])=>({...s[d],rows:Object.entries(h).toSorted(([f],[p])=>f.localeCompare(p)).map(([f,p])=>({...a[f],ids:t.map((m,x)=>{var y;return((y=p[x])==null?void 0:y.toSorted((g,v)=>(v.score??0)-(g.score??0)).map(({id:g})=>g))??[]}),homoMultimeric:t.map((m,x)=>{var y;return((y=p[x])==null?void 0:y.toSorted((g,v)=>(v.score??0)-(g.score??0)).map(({homoMultimeric:g})=>g))??[]}),scores:t.map((m,x)=>{var y;return((y=p[x])==null?void 0:y.toSorted((g,v)=>(v.score??0)-(g.score??0)).map(({score:g})=>g))??[]})}))}))},zl=(t,e=!0)=>(Jr(t.length===0||t[0].rows[0].ids.length===1),t.flatMap(({rows:n})=>n.flatMap(({ids:r})=>r.flatMap(i=>e?i[0]:i.flat())))),oe=(t,{lower:e,upper:n})=>{let r;for(const i of t)if(e!==void 0&&i<e)r="under";else if(n!==void 0&&i>n)r!=="under"&&(r="over");else{r="ok";break}return r},Bn=(t,e,n)=>e.map(r=>r.loading?[]:Ci(t,r.chains,r.chainIdToProteinIdToMapping,n).map(({distance:i})=>i).toArray()),Dl=(t,e)=>{if(t.length===0)return;const n=oe(t,e),r=t.filter(i=>oe([i],e)===n);return r.reduce((i,s)=>i+s,0)/r.length},si=(t,e,n,r)=>Object.fromEntries(t.flatMap(i=>i.loading?[]:[[i.id,Object.fromEntries(e.filter(({from:s,to:o})=>s.linkPosition!==void 0&&o.linkPosition!==void 0).map(s=>[s.id,oe(Ci(s,i.chains,i.chainIdToProteinIdToMapping,n).map(({distance:o})=>o),r??{})]))]])),Ah=t=>{switch(t){case"chimerax":return Th;case"pymol":return Mh}},Eh=async(t,e="XLinkUp",n,r,i)=>{const s=r.map(({category:c,from:l,to:d})=>[(i==null?void 0:i[c])??c,l.chainId,l.position,d.chainId,d.position]),o=document.createElement("a"),a=new Blob([Ah(t).replaceAll("%%experiment_name%%",e).replaceAll("%%data%%",JSON.stringify(s)).replaceAll("%%under%%",(i==null?void 0:i.under)??"under").replaceAll("%%ok%%",(i==null?void 0:i.ok)??"ok").replaceAll("%%over%%",(i==null?void 0:i.over)??"over")],{type:"text/x-python"});o.href=URL.createObjectURL(a),o.download=`${e}-${n}-xlinks.${t}.py`,o.click()},Rh=(t,{from:e,to:n})=>{switch(t){case"chimerax":return`distance /${e.chainId}:${e.position}@ca /${n.chainId}:${n.position}@ca`;case"pymol":return`distance ${e.chainId}//${e.position}/CA, ${n.chainId}//${n.position}/CA`}},ki=(t,e)=>{const n=Object.fromEntries(t.map(({proteins:d},h)=>[h,Object.fromEntries(d.map(f=>[f.id,f]))])),r=Object.fromEntries(t.map(({proteins:d},h)=>[h,Object.fromEntries(d.map(f=>[f.id,"peptides"in f?f.peptides:void 0]))])),i=(d,h)=>{var f;return h.peptideIndex!==void 0?(f=r[d][h.proteinId])==null?void 0:f[h.peptideIndex]:void 0},s=[];if(e)for(const{ids:d}of e.flatMap(({rows:h})=>h))s.push(...t.flatMap((h,f)=>d[f].map(p=>[f,h.crosslinks.find(m=>m.id===p)])));else s.push(...t.flatMap((d,h)=>d.crosslinks.map(f=>[h,f])));const o=(d,h)=>{const f=n[d][h.proteinId].sequence;if(h.linkPosition!=="ntd")return h.linkPosition!==void 0&&f?f[h.linkPosition-1]:h.aminoAcid},a=["Experiment","id","Score","Protein1","AminoAcid1","Position1","PeptideSeq1","PeptidePos1","PositionInPeptide1","Protein2","AminoAcid2","Position2","PeptideSeq2","PeptidePos2","PositionInPeptide2"],c={Experiment:s.map(([d])=>t[d].name),id:s.map(([,{id:d}])=>d),Score:s.map(([,{score:d}])=>d),Protein1:s.map(([d,{from:h}])=>n[d][h.proteinId].name),AminoAcid1:s.map(([d,{from:h}])=>o(d,h)),Position1:s.map(([,{from:d}])=>d.linkPosition==="ntd"?0:d.linkPosition),PeptideSeq1:s.map(([d,{from:h}])=>{var f;return(f=i(d,h))==null?void 0:f.sequence}),PeptidePos1:s.map(([d,{from:h}])=>{var f;return(f=i(d,h))==null?void 0:f.position}),PositionInPeptide1:s.map(([,{from:d}])=>"linkPositionInPeptide"in d?d.linkPositionInPeptide:void 0),Protein2:s.map(([d,{to:h}])=>n[d][h.proteinId].name),AminoAcid2:s.map(([d,{to:h}])=>o(d,h)),Position2:s.map(([,{to:d}])=>d.linkPosition==="ntd"?0:d.linkPosition),PeptideSeq2:s.map(([d,{to:h}])=>{var f;return(f=i(d,h))==null?void 0:f.sequence}),PeptidePos2:s.map(([d,{to:h}])=>{var f;return(f=i(d,h))==null?void 0:f.position}),PositionInPeptide2:s.map(([,{to:d}])=>"linkPositionInPeptide"in d?d.linkPositionInPeptide:void 0)},l=a.filter(d=>c[d].some(h=>h!==void 0));return{headers:l,rows:s.map((d,h)=>l.map(f=>c[f][h]))}},$h=(t,e,n)=>{const r=ki([{...t,crosslinks:n}]),i=$u(e).toArray();return r.headers.push(...i.map(([s,o])=>s+o)),n.forEach((s,o)=>{for(const[a,c]of i){const l=s.pairs.find(({from:d,to:h})=>d.chainId===a&&h.chainId===c||d.chainId===c&&h.chainId===a);l?r.rows[o].push(l.distance):r.rows[o].push(void 0)}}),r},Ii=(t,e)=>{const n=document.createElement("a"),r=new Blob([t.headers.join(",")+`
`+t.rows.map(i=>i.join(",")).join(`
`)],{type:"text/csv"});n.href=URL.createObjectURL(r),n.download=`${e}.csv`,n.click()},ae=t=>{switch(t){case"under":return"orange";case"ok":return"green";case"over":return"red";default:return"rgb(161, 161, 170)"}},Oh=(t,e)=>t&&e?`Crosslink distance is between ${t} Å and ${e} Å`:t&&!e?`Crosslink distance is above ${t} Å`:!t&&e?`Crosslink distance is below ${e} Å`:"Crosslink appears in structure",zh=(t,e)=>{const i=[10,void 0,void 0,void 0];t||(i[1]=1),e||(i[3]=1);const s=(100-i.reduce((o,a)=>(o??0)+(a??0),0))/i.filter(o=>o===void 0).length;return i.map(o=>o??s)};let Ut;const Dh=rt(({thresholds:{lower:t,upper:e}={},experimentId:n,ref:r,...i})=>{const[s,o,a,c]=zh(!!t,!!e),l=10;return u.jsxs(jr,{gap:0,align:"stretch",ref:r,...i,children:[u.jsxs(lt,{h:5,children:[u.jsx(Oe,{content:"Crosslink does not appear in structure",openDelay:200,children:u.jsx(At,{bg:ae(void 0),w:`${s}%`,borderLeftRadius:"md"})}),u.jsx(Oe,{content:`Crosslink distance is below ${t} Å`,openDelay:200,disabled:!t,children:u.jsx(At,{bg:ae("under"),w:`${o}%`})}),u.jsx(Oe,{content:Oh(t,e),openDelay:200,children:u.jsx(At,{bg:ae("ok"),w:`${a}%`})}),u.jsx(Oe,{content:`Crosslink distance is above ${e} Å`,openDelay:200,disabled:!e,children:u.jsx(At,{bg:ae("over"),w:`${c}%`,borderRightRadius:"md"})})]}),u.jsxs(lt,{children:[u.jsx(At,{w:`${s+o-l/2}%`}),u.jsx(Oe,{content:"Lower threshold",children:u.jsx(Bo,{value:t,onChange:d=>{if(Ut=or(Ut),!d){zr(n,{lower:void 0,upper:e});return}return d<=0?(Ut=jt(Ut,{type:"error",title:"Lower threshold must be positive"}),t):e&&d>=e?(Ut=jt(Ut,{type:"error",title:"Lower threshold must be below the upper threshold"}),t):(zr(n,{lower:d,upper:e}),d)},w:`${l}%`})}),u.jsx(At,{flexGrow:1}),u.jsx(Oe,{content:"Upper threshold",children:u.jsx(Bo,{value:e,onChange:d=>{if(Ut=or(Ut),!d){zr(n,{lower:t,upper:void 0});return}return d<=0?(Ut=jt(Ut,{type:"error",title:"Upper threshold must be positive"}),t):t&&d<=t?(Ut=jt(Ut,{type:"error",title:"Upper threshold must be above the lower threshold"}),e):(zr(n,{lower:t,upper:d}),d)},w:`${l}%`})}),u.jsx(At,{w:`${c-l/2}%`})]})]})}),Ir=({name:t,onRename:e,center:n=!1,disabled:r=!1,autoResize:i=!1,ref:s,...o})=>{const a=wi({defaultValue:t,disabled:r,autoResize:i,onValueCommit:({value:c})=>{const l=c.trim()===""?void 0:c.trim();l?(e(l),a.setValue(l)):a.setValue(t)}});return u.jsx(ne.RootProvider,{value:a,ref:s,...o,children:u.jsxs(ne.Area,{w:i?void 0:"full",children:[u.jsx(ne.Preview,{width:"full",justifyContent:n?"center":void 0}),u.jsx(ne.Input,{textAlign:n?"center":void 0,focusRing:"none",borderBottomWidth:"1px",borderBottomColor:"border",borderRadius:0,_focusVisible:{borderColor:"var(--focus-color)",boxShadow:"0px 1px 0px 0px var(--focus-color)"}})]})})},mr=vt.forwardRef(function(e,n){const{icon:r,children:i,inputProps:s,rootRef:o,...a}=e;return u.jsxs(Xn.Root,{ref:o,...a,children:[u.jsx(Xn.HiddenInput,{ref:n,...s}),u.jsx(Xn.Control,{children:r||u.jsx(Xn.Indicator,{})}),i!=null&&u.jsx(Xn.Label,{children:i})]})});function Nh(t){return Nn({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},child:[]}]})(t)}const Nl=_t(function(e,n){const{showArrow:r,children:i,portalled:s=!0,content:o,portalRef:a,...c}=e;return u.jsxs(dt.Root,{...c,positioning:{...c.positioning,gutter:4},children:[u.jsx(dt.Trigger,{asChild:!0,children:i}),u.jsx(pn,{disabled:!s,container:a,children:u.jsx(dt.Positioner,{children:u.jsxs(dt.Content,{width:"auto",px:"2",py:"1",textStyle:"xs",rounded:"sm",ref:n,children:[r&&u.jsx(dt.Arrow,{children:u.jsx(dt.ArrowTip,{})}),o]})})})]})}),Lh=_t(function(e,n){const{children:r,...i}=e;return u.jsx(Nl,{content:r,...i,ref:n,children:u.jsx(mn,{variant:"ghost","aria-label":"info",size:"2xs",colorPalette:"gray",ml:1,children:u.jsx(Nh,{})})})}),Fh=({checked:t,onCheckedChange:e,ref:n,...r})=>{const i=tt(()=>t==="indeterminate"?e==null?void 0:e({checked:!1}):e==null?void 0:e({checked:!t}),[e,t]);return u.jsx(mr,{checked:t,onCheckedChange:i,ref:n,...r})},Re=rt(({name:t,info:e,loading:n=!1,total:r,visible:i,ref:s,...o})=>{const a=i?i===r?!0:"indeterminate":!1,c=n?null:i===r?r:`${i}/${r}`;return u.jsx(Fh,{checked:a,disabled:n||!r,ref:s,...o,children:u.jsxs(lt,{inline:!0,alignItems:"baseline",gap:2,children:[u.jsxs(ji,{alignItems:"center",gap:0,children:[t!==void 0&&u.jsx(Ft,{fontWeight:"semibold",letterSpacing:"tight",children:t}),e&&u.jsx(Lh,{content:e})]}),u.jsxs(Ft,{color:"fg.muted",textStyle:"xs",children:[n&&u.jsx(Ue,{size:"xs"}),!n&&c]})]})})}),Bh=({stat:t,stat2:e,toggleVisibility:n,...r})=>u.jsx(Re,{visible:t.visible+((e==null?void 0:e.visible)??0),total:t.total+((e==null?void 0:e.total)??0),onCheckedChange:({checked:i})=>n(i!==!1,t.data,...e?[e.data]:[]),...r}),re=rt(Bh),be=vt.forwardRef(function(e,n){const{children:r,portalled:i=!0,portalRef:s,backdrop:o=!0,...a}=e;return u.jsxs(pn,{disabled:!i,container:s,children:[o&&u.jsx(Wt.Backdrop,{}),u.jsx(Wt.Positioner,{children:u.jsx(Wt.Content,{ref:n,...a,asChild:!1,children:r})})]})}),Ce=vt.forwardRef(function(e,n){return u.jsx(Wt.CloseTrigger,{position:"absolute",top:"2",insetEnd:"2",...e,asChild:!0,children:u.jsx(bi,{size:"sm",ref:n,children:e.children})})}),Vh=Wt.Root,ke=Wt.Footer,Ie=Wt.Header,Pe=Wt.Body;Wt.Backdrop;const Te=Wt.Title,Pr=Wt.Description,Hh=Wt.Trigger,gs=Wt.ActionTrigger,Wh=10,Pi=t=>/^[OPQ][0-9][A-Z0-9]{3}[0-9]|[A-NR-Z][0-9]([A-Z][A-Z0-9]{2}[0-9]){1,2}$/.test(t),to=t=>t,Xh="https://www.ebi.ac.uk/proteins",Yh=Xh+"/api",Uh=(t,e)=>Gs.get(Yh+t,{validateStatus:null,signal:e}),Ll=to(async({accession:t},e)=>{var s,o,a,c,l,d,h;if(!Pi(t))throw new Error("Invalid UniProt accession number");const{data:n,statusText:r}=await Uh(`/proteins/${t}`,e);if(!n.accession||n.errorMessage)throw n.errorMessage?new Error(n.errorMessage):new Error(`Failed to fetch UniProt entry: ${r}`);const i=((s=n.protein.recommendedName)==null?void 0:s.fullName.value)??((o=n.protein.submittedName)==null?void 0:o[0].fullName.value);return{uniprotAccession:n.accession,uniprotEntryName:n.id,name:i,geneName:((l=(c=(a=n.gene)==null?void 0:a[0])==null?void 0:c.name)==null?void 0:l.value)??null,organismName:((d=n.organism.names.find(({type:f})=>f==="scientific"))==null?void 0:d.value)??null,sequence:((h=n.sequence)==null?void 0:h.sequence)??null}}),qh="https://rest.uniprot.org/uniprotkb/search",Gh=(t,e)=>Gs.get(qh,{params:{format:"json",...t},validateStatus:null,signal:e}),Kh=to(async({accessions:t},e)=>{const n=t.filter(c=>!Pi(c));if(n.length>0)throw new Error(`Invalid UniProt accession${n.length!==1?"s":""}: ${n.join(", ")}`);const r=t.map(c=>`(accession:${c})`).join("OR"),{data:i,statusText:s}=await Gh({query:r,fields:"accession,id,gene_primary,sequence",size:500},e),{results:o,messages:a}=i??{};if(!o)throw a!==void 0&&a.length>0?new Error(a.join(", ")):new Error(`Failed to fetch UniProt: ${s}`);return new Map(o.map(({primaryAccession:c,uniProtkbId:l,genes:d,sequence:h})=>[c,{id:l,geneName:d.length>0?d[0].geneName.value:void 0,sequence:h.value}]))}),Zh="_dragover_1s8s7_1",Pn={dragover:Zh},Qh=({mappedPeptides:t,offset:e})=>t.map(({sequence:n,position:r})=>({start:r+e-1,end:r+e-1+n.length})),Jh=(t,e=0)=>{if(t.length===0)return[];const n=t.map(({start:d})=>d).toSorted((d,h)=>d-h),r=t.map(({end:d})=>d).toSorted((d,h)=>d-h),i=n[0],s=r[r.length-1],o=[];let a=0,c=0,l=0;for(let d=Math.min(0,i);d<s;d++){let h=!1;for(;n[c]===d;)a===0&&(h=!0),a++,c++;const f=a;let p=!1;for(;r[l]===d+1;)a--,l++,a===0&&(p=!0);d>=e&&o.push({count:f,isStart:h,isEnd:p})}return o},qn=t=>t!==void 0&&t>0?`green.400/${Math.min(t*40,100)}`:void 0,tf=({sequence:t,peptidePositions:e,mappedPositions:n})=>{var o,a,c,l,d,h,f,p;const r=[],s=e?Jh(e):n?Array.from(Array(t.length)).map((m,x)=>({count:n.mappedPositions.has(n.offset+x+1)?1:0,isStart:!0,isEnd:!0})):[];for(let m=0;m<t.length;m+=10){const x=Math.min(m+10,t.length),y=s.slice(m,x),g=((o=s[m])==null?void 0:o.isStart)??!1?0:Math.min(((a=s[m-1])==null?void 0:a.count)??((c=s[m])==null?void 0:c.count)??0,((l=s[m])==null?void 0:l.count)??0),v=((d=s[x])==null?void 0:d.isStart)??!1?0:Math.min(((h=s[x-1])==null?void 0:h.count)??0,((f=s[x])==null?void 0:f.count)??0);r.push({sequence:t.slice(m,x),peptides:y,stableNumOfPeptides:y.every(({isStart:w,isEnd:b})=>!w&&!b)&&new Set(y.map(({count:w})=>w)).size===1?((p=y[0])==null?void 0:p.count)??0:void 0,numPeptidesBefore:g,numPeptidesAfter:v})}return u.jsx(lt,{gapY:2,wrap:"wrap",children:u.jsx(No,{each:r,children:(m,x)=>u.jsxs(lt,{children:[u.jsx(At,{direction:"column",minW:3,mt:"1.1lh",h:"0.8lh",bg:qn(m.numPeptidesBefore)}),u.jsxs(lt,{direction:"column",align:"end",children:[u.jsx(Ft,{color:"fg.muted",children:t.length<10?t.length:x*10+10}),u.jsxs(Ft,{whiteSpace:"pre",children:[m.stableNumOfPeptides?u.jsx(le,{bg:qn(m.stableNumOfPeptides),children:m.sequence}):u.jsx(No,{each:Array.from(m.sequence),children:(y,g)=>{var v,w,b;return u.jsx(le,{bg:qn((v=m.peptides[g])==null?void 0:v.count),borderStartRadius:((w=m.peptides[g])==null?void 0:w.isStart)??!1?"md":void 0,borderEndRadius:((b=m.peptides[g])==null?void 0:b.isEnd)??!1?"md":void 0,children:y},g)}}),10>m.sequence.length&&u.jsx(le,{bg:qn(m.numPeptidesAfter),children:" ".repeat(10-m.sequence.length)})]})]}),u.jsx(At,{direction:"column",minW:3,mt:"1.1lh",h:"0.8lh",bg:qn(m.numPeptidesAfter)})]},x)})})};let Ct;const Fl=({defaultValue:t,onChange:e,disabled:n=!1,setIsEditing:r,defaultEdit:i,inputRef:s,mappedPeptides:o,mappedPositions:a,onDropRef:c,ref:l,...d})=>{const h=wi({defaultValue:t,placeholder:"Enter a sequence, UniProt accession, or drop a FASTA file",disabled:n,defaultEdit:i,onValueCommit:({value:y})=>{const g=y.toUpperCase().replaceAll(/\s/g,"");if(Pi(g)){Ct=jt(Ct,{type:"loading",title:`Fetching ${g} from UniProt...`}),Ll({accession:g}).then(({uniprotEntryName:w,sequence:b})=>{b?(He.success({id:Ct,title:`Loaded ${g} from UniProt`,description:w}),h.setValue(b),e(b)):(He.error({id:Ct,title:`Entry ${g} has no sequence`,description:w}),h.clearValue(),e())}).catch(w=>{He.error({id:Ct,title:"Failed to fetch sequence from UniProt",description:w.message}),h.clearValue(),e()});return}const v=g.replaceAll(/[^GAVLITSMCPFYWHKRDENQ]/g,"");v!==g&&(Ct=jt(Ct,{type:"warning",title:"Invalid characters removed from the sequence",description:"Please ensure the sequence contains only valid amino acid codes."})),h.setValue(v),e(v!==""?v:void 0)},onEditChange:({edit:y})=>r==null?void 0:r(y)}),f=L(()=>o?Qh(o):void 0,[o]),p=tt(y=>{if(y.size===0){Ct=jt(Ct,{type:"error",title:`${y.name} is empty`});return}y.text().then(g=>{if(!wl(g)){Ct=jt(Ct,{type:"error",title:`${y.name} is not a valid FASTA file`});return}const v=jl(g),w=v.next().value;if(w){const b=w.sequence.toUpperCase().replaceAll(/[^GAVLITSMCPFYWHKRDENQ]/g,"").trim(),C=b!==w.sequence.toUpperCase().trim(),A=!!v.next().value;Ct=jt(Ct,{type:C||A?"warning":"success",title:`Loaded the sequence of ${w.id} from ${y.name}`,description:[C?"Invalid characters were removed from the sequence.":"",A?"Note that only the first sequence is loaded.":""].join(" ")}),h.cancel(),h.setValue(b),e(b)}else{Ct=jt(Ct,{type:"error",title:`Couldn't parse ${y.name} as FASTA`}),h.edit(),h.setValue(g);return}}).catch(g=>{Ct=jt(Ct,{type:"error",title:`Couldn't read ${y.name}`,description:g.message})})},[h,e]);St(()=>(c&&"current"in c&&(c.current=p),()=>{c&&"current"in c&&(c.current=null)}),[c,p]);const m=tt(y=>{var v;if(!((v=y.dataTransfer)!=null&&v.items)||y.dataTransfer.items.length===0)return;const g=y.dataTransfer.items[0];if(g.kind==="file"){const w=g.getAsFile();w&&p(w)}},[p]);let x=0;return u.jsxs(Cd,{value:h,fontFamily:"mono",onDragEnter:y=>{y.stopPropagation(),++x===1&&y.currentTarget.classList.add(Pn.dragover)},onDragLeave:y=>{y.stopPropagation(),--x===0&&y.currentTarget.classList.remove(Pn.dragover)},onDragOver:y=>{y.preventDefault(),y.stopPropagation()},onDrop:y=>{y.preventDefault(),y.stopPropagation(),y.currentTarget.classList.remove(Pn.dragover),x=0,m(y)},border:"2px solid transparent",ref:l,...d,children:[u.jsxs(kd,{w:"full",_hover:{bg:"unset"},_placeholderShown:{color:"fg.muted",fontFamily:"body"},children:[h.empty&&h.valueText,!h.empty&&u.jsx(tf,{sequence:h.value,peptidePositions:f,mappedPositions:a})]}),u.jsx(Id,{ref:s,_placeholderShown:{color:"fg.muted",fontFamily:"body"},overflowY:"hidden",onFocus:y=>{y.currentTarget.style.height="auto",y.currentTarget.style.height=`${y.currentTarget.scrollHeight}px`},onInput:y=>{y.currentTarget.style.height="auto",y.currentTarget.style.height=`${y.currentTarget.scrollHeight}px`},onKeyDown:y=>y.key==="Enter"&&h.submit()})]})},ot=_t(function(e,n){const{loading:r,disabled:i,loadingText:s,children:o,...a}=e;return u.jsx(_r,{disabled:r||i,ref:n,...a,children:r&&!s?u.jsxs(u.Fragment,{children:[u.jsx(qs,{display:"inline-flex",children:u.jsx(Ue,{size:"inherit",color:"inherit"})}),u.jsx(le,{opacity:0,children:o})]}):r&&s?u.jsxs(u.Fragment,{children:[u.jsx(Ue,{size:"inherit",color:"inherit",writingMode:"initial"}),s]}):o})}),ef=rt(({protein:{id:t,name:e,linkPositionToAminoAcid:n,peptides:r,sequence:i},experimentId:s,isEditing:o,setIsEditing:a,onDropRef:c,closeDialog:l})=>{const[d,h]=ct(i),f=at(null),{proteinPositionToAminoAcid:p,lastAminoAcidPosition:m}=L(()=>{const v=Js({linkPositionToAminoAcid:n,peptides:r}),[w,b]=$l(v);return{proteinPositionToAminoAcid:v,lastAminoAcidPosition:b}},[n,r]),x=L(()=>d?Qs(p,d,0,!1):void 0,[d,p]),y=x&&x.mismatchedPositions.size===0&&x.unmappedPositions.size===0&&(x.mappedPositions.size===0||x.success),g=L(()=>d&&x&&r?r.filter(({position:v,sequence:w})=>v-1+w.length-1>=0&&v-1<d.length).filter(({position:v,sequence:w})=>Array.from(Array(w.length)).map((b,C)=>v+C).every(b=>x.mappedPositions.has(b))):void 0,[d,x,r]);return Vs("keydown",v=>{v.key==="Enter"&&v.target!==f.current&&(!d||y)&&(v.preventDefault(),d!==i&&hr(s,t,{sequence:d}),l())}),u.jsxs(u.Fragment,{children:[u.jsxs(Ie,{flexDir:"column",children:[u.jsxs(Te,{children:[e," Sequence"]}),u.jsx(Pr,{children:"Sequences in strcutures are aligned to the provided protein sequences to determine crosslink positions."}),u.jsx(Ce,{})]}),u.jsxs(Pe,{children:[u.jsx(Fl,{defaultValue:i,inputRef:f,onChange:h,setIsEditing:a,defaultEdit:!i,mappedPeptides:g?{mappedPeptides:g,offset:0}:void 0,mappedPositions:x?{mappedPositions:x.mappedPositions,offset:0}:void 0,onDropRef:c}),d&&!o&&u.jsxs(Kt.Root,{status:y?"success":"error",mt:5,children:[u.jsx(Kt.Indicator,{}),u.jsx(Kt.Content,{children:u.jsx(Kt.Description,{children:y?r?`${r.length>1?"All":"The"} ${yt(r.length,"peptide")} of ${e} ${r.length===1?"was":"were"} mapped succesfully to the sequence.`:`${p.size>1?"All":"The"} ${yt(p.size,"crosslink position")} in ${e} ${p.size===1?"was":"were"} mapped succesfully to the sequence.`:d.length<m?`The sequence should be at least ${yt(m,"amino acid")} long (because the last ${r?"peptide of":"crosslink position in"} ${e} ${r?"ends at":"is"} ${p.get(m)??""}${m}).`:((x==null?void 0:x.mismatchedPositions.size)??0)>0?r?`Some peptides of ${e} don't match the sequence.`:`Some positions of ${e} don't match the sequence.`:`The sequence doesn't match the positions of ${e}.`})})]})]}),u.jsxs(ke,{children:[(o||i===d)&&u.jsx(ot,{variant:"surface",onClick:l,children:"Close"}),i!==d&&!o&&u.jsxs(u.Fragment,{children:[u.jsx(ot,{variant:"surface",onClick:l,children:"Cancel"}),u.jsx(ot,{colorPalette:"green",onClick:()=>{hr(s,t,{sequence:d}),l()},disabled:!!d&&!y,children:"Save sequence"})]})]})]})}),nf=_t(function(e,n){const{children:r,clearable:i,hideIndicator:s,triggerProps:o,...a}=e;return u.jsxs(It.Control,{...a,children:[u.jsx(It.Trigger,{...o,ref:n,children:r}),u.jsxs(It.IndicatorGroup,{children:[i&&u.jsx(rf,{}),!s&&u.jsx(It.Indicator,{})]})]})}),rf=_t(function(e,n){return u.jsx(It.ClearTrigger,{asChild:!0,...e,ref:n,children:u.jsx(bi,{size:"xs",variant:"plain",focusVisibleRing:"inside",focusRingWidth:"2px",pointerEvents:"auto"})})}),Bl=_t(function(e,n){const{portalled:r=!0,portalRef:i,...s}=e;return u.jsx(pn,{disabled:!r,container:i,children:u.jsx(It.Positioner,{children:u.jsx(It.Content,{...s,ref:n})})})}),xs=_t(function(e,n){const{item:r,children:i,...s}=e;return u.jsxs(It.Item,{item:r,...s,ref:n,children:[i,u.jsx(It.ItemIndicator,{})]},r.value)}),sf=_t(function(e,n){const{children:r,...i}=e;return u.jsx(It.ValueText,{...i,ref:n,children:u.jsx(It.Context,{children:s=>{const o=s.selectedItems;return o.length===0?e.placeholder:r?r(o):o.length===1?s.collection.stringifyItem(o[0]):`${o.length} selected`}})})});_t(function(e,n){return u.jsx(It.Root,{...e,ref:n,positioning:{sameWidth:!0,...e.positioning},children:e.asChild?e.children:u.jsxs(u.Fragment,{children:[u.jsx(It.HiddenSelect,{}),e.children]})})});_t(function(e,n){const{children:r,label:i,...s}=e;return u.jsxs(It.ItemGroup,{...s,ref:n,children:[u.jsx(It.ItemGroupLabel,{children:i}),r]})});const of=It.Label;It.ItemText;const Qo=t=>{const e=Us();return O.referenceProteinsById[e]={id:e,...t},e},af=t=>{const e=Object.entries(O.proteinIdToReferenceProtein).filter(([n,{id:r}])=>r===t).map(([n])=>n);for(const n of e)O.proteinIdToReferenceProtein.delete(n);O.referenceProteinsById=Object.fromEntries(Object.entries(O.referenceProteinsById).filter(([,{id:n}])=>n!==t))},oi=(t,e)=>_l(O.referenceProteinsById[t],e),lf=async t=>{O.proteinIdToReferenceProtein.delete(t)},cf=async(t,e,n)=>{const r=O.referenceProteinsById[e],{alignmentOffsets:i}=await Ol(t.sequence,r.sequence,n),s={ntd:i[0]===0?"ntd":void 0,...Object.fromEntries(i.map((o,a)=>[a+1,o!==-1?o+1:void 0]))};return O.proteinIdToReferenceProtein.set(t.id,{id:r.id,xlPosToRefPos:s}),i},Vl=({proteinIdToReferenceProtein:t,referenceProteinsById:e},n)=>n.map(r=>{var s;const i=(s=t.get(r.id))==null?void 0:s.id;if(i){const o=e[i];if(o)return{isReferenceProtein:!0,...o}}return{isReferenceProtein:!1,...r}}),uf=t=>Vl(O,t),df=(t,e,n)=>{const r=i=>{const s=e.get(i.proteinId);if(!s)return i;const o=n[s.id];if(!o)throw new Error("Reference protein not found");const a=s.xlPosToRefPos[i.linkPosition];return{proteinId:s.id,linkPosition:a,aminoAcid:a!==void 0&&a!=="ntd"?o.sequence[a-1]:void 0}};return t.map(i=>{const[s,o]=[r(i.from),r(i.to)].toSorted((a,c)=>{if(a.proteinId!==c.proteinId)return a.proteinId.localeCompare(c.proteinId);const[l,d]=[a,c].map(({linkPosition:h})=>h===void 0?Number.POSITIVE_INFINITY:h==="ntd"?0:h);return l-d});return{...i,homoMultimeric:i.homoMultimeric||i.from.proteinId!==i.to.proteinId&&s.proteinId===o.proteinId,from:s,to:o,originalCrosslink:i}})},Hl=t=>{const{proteinIdToReferenceProtein:e,referenceProteinsById:n}=mt(O);return L(()=>t.map(({proteins:r,crosslinks:i,...s})=>({proteins:Vl({proteinIdToReferenceProtein:e,referenceProteinsById:n},r),crosslinks:df(i,e,n),...s})),[t,e,n])},hf=t=>{const e=L(()=>t?[t]:[],[t]);return Hl(e)[0]},eo=()=>{const{referenceProteinsById:t}=mt(O);return L(()=>Array.from(Object.values(t)).toSorted((e,n)=>e.name.localeCompare(n.name)),[t])},Wl=t=>{const{proteinIdToReferenceProtein:e,referenceProteinsById:n}=mt(O),r=e.get(t.id);return r?{resolvedProtein:{isReferenceProtein:!0,...n[r.id]},xlPosToRefPos:r.xlPosToRefPos}:{resolvedProtein:{isReferenceProtein:!1,...t},xlPosToRefPos:void 0}},ff=({closeDialog:t,onAddedReferenceProtein:e})=>{const n=at(null),r=at(null),[i,s]=ct(""),[o,a]=ct(""),c=i.length>0&&o.length>0;return Vs("keydown",l=>{var d,h;if(l.key==="Enter"){if(l.target===n.current&&i.length>0){l.preventDefault(),(h=(d=r.current)==null?void 0:d.previousElementSibling)==null||h.focus();return}if(l.target!==r.current&&c){l.preventDefault();const f=Qo({name:i,sequence:o});e==null||e(f),t()}}}),u.jsxs(u.Fragment,{children:[u.jsx(Ce,{}),u.jsx(Ie,{children:u.jsx(Te,{children:"Add a reference protein to the project"})}),u.jsx(Pe,{asChild:!0,children:u.jsx(We.Root,{children:u.jsxs(We.Content,{children:[u.jsx(cr,{label:"Name",children:u.jsx(ln,{type:"text",ref:n,value:i,onChange:l=>s(l.target.value),autoFocus:!0})}),u.jsx(cr,{label:"Sequence",children:u.jsx(Fl,{inputRef:r,onChange:l=>a(l??"")})})]})})}),u.jsxs(ke,{children:[u.jsx(ot,{variant:"surface",onClick:t,children:"Close"}),u.jsx(ot,{colorPalette:"green",disabled:!c,onClick:()=>{const l=Qo({name:i,sequence:o});e==null||e(l),t()},children:"Add protein"})]})]})},Xl=({dialogRef:t,onAddedReferenceProtein:e})=>{const n=ye({restoreFocus:!1});return St(()=>(t&&(t.current=n),()=>{t&&(t.current=null)}),[t,n]),u.jsx(Ge,{value:n,placement:"top",size:"xl",lazyMount:!0,unmountOnExit:!0,children:u.jsx(be,{children:u.jsx(ff,{closeDialog:()=>n.setOpen(!1),onAddedReferenceProtein:e})})})},ys=rt(({active:t,children:e,ref:n,...r})=>u.jsx(_i,{fontSize:"xs",variant:"underline",color:t?void 0:"fg.muted/50",textDecorationLine:"none",_hover:{color:"unset",textDecorationLine:"underline"},ref:n,...r,children:e})),pf=rt(({protein:t,experimentId:e,onDropRef:n,ref:r,...i})=>{const[s,o]=ct(!1),a=ye({closeOnInteractOutside:!s,closeOnEscape:!s,trapFocus:!1,restoreFocus:!1}),c=at(null);St(()=>(n&&"current"in n&&(n.current=m=>{a.setOpen(!0),setTimeout(()=>{var x;return(x=c.current)==null?void 0:x.call(c,m)},0)}),()=>{n&&"current"in n&&(n.current=null)}),[n,a]);const l=at(null),d=eo(),h=L(()=>Sl({items:[...d.map(({id:m,name:x})=>({value:m,label:x})),{value:"new",label:"Add..."}]}),[d]),{resolvedProtein:f}=Wl(t),p=Cl({collection:h,defaultValue:f.isReferenceProtein?[f.id]:void 0,deselectable:!0,onValueChange:async({value:m})=>{var x;if(m[0]==="new"){(x=l.current)==null||x.setOpen(!0),p.clearValue();return}if(m.length===0){await lf(t.id);return}if(!t.sequence)throw new Error;await cf(t,m[0])},positioning:{gutter:5,shift:20}});return u.jsxs(u.Fragment,{children:[u.jsx(Ge,{value:a,size:"xl",placement:"top",lazyMount:!0,unmountOnExit:!0,children:u.jsx(be,{h:"fit",children:u.jsx(ef,{protein:t,experimentId:e,isEditing:s,setIsEditing:o,onDropRef:c,closeDialog:()=>{o(!1),a.setOpen(!1)}})})}),u.jsx(Xl,{dialogRef:l,onAddedReferenceProtein:m=>{p.setValue([m])}}),u.jsxs(ji,{ref:r,...i,children:[u.jsx(ys,{active:!!t.sequence,onClick:()=>a.setOpen(!0),py:2,children:"Sequence"}),t.sequence&&u.jsxs(kl,{value:p,size:"xs",pt:"2px",children:[u.jsx(Pd,{width:"full",children:u.jsx(Td,{as:"span",asChild:!0,border:"none",pl:0,children:u.jsxs(ys,{active:!p.empty,w:"full",children:[u.jsx(Ou,{}),u.jsx(Md,{placeholder:"Reference"})]})})}),u.jsx(Bl,{mt:-1,children:p.collection.items.map(m=>u.jsxs(hd,{children:[m.value==="new"&&p.collection.items.length>1&&u.jsx(cn,{},"before-new"),u.jsx(xs,{item:m,children:m.label})]},m.value))})]})]})]})}),mf="_dragover_1ksss_1",Xi={dragover:mf},gf=({domain:{name:t,startPosition:e,endPosition:n},stats:{interdomain:r,intradomain:i},toggleVisibility:s,deleteDomain:o})=>u.jsxs(Sr,{children:[u.jsxs(lt,{justifyContent:"space-between",children:[u.jsx(re,{size:"sm",name:t,stat:r,stat2:i,toggleVisibility:s}),u.jsxs(Ft,{fontSize:"xs",color:"fg.muted",children:["from ",e," to ",n,u.jsx(mn,{size:"2xs",variant:"ghost",_hover:{colorPalette:"red"},verticalAlign:"center",ml:2,onClick:()=>o(e),children:u.jsx(fl,{})})]})]}),u.jsx(re,{name:"Inter-domain",ms:6,size:"sm",info:"Crosslinks that occur between two different domains",stat:r,toggleVisibility:s}),u.jsx(re,{name:"Intra-domain",ms:6,size:"sm",info:"Crosslinks that occur within the same domain",stat:i,toggleVisibility:s})]}),Jo=({domains:t,proteinLength:e,addDomain:n})=>{const[r,i]=ct(""),[s,o]=ct(""),[a,c]=ct(""),l=r.length>0?r.trim():void 0,d=(()=>{if(l!==void 0)return l.length===0?"Domain name can't be empty":(t==null?void 0:t.some(m=>m.name===l))??!1?"Domain name already exist":!1})(),h=(()=>{if(s.length===0)return;if(!/^[0-9]+$/.test(s.trim()))return"Invalid position";const m=Number.parseInt(s);if(!Number.isSafeInteger(m)||m<=0)return"Invalid position";if(e!==void 0&&m>e)return`Must be smaller than the protein's length (${e})`;const x=ii(m,t);return x?`The position is in an existing domain (${x.name})`:m})(),f=(()=>{if(typeof h!="number"||a.length===0)return;if(!/^[0-9]+$/.test(a.trim()))return"Invalid position";const m=Number.parseInt(a);if(!Number.isSafeInteger(m))return"Invalid position";if(e!==void 0&&m>e)return`Must be smaller than the protein's length (${e})`;if(m<h)return"Must be larger than the start position";const x=ii(m,t);return x?`The position is in an existing domain (${x.name})`:m})(),p=(()=>{if(typeof h!="number"||typeof f!="number")return;const m=(t==null?void 0:t.filter(x=>x.startPosition<=f&&x.endPosition>=h))??[];return m.length>0?m.length===1?`Overlapping with an existing domain (${m[0].name})`:`Overlapping with ${yt(m.length,"domain")}: ${Ht(m.map(({name:x})=>x))}`:!1})();return u.jsx(dn,{asChild:!0,children:u.jsxs("form",{onSubmit:m=>{m.preventDefault(),d===!1&&p===!1&&n(l,h,f)},children:[u.jsxs(Yn.Root,{invalid:!!d,children:[u.jsx(Ad,{fontSize:"xs",children:"Domain name"}),u.jsx(ln,{size:"xs",onChange:m=>i(m.target.value)}),u.jsx(Cn,{children:d})]}),u.jsxs(Yn.Root,{invalid:!!p,children:[u.jsx(Yn.Label,{fontSize:"xs",children:"Position"}),u.jsxs(ji,{align:"start",children:[u.jsxs(Yn.Root,{invalid:!!p||typeof h=="string",children:[u.jsx(ln,{size:"xs",placeholder:"Start",inputMode:"numeric",onChange:m=>o(m.target.value)}),typeof h=="string"&&u.jsx(Cn,{children:h})]}),u.jsxs(Yn.Root,{invalid:!!p||typeof f=="string",children:[u.jsx(ln,{size:"xs",placeholder:"End",inputMode:"numeric",onChange:m=>c(m.target.value)}),typeof f=="string"&&u.jsx(Cn,{children:f})]})]}),u.jsx(Cn,{children:p})]}),u.jsx(_r,{size:"xs",type:"submit",disabled:d!==!1||p!==!1,children:"Add"})]})})},ta=_t(function(e,n){const{portalled:r=!0,portalRef:i,...s}=e;return u.jsx(pn,{disabled:!r,container:i,children:u.jsx(dt.Positioner,{children:u.jsx(dt.Content,{ref:n,...s})})})}),ea=_t(function(e,n){return u.jsx(dt.Arrow,{...e,ref:n,children:u.jsx(dt.ArrowTip,{})})});_t(function(e,n){return u.jsx(dt.CloseTrigger,{position:"absolute",top:"1",insetEnd:"1",...e,asChild:!0,ref:n,children:u.jsx(bi,{size:"sm"})})});dt.Title;dt.Description;dt.Footer;dt.Header;dt.Root;dt.Body;dt.Trigger;const Yl=({protein:t,experimentId:e,domainNameToStats:n,toggleVisibility:r,ref:i,...s})=>{var d,h;const o=Lo({}),a=Lo({portalled:!1,positioning:{placement:"right"}}),c=tt(f=>{var m;const p=(m=t.domains)==null?void 0:m.filter(x=>x.startPosition!==f);t.isReferenceProtein?oi(t.id,{domains:p}):e&&hr(e,t.id,{domains:p})},[t.domains,t.isReferenceProtein,t.id,e]),l=tt((f,p,m)=>{const x=[...t.domains??[],{name:f,startPosition:p,endPosition:m}].toSorted((y,g)=>y.startPosition-g.startPosition);t.isReferenceProtein?oi(t.id,{domains:x}):e&&hr(e,t.id,{domains:x}),a.setOpen(!1)},[t.domains,t.isReferenceProtein,t.id,e,a]);return u.jsxs(dt.RootProvider,{value:o,size:"sm",unmountOnExit:!0,lazyMount:!0,children:[u.jsx(dt.Trigger,{asChild:!0,children:u.jsx(ys,{active:o.open||an(t.domains),ref:i,...s,children:an(t.domains)?yt(t.domains.length,"domain"):"Domains"})}),u.jsxs(ta,{maxH:"unset",children:[u.jsx(ea,{}),u.jsx(dt.Body,{children:u.jsx(dn,{gapY:5,children:an(t.domains)?u.jsxs(u.Fragment,{children:[t.domains.map(f=>u.jsx(gf,{domain:f,stats:n[f.name],toggleVisibility:r,deleteDomain:c},f.startPosition)),u.jsxs(dt.RootProvider,{value:a,size:"xs",lazyMount:!0,unmountOnExit:!0,children:[u.jsx(dt.Trigger,{asChild:!0,children:u.jsxs(ot,{size:"2xs",children:[u.jsx(Rn,{}),"Add domain"]})}),u.jsxs(ta,{portalled:!1,children:[u.jsx(ea,{}),u.jsx(dt.Body,{children:u.jsx(Jo,{domains:t.domains,proteinLength:(d=t.sequence)==null?void 0:d.length,addDomain:l})})]})]})]}):u.jsx(Jo,{domains:t.domains,proteinLength:(h=t.sequence)==null?void 0:h.length,addDomain:l})})})]})]})},xf=({protein:t,stats:e,domainNameToStats:n,toggleVisibility:r,experimentId:i,hideMultiProteinToggles:s,ref:o,...a})=>{const c=e.interprotein.visible+e.intraprotein.visible>0,{resolvedProtein:l}=Wl(t),d=at(null);let h=0;return u.jsxs(De.Root,{borderColor:c?"colorPalette.solid":void 0,onDragEnter:f=>{f.stopPropagation(),++h===1&&f.currentTarget.classList.add(Xi.dragover)},onDragLeave:f=>{f.stopPropagation(),--h===0&&f.currentTarget.classList.remove(Xi.dragover)},onDragOver:f=>{f.stopPropagation(),f.preventDefault()},onDrop:f=>{var m,x;f.stopPropagation(),f.preventDefault(),f.currentTarget.classList.remove(Xi.dragover),h=0;const p=(m=f.dataTransfer.items[0])==null?void 0:m.getAsFile();p&&((x=d==null?void 0:d.current)==null||x.call(d,p))},ref:o,...a,children:[u.jsxs(De.Header,{children:[u.jsxs(lt,{flexDir:"row",alignItems:"center",children:[u.jsx(Ir,{name:t.name,onRename:f=>hr(i,t.id,{name:f}),size:"lg",fontWeight:"semibold"},t.name),u.jsx(re,{stat:e.interprotein,stat2:e.intraprotein,toggleVisibility:r,dir:"rtl"})]}),u.jsx(pf,{protein:t,experimentId:i,onDropRef:d}),u.jsx(Yl,{protein:l,domainNameToStats:n,toggleVisibility:r,experimentId:i,w:"fit-content",mt:-2})]}),u.jsx(De.Body,{p:s&&e.homomultimeric.total===0?0:void 0,children:u.jsxs(Sr,{children:[!s&&u.jsxs(u.Fragment,{children:[u.jsx(re,{name:"Inter-protein",info:"Crosslinks that occur between two different proteins",stat:e.interprotein,toggleVisibility:r}),u.jsx(re,{name:"Intra-protein",info:"Crosslinks that occur within the same protein",stat:e.intraprotein,toggleVisibility:r})]}),e.homomultimeric.total>0&&u.jsx(re,{ms:s?void 0:6,name:"Homo-multimeric",info:"Crosslinks that occur between overlapping peptides",stat:e.homomultimeric,toggleVisibility:r})]})}),u.jsx(De.Footer,{})]})},yf=rt(xf),no=(t,e)=>{const n=O.experimentIdToGroupedStructureIds[t];n.flat(2).every(r=>!e.includes(r))||(O.experimentIdToGroupedStructureIds[t]=Ln(n.map(r=>r.filter(i=>!e.includes(i)))))},vf=(t,e)=>{O.experimentIdToGroupedStructureIds[t]=Ln([...O.experimentIdToGroupedStructureIds[t],e])},Yi=(t,e)=>{const n=O.experimentIdToGroupedStructureIds[t].flat().filter(r=>e.flat().every(i=>i!==r));O.experimentIdToGroupedStructureIds[t]=Ln([...e,n])},bf=(t,e)=>{const n=O.experimentIdToGroupedStructureIds[t];O.experimentIdToGroupedStructureIds[t]=Ln([e,...n])},ai=(t,e,n)=>{const r=new Set(O.experimentIdToVisibleCrosslinkIds[t]),i=e?r.union(n):r.difference(n);O.experimentIdToVisibleCrosslinkIds[t]=i},wf=t=>{const e=O.experiments.find(({id:r})=>r===t);if(!e)return;const n=new Set(e==null?void 0:e.crosslinks.map(({id:r})=>r));O.experimentIdToVisibleCrosslinkIds[t]=n},jf=async t=>{const e=O.experiments.find(({id:i})=>i===t);if(!e)return;const n=e==null?void 0:e.proteins.map(({name:i})=>i);if(!n)return;const r=await Kh({accessions:n});for(const i of e.proteins){const s=r.get(i.name);if(s&&(i.name=s.geneName??s.id,!i.sequence)){const o=Js(i);(o.size===0||Qs(o,s.sequence,0,!0).success)&&(i.sequence=s.sequence)}}},_f=rt(({experiment:{id:t,proteins:e},resolvedExperiment:{proteins:n,crosslinks:r},ref:i,...s})=>{const o=L(()=>{const m=x=>({total:x.length,data:new Set(x)});return Object.fromEntries(e.map(({id:x,interProteinCrosslinks:y,intraProteinCrosslinks:g,homoMultimericCrosslinks:v},w)=>{var b;return[x,{stats:{interprotein:m(y),intraprotein:m(g),homomultimeric:m(v)},domainNameToStats:Object.fromEntries(((b=n[w].domains)==null?void 0:b.map(C=>{const A=n[w].id,_=[],S=[];for(const{id:T,from:P,to:M}of r){const $=P.proteinId===A&&ms(P.linkPosition,C),R=M.proteinId===A&&ms(M.linkPosition,C);!$&&!R||($===R?S.push(T):_.push(T))}return[C.name,{interdomain:m(_),intradomain:m(S)}]}))??[])}]}))},[e,r,n]),{experimentIdToVisibleCrosslinkIds:a}=mt(O),c=a[t],l=L(()=>{const m=g=>g.intersection(c).size,x=g=>ur(Object.entries(g).map(([v,{data:w,...b}])=>[v,{visible:m(w),data:w,...b}])),y={};for(const[g,{stats:v,domainNameToStats:w}]of Object.entries(o))y[g]={stats:x(v),domainNameToStats:ur(Object.entries(w).map(([b,C])=>[b,x(C)]))};return y},[o,c]),d=tt((m,...x)=>ai(t,m,x.length===1?x[0]:new Set(x.flatMap(y=>Array.from(y)))),[t]),[{loading:h},f]=Pl(jf),p=L(()=>e.length>0&&e.every(({name:m})=>Pi(m)),[e]);return u.jsxs(At,{position:"relative",ref:i,...s,children:[(p||h)&&u.jsxs(ot,{my:5,colorPalette:"teal",onClick:()=>!h&&Ys(()=>{f(t)}),w:"full",loading:h,loadingText:`Loading protein${e.length>1?"s":""} data from UniProt...`,children:[u.jsx(Oo,{}),"Load protein",e.length>1?"s":""," data from UniProt",u.jsx(Oo,{style:{transform:"rotateY(180deg)"}})]}),u.jsx(lt,{gapY:5,gapX:10,wrap:"wrap",children:e.map(m=>u.jsx(yf,{experimentId:t,protein:m,stats:l[m.id].stats,domainNameToStats:l[m.id].domainNameToStats,toggleVisibility:d,hideMultiProteinToggles:e.length===1,w:"30%",overflow:"clip",size:"sm"},m.id))})]})}),Sf=rt(({experimentId:t,structureToXlinkIdToStatus:e,allCrosslinkIds:n,visibleCrosslinkIds:r,unmappedCrosslinkIds:i,numOfDistanceConstraints:s,ref:o,...a})=>{const c=L(()=>{if(e==="loading")return e;if(Object.keys(e).length===0)return null;const f={};for(const p of Object.values(e))for(const[m,x]of Object.entries(p))m in f||(f[m]=new Set),x!==void 0&&f[m].add(x);return{missing:Object.entries(f).filter(([p,m])=>m.size===0).map(([p])=>p),appear:Object.entries(f).filter(([p,m])=>m.size>0).map(([p])=>p),withoutConflicts:Object.entries(f).filter(([p,m])=>!m.has("under")&&!m.has("over")).map(([p])=>p),withConflicts:Object.entries(f).filter(([p,m])=>m.has("under")||m.has("over")).map(([p])=>p)}},[e]),l=tt(f=>f?{loading:!1,visible:f.filter(p=>r.has(p)).length,total:f.length,onCheckedChange:({checked:p})=>ai(t,p!==!1,new Set(f))}:{loading:!0,visible:void 0,total:void 0},[r,t]),d=L(()=>{if(!(!i||i.size===0))return u.jsx(Re,{ms:6,name:"Not mapped to reference protein",info:"Crosslinks that one or both of their residues are not mapped to the reference protein",...l(Array.from(i))})},[i,l]),h=L(()=>{if(c===null)return;const f=c!=="loading"?p=>c[p]:()=>{};return s>0?u.jsxs(u.Fragment,{children:[u.jsx(Re,{ms:6,name:"Without any conflict",info:`Crosslinks that don't violate the distance constraint${s!==1?"s":""} in any of the structures`,...l(f("withoutConflicts"))}),u.jsx(Re,{ms:12,name:"Missing in all structures",info:"Crosslinks that don't appear in any of the structures",...l(f("missing"))}),u.jsx(Re,{ms:6,name:"With some conflicts",info:`Crosslinks that violate the distance constraint${s!==1?"s":""} in some of the structures`,...l(f("withConflicts"))})]}):u.jsxs(u.Fragment,{children:[u.jsx(Re,{ms:6,name:"Missing in all structures",info:"Crosslinks that don't appear in any of the structures",...l(f("missing"))}),u.jsx(Re,{ms:6,name:"Appear in all structures",info:"Crosslinks that appear in all of the structures",...l(f("appear"))})]})},[c,l,s]);return u.jsxs(Sr,{ref:o,...a,children:[u.jsx(Re,{name:"All crosslinks",visible:r.size,total:n.size,onCheckedChange:({checked:f})=>ai(t,f!==!1,n)}),d,h]})});function Cf(t){return new Worker("/xlinkup/assets/load-structures-worker-PujOvQ3G.js",{name:t==null?void 0:t.name})}const kf=async(t,e,n,r)=>{const i=O.structures.find(({id:c})=>c===t);if(!i||i.loading)throw new Error("Structure not available for mapping");const s=i.chains.find(({id:c})=>c===e);if(!s)throw new Error("Chain not found in structure");const o=await Sh(s,n,r);if(!o){let c=`Chain ${e} couldn't be mapped to `;throw n.sequence?c+=`the provided sequence of ${n.name}.`:c+=`${n.name}. Try adding a sequence to ${n.name} to perform sequence alignment.`,new Error(c)}let a=(()=>{let c=`${yt(o.hits,"position")} matched (${Math.round(o.relativeHits*100)}% of ${n.name}'s positions)`;return o.alignmentScore&&(c+=`, alignment score is ${Math.round(o.alignmentScore*100)}%`),c+"."})();return Ch([o])!==o&&(a="Note that this mapping might be wrong: "+a),i.chainIdToProteinIdToMapping[e][n.id]=o.proteinPosToChainPos,{message:a,mapping:o}},If=(t,{metadata:e,chains:n,chainIdToProteinIdToMapping:r})=>{var c;const i=O.structures.findIndex(l=>l.id===t);if(i===-1||!O.structures[i].loading){zu(`Loaded structure ${t} doesn't exist, or wasn't in loading state when loading finished (loading = ${(c=O.structures[i])==null?void 0:c.loading})`);return}let s=O.structures[i].name;e.suffix.length>0&&(s+="-"+e.suffix.join("-"));const o=Us();O.structures.push({id:o,name:s,metadata:e,chains:md(n),chainIdToProteinIdToMapping:r,loading:!1});const a=Object.keys(O.experimentIdToGroupedStructureIds);for(const l of a)O.experimentIdToGroupedStructureIds[l]=Ln(O.experimentIdToGroupedStructureIds[l].map(d=>d.includes(t)?[...d,o]:d))},Ul=new Cf;Ul.onmessage=({data:t})=>{const{id:e}=t;if("error"in t){He.error({title:"Failed to load structure",description:t.error.message}),vs([e]);return}t.done?vs([e]):If(e,t.structure)};const na=t=>{const e=t.map(s=>({...s,id:Us()}));for(const{id:s,name:o}of e)O.structures.push({id:s,name:o,loading:!0});const n=Object.keys(O.experimentIdToGroupedStructureIds);for(const s of n)O.experimentIdToGroupedStructureIds[s]=Ln([...O.experimentIdToGroupedStructureIds[s],e.map(({id:o})=>o)]);const r=new Set,i=[];for(const s of[...uf(O.experiments.flatMap(({proteins:o})=>o)),...Object.values(O.referenceProteinsById)])r.has(s.id)||(i.push(pd(s)),r.add(s.id));Ul.postMessage({action:"load-structures",structures:e,proteins:i})},ql=(t,e)=>{const n=O.structures.find(r=>r.id===t);n&&_l(n,e)},Pf=(t,e,n)=>{const r=O.structures.find(i=>i.id===t);r&&(r.loading||r.chainIdToProteinIdToMapping[e][n]!==void 0&&(r.chainIdToProteinIdToMapping[e]=Object.fromEntries(Object.entries(r.chainIdToProteinIdToMapping[e]).filter(([i])=>i!==n))))},vs=t=>{O.structures=O.structures.filter(({id:e})=>!t.includes(e));for(const{id:e}of O.experiments)no(e,t)},Tf=({id:t})=>{const{experimentIdToGroupedStructureIds:e}=mt(O),n=e[t],r=n.some(s=>s.length>0),{structures:i}=mt(O);return L(()=>{if(!r)return[[],n];const s=n.flat(2);return[i.filter(({id:a})=>s.includes(a)),n]},[r,i,n])},ge=({startElement:t,endElement:e,onClose:n,closable:r=!!n,children:i,ref:s,...o})=>u.jsxs(bn.Root,{ref:s,...o,children:[t&&u.jsx(bn.StartElement,{children:t}),u.jsx(bn.Label,{children:i}),e&&u.jsx(bn.EndElement,{children:e}),r&&u.jsx(bn.EndElement,{children:u.jsx(bn.CloseTrigger,{onClick:n})})]});function Ti(t){return Nn({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M221.69,199.77,160,96.92V40h8a8,8,0,0,0,0-16H88a8,8,0,0,0,0,16h8V96.92L34.31,199.77A16,16,0,0,0,48,224H208a16,16,0,0,0,13.72-24.23Zm-90.08-42.91c-15.91-8.05-31.05-12.32-45.22-12.81l24.47-40.8A7.93,7.93,0,0,0,112,99.14V40h32V99.14a7.93,7.93,0,0,0,1.14,4.11L183.36,167C171.4,169.34,154.29,168.34,131.61,156.86Z"},child:[]}]})(t)}function Mf(t){return Nn({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M195.51,62.66,212.44,44A6,6,0,1,0,203.56,36L186.63,54.58A94,94,0,0,0,60.49,193.34L43.56,212A6,6,0,0,0,52.44,220l16.93-18.62A94,94,0,0,0,195.51,62.66ZM46,128A81.93,81.93,0,0,1,178.53,63.49L68.59,184.43A81.69,81.69,0,0,1,46,128Zm82,82a81.57,81.57,0,0,1-50.53-17.49L187.41,71.57A81.94,81.94,0,0,1,128,210Z"},child:[]}]})(t)}function Gl(t){return Nn({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,112v96a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V112A16,16,0,0,1,56,96H80a8,8,0,0,1,0,16H56v96H200V112H176a8,8,0,0,1,0-16h24A16,16,0,0,1,216,112ZM93.66,69.66,120,43.31V136a8,8,0,0,0,16,0V43.31l26.34,26.35a8,8,0,0,0,11.32-11.32l-40-40a8,8,0,0,0-11.32,0l-40,40A8,8,0,0,0,93.66,69.66Z"},child:[]}]})(t)}const ra=(t,e)=>t===void 0?u.jsx(Mf,{}):t==="ntd"?"N`":`${e??""}${t}`,ia=({hoverKey:t,...e})=>u.jsx(ge,{className:`xlp${dr(t)}`,...e}),sa=({proteinId:t,proteinName:e,domainName:n})=>u.jsxs(u.Fragment,{children:[u.jsx(ia,{hoverKey:t,...n?{borderRightRadius:0}:{},children:e}),n&&u.jsx(ia,{hoverKey:t+n,borderLeftRadius:0,children:n})]}),Kl=rt(({rowHeader:t,groupHeader:e,field:n,checked:r,groupedChecked:i,toggle:s,toggleGroup:o,ref:a,...c})=>{const l=t.ids.flat().length>1,d=t.homoMultimeric.flat().filter(f=>f===!0).length,h=d===t.ids.flat().length?"all":d>0?"some":"none";return u.jsxs(lt,{minW:"fit-content",justify:"space-between",align:"baseline",wrap:"nowrap",whiteSpace:"nowrap",ref:a,...c,children:[e&&u.jsxs("span",{style:{flexShrink:0,display:"flex",fontWeight:"bolder"},children:[i!==void 0&&u.jsx(mr,{size:"xs",mx:2,checked:i,inputProps:{onClick:({shiftKey:f})=>o==null?void 0:o(i!==!0,e,f)},disabled:!o,visibility:o?void 0:"hidden"}),u.jsxs(lt,{onClick:({shiftKey:f})=>o==null?void 0:o(i!==!0,e,f),children:[u.jsx(sa,{proteinId:e.fromProteinId,proteinName:e.fromProteinName,domainName:e.fromDomainName}),"-",u.jsx(sa,{proteinId:e.toProteinId,proteinName:e.toProteinName,domainName:e.toDomainName})]})]}),u.jsx("div",{style:{minWidth:"10px",flexGrow:1}}),u.jsxs(lt,{flexShrink:0,mr:n?void 0:3,children:[u.jsx(mr,{size:"xs",mx:2,checked:r,inputProps:{onClick:({shiftKey:f})=>s==null?void 0:s(r!==!0,t,f)},disabled:!s,visibility:s?void 0:"hidden"}),u.jsxs(lt,{onClick:({shiftKey:f})=>s==null?void 0:s(r!==!0,t,f),children:[u.jsx(ge,{opacity:t.fromPosition===void 0?.5:void 0,children:ra(t.fromPosition,t.fromAminoAcid)}),"-",u.jsx(ge,{opacity:t.toPosition===void 0?.5:void 0,children:ra(t.toPosition,t.toAminoAcid)})]})]}),n&&u.jsx(Ft,{ml:5,mr:3,fontFamily:"mono",fontSize:"2xs",minW:"8",textAlign:"right",children:t[n].length===1&&u.jsxs(u.Fragment,{children:[h==="all"&&"M ",h==="some"&&u.jsx("span",{style:{color:"gray"},children:"m "}),t[n][0][0],l?"..":""]})})]})});var Ui={exports:{}},Mt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oa;function Af(){if(oa)return Mt;oa=1;var t=Xs;function e(c){var l="https://react.dev/errors/"+c;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)l+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+c+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(c,l,d){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:h==null?null:""+h,children:c,containerInfo:l,implementation:d}}var o=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(c,l){if(c==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return Mt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Mt.createPortal=function(c,l){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(e(299));return s(c,l,null,d)},Mt.flushSync=function(c){var l=o.T,d=r.p;try{if(o.T=null,r.p=2,c)return c()}finally{o.T=l,r.p=d,r.d.f()}},Mt.preconnect=function(c,l){typeof c=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,r.d.C(c,l))},Mt.prefetchDNS=function(c){typeof c=="string"&&r.d.D(c)},Mt.preinit=function(c,l){if(typeof c=="string"&&l&&typeof l.as=="string"){var d=l.as,h=a(d,l.crossOrigin),f=typeof l.integrity=="string"?l.integrity:void 0,p=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;d==="style"?r.d.S(c,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:h,integrity:f,fetchPriority:p}):d==="script"&&r.d.X(c,{crossOrigin:h,integrity:f,fetchPriority:p,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},Mt.preinitModule=function(c,l){if(typeof c=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var d=a(l.as,l.crossOrigin);r.d.M(c,{crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&r.d.M(c)},Mt.preload=function(c,l){if(typeof c=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var d=l.as,h=a(d,l.crossOrigin);r.d.L(c,d,{crossOrigin:h,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},Mt.preloadModule=function(c,l){if(typeof c=="string")if(l){var d=a(l.as,l.crossOrigin);r.d.m(c,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else r.d.m(c)},Mt.requestFormReset=function(c){r.d.r(c)},Mt.unstable_batchedUpdates=function(c,l){return c(l)},Mt.useFormState=function(c,l,d){return o.H.useFormState(c,l,d)},Mt.useFormStatus=function(){return o.H.useHostTransitionStatus()},Mt.version="19.0.0",Mt}var aa;function Ef(){if(aa)return Ui.exports;aa=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),Ui.exports=Af(),Ui.exports}var Rf=Ef();function jn(t,e,n){let r=n.initialDeps??[],i;function s(){var o,a,c,l;let d;n.key&&((o=n.debug)!=null&&o.call(n))&&(d=Date.now());const h=t();if(!(h.length!==r.length||h.some((m,x)=>r[x]!==m)))return i;r=h;let p;if(n.key&&((a=n.debug)!=null&&a.call(n))&&(p=Date.now()),i=e(...h),n.key&&((c=n.debug)!=null&&c.call(n))){const m=Math.round((Date.now()-d)*100)/100,x=Math.round((Date.now()-p)*100)/100,y=x/16,g=(v,w)=>{for(v=String(v);v.length<w;)v=" "+v;return v};console.info(`%c⏱ ${g(x,5)} /${g(m,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*y,120))}deg 100% 31%);`,n==null?void 0:n.key)}return(l=n==null?void 0:n.onChange)==null||l.call(n,i),i}return s.updateDeps=o=>{r=o},s}function qi(t,e){if(t===void 0)throw new Error("Unexpected undefined");return t}const $f=(t,e)=>Math.abs(t-e)<1,Zl=(t,e,n)=>{let r;return function(...i){t.clearTimeout(r),r=t.setTimeout(()=>e.apply(this,i),n)}},Of=t=>t,ro=t=>{const e=Math.max(t.startIndex-t.overscan,0),n=Math.min(t.endIndex+t.overscan,t.count-1),r=[];for(let i=e;i<=n;i++)r.push(i);return r},zf=(t,e)=>{const n=t.scrollElement;if(!n)return;const r=t.targetWindow;if(!r)return;const i=o=>{const{width:a,height:c}=o;e({width:Math.round(a),height:Math.round(c)})};if(i(n.getBoundingClientRect()),!r.ResizeObserver)return()=>{};const s=new r.ResizeObserver(o=>{const a=()=>{const c=o[0];if(c!=null&&c.borderBoxSize){const l=c.borderBoxSize[0];if(l){i({width:l.inlineSize,height:l.blockSize});return}}i(n.getBoundingClientRect())};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()});return s.observe(n,{box:"border-box"}),()=>{s.unobserve(n)}},gr={passive:!0},Df=(t,e)=>{const n=t.scrollElement;if(!n)return;const r=()=>{e({width:n.innerWidth,height:n.innerHeight})};return r(),n.addEventListener("resize",r,gr),()=>{n.removeEventListener("resize",r)}},li=typeof window>"u"?!0:"onscrollend"in window,Nf=(t,e)=>{const n=t.scrollElement;if(!n)return;const r=t.targetWindow;if(!r)return;let i=0;const s=t.options.useScrollendEvent&&li?()=>{}:Zl(r,()=>{e(i,!1)},t.options.isScrollingResetDelay),o=d=>()=>{const{horizontal:h,isRtl:f}=t.options;i=h?n.scrollLeft*(f&&-1||1):n.scrollTop,s(),e(i,d)},a=o(!0),c=o(!1);c(),n.addEventListener("scroll",a,gr);const l=t.options.useScrollendEvent&&li;return l&&n.addEventListener("scrollend",c,gr),()=>{n.removeEventListener("scroll",a),l&&n.removeEventListener("scrollend",c)}},Lf=(t,e)=>{const n=t.scrollElement;if(!n)return;const r=t.targetWindow;if(!r)return;let i=0;const s=t.options.useScrollendEvent&&li?()=>{}:Zl(r,()=>{e(i,!1)},t.options.isScrollingResetDelay),o=d=>()=>{i=n[t.options.horizontal?"scrollX":"scrollY"],s(),e(i,d)},a=o(!0),c=o(!1);c(),n.addEventListener("scroll",a,gr);const l=t.options.useScrollendEvent&&li;return l&&n.addEventListener("scrollend",c,gr),()=>{n.removeEventListener("scroll",a),l&&n.removeEventListener("scrollend",c)}},Ff=(t,e,n)=>{if(e!=null&&e.borderBoxSize){const r=e.borderBoxSize[0];if(r)return Math.round(r[n.options.horizontal?"inlineSize":"blockSize"])}return Math.round(t.getBoundingClientRect()[n.options.horizontal?"width":"height"])},Bf=(t,{adjustments:e=0,behavior:n},r)=>{var i,s;const o=t+e;(s=(i=r.scrollElement)==null?void 0:i.scrollTo)==null||s.call(i,{[r.options.horizontal?"left":"top"]:o,behavior:n})},Vf=(t,{adjustments:e=0,behavior:n},r)=>{var i,s;const o=t+e;(s=(i=r.scrollElement)==null?void 0:i.scrollTo)==null||s.call(i,{[r.options.horizontal?"left":"top"]:o,behavior:n})};class Hf{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let n=null;const r=()=>n||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:n=new this.targetWindow.ResizeObserver(i=>{i.forEach(s=>{const o=()=>{this._measureElement(s.target,s)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()})}));return{disconnect:()=>{var i;(i=r())==null||i.disconnect(),n=null},observe:i=>{var s;return(s=r())==null?void 0:s.observe(i,{box:"border-box"})},unobserve:i=>{var s;return(s=r())==null?void 0:s.unobserve(i)}}})(),this.range=null,this.setOptions=n=>{Object.entries(n).forEach(([r,i])=>{typeof i>"u"&&delete n[r]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Of,rangeExtractor:ro,onChange:()=>{},measureElement:Ff,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...n}},this.notify=n=>{var r,i;(i=(r=this.options).onChange)==null||i.call(r,this,n)},this.maybeNotify=jn(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),n=>{this.notify(n)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(n=>n()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var n;const r=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==r){if(this.cleanup(),!r){this.maybeNotify();return}this.scrollElement=r,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((n=this.scrollElement)==null?void 0:n.window)??null,this.elementsCache.forEach(i=>{this.observer.observe(i)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,i=>{this.scrollRect=i,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(i,s)=>{this.scrollAdjustments=0,this.scrollDirection=s?this.getScrollOffset()<i?"forward":"backward":null,this.scrollOffset=i,this.isScrolling=s,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(n,r)=>{const i=new Map,s=new Map;for(let o=r-1;o>=0;o--){const a=n[o];if(i.has(a.lane))continue;const c=s.get(a.lane);if(c==null||a.end>c.end?s.set(a.lane,a):a.end<c.end&&i.set(a.lane,!0),i.size===this.options.lanes)break}return s.size===this.options.lanes?Array.from(s.values()).sort((o,a)=>o.end===a.end?o.index-a.index:o.end-a.end)[0]:void 0},this.getMeasurementOptions=jn(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(n,r,i,s,o)=>(this.pendingMeasuredCacheIndexes=[],{count:n,paddingStart:r,scrollMargin:i,getItemKey:s,enabled:o}),{key:!1}),this.getMeasurements=jn(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:n,paddingStart:r,scrollMargin:i,getItemKey:s,enabled:o},a)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(d=>{this.itemSizeCache.set(d.key,d.size)}));const c=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const l=this.measurementsCache.slice(0,c);for(let d=c;d<n;d++){const h=s(d),f=this.options.lanes===1?l[d-1]:this.getFurthestMeasurement(l,d),p=f?f.end+this.options.gap:r+i,m=a.get(h),x=typeof m=="number"?m:this.options.estimateSize(d),y=p+x,g=f?f.lane:d%this.options.lanes;l[d]={index:d,start:p,size:x,end:y,key:h,lane:g}}return this.measurementsCache=l,l},{key:!1,debug:()=>this.options.debug}),this.calculateRange=jn(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(n,r,i,s)=>this.range=n.length>0&&r>0?Wf({measurements:n,outerSize:r,scrollOffset:i,lanes:s}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=jn(()=>{let n=null,r=null;const i=this.calculateRange();return i&&(n=i.startIndex,r=i.endIndex),this.maybeNotify.updateDeps([this.isScrolling,n,r]),[this.options.rangeExtractor,this.options.overscan,this.options.count,n,r]},(n,r,i,s,o)=>s===null||o===null?[]:n({startIndex:s,endIndex:o,overscan:r,count:i}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=n=>{const r=this.options.indexAttribute,i=n.getAttribute(r);return i?parseInt(i,10):(console.warn(`Missing attribute name '${r}={index}' on measured element.`),-1)},this._measureElement=(n,r)=>{const i=this.indexFromElement(n),s=this.measurementsCache[i];if(!s)return;const o=s.key,a=this.elementsCache.get(o);a!==n&&(a&&this.observer.unobserve(a),this.observer.observe(n),this.elementsCache.set(o,n)),n.isConnected&&this.resizeItem(i,this.options.measureElement(n,r,this))},this.resizeItem=(n,r)=>{const i=this.measurementsCache[n];if(!i)return;const s=this.itemSizeCache.get(i.key)??i.size,o=r-s;o!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(i,o,this):i.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=o,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(i.index),this.itemSizeCache=new Map(this.itemSizeCache.set(i.key,r)),this.notify(!1))},this.measureElement=n=>{if(!n){this.elementsCache.forEach((r,i)=>{r.isConnected||(this.observer.unobserve(r),this.elementsCache.delete(i))});return}this._measureElement(n,void 0)},this.getVirtualItems=jn(()=>[this.getVirtualIndexes(),this.getMeasurements()],(n,r)=>{const i=[];for(let s=0,o=n.length;s<o;s++){const a=n[s],c=r[a];i.push(c)}return i},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=n=>{const r=this.getMeasurements();if(r.length!==0)return qi(r[Ql(0,r.length-1,i=>qi(r[i]).start,n)])},this.getOffsetForAlignment=(n,r,i=0)=>{const s=this.getSize(),o=this.getScrollOffset();r==="auto"&&(r=n>=o+s?"end":"start"),r==="center"?n+=(i-s)/2:r==="end"&&(n-=s);const a=this.options.horizontal?"scrollWidth":"scrollHeight",l=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[a]:this.scrollElement[a]:0)-s;return Math.max(Math.min(l,n),0)},this.getOffsetForIndex=(n,r="auto")=>{n=Math.max(0,Math.min(n,this.options.count-1));const i=this.measurementsCache[n];if(!i)return;const s=this.getSize(),o=this.getScrollOffset();if(r==="auto")if(i.end>=o+s-this.options.scrollPaddingEnd)r="end";else if(i.start<=o+this.options.scrollPaddingStart)r="start";else return[o,r];const a=r==="end"?i.end+this.options.scrollPaddingEnd:i.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,r,i.size),r]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(n,{align:r="start",behavior:i}={})=>{this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(n,r),{adjustments:void 0,behavior:i})},this.scrollToIndex=(n,{align:r="auto",behavior:i}={})=>{n=Math.max(0,Math.min(n,this.options.count-1)),this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const s=this.getOffsetForIndex(n,r);if(!s)return;const[o,a]=s;this._scrollToOffset(o,{adjustments:void 0,behavior:i}),i!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(n))){const[l]=qi(this.getOffsetForIndex(n,a));$f(l,this.getScrollOffset())||this.scrollToIndex(n,{align:a,behavior:i})}else this.scrollToIndex(n,{align:a,behavior:i})}))},this.scrollBy=(n,{behavior:r}={})=>{this.cancelScrollToIndex(),r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+n,{adjustments:void 0,behavior:r})},this.getTotalSize=()=>{var n;const r=this.getMeasurements();let i;if(r.length===0)i=this.options.paddingStart;else if(this.options.lanes===1)i=((n=r[r.length-1])==null?void 0:n.end)??0;else{const s=Array(this.options.lanes).fill(null);let o=r.length-1;for(;o>0&&s.some(a=>a===null);){const a=r[o];s[a.lane]===null&&(s[a.lane]=a.end),o--}i=Math.max(...s.filter(a=>a!==null))}return Math.max(i-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(n,{adjustments:r,behavior:i})=>{this.options.scrollToFn(n,{behavior:i,adjustments:r},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(e)}}const Ql=(t,e,n,r)=>{for(;t<=e;){const i=(t+e)/2|0,s=n(i);if(s<r)t=i+1;else if(s>r)e=i-1;else return i}return t>0?t-1:0};function Wf({measurements:t,outerSize:e,scrollOffset:n,lanes:r}){const i=t.length-1,s=c=>t[c].start;if(t.length<=r)return{startIndex:0,endIndex:i};let o=Ql(0,i,s,n),a=o;if(r===1)for(;a<i&&t[a].end<n+e;)a++;else if(r>1){const c=Array(r).fill(0);for(;a<i&&c.some(d=>d<n+e);){const d=t[a];c[d.lane]=d.end,a++}const l=Array(r).fill(n+e);for(;o>0&&l.some(d=>d>=n);){const d=t[o];l[d.lane]=d.start,o--}o=Math.max(0,o-o%r),a=Math.min(i,a+(r-1-a%r))}return{startIndex:o,endIndex:a}}const la=typeof document<"u"?vt.useLayoutEffect:vt.useEffect;function Jl(t){const e=vt.useReducer(()=>({}),{})[1],n={...t,onChange:(i,s)=>{var o;s?Rf.flushSync(e):e(),(o=t.onChange)==null||o.call(t,i,s)}},[r]=vt.useState(()=>new Hf(n));return r.setOptions(n),la(()=>r._didMount(),[]),la(()=>r._willUpdate()),r}function tc(t){return Jl({observeElementRect:zf,observeElementOffset:Nf,scrollToFn:Vf,...t})}function ec(t){return Jl({getScrollElement:()=>typeof document<"u"?window:null,observeElementRect:Df,observeElementOffset:Lf,scrollToFn:Bf,initialOffset:()=>typeof document<"u"?window.scrollY:0,...t})}const nc=_t(function(e,n){const{children:r,portalled:i=!0,portalRef:s,...o}=e;return u.jsx(pn,{disabled:!i,container:s,children:u.jsx($n.Positioner,{children:u.jsx($n.Content,{ref:n,...o,asChild:!1,children:r})})})}),rc=_t(function(e,n){return u.jsx($n.CloseTrigger,{...e,asChild:!0,ref:n,children:u.jsx(bi,{size:"sm"})})}),ic=$n.Root,sc=$n.SelectionTrigger,ci=$n.Separator;function Xf(t){return Nn({attr:{viewBox:"0 0 32 32"},child:[{tag:"path",attr:{d:"M 5 5 L 5 9 L 6 9 L 6 23 L 5 23 L 5 27 L 9 27 L 9 26 L 23 26 L 23 27 L 27 27 L 27 23 L 26 23 L 26 9 L 27 9 L 27 5 L 23 5 L 23 6 L 9 6 L 9 5 Z M 9 8 L 23 8 L 23 9 L 24 9 L 24 23 L 23 23 L 23 24 L 9 24 L 9 23 L 8 23 L 8 9 L 9 9 Z M 10 10 L 10 18 L 14 18 L 14 22 L 22 22 L 22 14 L 18 14 L 18 10 Z M 12 12 L 16 12 L 16 16 L 12 16 Z M 18 16 L 20 16 L 20 20 L 16 20 L 16 18 L 18 18 Z"},child:[]}]})(t)}const Yf=rt(({experimentId:t,structure:{id:e,name:n,loading:r},checked:i,onToggle:s,onClick:o,ref:a,...c})=>u.jsxs(lt,{flexDir:"column",h:"100%",justifyContent:"space-between",alignItems:"center",gap:3,ref:a,...c,children:[u.jsx(mr,{size:"xs",inputProps:{onClick:({shiftKey:l})=>s==null?void 0:s(!i,t,e,l)},disabled:!s,visibility:s?void 0:"hidden",checked:i}),u.jsx(ot,{variant:"ghost",size:"2xs",writingMode:"vertical-lr",minH:"fit",loading:r,flexGrow:1,justifyContent:"end",loadingText:us(n,12),onClick:o,children:us(n,15)})]})),Le=vt.forwardRef(function(e,n){const{portalled:r=!0,portalRef:i,...s}=e;return u.jsx(pn,{disabled:!r,container:i,children:u.jsx(U.Positioner,{children:u.jsx(U.Content,{ref:n,...s})})})});vt.forwardRef(function(e,n){return u.jsx(U.Arrow,{ref:n,...e,children:u.jsx(U.ArrowTip,{})})});const ar=vt.forwardRef(function(e,n){return u.jsxs(U.CheckboxItem,{ps:"8",ref:n,...e,children:[u.jsx(qs,{axis:"horizontal",insetStart:"4",asChild:!0,children:u.jsx(U.ItemIndicator,{children:u.jsx(Hs,{})})}),e.children]})}),kn=vt.forwardRef(function(e,n){const{children:r,...i}=e;return u.jsxs(U.RadioItem,{ps:"8",ref:n,...i,children:[u.jsx(qs,{axis:"horizontal",insetStart:"4",asChild:!0,children:u.jsx(U.ItemIndicator,{children:u.jsx(Hs,{})})}),u.jsx(U.ItemText,{children:r})]})}),Uf=vt.forwardRef(function(e,n){const{title:r,children:i,...s}=e;return u.jsxs(U.ItemGroup,{ref:n,...s,children:[r&&u.jsx(U.ItemGroupLabel,{userSelect:"none",children:r}),i]})}),Gi=vt.forwardRef(function(e,n){const{startIcon:r,children:i,...s}=e;return u.jsxs(U.TriggerItem,{ref:n,...s,children:[r,i,u.jsx(Du,{})]})}),bs=U.RadioItemGroup,qf=U.ContextTrigger,Fe=U.Root,Tn=U.Separator,Jt=U.Item;U.ItemText;U.ItemCommand;const nn=U.Trigger,oc=rt(({field:t,onFieldClick:e,viewName:n,experiments:r,groupedCrosslinkIds:i,disableMenus:s,exportFigureDialog:o,showingStructures:a,ref:c,...l})=>{const{experimentIdToGroupedStructureIds:d}=mt(O),h=O?Math.min(...r.map(({id:g})=>d[g].flat().length)):void 0,f=h&&h>2?Math.min(3,h-1):void 0,p=r.some(({id:g})=>d[g].filter(v=>v.length>0).length>1),m=tt(()=>{r.forEach((g,v)=>{const w=O.experimentIdToGroupedStructureIds[g.id].flat(),b=si(O.structures.filter(({id:A})=>w.includes(A)),g.crosslinks,O.aminoAcidsMustMatch,O.experimentIdToThresholds[g.id]),C={};for(const A of w){const _=i.flatMap(({rows:M})=>M.map($=>$.ids[v][0])).map(M=>b[A][M]),S=Object.fromEntries(Object.entries(Object.groupBy(_,M=>M??"unmapped")).map(([M,$])=>[M,($==null?void 0:$.length)??0])),P=["ok","below","above","unmapped"].map(M=>(S[M]??0).toString().padStart(5,"0")).join("")+_.map(M=>{switch(M){case"over":return"+";case"ok":return"V";case"under":return"-";case void 0:return" "}}).join("");P in C||(C[P]=[]),C[P].push(A)}Yi(g.id,Object.keys(C).toSorted((A,_)=>_.localeCompare(A)).map(A=>C[A]))})},[r,i]),x=tt(()=>{f&&Nu(async()=>{const{kmeans:g}=await import("https://esm.sh/ml-kmeans@^6.0.0");return{kmeans:g}},[]).then(({kmeans:g})=>{r.forEach((v,w)=>{const b=O.experimentIdToGroupedStructureIds[v.id].flat(),C=si(O.structures.filter(({id:_})=>b.includes(_)),v.crosslinks,O.aminoAcidsMustMatch,O.experimentIdToThresholds[v.id]),{clusters:A}=g(b.map(_=>i.flatMap(({rows:S})=>S.map(T=>T.ids[w][0])).map(S=>{switch(C[_][S]){case"over":return 10;case"ok":return 0;case"under":return-10;case void 0:return-500}})),f,{});Yi(v.id,Array.from(new Array(f)).map((_,S)=>b.filter((T,P)=>A[P]===S)))})})},[f,r,i]),y=tt(()=>r.forEach(({id:g})=>Yi(g,[O.experimentIdToGroupedStructureIds[g].flat()])),[r]);return u.jsxs(lt,{h:"100%",flexDirection:"column",justify:"space-between",ref:c,...l,children:[u.jsxs(lt,{my:3,gap:2,children:[u.jsxs(Fe,{size:"sm",positioning:{gutter:2},onSelect:({value:g})=>g==="figure"?o==null?void 0:o.setOpen(!0):g==="table"?Ii(ki(r,i),`${n}-xlinks`):null,children:[u.jsx(nn,{asChild:!0,children:u.jsxs(ot,{size:"2xs",variant:"outline",disabled:s,children:[u.jsx(Gl,{}),"Export"]})}),u.jsxs(Le,{children:[u.jsxs(Jt,{value:"figure",disabled:!o,children:[u.jsx(pl,{}),"Figure..."]}),u.jsxs(Jt,{value:"table",children:[u.jsx(ml,{}),"Crosslink Table"]})]})]}),a&&u.jsxs(Fe,{size:"sm",positioning:{gutter:2},onSelect:({value:g})=>g==="kmeans"?x():g==="identical"?m():g==="ungroup"?y():null,children:[u.jsx(nn,{asChild:!0,children:u.jsxs(ot,{size:"2xs",variant:"outline",disabled:s,children:[u.jsx(Lu,{}),"Structures"]})}),u.jsxs(Le,{children:[u.jsxs(Uf,{children:[u.jsx(Il,{fontSize:"xs",userSelect:"none",cursor:"default",children:"Group structures by"}),u.jsxs(Jt,{value:"identical",disabled:(h??0)<2,children:[u.jsx(Fu,{}),"Identical Crosslinking Pattern"]}),u.jsxs(Jt,{value:"kmeans",disabled:!f,children:[u.jsx(Bu,{}),u.jsx(Ft,{fontStyle:"italic",marginRight:-1,children:"k"}),"-means",f?` (${yt(f,"cluster")})`:null]})]}),u.jsx(Tn,{}),u.jsxs(Jt,{value:"ungroup",disabled:!p,children:[u.jsx(Vu,{}),"Ungroup"]})]})]})]}),u.jsxs(lt,{minW:"fit-content",justify:"space-between",align:"baseline",wrap:"nowrap",whiteSpace:"nowrap",py:3,opacity:0,_hover:{opacity:1},transition:"opacity 0.2s",mr:t?void 0:3,children:[u.jsxs("span",{style:{flexShrink:0,display:"flex",fontWeight:"bolder"},children:[u.jsx(ge,{children:"From"}),"-",u.jsx(ge,{children:"To"})]}),u.jsx("div",{style:{minWidth:"10px",flexGrow:1}}),u.jsxs("span",{style:{flexShrink:0,display:"flex"},children:[u.jsx(ge,{children:"From"}),"-",u.jsx(ge,{children:"To"})]}),t&&(e?u.jsx(ot,{size:"2xs",fontSize:"2xs",ml:2,mr:3,minW:"12",px:1,fontFamily:"mono",onClick:e,children:t}):u.jsx(Ft,{ml:5,mr:3,fontFamily:"mono",fontSize:"2xs",minW:"7",textAlign:"right",children:t}))]})]})}),Gf="_weak_1r16j_1",Ki={weak:Gf},ac=vt.forwardRef(function(e,n){return u.jsx(Ke.Indicator,{copied:u.jsx(Hs,{}),...e,ref:n,children:u.jsx(Hu,{})})}),io=vt.forwardRef(function(e,n){return u.jsx(Ke.Indicator,{copied:"Copied",...e,ref:n,children:"Copy"})});vt.forwardRef(function(e,n){return u.jsx(Ke.Label,{textStyle:"sm",fontWeight:"medium",display:"inline-block",mb:"1",...e,ref:n})});vt.forwardRef(function(e,n){return u.jsx(Ke.Trigger,{asChild:!0,children:u.jsxs(_r,{ref:n,size:"sm",variant:"surface",...e,children:[u.jsx(ac,{}),u.jsx(io,{})]})})});vt.forwardRef(function(e,n){return u.jsx(Ke.Trigger,{asChild:!0,children:u.jsxs(_r,{unstyled:!0,variant:"plain",size:"xs",display:"inline-flex",alignItems:"center",gap:"2",ref:n,...e,children:[u.jsx(Wu,{}),u.jsx(io,{})]})})});const Kf=vt.forwardRef(function(e,n){return u.jsx(Ke.Trigger,{asChild:!0,children:u.jsxs(mn,{ref:n,size:"xs",variant:"subtle",...e,children:[u.jsx(ac,{}),u.jsx(io,{srOnly:!0})]})})});vt.forwardRef(function(e,n){return u.jsx(Ke.Input,{asChild:!0,children:u.jsx(ln,{ref:n,...e})})});const Zf=Ke.Root,so=[{key:"pymol",name:"PyMOL"},{key:"chimerax",name:"ChimeraX"}],lc="preferredVisualizationTool",Qf=()=>{const t=window.localStorage.getItem(lc);if(t&&so.some(e=>e.key===t))return t},ui=gd({toolKey:Qf()??"pymol"});xd(ui,()=>{window.localStorage.setItem(lc,ui.toolKey)});const Jf=t=>{ui.toolKey=t},oo=()=>{const{toolKey:t}=mt(ui);return so.find(({key:e})=>e===t)},ca=({aminoAcid:t},{aminoAcid:e})=>t&&e&&t!==e&&u.jsx(Nl,{showArrow:!0,content:`The crosslinked residue (${t}) is different from the aligned residue in the structure (${e})`,children:u.jsx(mn,{verticalAlign:"middle",ml:"0.2rem",mb:"0.1rem",size:"2xs",height:"unset",minW:"unset",variant:"ghost",children:u.jsx(Uu,{style:{height:"unset",width:"unset"}})})}),tp=t=>{const e=t.filter(({homoMultimeric:a})=>a);if(e.length===0)return null;const n=e.map(({id:a})=>a),r=t.length-n.length,i=u.jsxs(u.Fragment,{children:[t.length===1?"This crosslink":t.length===n.length?"These crosslinks":`${n.length} of the crosslinks (id${n.length>1?"s":""}: ${Ht(n)})`," ",n.length===1?"is":"are"," classified as ",u.jsx("b",{children:"homo-multimeric"})]}),s=(()=>{var d,h,f,p;if(!(e[0].from.proteinId===e[0].to.proteinId))return null;if(e[0].from.linkPosition===e[0].to.linkPosition)return"the same residue";const l=new Set;for(const m of e)((d=m.originalCrosslink)==null?void 0:d.from.proteinId)!==((h=m.originalCrosslink)==null?void 0:h.to.proteinId)&&l.add("different proteins"),(m.from.peptideIndex!==void 0||((f=m.originalCrosslink)==null?void 0:f.from.peptideIndex)!==void 0)&&(m.to.peptideIndex!==void 0||((p=m.originalCrosslink)==null?void 0:p.to.peptideIndex)!==void 0)&&l.add("overlapping peptides");return l.size===0?null:Array.from(l).join(" / ")})(),o=u.jsx(u.Fragment,{children:r>0?u.jsxs(u.Fragment,{children:["However, because ",r," of the crosslinks"," ",r===1?"is":"are"," not classified as homo-multimeric, distances within the same chain are"," ",u.jsx("b",{children:"not excluded"})]}):u.jsxs(u.Fragment,{children:["Therefore, distances within the same chain are ",u.jsx("b",{children:"excluded"})]})});return u.jsx(Kt.Root,{status:"neutral",children:u.jsx(Kt.Content,{overflow:"clip",children:u.jsxs(Kt.Description,{children:[i,s?` because ${n.length===1?"it occurs":"they occur"} between ${s}`:"",". ",o,"."]})})})},ua=t=>t===void 0?"(unmapped residue)":t==="ntd"?"N`":t.toString(),ep=rt(({experiment:t,crosslinkIds:e,structure:n,ref:r,...i})=>{const{experimentIdToThresholds:s,aminoAcidsMustMatch:o}=mt(O),a=s[t.id],c=oo(),l=t.crosslinks.filter(({id:g})=>e.includes(g));if(l.length===0)return null;const d=t.proteins.find(({id:g})=>g==l[0].from.proteinId),h=t.proteins.find(({id:g})=>g==l[0].to.proteinId);if(!d||!h)return null;const f=tp(l),p=l[0].from.linkPosition&&l[0].to.linkPosition?Ci(l[0],n.chains,n.chainIdToProteinIdToMapping,o).toArray().toSorted((g,v)=>g.distance-v.distance):[],m=l.flatMap(({score:g})=>g!==void 0?[g]:[]),x=oe(p.map(({distance:g})=>g),a??{}),y=(()=>{const g=p.map(({distance:v})=>v).filter(v=>oe([v],a??{})===x);return g.reduce((v,w)=>v+w,0)/g.length})();return u.jsxs(be,{ref:r,...i,children:[u.jsxs(Ie,{flexDir:"column",children:[u.jsxs(Te,{children:[u.jsx("span",{className:Ki.weak,children:d.name})," ",l[0].from.aminoAcid??"",ua(l[0].from.linkPosition),u.jsxs("span",{className:Ki.weak,children:[" to ",d.id!==h.id&&`${h.name} `]}),l[0].to.aminoAcid??"",ua(l[0].to.linkPosition),u.jsx("br",{}),u.jsxs(le,{pl:5,children:[u.jsx("span",{className:Ki.weak,children:"in "}),n.name]})]}),u.jsx(Pr,{asChild:!0,children:u.jsxs(Nt.Root,{size:"sm",orientation:"horizontal",wordBreak:"break-word",children:[u.jsxs(Nt.Item,{children:[u.jsx(Nt.ItemLabel,{children:"Experiment"}),u.jsx(Nt.ItemValue,{children:t.name})]}),u.jsxs(Nt.Item,{children:[u.jsxs(Nt.ItemLabel,{children:["Crosslink ID",l.length>1?"s":""]}),u.jsx(Nt.ItemValue,{children:l.map(({id:g})=>g).join(", ")})]}),m.length>0&&u.jsxs(Nt.Item,{children:[u.jsxs(Nt.ItemLabel,{children:["Crosslink score",l.length>1?"s":""]}),u.jsx(Nt.ItemValue,{children:l.map(({score:g})=>g!==void 0?g.toString():"(no score)").join(", ")})]})]})}),u.jsx(Ce,{})]}),u.jsx(Pe,{children:u.jsxs(jr,{gap:5,align:"stretch",children:[f,p.length===0&&"The crosslink was not found in this structure.",p.length>0&&u.jsxs(u.Fragment,{children:[u.jsxs(ds,{size:"md",children:["Crosslink Distance:"," ",u.jsxs(le,{color:ae(x),children:[y.toFixed(2)," Å"]})]}),u.jsx(Qt.Root,{mt:"10px",gap:2,variant:"plain",align:"center",children:p.map((g,v)=>{const w=oe([g.distance],a??{});return u.jsxs(Qt.Item,{children:[u.jsx(Qt.Indicator,{color:x===w?ae(x):void 0,asChild:!0,children:x===w?u.jsx(Xu,{}):u.jsx(Yu,{})}),u.jsxs(ge,{children:["/",g.from.chainId,":",g.from.aminoAcid??"",g.from.position,ca(l[0].from,g.from)]}),"-",u.jsxs(ge,{children:["/",g.to.chainId,":",g.to.aminoAcid??"",g.to.position,ca(l[0].to,g.to)]}),u.jsx("span",{style:{marginLeft:"10px",marginRight:"10px"},children:" - "}),u.jsxs("span",{style:{color:ae(oe([g.distance],a??{}))},children:[Math.round((g.distance+Number.EPSILON)*100)/100," ","Å"]}),u.jsx(Oe,{content:`Copy as ${c.name} command`,ids:{trigger:String(v)},showArrow:!0,children:u.jsx(Zf,{value:Rh(c.key,g),asChild:!0,ids:{root:String(v)},ml:5,children:u.jsx(Kf,{size:"2xs",variant:"plain"})})})]},v)})})]})]})}),u.jsx(ke,{})]})}),np=({dialog:t,dialogProps:e})=>u.jsx(Ge,{value:t,unmountOnExit:!0,lazyMount:!0,children:e&&u.jsx(ep,{...e})}),cc=rt(({inputProps:t,children:e,rootRef:n,trackLabel:r,thumbLabel:i,ref:s,...o})=>u.jsxs(Je.Root,{ref:n,...o,children:[u.jsx(Je.HiddenInput,{ref:s,...t}),u.jsxs(Je.Control,{children:[u.jsx(Je.Thumb,{children:i&&u.jsx(Je.ThumbIndicator,{fallback:i==null?void 0:i.off,children:i==null?void 0:i.on})}),r&&u.jsx(Je.Indicator,{fallback:r.off,children:r.on})]}),e!=null&&u.jsx(Je.Label,{children:e})]})),rp=({experiment:t,structure:e,ref:n,...r})=>{const{experimentIdToThresholds:i}=mt(O),s=i[t.id],o=L(()=>s!=null&&s.lower&&!(s!=null&&s.upper)?[{category:"under",colorPalette:"below",text:`Below ${s.lower} Å`},{category:"ok",colorPalette:"green",text:`Above ${s.lower} Å`}]:!(s!=null&&s.lower)&&(s!=null&&s.upper)?[{category:"ok",colorPalette:"green",text:`Below ${s.upper} Å`},{category:"over",colorPalette:"red",text:`Above ${s.upper} Å`}]:s!=null&&s.lower&&(s!=null&&s.upper)?[{category:"under",colorPalette:"below",text:`Below ${s.lower} Å`},{category:"ok",colorPalette:"green",text:`Between ${s.lower} Å and ${s.upper} Å`},{category:"over",colorPalette:"red",text:`Above ${s.upper} Å`}]:[],[s]),{experimentIdToVisibleCrosslinkIds:a,aminoAcidsMustMatch:c}=mt(O),l=a[t.id],d=L(()=>Object.fromEntries(t.crosslinks.filter(({id:v})=>l.has(v)).map(v=>[v.id,v])),[t.crosslinks,l]),h=L(()=>Object.fromEntries(t.proteins.map(v=>[v.id,v])),[t.proteins]),f=L(()=>zl(pr([Object.values(d)],h),!0).map(v=>d[v]),[d,h]),p=L(()=>{if(!s||!e||e.loading)return[];const v=[];for(const w of f){const b=Ci(w,e.chains,e.chainIdToProteinIdToMapping,c).toArray(),C=oe(b.map(({distance:A})=>A),s);v.push({...w,category:C,pairs:b.map(A=>({...A,category:oe([A.distance],s)}))})}return v},[f,e,c,s]),[m,x]=ct({under:!0,ok:!0,over:!0}),y=L(()=>p.filter(({category:v})=>v&&m[v]),[p,m]),g=oo();if(!(!e||e.loading))return u.jsxs(We.Root,{ref:n,...r,children:[u.jsx(We.Legend,{children:"Export crosslinks in structure"}),u.jsx(We.Content,{children:u.jsx(Sr,{children:o.map(({category:v,colorPalette:w,text:b})=>{const C=p.some(A=>A.category===v);return u.jsx(cc,{colorPalette:w,checked:m[v]&&C,onCheckedChange:({checked:A})=>x(_=>({..._,[v]:A})),disabled:!C,children:b},v)})})}),u.jsxs(ji,{alignSelf:"end",children:["Export ",yt(y.length,"crosslink"),":",u.jsxs(ti,{attached:!0,children:[u.jsxs(ot,{size:"xs",variant:"subtle",disabled:y.length===0,onClick:()=>Ii($h(t,e.chains.map(({id:v})=>v),y),`${t.name??"XLinkUp"}-${e.name}-xlinks`),children:[u.jsx(ml,{}),"Distance Table"]}),u.jsx(Oe,{showArrow:!0,content:`Python script that adds the selected distances to the models in the current ${g.name} session`,children:u.jsxs(ot,{size:"xs",variant:"subtle",disabled:y.length===0,onClick:()=>Eh(g.key,t.name,e.name,y.flatMap(({category:v,pairs:w})=>w.filter(b=>b.category===v)),Object.fromEntries(o.map(({category:v,text:w})=>[v,w]))),children:[u.jsx(qu,{}),g.name," Script"]})})]})]})]})},ip=t=>{const e=t.filter(({sequence:n})=>!/^[GAVLITSMCPFYWHKRDENQX-]*$/.test(n.toUpperCase()));return e.length>0?{error:{type:"error",title:`The sequence${e.length!==1?"s":""} of ${Ht(e.map(({id:n})=>n))} contain invalid characters`}}:new Set(t.map(({sequence:n})=>n.length)).size!==1?{error:{type:"error",title:"Sequences are not equal in size"}}:{error:void 0}},sp=({sequences:t,...e})=>{const r=[];for(let c=0;c<t[0].sequence.length;c+=10){const l=Math.min(c+10,t[0].sequence.length);r.push(t.map(d=>d.sequence.slice(c,l).replaceAll("X","-")))}const i=":  ",s=Math.ceil((Math.max(...t.map(({id:c})=>c.length))+i.length)/10)*10,o=new Set;for(let c=0;c<t[0].sequence.length;c++){const l=t[0].sequence[c];t.every(d=>d.sequence[c]===l)&&o.add(c)}const a=t.map(({sequence:c,highlightedPositions:l})=>{if(!l)return;const d=new Set;let h=1;return Array.from(c).forEach((f,p)=>{f!=="-"&&(l.has(h)&&d.add(p),++h)}),d});return u.jsxs(lt,{gapY:10,wrap:"wrap",...e,children:[u.jsxs(lt,{children:[u.jsx(At,{direction:"column",mt:"1.1lh",h:"0.8lh"}),u.jsx(lt,{direction:"column",align:"end",justify:"end",children:t.map(({id:c})=>u.jsxs(Ft,{whiteSpace:"pre",fontWeight:"bold",children:[10>c.length+i.length&&u.jsx(u.Fragment,{children:" ".repeat(s-(c.length+i.length))}),c,i]},c))})]}),r.map((c,l)=>u.jsxs(lt,{children:[u.jsx(At,{direction:"column",mt:"1.1lh",h:"0.8lh"}),u.jsxs(lt,{direction:"column",align:"end",children:[u.jsx(Ft,{color:"fg.muted",children:t[0].sequence.length<10?t[0].sequence.length:l*10+10}),c.map((d,h)=>u.jsxs(Ft,{whiteSpace:"pre",children:[Array.from(d).map((f,p)=>{var m,x;return f==="-"?u.jsx(le,{color:"fg.subtle",children:f},p):u.jsx(le,{bg:o.has(l*10+p)?"yellow.focusRing":void 0,fontWeight:(m=a[h])!=null&&m.has(l*10+p)?"bold":void 0,color:(x=a[h])!=null&&x.has(l*10+p)?"red":void 0,children:f},p)}),10>d.length&&u.jsx(u.Fragment,{children:" ".repeat(10-d.length)})]},t[h].id))]})]},l))]})},Nr=(t,e)=>{const n=Array.from(jl(e)),r=new Set(n.filter((f,p,m)=>m.findIndex(x=>x.id===f.id)!==p).map(({id:f})=>f));if(r.size>0)return{error:{type:"error",title:`Duplicate sequence${r.size!==1?"s":""} of ${Ht(Array.from(r).map(f=>`${f} (appears ${Gu(n.filter(p=>p.id===f).length)})`))}`}};const i=new Set(t.map(({id:f})=>f)),s=new Set(n.map(({id:f})=>f)),o=i.difference(s);if(o.size>0)return{error:{type:"error",title:`Missing sequence${o.size!==1?"s":""} of ${Ht(Array.from(o))}`}};let a;const c=s.difference(i);c.size>0&&(a={type:"warning",title:`Extra sequence${c.size!==1?"s":""} of ${Ht(Array.from(c))} ${c.size!==1?"are":"is"} ignored`,description:`Expected only the sequence${i.size!==1?"s":""} of ${Ht(Array.from(i))}`});const l=t.map(f=>({...f,sequence:n.find(({id:p})=>p===f.id).sequence.toUpperCase()})),d=l.filter(({sequence:f},p)=>f.replaceAll("-","")!==t[p].sequence.replaceAll("-",""));if(d.length>0)return{error:{type:"error",title:`Non-identical sequence${d.length!==1?"s":""} of ${Ht(d.map(({id:f})=>f))}`,description:"The sequences must be identical except for the gaps (i.e. '-')"}};const{error:h}=ip(l);return h?{error:h}:{warning:a,sequences:l}},Zi=({currentTarget:t},e)=>{const n=t.closest("[data-part=positioner]")||document.documentElement,r=n.scrollLeft,i=n.scrollTop;e&&(t.value=e),t.style.height="auto",t.style.height=`${t.scrollHeight}px`,n.scrollTo(r,i)};let bt;const op=({defaultSequences:t,onChange:e,readOnly:n=!1,setIsEditing:r,defaultEdit:i,inputRef:s,ref:o,...a})=>{const c=tt(({value:_})=>{const{warning:S,sequences:T}=Nr(t,_);T&&(bt=or(bt),S&&(bt=jt(bt,S)),e(T))},[t,e]),l=L(()=>yd(t),[t]),[d,h]=ct(i??!1),f=tt(_=>{h(_),r==null||r(_)},[r]),[p,m]=ct(),x=d?void 0:p,y=L(()=>{if(x)return Nr(t,x).sequences},[x,t]),g=d?p:void 0,v=L(()=>{if(g===void 0)return;if(g.trim().length===0)return`Enter a sequence alignment of ${Ht(t.map(({id:S})=>S))} in FASTA format`;const{error:_}=Nr(t,g);return _==null?void 0:_.title},[t,g]),w=tt((_,S=!1)=>{bt=or(bt);const{error:T,warning:P}=Nr(t,_);return T?(S||(bt=jt(bt,T)),f(!0),!1):(P&&!S&&(bt=jt(bt,P)),f(!1),c({value:_}),!0)},[t,f,c]),b=tt(_=>{if(_.size===0){bt=jt(bt,{type:"error",title:`${_.name} is empty`});return}_.text().then(S=>{if(!wl(S)){bt=jt(bt,{type:"error",title:`${_.name} is not a valid FASTA file`});return}m(S),s.current&&Zi({currentTarget:s.current},S),w(S)&&(bt=jt(bt,{type:"success",title:`Loaded alignment from ${_.name}`}))}).catch(S=>{bt=jt(bt,{type:"error",title:`Couldn't read ${_.name}`,description:S.message})})},[s,w]),C=tt(_=>{var T;if(!((T=_.dataTransfer)!=null&&T.items)||_.dataTransfer.items.length===0)return;const S=_.dataTransfer.items[0];if(S.kind==="file"){const P=S.getAsFile();P&&b(P)}},[b]);let A=0;return u.jsxs(At,{onDragEnter:_=>{_.stopPropagation(),++A===1&&_.currentTarget.classList.add(Pn.dragover)},onDragLeave:_=>{_.stopPropagation(),--A===0&&_.currentTarget.classList.remove(Pn.dragover)},onDragOver:_=>{_.preventDefault(),_.stopPropagation()},onDrop:_=>{_.preventDefault(),_.stopPropagation(),_.currentTarget.classList.remove(Pn.dragover),A=0,C(_)},border:"2px solid transparent",ref:o,...a,children:[!d&&u.jsx(sp,{sequences:y??t,onClick:()=>!n&&f(!0),cursor:"text",fontFamily:"mono"}),d&&u.jsxs(Ed,{invalid:!!v,children:[u.jsx(Rd,{autoFocus:!0,fontFamily:"mono",overflowY:"hidden",ref:s,onFocus:Zi,onInput:Zi,value:p??l,onChange:_=>{bt=or(bt),m(_.currentTarget.value)},onKeyDown:_=>{_.key==="Enter"&&_.metaKey&&w(_.currentTarget.value)},onBlur:_=>w(_.currentTarget.value,!0)}),u.jsxs(Cn,{children:[v,"."," ",u.jsx(_i,{onClick:()=>{m(void 0),f(!1)},children:"Revert changes."})]})]})]})},ap=rt(({alignment:t,readOnly:e=!1,applyAlignment:n,closeDialog:r})=>{const i=at(null),s=!t,[o,a]=ct(s),[c,l]=ct(t),d=!o&&c&&JSON.stringify(c)===JSON.stringify(t);return u.jsxs(u.Fragment,{children:[u.jsxs(Ie,{flexDir:"column",children:[u.jsx(Te,{children:"Alignment"}),u.jsx(Pr,{}),u.jsx(Ce,{})]}),u.jsxs(Pe,{children:[u.jsx(op,{defaultSequences:t,onChange:h=>l(h),defaultEdit:s,setIsEditing:a,readOnly:e,inputRef:i}),!o&&u.jsxs(Ft,{mt:5,fontSize:"xs",children:[u.jsx(le,{bg:"yellow.focusRing",children:"X"})," - Conserved",u.jsx(le,{fontWeight:"bold",color:"red",ml:5,children:"X"})," ","- Cross-linked"]})]}),u.jsxs(ke,{children:[!o&&d&&u.jsx(ot,{variant:"surface",onClick:r,children:"Close"}),!o&&!d&&u.jsxs(u.Fragment,{children:[u.jsx(ot,{variant:"surface",onClick:r,children:"Cancel"}),u.jsx(ot,{colorPalette:"green",onClick:()=>{c&&(n(c.map(({sequence:h})=>h)),r())},disabled:!c,children:"Save alignment"})]})]})]})}),lp=rt(({experimentId:t,structureId:e,chain:n,proteinsCollection:r,mappedProteinId:i,onShowAlignment:s,ref:o,...a})=>{const[{value:c,loading:l,error:d},h]=Pl(tt(async(g,v)=>{var b;if(i&&Pf(e,n.id,i),!g)return;const w=g in O.referenceProteinsById?O.referenceProteinsById[g]:(b=O.experiments.find(({id:C})=>C===t))==null?void 0:b.proteins.find(({id:C})=>C===g);if(w)return kf(e,n.id,w,v)},[i,e,n.id,t])),f=Cl({defaultValue:i?[i]:[],collection:r,onValueChange:({value:g})=>h(g[0]),invalid:!!d&&!l,disabled:l}),p=!l&&!d&&!!c,m=p&&c.message.startsWith("Note that this mapping might be wrong"),x=r.items.filter(g=>g.fileId===t),y=r.items.filter(g=>g.fileId===void 0&&!x.some(({value:v})=>v===g.value));return u.jsxs(cr,{invalid:!!d&&!l,ref:o,...a,children:[u.jsxs(kl,{size:"xs",value:f,flexDirection:"row",gapX:3,alignItems:"center",children:[u.jsxs(of,{minW:5,children:["/",n.id]}),u.jsxs(nf,{clearable:!l,hideIndicator:l,flexGrow:1,triggerProps:p?{borderColor:m?"fg.warning":"fg.success"}:void 0,children:[u.jsx(sf,{placeholder:"Select protein to map",children:g=>Ht(g.map(v=>v.label+(v.isReferenceProtein?" (reference protein)":"")))}),l&&u.jsx(Ue,{})]}),u.jsxs(Bl,{portalled:!1,mt:-1,children:[x.map(g=>u.jsxs(xs,{item:g,children:[g.label," ",g.isReferenceProtein?"(reference protein)":""]},g.value)),y.length>0&&u.jsxs(u.Fragment,{children:[u.jsx(cn,{}),y.map(g=>u.jsxs(xs,{item:g,children:[g.label," ",g.isReferenceProtein?"(reference protein)":""]},g.value))]})]})]}),!l&&d&&u.jsx(Cn,{children:d.message}),p&&u.jsxs($d,{color:m?"fg.warning":"fg.success",children:[c.message," ",s&&c.mapping.alignedSequences&&u.jsx(_i,{onClick:()=>{Jr(f.selectedItems.length===1);const g=f.selectedItems[0];if(!g)return;const v=new Set;if(g.isReferenceProtein)for(const[w,b]of O.proteinIdToReferenceProtein.entries()){if(b.id!==g.value)continue;const C=O.experiments.flatMap(({proteins:A})=>A).find(({id:A})=>A===w);C&&Object.keys(C.linkPositionToAminoAcid).map(A=>Number.parseInt(A)).forEach(A=>{const _=b.xlPosToRefPos[A];_&&v.add(_)})}else{const w=O.experiments.flatMap(({proteins:b})=>b).find(({id:b})=>b===g.value);w&&Object.keys(w.linkPositionToAminoAcid).map(b=>Number.parseInt(b)).forEach(b=>{v.add(b)})}return s({sequences:[{id:`/${n.id}`,sequence:c.mapping.alignedSequences.chain},{id:g.label,sequence:c.mapping.alignedSequences.protein,highlightedPositions:v}],applyAlignment:w=>h(g.value,w)})},children:"View alignment."})]})]})}),cp=rt(({experiment:t,structureId:e,ref:n,...r})=>{const{structures:i}=mt(O),s=i.find(({id:h})=>h===e),o=eo(),a=L(()=>{const h=new Set;return Sl({items:[...t.proteins.map(({id:f,name:p,isReferenceProtein:m})=>(m&&h.add(f),{value:f,label:p,fileId:t.id,isReferenceProtein:m})),...o.filter(({id:f})=>!h.has(f)).map(({id:f,name:p})=>({value:f,label:p,fileId:void 0,isReferenceProtein:!0}))]})},[t.id,t.proteins,o]),c=ye({trapFocus:!1}),[l,d]=ct();if(!(!s||s.loading))return u.jsxs(be,{ref:n,...r,children:[u.jsxs(Ie,{flexDir:"column",children:[u.jsx(Te,{children:"Structure"}),u.jsx(Pr,{asChild:!0,children:u.jsx(Nt.Root,{size:"sm",orientation:"horizontal",wordBreak:"break-word",children:u.jsxs(Nt.Item,{children:[u.jsx(Nt.ItemLabel,{children:"Name"}),u.jsx(Nt.ItemValue,{children:u.jsx(Ir,{name:s.name,onRename:h=>ql(s.id,{name:h})})})]})})}),u.jsx(Ce,{})]}),u.jsx(Pe,{children:u.jsxs(jr,{gap:5,align:"stretch",children:[u.jsxs(We.Root,{children:[u.jsxs(We.Legend,{children:["Map chains to proteins in ",t.name]}),u.jsx(We.Content,{children:s.chains.map(h=>{var f;return u.jsx(lp,{experimentId:t.id,structureId:s.id,chain:h,proteinsCollection:a,mappedProteinId:(f=Object.entries(s.chainIdToProteinIdToMapping[h.id]).find(([p,m])=>a.has(p)&&m!==void 0))==null?void 0:f[0],onShowAlignment:p=>{d(p),c.setOpen(!0)}},h.id)})})]}),u.jsx(rp,{experiment:t,structure:s},`${s.id}-${t.id}`)]})}),u.jsx(ke,{}),u.jsx(Ge,{value:c,size:"xl",placement:"top",lazyMount:!0,unmountOnExit:!0,children:u.jsx(be,{h:"fit",portalled:!1,children:l&&u.jsx(ap,{alignment:l.sequences,applyAlignment:l.applyAlignment,closeDialog:()=>{c.setOpen(!1)}})})})]})}),up=rt(({dialog:t,dialogProps:e})=>u.jsx(Ge,{value:t,unmountOnExit:!0,lazyMount:!0,children:e&&u.jsx(cp,{...e})})),da=t=>t.linkPosition?`${t.aminoAcid??""}${t.linkPosition}`:"Ø",dp={cell:{width:20,height:20},labels:{crosslinks:{width:270,padding:10,fontSize:10,columns:[{render:({id:t})=>t,padding:0},{render:({from:t,to:e})=>`${da(t)} - ${da(e)}`,padding:30},{render:({from:t,to:e},n,r)=>r?`${n[t.proteinId].name} - ${n[e.proteinId].name}`:null,x:0,textAnchor:"start"}]},structures:{height:100,padding:10,fontSize:10}}},hp=({config:t=dp,experiments:e,groupedCrosslinkIds:n,structureNameById:r,proteinsById:i,ref:s,...o})=>{const a=e.flatMap(({groupedStructureIds:l},d)=>l.flat().map(h=>[d,h])),c=[];for(const{ids:l}of n.flatMap(({rows:d})=>d))c.push(...e.flatMap(({experiment:{crosslinks:d}},h)=>l[h].map(f=>[h,d.find(p=>p.id===f)])));return u.jsxs("svg",{viewBox:`0 0 ${t.labels.crosslinks.width+a.length*t.cell.width} ${t.labels.structures.height+c.length*t.cell.height}`,width:t.labels.crosslinks.width+a.length*t.cell.width,height:t.labels.structures.height+c.length*t.cell.height,...o,ref:s,children:[c.map(([l,d],h)=>a.map(([f,p],m)=>{var x;return f===l?u.jsx("rect",{width:t.cell.width,height:t.cell.height,x:t.labels.crosslinks.width+m*t.cell.width,y:t.labels.structures.height+h*t.cell.height,fill:ae((x=e[f].structureToXlinkIdToStatus[p])==null?void 0:x[d.id])},`${f}-${d.id}-${p}`):null})),c.map(([l,d],h)=>t.labels.crosslinks.columns.map(({render:f,padding:p,...m},x)=>u.jsx("text",{y:t.labels.structures.height+(h+.5)*t.cell.height,x:t.labels.crosslinks.width-t.labels.crosslinks.padding-(p??0),dominantBaseline:"middle",textAnchor:"end",fontSize:t.labels.crosslinks.fontSize,...m,children:f(d,i,h===0||d.from.proteinId!==c[h-1][1].from.proteinId||d.to.proteinId!==c[h-1][1].to.proteinId)},`${l}-xlink-${d.id}-${x}`))),a.map(([l,d],h)=>u.jsx("text",{transform:`translate(${t.labels.crosslinks.width+(h+.5)*t.cell.width}, ${t.labels.structures.height-t.labels.structures.padding}) rotate(90)`,dominantBaseline:"middle",textAnchor:"end",fontSize:t.labels.structures.fontSize,children:r[d]},`${l}-structure-${d}`))]})},fp=({exportBasename:t,gridProps:e,...n})=>{const r=at(null),i=tt(()=>{if(!r.current)return;const d=document.createElement("a"),h=new Blob([new XMLSerializer().serializeToString(r.current)],{type:"image/svg+xml"});d.href=URL.createObjectURL(h),d.download=`${t}-figure.svg`,d.click()},[r,t]),s=tt(()=>{if(!r.current)return;const d=new Blob([new XMLSerializer().serializeToString(r.current)],{type:"image/svg+xml"}),h=window.URL||window.webkitURL||window,f=h.createObjectURL(d),p=new Image;p.width=r.current.viewBox.baseVal.width,p.height=r.current.viewBox.baseVal.height,p.src=f,p.onload=function(){const m=document.getElementById("canvas");m.width=p.width,m.height=p.height;const x=m.getContext("2d");x==null||x.drawImage(p,0,0),h.revokeObjectURL(f);const y=m.toDataURL("image/png").replace("image/png","image/octet-stream"),g=document.createElement("a");g.href=y,g.download=`${t}.png`,g.click()}},[r,t]),[o,a]=ct(!1),[c,l]=ct(!1);return u.jsxs(be,{...n,children:[u.jsxs(Ie,{flexDir:"column",children:[u.jsx(Te,{children:"Export Figure"}),u.jsx(Ce,{})]}),u.jsxs(Pe,{as:lt,justifyContent:"center",onClick:()=>a(d=>!d),cursor:o?"zoom-out":"zoom-in",bgImage:c?"linear-gradient(45deg, #E0E0E0 25%, transparent 25%), linear-gradient(-45deg, #E0E0E0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #E0E0E0 75%), linear-gradient(-45deg, transparent 75%, #E0E0E0 75%)":void 0,bgSize:c?"20px 20px":void 0,bgPos:c?"0 0, 0 10px, 10px -10px, -10px 0px":void 0,children:[u.jsx(hp,{...e,ref:r,...o?{}:{height:"100%"},...c?{}:{style:{backgroundColor:"white"}}}),u.jsx("canvas",{style:{display:"none"},id:"canvas"})]}),u.jsxs(ke,{as:lt,justifyContent:"space-between",children:[u.jsx(mr,{checked:c,onCheckedChange:({checked:d})=>l(!!d),variant:"outline",children:"Transparent background"}),u.jsxs(ti,{children:[u.jsx(ot,{variant:"outline",onClick:()=>i(),children:"Export as SVG"}),u.jsx(ot,{variant:"outline",onClick:()=>s(),children:"Export as PNG"})]})]})]})},uc=({dialog:t,dialogProps:e})=>u.jsx(Ge,{value:t,size:"cover",placement:"center",scrollBehavior:"inside",unmountOnExit:!0,lazyMount:!0,children:e&&u.jsx(fp,{...e})}),ha=({fromProteinId:t,fromDomainName:e,toProteinId:n,toDomainName:r})=>`${t}-${e}-${n}-${r}`,dc=(t,e,n,r)=>{const[i,s]=ct({});for(const[m,x]of Object.entries(i)){const y=t.indexOf(m);if(y===-1)s(g=>Object.fromEntries(Object.entries(g).filter(([v])=>v!==m)));else{const g=new Set(x).difference(new Set(e.flatMap(({rows:v})=>v.flatMap(({ids:w})=>w[y]))));g.size>0&&s(v=>{var w;return{...v,[m]:(w=v[m])==null?void 0:w.filter(b=>!g.has(b))}})}}const o=L(()=>n.map(m=>{if(m)return m.ids.every((x,y)=>x.every(g=>{var v;return((v=i[t[y]])==null?void 0:v.includes(g))===!0}))?!0:m.ids.some((x,y)=>x.some(g=>{var v;return((v=i[t[y]])==null?void 0:v.includes(g))===!0}))?"indeterminate":!1}),[n,i,t]),a=L(()=>r.map((m,x)=>{if(m===void 0)return;let y;for(let g=x;g<o.length&&(g===x||r[g]===void 0);++g)if(o[g]!==void 0){if(y===void 0){if(y=o[g],y==="indeterminate")return"indeterminate"}else if(y!==o[g])return"indeterminate"}return y}),[r,o]),c=Object.values(i).flat().length,l=o.some(m=>m==="indeterminate")?void 0:o.filter(m=>m===!0).length,d=tt((m,x)=>{const y=Object.fromEntries(In(...x.map(({ids:g})=>g)).map((g,v)=>[t[v],g.flatMap(w=>w??[])]));s(m?g=>Object.fromEntries(Object.values(Object.groupBy([...Object.entries(g).flatMap(([v,w])=>w?[[v,w]]:[]),...Object.entries(y)],([v])=>v)).filter(v=>v!==void 0).map(v=>[v[0][0],Array.from(new Set(v.flatMap(([w,b])=>b)))])):g=>Object.fromEntries(Object.entries(g).map(([v,w])=>[v,w==null?void 0:w.filter(b=>!y[v].includes(b))])))},[t]),h=tt((m,x,y)=>{if(!y)d(m,[x]);else{const g=n.findIndex(w=>w&&JSON.stringify(w)===JSON.stringify(x)),v=gl(o,m,g);d(m,v.map(w=>n[w]).filter(w=>w!==void 0))}},[d,n,o]),f=tt((m,x,y)=>d(m,e.find(g=>ha(g)===ha(x)).rows),[d,e]),p=tt(()=>s({}),[]);return{selectedCrosslinkIds:i,rowIndexToCheckedState:o,rowIndexToGroupCheckedState:a,numOfSelectedCrosslinks:c,numOfSelectedRows:l,onRowToggle:h,onGroupToggle:f,clearSelectedRows:p}},hc=rt(({selectedCrosslinkIds:t,numOfSelectedCrosslinks:e,numOfSelectedRows:n,clearSelectedRows:r,saveCrosslinksTable:i,hideCrosslinks:s,...o})=>u.jsx(ic,{open:e>0,onOpenChange:({open:a})=>a?null:r(),closeOnInteractOutside:!1,...o,children:u.jsxs(nc,{children:[u.jsxs(sc,{children:[n!==void 0&&n!==e?yt(n,"row"):yt(e,"crosslink")," ","selected"]}),u.jsx(ci,{}),u.jsxs(ot,{variant:"surface",size:"sm",onClick:()=>i(t),children:[u.jsx(Gl,{}),"Export"]}),u.jsx(ci,{}),u.jsxs(ot,{variant:"surface",colorPalette:"red",size:"sm",onClick:()=>{s(t),r()},children:[u.jsx(Ku,{}),"Hide"]}),u.jsx(rc,{})]})})),pp="_experimentname_7yvhj_1",mp={experimentname:pp},gp=t=>{var d;const[e,n]=ct({});for(const[h,f]of Object.entries(e)){const p=(d=t.find(x=>x.experimentId===h))==null?void 0:d.structureIds;if(p===void 0){n(x=>Object.fromEntries(Object.entries(x).filter(([y])=>y!==h)));continue}const m=new Set(f).difference(new Set(p));m.size>0&&n(x=>{var y;return{...x,[h]:(y=x[h])==null?void 0:y.difference(m)}})}const r=L(()=>t.flatMap(({experimentId:h,structureIds:f})=>f.map(p=>{var m;return{experimentId:h,structureId:p,checked:((m=e[h])==null?void 0:m.has(p))??!1}})),[t,e]),i=t.map(({experimentId:h})=>{var f;return((f=e[h])==null?void 0:f.size)??0}),s=i.reduce((h,f)=>h+f,0),o=s===0?0:i.reduce((h,f)=>h+(f>0?1:0),0),a=tt((h,f)=>{const p=Object.fromEntries(Object.entries(Object.groupBy(f,({experimentId:m})=>m)).map(([m,x])=>[m,(x==null?void 0:x.map(({structureId:y})=>y))??[]]));n(h?m=>Object.fromEntries(Object.values(Object.groupBy([...Object.entries(m).flatMap(([x,y])=>y?[[x,Array.from(y)]]:[]),...Object.entries(p)],([x])=>x)).filter(x=>x!==void 0).map(x=>[x[0][0],new Set(x.flatMap(([y,g])=>g))])):m=>Object.fromEntries(Object.entries(m).map(([x,y])=>[x,y==null?void 0:y.difference(new Set(p[x]??[]))])))},[]),c=tt((h,f,p,m)=>{if(!m)a(h,[{experimentId:f,structureId:p}]);else{const x=r.findIndex(g=>g.experimentId===f&&g.structureId===p),y=gl(r.map(({checked:g})=>g),h,x);a(h,y.map(g=>r[g]).filter(g=>g!==void 0))}},[a,r]),l=tt(()=>n({}),[]);return{experimentIdToSelectedStructureIds:e,numOfSelectedStructures:s,numOfExperimentsWithSelections:o,onStructureToggle:c,clearStructureSelection:l}},xp=rt(({experiments:t,groupedCrosslinkIds:e,proteinsById:n,structuresById:r,groupDuplicates:i,hideCrosslinks:s})=>{var Qe,Pt,se;const o=Gt(t),a=!Object.is(o,t),c=Gt(e),l=Gt(n),d=Gt(r),h=Gt(i),f=at(null),p=L(()=>{const z=[void 0,void 0];return c.forEach(({rows:W},X)=>{X!==0&&z.push(void 0);const et=h?W.length:W.reduce((st,{ids:Dt})=>st+Math.max(...Dt.map(ft=>ft.length)),0);z.push(X),z.push(...Array(et-1).fill(void 0))}),z},[h,c]),m=L(()=>{const z=[void 0,void 0];return c.forEach(({rows:W},X)=>{X!==0&&z.push(void 0);for(const et of W)if(h)z.push(et);else{const st=In(...et.homoMultimeric),Dt=In(...et.scores);z.push(...In(...et.ids).map((ft,J)=>({...et,ids:ft.map(Tt=>Tt!==void 0?[Tt]:[]),homoMultimeric:ft.map((Tt,de)=>{var Ae;return Tt!==void 0?[(Ae=st[J])==null?void 0:Ae[de]]:[]}),scores:ft.map((Tt,de)=>{var Ae;return Tt!==void 0?[(Ae=Dt[J])==null?void 0:Ae[de]]:[]})})).flat())}}),z},[h,c]),x=z=>{if(z===0)return"header";if(z===1)return"header-2";const W=m[z];return W===void 0?`gap-after-${x(z-1)}`:W.ids.map(X=>X.length>0?X.join("-"):"X").join(":")},y=ec({enabled:c.length>0,count:m.length,estimateSize:z=>z===0?40:z===1?80:m[z]===void 0?5:26,scrollMargin:((Qe=f.current)==null?void 0:Qe.offsetTop)??0,getItemKey:x,overscan:20,rangeExtractor:z=>new Set([0,1,...ro(z),...p.flatMap((W,X)=>W!==void 0?[X]:[])]).values().toArray()}),g=L(()=>{const z=[void 0];return o.forEach(({groupedStructureIds:W},X)=>{X!==0&&z.push(void 0),z.push([X,void 0]),W.forEach((et,st)=>{st!==0&&z.push([X,void 0]),z.push(...et.map(Dt=>[X,Dt]))}),z.push([X,void 0])}),z},[o]),v=z=>{if(z===0)return"header";const W=g[z];return W===void 0||W[1]===void 0?`gap-after-${v(z-1)}`:`${o[W[0]].experiment.id}-${W[1]}`},w=tc({enabled:c.length>0,horizontal:!0,count:g.length,getScrollElement:()=>f.current,estimateSize:z=>{if(z===0)return 237;const W=g[z];return W===void 0?10:W[1]===void 0?5:26},overscan:20,getItemKey:v}),b=w.getVirtualItems(),[C,A]=b.length>0?[b[0].start,w.getTotalSize()-b[b.length-1].end]:[0,0],{experimentIdToSelectedStructureIds:_,numOfSelectedStructures:S,numOfExperimentsWithSelections:T,onStructureToggle:P,clearStructureSelection:M}=gp(L(()=>o.map(({experiment:z,groupedStructureIds:W})=>({experimentId:z.id,structureIds:W.flat()})),[o]));let $=((Pt=w.measurementsCache[0])==null?void 0:Pt.size)??0;const R=z=>{var st,Dt;if(!w.options.enabled||!z||!z.dataset.index)return;const W=z.getBoundingClientRect().width;if(z.dataset.index==="0"){$<W&&($=W,w.resizeItem(0,Math.ceil(W)));return}const[X,et]=z.dataset.index.split("-").map(ft=>Number.parseInt(ft));if(!Number.isNaN(X)&&!Number.isNaN(et)){let ft=W;for(let Tt=X;Tt<et;++Tt){const de=g[Tt];de===void 0?ft-=10:de[1]===void 0?ft-=5:ft-=26}const J=ft/2;(((st=w.measurementsCache[X])==null?void 0:st.size)??0)<J&&w.resizeItem(X,Math.ceil(J)),(((Dt=w.measurementsCache[et])==null?void 0:Dt.size)??0)<J&&w.resizeItem(et,Math.ceil(J))}};St(()=>{w.measure()},[c,l,w]);let j=((se=y.measurementsCache[0])==null?void 0:se.size)??0;const I=z=>{!y.options.enabled||!z||z.dataset.index!=="1"||j<z.getBoundingClientRect().height&&(j=z.getBoundingClientRect().height,y.resizeItem(1,Math.ceil(z.getBoundingClientRect().height)))};St(()=>{y.measure()},[d,y]);const k=L(()=>u.jsxs(u.Fragment,{children:[u.jsx(ei,{styles:{".xlink":{cursor:"pointer",color:"transparent",fontSize:"0.8rem",alignContent:"center",textAlign:"center",":hover":{boxShadow:"inset 0px 0px 0px 1px var(--chakra-colors-fg-inverted)",color:"var(--chakra-colors-fg-inverted)"}}}}),u.jsx(ei,{styles:Object.fromEntries(c.flatMap(({fromProteinId:z,fromDomainName:W,toProteinId:X,toDomainName:et})=>[z,...W?[z+W]:[],X,...et?[X+et]:[]].map(st=>[`html:has(.xlp${dr(st)}:hover) .xlp${dr(st)}`,{boxShadow:"inset 0px 0px 0px 1px var(--chakra-colors-fg-info)"}])))})]}),[c]),[E,N]=ct(),V=ye({trapFocus:!1}),[F,H]=ct(),K=ye({trapFocus:!1}),D=o.some(({experiment:{crosslinks:z}})=>z.some(({score:W})=>W!==void 0)),[B,Y]=Yd("fieldToShow","ids"),q=o.length>1?void 0:D?B:"ids",G=D?()=>Y(B==="ids"?"scores":"ids"):void 0,Z=ye({}),{selectedCrosslinkIds:it,rowIndexToCheckedState:nt,rowIndexToGroupCheckedState:Ot,numOfSelectedCrosslinks:ut,numOfSelectedRows:xt,onRowToggle:wt,onGroupToggle:ht,clearSelectedRows:Q}=dc(L(()=>o.map(({experiment:z})=>z.id),[o]),c,m,p),zt=tt(z=>Ii(ki(o.map(({experiment:W})=>W),c.map(({rows:W,...X})=>({rows:W.map(({ids:et,...st})=>({ids:et.map((Dt,ft)=>Dt.filter(J=>{var Tt;return((Tt=z[o[ft].experiment.id])==null?void 0:Tt.includes(J))===!0})),...st})),...X}))),`${o.length===1?o[0].experiment.name??"XLinkUp":"Experiments"}-xlinks`),[o,c]);return u.jsxs(u.Fragment,{children:[u.jsx(up,{dialog:V,dialogProps:E}),u.jsx(np,{dialog:K,dialogProps:F}),u.jsx(uc,{dialog:Z,dialogProps:{exportBasename:o.length===1?o[0].experiment.name??"XLinkUp":"Experiments",gridProps:{experiments:o,groupedCrosslinkIds:c,proteinsById:l,structureNameById:Object.fromEntries(Object.values(d).map(({id:z,name:W})=>[z,W]))}}}),k,u.jsx("div",{ref:f,style:{overflowY:"auto",opacity:a?.5:1,transition:a?"opacity 0.2s 0.2s linear":"opacity 0s 0s linear",userSelect:"none",WebkitUserSelect:"none",display:"flex",justifyContent:"center",marginLeft:"1rem",marginRight:"1rem",marginBottom:ut>0||S>0?"5rem":void 0},children:u.jsx("div",{style:{height:y.getTotalSize(),position:"relative",width:w.getTotalSize()},children:y.getVirtualItems().map(z=>{const W=z.index===0||z.index===1,X=m[z.index];if(!W&&X===void 0)return null;const et=!W&&p[z.index]!==void 0?c[p[z.index]]:void 0;return u.jsxs("div",{"data-index":z.index,ref:z.index===1?I:void 0,style:{position:"absolute",top:0,left:0,transform:`translateY(${z.start-y.options.scrollMargin}px)`,display:"flex"},children:[u.jsx("div",{style:{width:`${C}px`}}),b.map(st=>{var Tt,de,Ae;const Dt=st.index===0,ft=g[st.index];if(z.index===0){const Vt=ft==null?void 0:ft[0];if(Vt===void 0)return u.jsx("div",{"data-index":st.index,style:{minHeight:z.size,minWidth:st.size,maxHeight:150,maxWidth:500,flexShrink:0}},st.key);if(((Tt=g[st.index-1])==null?void 0:Tt[0])===Vt)return null;const Eo=g.findLastIndex(he=>(he==null?void 0:he[0])===Vt&&(he==null?void 0:he[1])===void 0),Au=Array.from(new Array(Eo-st.index+1)).map((he,Hi)=>st.index+Hi);return u.jsx("div",{"data-index":`${st.index}-${Eo}`,ref:R,className:o.length>1?mp.experimentname:void 0,style:{minHeight:z.size,minWidth:Au.reduce((he,Hi)=>{var Ro;return he+(((Ro=b[Hi])==null?void 0:Ro.size)??0)},0),maxHeight:150,maxWidth:500,flexShrink:0,textAlign:"center"},children:o.length>1&&u.jsxs("span",{children:[u.jsx(Cr,{pb:"0.1rem",mr:"0.5rem",children:u.jsx(Ti,{})}),o[Vt].experiment.name]})},st.key)}const J=ft!==void 0&&ft[1]!==void 0?{file:o[ft[0]],structureId:ft[1],crosslinkIds:X==null?void 0:X.ids[ft[0]]}:void 0;return u.jsxs("div",{"data-index":st.index,ref:st.index===0?R:void 0,className:an(J==null?void 0:J.crosslinkIds)?"xlink":void 0,onClick:()=>{if(J!=null&&J.crosslinkIds&&J.crosslinkIds.length>0){const Vt=d[J.structureId];if(Vt.loading)return;H({experiment:J.file.experiment,crosslinkIds:J.crosslinkIds,structure:Vt}),K.setOpen(!0)}},style:{minHeight:z.size,maxHeight:150,minWidth:st.size,maxWidth:500,flexShrink:0,...an(J==null?void 0:J.crosslinkIds)&&!d[J.structureId].loading?{backgroundColor:ae((de=J.file.structureToXlinkIdToStatus[J.structureId])==null?void 0:de[J.crosslinkIds[0]])}:{}},children:[W&&z.index===1&&Dt&&u.jsx(oc,{field:q,onFieldClick:G,viewName:o.length===1?o[0].experiment.name??"XLinkUp":"Experiments",experiments:o.map(({experiment:Vt})=>Vt),groupedCrosslinkIds:c,exportFigureDialog:o.some(({groupedStructureIds:Vt})=>Vt.flat().length>0)?Z:void 0,showingStructures:o.some(({groupedStructureIds:Vt})=>Vt.flat().length>0),disableMenus:ut!==0||S!==0}),W&&z.index===1&&!Dt&&J!==void 0&&u.jsx(Yf,{experimentId:J.file.experiment.id,structure:d[J.structureId],checked:((Ae=_==null?void 0:_[J.file.experiment.id])==null?void 0:Ae.has(J.structureId))??!1,onToggle:ut===0?P:void 0,onClick:()=>{N({experiment:J.file.experiment,structureId:J.structureId}),V.setOpen(!0)}}),Dt&&!W&&X!==void 0&&u.jsx(Kl,{rowHeader:X,groupHeader:et,field:q,checked:nt[z.index],groupedChecked:Ot[z.index],toggle:S===0?wt:void 0,toggleGroup:S===0?ht:void 0}),(J==null?void 0:J.crosslinkIds)&&(J.crosslinkIds.length??0)>1&&`x${J.crosslinkIds.length}`]},st.key)}),u.jsx("div",{style:{width:`${A}px`}})]},z.key)})})}),u.jsx(ic,{open:S>0,onOpenChange:({open:z})=>z?null:M(),closeOnInteractOutside:!1,children:u.jsxs(nc,{children:[u.jsxs(sc,{children:[yt(S,"structure")," selected"]}),u.jsx(ci,{}),u.jsxs(ot,{variant:"surface",size:"sm",disabled:T>1,onClick:()=>{const z=Object.entries(_??{}).find(([et,st])=>st&&st.size>0);if(!z||!z[1])return;const[W,X]=z;bf(W,[...X]),M()},children:[u.jsx(Xf,{}),"Group"]}),u.jsx(ci,{}),u.jsxs(Vh,{placement:"center",children:[u.jsx(Hh,{asChild:!0,children:u.jsxs(ot,{variant:"surface",colorPalette:"red",size:"sm",children:[u.jsx(Zu,{}),"Hide"]})}),u.jsxs(be,{children:[u.jsxs(Ie,{children:[u.jsxs(Te,{children:["Hide ",yt(S,"structure"),"?"]}),u.jsx(Ce,{})]}),u.jsxs(Pe,{children:["The structure",S!==1?"s":""," will be removed from the experiment",T!==1?"s":"",', but will still be available under the "Structures" tab.']}),u.jsxs(ke,{children:[u.jsx(gs,{asChild:!0,children:u.jsx(ot,{variant:"outline",children:"Cancel"})}),u.jsx(gs,{asChild:!0,children:u.jsx(ot,{colorPalette:"red",onClick:()=>{Object.entries(_??{}).forEach(([z,W])=>{W&&no(z,Array.from(W))}),M()},children:"Hide"})})]})]})]}),u.jsx(rc,{})]})}),u.jsx(hc,{selectedCrosslinkIds:it,numOfSelectedCrosslinks:ut,numOfSelectedRows:xt,clearSelectedRows:Q,saveCrosslinksTable:zt,hideCrosslinks:s})]})}),fc=rt(({resetFilters:t,loading:e})=>u.jsx(Un.Root,{children:u.jsxs(Un.Content,{children:[u.jsx(Un.Indicator,{children:u.jsx(Qu,{})}),u.jsxs(jr,{textAlign:"center",children:[u.jsx(Un.Title,{children:"No crosslinks match the current filters"}),u.jsx(Un.Description,{children:"Adjust the filters or upload a new file to see crosslinks."}),u.jsx(_r,{size:"sm",onClick:t,variant:"outline",loading:e,children:"Reset Filters"})]})]})}));function pc({experiments:t,structures:e,groupDuplicates:n,resetFilters:r,hideCrosslinks:i}){const s=L(()=>Object.fromEntries(e.map(c=>[c.id,c])),[e]),o=L(()=>Object.fromEntries(t.flatMap(({experiment:{proteins:c}})=>c.map(l=>[l.id,l]))),[t]),a=L(()=>pr(t.map(({experiment:{crosslinks:c},visibleCrosslinkIds:l})=>c.filter(({id:d})=>l.has(d))),o),[t,o]);return a.length===0?u.jsx(fc,{resetFilters:r,loading:!1}):u.jsx(xp,{experiments:t,groupedCrosslinkIds:a,proteinsById:o,structuresById:s,groupDuplicates:n,hideCrosslinks:i})}const mc=(t,e)=>{const n=new Set;for(const r of t){const i=Dl(r,e),s=oe(i?[i]:[],e);n.add(s)}return n.size===1&&n.has(void 0)?"unmapped":(n.delete(void 0),n.size===1?n.values().next().value??"unmapped":n.has("ok")?(Jr(n.has("under")||n.has("over")),"partially-ok"):(Jr(n.size===2&&n.has("under")&&n.has("over")),"mixed-violated"))},Mi=(t,e)=>{const n=t.map(r=>mc(r,e));return ur(Object.entries(Object.groupBy(n,r=>r)).map(([r,i])=>[r,i.length]))},gc="label";function fa(t,e){typeof t=="function"?t(e):t&&(t.current=e)}function yp(t,e){const n=t.options;n&&e&&Object.assign(n,e)}function xc(t,e){t.labels=e}function yc(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:gc;const r=[];t.datasets=e.map(i=>{const s=t.datasets.find(o=>o[n]===i[n]);return!s||!i.data||r.includes(s)?{...i}:(r.push(s),Object.assign(s,i),s)})}function vp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gc;const n={labels:[],datasets:[]};return xc(n,t.labels),yc(n,t.datasets,e),n}function bp(t,e){const{height:n=150,width:r=300,redraw:i=!1,datasetIdKey:s,type:o,data:a,options:c,plugins:l=[],fallbackContent:d,updateMode:h,...f}=t,p=at(null),m=at(null),x=()=>{p.current&&(m.current=new ve(p.current,{type:o,data:vp(a,s),options:c&&{...c},plugins:l}),fa(e,m.current))},y=()=>{fa(e,null),m.current&&(m.current.destroy(),m.current=null)};return St(()=>{!i&&m.current&&c&&yp(m.current,c)},[i,c]),St(()=>{!i&&m.current&&xc(m.current.config.data,a.labels)},[i,a.labels]),St(()=>{!i&&m.current&&a.datasets&&yc(m.current.config.data,a.datasets,s)},[i,a.datasets]),St(()=>{m.current&&(i?(y(),setTimeout(x)):m.current.update(h))},[i,c,a.labels,a.datasets,h]),St(()=>{m.current&&(y(),setTimeout(x))},[o]),St(()=>(x(),()=>y()),[]),Xs.createElement("canvas",{ref:p,role:"img",height:n,width:r,...f},d)}const wp=_t(bp);function vc(t,e){return ve.register(e),_t((n,r)=>Xs.createElement(wp,{...n,ref:r,type:t}))}const jp=vc("line",Dd),ao=vc("bar",Nd);ve.register(Ks,Si,Zs,Ze,Ld);Ze.positioners.center=(t,e)=>{if(t.length===0)return!1;const{base:n,x:r,y:i,height:s}=t[0].element;return e.x<n||e.x>r?!1:{x:n+(r-n)/2,y:i-s/2,yAlign:"bottom"}};const bc=({groupedCategoryToCount:t})=>{const e={plugins:{legend:{display:!1,onClick:()=>{}},tooltip:{position:"center"}},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,title:{display:!0,text:"Count"}},y:{stacked:!0}},indexAxis:"y",layout:{padding:{top:40}}},n={labels:t.map(({label:r})=>r),datasets:[{label:"Satisfied",data:t.map(({categoryToCount:r})=>r.ok??0),backgroundColor:"green"},{label:"Partially Satisfied",data:t.map(({categoryToCount:r})=>r["partially-ok"]??0),backgroundColor:"#14b8a6"},{label:"Above threshold",data:t.map(({categoryToCount:r})=>r.over??0),backgroundColor:"red"},{label:"Mixed",data:t.map(({categoryToCount:r})=>r["mixed-violated"]??0),backgroundColor:"pink"},{label:"Below threshold",data:t.map(({categoryToCount:r})=>r.under??0),backgroundColor:"orange"},{label:"Unmapped",data:t.map(({categoryToCount:r})=>r.unmapped??0),backgroundColor:"rgb(161, 161, 170)"}]};return u.jsx("div",{style:{position:"relative",height:(190+t.length*60)/2,width:"100%"},children:u.jsx(ao,{options:e,data:n})})},_p=({groupedCrosslinks:t,structures:e,thresholds:n,aminoAcidsMustMatch:r})=>{const i=L(()=>t.map(({crosslinks:a})=>a.map(c=>Bn(c,e,r))),[t,e,r]),s=L(()=>i.map((a,c)=>{const l=(f,p)=>p===void 0?f:`${f} (${p})`,d=l(t[c].groupHeader.fromProteinName??"",t[c].groupHeader.fromDomainName),h=l(t[c].groupHeader.toProteinName??"",t[c].groupHeader.toDomainName);return{label:`${d} : ${h}`,categoryToCount:Mi(a,n??{})}}),[i,t,n]),o=(n==null?void 0:n.lower)!==void 0||(n==null?void 0:n.upper)!==void 0;return u.jsx(bc,{groupedCategoryToCount:s,hasThresholds:o})},Sp=({crosslinks:t,groupedStructures:e,thresholds:n,aminoAcidsMustMatch:r})=>{const i=L(()=>e.map(a=>t.map(c=>Bn(c,a,r))),[e,t,r]),s=L(()=>(i.length===1?i[0].map(a=>[a]):i).map((a,c)=>({label:e[c].map(({name:l})=>l).join(","),categoryToCount:Mi(a,n??{})})),[i,e,n]),o=(n==null?void 0:n.lower)!==void 0||(n==null?void 0:n.upper)!==void 0;return u.jsx(bc,{groupedCategoryToCount:s,hasThresholds:o})};ve.register(Ks,Si,Zs,Ze);Ze.positioners.top=t=>{if(t.length===0)return!1;const e=t[0].element.x,n=t.reduce((r,{element:i})=>Math.min(r,i.y),1/0);return{x:e,y:n,yAlign:"bottom"}};const Cp=({crosslinks:t,structures:e,thresholds:n,aminoAcidsMustMatch:r})=>{const i=L(()=>t.map(c=>Bn(c,e,r)),[t,e,r]),s=L(()=>Mi(i,n??{}),[i,n]),o={plugins:{legend:{display:!1},tooltip:{position:"top",titleAlign:"center",filter(c){switch(c.label){case"Satisfied":case"Mapped":return["ok"].includes(c.dataset.label??"");case"Partially Satisfied":return["partially-ok"].includes(c.dataset.label??"");case"Violated":return["under","mixed-violated","over"].includes(c.dataset.label??"");case"Unmapped":return c.dataset.label===void 0}return!1},callbacks:{title:c=>{const l=c.reduce((h,{raw:f})=>h+f,0);let d=`${yt(l,"crosslink")} ${l===1?"is":"are"} `;switch(c[0].label){case"Satisfied":d+=`satisfied
in all mapped structures`;break;case"Mapped":d+=`mapped
in all structures`;break;case"Unmapped":d+=`unmapped
in all structures`;break;case"Violated":d+=`violated
in all mapped structures`;break;case"Partially Satisfied":d+=`satisfied
in some mapped structures,
and violated in others`;break}return d},label:c=>{if(c.label!=="Violated")return"";switch(c.dataset.label){case"over":return(n==null?void 0:n.upper)===void 0?"":`Above ${(n==null?void 0:n.upper)??0} Å: ${c.raw}`;case"under":return(n==null?void 0:n.lower)===void 0?"":`Below ${(n==null?void 0:n.lower)??0} Å: ${c.raw}`;case"mixed-violated":return c.raw===0?"":`Mixed: ${c.raw}`}}}}},responsive:!0,maintainAspectRatio:!1,interaction:{mode:"x",intersect:!1},scales:{x:{stacked:!0},y:{stacked:!0,title:{display:!0,text:"Count"}}},layout:{padding:{top:40}}},a=(()=>{const c=(n==null?void 0:n.lower)!==void 0||(n==null?void 0:n.upper)!==void 0,l=c?["Satisfied","Partially Satisfied","Violated","Unmapped"]:["Mapped","Unmapped"],d=(h,f,p)=>({label:f,data:l.map(m=>m===h?s[f]??0:0),backgroundColor:p});return{labels:l,datasets:c?[d("Satisfied","ok","green"),d("Partially Satisfied","partially-ok","#14b8a6"),d("Violated","over","red"),d("Violated","mixed-violated","#f472b6"),d("Violated","under","orange"),d("Unmapped","unmapped","rgb(161, 161, 170)")]:[d("Mapped","ok","green"),d("Unmapped","unmapped","rgb(161, 161, 170)")]}})();return u.jsx(kr,{children:u.jsx("div",{style:{position:"relative",height:"300px",width:"100%"},children:u.jsx(ao,{options:o,data:a})})})};function Ur(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function kp(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function wc(t){let e,n,r;t.length!==2?(e=Ur,n=(a,c)=>Ur(t(a),c),r=(a,c)=>t(a)-c):(e=t===Ur||t===kp?t:Ip,n=t,r=t);function i(a,c,l=0,d=a.length){if(l<d){if(e(c,c)!==0)return d;do{const h=l+d>>>1;n(a[h],c)<0?l=h+1:d=h}while(l<d)}return l}function s(a,c,l=0,d=a.length){if(l<d){if(e(c,c)!==0)return d;do{const h=l+d>>>1;n(a[h],c)<=0?l=h+1:d=h}while(l<d)}return l}function o(a,c,l=0,d=a.length){const h=i(a,c,l,d-1);return h>l&&r(a[h-1],c)>-r(a[h],c)?h-1:h}return{left:i,center:o,right:s}}function Ip(){return 0}function Pp(t){return t===null?NaN:+t}const Tp=wc(Ur),Mp=Tp.right;wc(Pp).center;function Ap(t,e){let n=0;for(let r of t)r!=null&&(r=+r)>=r&&++n;return n}function Qi(t,e){let n,r;if(e===void 0)for(const i of t)i!=null&&(n===void 0?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let s of t)(s=e(s,++i,t))!=null&&(n===void 0?s>=s&&(n=r=s):(n>s&&(n=s),r<s&&(r=s)))}return[n,r]}function Ep(t){return t}var Rp=Array.prototype,$p=Rp.slice;function Ji(t){return()=>t}const Op=Math.sqrt(50),zp=Math.sqrt(10),Dp=Math.sqrt(2);function di(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=Op?10:s>=zp?5:s>=Dp?2:1;let a,c,l;return i<0?(l=Math.pow(10,-i)/o,a=Math.round(t*l),c=Math.round(e*l),a/l<t&&++a,c/l>e&&--c,l=-l):(l=Math.pow(10,i)*o,a=Math.round(t/l),c=Math.round(e/l),a*l<t&&++a,c*l>e&&--c),c<a&&.5<=n&&n<2?di(t,e,n*2):[a,c,l]}function jc(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,s,o]=r?di(e,t,n):di(t,e,n);if(!(s>=i))return[];const a=s-i+1,c=new Array(a);if(r)if(o<0)for(let l=0;l<a;++l)c[l]=(s-l)/-o;else for(let l=0;l<a;++l)c[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)c[l]=(i+l)/-o;else for(let l=0;l<a;++l)c[l]=(i+l)*o;return c}function ws(t,e,n){return e=+e,t=+t,n=+n,di(t,e,n)[2]}function Np(t,e,n){let r;for(;;){const i=ws(t,e,n);if(i===r||i===0||!isFinite(i))return[t,e];i>0?(t=Math.floor(t/i)*i,e=Math.ceil(e/i)*i):i<0&&(t=Math.ceil(t*i)/i,e=Math.floor(e*i)/i),r=i}}function Lp(t){return Math.max(1,Math.ceil(Math.log(Ap(t))/Math.LN2)+1)}function Fp(){var t=Ep,e=Qi,n=Lp;function r(i){Array.isArray(i)||(i=Array.from(i));var s,o=i.length,a,c,l=new Array(o);for(s=0;s<o;++s)l[s]=t(i[s],s,i);var d=e(l),h=d[0],f=d[1],p=n(l,h,f);if(!Array.isArray(p)){const w=f,b=+p;if(e===Qi&&([h,f]=Np(h,f,b)),p=jc(h,f,b),p[0]<=h&&(c=ws(h,f,b)),p[p.length-1]>=f)if(w>=f&&e===Qi){const C=ws(h,f,b);isFinite(C)&&(C>0?f=(Math.floor(f/C)+1)*C:C<0&&(f=(Math.ceil(f*-C)+1)/-C))}else p.pop()}for(var m=p.length,x=0,y=m;p[x]<=h;)++x;for(;p[y-1]>f;)--y;(x||y<m)&&(p=p.slice(x,y),m=y-x);var g=new Array(m+1),v;for(s=0;s<=m;++s)v=g[s]=[],v.x0=s>0?p[s-1]:h,v.x1=s<m?p[s]:f;if(isFinite(c)){if(c>0)for(s=0;s<o;++s)(a=l[s])!=null&&h<=a&&a<=f&&g[Math.min(m,Math.floor((a-h)/c))].push(i[s]);else if(c<0){for(s=0;s<o;++s)if((a=l[s])!=null&&h<=a&&a<=f){const w=Math.floor((h-a)*c);g[Math.min(m,w+(p[w]<=a))].push(i[s])}}}else for(s=0;s<o;++s)(a=l[s])!=null&&h<=a&&a<=f&&g[Mp(p,a,0,m)].push(i[s]);return g}return r.value=function(i){return arguments.length?(t=typeof i=="function"?i:Ji(i),r):t},r.domain=function(i){return arguments.length?(e=typeof i=="function"?i:Ji([i[0],i[1]]),r):e},r.thresholds=function(i){return arguments.length?(n=typeof i=="function"?i:Ji(Array.isArray(i)?$p.call(i):i),r):n},r}var Bp={value:()=>{}};function Tr(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new qr(n)}function qr(t){this._=t}function Vp(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}qr.prototype=Tr.prototype={constructor:qr,on:function(t,e){var n=this._,r=Vp(t+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(t=r[s]).type)&&(i=Hp(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=r[s]).type)n[i]=pa(n[i],t.name,e);else if(e==null)for(i in n)n[i]=pa(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new qr(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,i=s.length;r<i;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};function Hp(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function pa(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Bp,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var js="http://www.w3.org/1999/xhtml";const ma={svg:"http://www.w3.org/2000/svg",xhtml:js,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ai(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),ma.hasOwnProperty(e)?{space:ma[e],local:t}:t}function Wp(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===js&&e.documentElement.namespaceURI===js?e.createElement(t):e.createElementNS(n,t)}}function Xp(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function _c(t){var e=Ai(t);return(e.local?Xp:Wp)(e)}function Yp(){}function lo(t){return t==null?Yp:function(){return this.querySelector(t)}}function Up(t){typeof t!="function"&&(t=lo(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,a=r[i]=new Array(o),c,l,d=0;d<o;++d)(c=s[d])&&(l=t.call(c,c.__data__,d,s))&&("__data__"in c&&(l.__data__=c.__data__),a[d]=l);return new Xt(r,this._parents)}function qp(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Gp(){return[]}function Sc(t){return t==null?Gp:function(){return this.querySelectorAll(t)}}function Kp(t){return function(){return qp(t.apply(this,arguments))}}function Zp(t){typeof t=="function"?t=Kp(t):t=Sc(t);for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o=e[s],a=o.length,c,l=0;l<a;++l)(c=o[l])&&(r.push(t.call(c,c.__data__,l,o)),i.push(c));return new Xt(r,i)}function Cc(t){return function(){return this.matches(t)}}function kc(t){return function(e){return e.matches(t)}}var Qp=Array.prototype.find;function Jp(t){return function(){return Qp.call(this.children,t)}}function t0(){return this.firstElementChild}function e0(t){return this.select(t==null?t0:Jp(typeof t=="function"?t:kc(t)))}var n0=Array.prototype.filter;function r0(){return Array.from(this.children)}function i0(t){return function(){return n0.call(this.children,t)}}function s0(t){return this.selectAll(t==null?r0:i0(typeof t=="function"?t:kc(t)))}function o0(t){typeof t!="function"&&(t=Cc(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,a=r[i]=[],c,l=0;l<o;++l)(c=s[l])&&t.call(c,c.__data__,l,s)&&a.push(c);return new Xt(r,this._parents)}function Ic(t){return new Array(t.length)}function a0(){return new Xt(this._enter||this._groups.map(Ic),this._parents)}function hi(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}hi.prototype={constructor:hi,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function l0(t){return function(){return t}}function c0(t,e,n,r,i,s){for(var o=0,a,c=e.length,l=s.length;o<l;++o)(a=e[o])?(a.__data__=s[o],r[o]=a):n[o]=new hi(t,s[o]);for(;o<c;++o)(a=e[o])&&(i[o]=a)}function u0(t,e,n,r,i,s,o){var a,c,l=new Map,d=e.length,h=s.length,f=new Array(d),p;for(a=0;a<d;++a)(c=e[a])&&(f[a]=p=o.call(c,c.__data__,a,e)+"",l.has(p)?i[a]=c:l.set(p,c));for(a=0;a<h;++a)p=o.call(t,s[a],a,s)+"",(c=l.get(p))?(r[a]=c,c.__data__=s[a],l.delete(p)):n[a]=new hi(t,s[a]);for(a=0;a<d;++a)(c=e[a])&&l.get(f[a])===c&&(i[a]=c)}function d0(t){return t.__data__}function h0(t,e){if(!arguments.length)return Array.from(this,d0);var n=e?u0:c0,r=this._parents,i=this._groups;typeof t!="function"&&(t=l0(t));for(var s=i.length,o=new Array(s),a=new Array(s),c=new Array(s),l=0;l<s;++l){var d=r[l],h=i[l],f=h.length,p=f0(t.call(d,d&&d.__data__,l,r)),m=p.length,x=a[l]=new Array(m),y=o[l]=new Array(m),g=c[l]=new Array(f);n(d,h,x,y,g,p,e);for(var v=0,w=0,b,C;v<m;++v)if(b=x[v]){for(v>=w&&(w=v+1);!(C=y[w])&&++w<m;);b._next=C||null}}return o=new Xt(o,r),o._enter=a,o._exit=c,o}function f0(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function p0(){return new Xt(this._exit||this._groups.map(Ic),this._parents)}function m0(t,e,n){var r=this.enter(),i=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?s.remove():n(s),r&&i?r.merge(i).order():i}function g0(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),c=0;c<o;++c)for(var l=n[c],d=r[c],h=l.length,f=a[c]=new Array(h),p,m=0;m<h;++m)(p=l[m]||d[m])&&(f[m]=p);for(;c<i;++c)a[c]=n[c];return new Xt(a,this._parents)}function x0(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function y0(t){t||(t=v0);function e(h,f){return h&&f?t(h.__data__,f.__data__):!h-!f}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],a=o.length,c=i[s]=new Array(a),l,d=0;d<a;++d)(l=o[d])&&(c[d]=l);c.sort(e)}return new Xt(i,this._parents).order()}function v0(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function b0(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function w0(){return Array.from(this)}function j0(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function _0(){let t=0;for(const e of this)++t;return t}function S0(){return!this.node()}function C0(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],s=0,o=i.length,a;s<o;++s)(a=i[s])&&t.call(a,a.__data__,s,i);return this}function k0(t){return function(){this.removeAttribute(t)}}function I0(t){return function(){this.removeAttributeNS(t.space,t.local)}}function P0(t,e){return function(){this.setAttribute(t,e)}}function T0(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function M0(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function A0(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function E0(t,e){var n=Ai(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?I0:k0:typeof e=="function"?n.local?A0:M0:n.local?T0:P0)(n,e))}function Pc(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function R0(t){return function(){this.style.removeProperty(t)}}function $0(t,e,n){return function(){this.style.setProperty(t,e,n)}}function O0(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function z0(t,e,n){return arguments.length>1?this.each((e==null?R0:typeof e=="function"?O0:$0)(t,e,n??"")):On(this.node(),t)}function On(t,e){return t.style.getPropertyValue(e)||Pc(t).getComputedStyle(t,null).getPropertyValue(e)}function D0(t){return function(){delete this[t]}}function N0(t,e){return function(){this[t]=e}}function L0(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function F0(t,e){return arguments.length>1?this.each((e==null?D0:typeof e=="function"?L0:N0)(t,e)):this.node()[t]}function Tc(t){return t.trim().split(/^|\s+/)}function co(t){return t.classList||new Mc(t)}function Mc(t){this._node=t,this._names=Tc(t.getAttribute("class")||"")}Mc.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Ac(t,e){for(var n=co(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Ec(t,e){for(var n=co(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function B0(t){return function(){Ac(this,t)}}function V0(t){return function(){Ec(this,t)}}function H0(t,e){return function(){(e.apply(this,arguments)?Ac:Ec)(this,t)}}function W0(t,e){var n=Tc(t+"");if(arguments.length<2){for(var r=co(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?H0:e?B0:V0)(n,e))}function X0(){this.textContent=""}function Y0(t){return function(){this.textContent=t}}function U0(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function q0(t){return arguments.length?this.each(t==null?X0:(typeof t=="function"?U0:Y0)(t)):this.node().textContent}function G0(){this.innerHTML=""}function K0(t){return function(){this.innerHTML=t}}function Z0(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Q0(t){return arguments.length?this.each(t==null?G0:(typeof t=="function"?Z0:K0)(t)):this.node().innerHTML}function J0(){this.nextSibling&&this.parentNode.appendChild(this)}function tm(){return this.each(J0)}function em(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function nm(){return this.each(em)}function rm(t){var e=typeof t=="function"?t:_c(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function im(){return null}function sm(t,e){var n=typeof t=="function"?t:_c(t),r=e==null?im:typeof e=="function"?e:lo(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function om(){var t=this.parentNode;t&&t.removeChild(this)}function am(){return this.each(om)}function lm(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function cm(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function um(t){return this.select(t?cm:lm)}function dm(t){return arguments.length?this.property("__data__",t):this.node().__data__}function hm(t){return function(e){t.call(this,e,this.__data__)}}function fm(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function pm(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,s;n<i;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function mm(t,e,n){return function(){var r=this.__on,i,s=hm(e);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=n),i.value=e;return}}this.addEventListener(t.type,s,n),i={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(i):this.__on=[i]}}function gm(t,e,n){var r=fm(t+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,l=a.length,d;c<l;++c)for(i=0,d=a[c];i<s;++i)if((o=r[i]).type===d.type&&o.name===d.name)return d.value}return}for(a=e?mm:pm,i=0;i<s;++i)this.each(a(r[i],e,n));return this}function Rc(t,e,n){var r=Pc(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function xm(t,e){return function(){return Rc(this,t,e)}}function ym(t,e){return function(){return Rc(this,t,e.apply(this,arguments))}}function vm(t,e){return this.each((typeof e=="function"?ym:xm)(t,e))}function*bm(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var $c=[null];function Xt(t,e){this._groups=t,this._parents=e}function Mr(){return new Xt([[document.documentElement]],$c)}function wm(){return this}Xt.prototype=Mr.prototype={constructor:Xt,select:Up,selectAll:Zp,selectChild:e0,selectChildren:s0,filter:o0,data:h0,enter:a0,exit:p0,join:m0,merge:g0,selection:wm,order:x0,sort:y0,call:b0,nodes:w0,node:j0,size:_0,empty:S0,each:C0,attr:E0,style:z0,property:F0,classed:W0,text:q0,html:Q0,raise:tm,lower:nm,append:rm,insert:sm,remove:am,clone:um,datum:dm,on:gm,dispatch:vm,[Symbol.iterator]:bm};function te(t){return typeof t=="string"?new Xt([[document.querySelector(t)]],[document.documentElement]):new Xt([[t]],$c)}function jm(t){let e;for(;e=t.sourceEvent;)t=e;return t}function pe(t,e){if(t=jm(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}const _m={passive:!1},xr={capture:!0,passive:!1};function ts(t){t.stopImmediatePropagation()}function Mn(t){t.preventDefault(),t.stopImmediatePropagation()}function Oc(t){var e=t.document.documentElement,n=te(t).on("dragstart.drag",Mn,xr);"onselectstart"in e?n.on("selectstart.drag",Mn,xr):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function zc(t,e){var n=t.document.documentElement,r=te(t).on("dragstart.drag",null);e&&(r.on("click.drag",Mn,xr),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Lr=t=>()=>t;function _s(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:s,x:o,y:a,dx:c,dy:l,dispatch:d}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:d}})}_s.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function Sm(t){return!t.ctrlKey&&!t.button}function Cm(){return this.parentNode}function km(t,e){return e??{x:t.x,y:t.y}}function Im(){return navigator.maxTouchPoints||"ontouchstart"in this}function Pm(){var t=Sm,e=Cm,n=km,r=Im,i={},s=Tr("start","drag","end"),o=0,a,c,l,d,h=0;function f(b){b.on("mousedown.drag",p).filter(r).on("touchstart.drag",y).on("touchmove.drag",g,_m).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(b,C){if(!(d||!t.call(this,b,C))){var A=w(this,e.call(this,b,C),b,C,"mouse");A&&(te(b.view).on("mousemove.drag",m,xr).on("mouseup.drag",x,xr),Oc(b.view),ts(b),l=!1,a=b.clientX,c=b.clientY,A("start",b))}}function m(b){if(Mn(b),!l){var C=b.clientX-a,A=b.clientY-c;l=C*C+A*A>h}i.mouse("drag",b)}function x(b){te(b.view).on("mousemove.drag mouseup.drag",null),zc(b.view,l),Mn(b),i.mouse("end",b)}function y(b,C){if(t.call(this,b,C)){var A=b.changedTouches,_=e.call(this,b,C),S=A.length,T,P;for(T=0;T<S;++T)(P=w(this,_,b,C,A[T].identifier,A[T]))&&(ts(b),P("start",b,A[T]))}}function g(b){var C=b.changedTouches,A=C.length,_,S;for(_=0;_<A;++_)(S=i[C[_].identifier])&&(Mn(b),S("drag",b,C[_]))}function v(b){var C=b.changedTouches,A=C.length,_,S;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),_=0;_<A;++_)(S=i[C[_].identifier])&&(ts(b),S("end",b,C[_]))}function w(b,C,A,_,S,T){var P=s.copy(),M=pe(T||A,C),$,R,j;if((j=n.call(b,new _s("beforestart",{sourceEvent:A,target:f,identifier:S,active:o,x:M[0],y:M[1],dx:0,dy:0,dispatch:P}),_))!=null)return $=j.x-M[0]||0,R=j.y-M[1]||0,function I(k,E,N){var V=M,F;switch(k){case"start":i[S]=I,F=o++;break;case"end":delete i[S],--o;case"drag":M=pe(N||E,C),F=o;break}P.call(k,b,new _s(k,{sourceEvent:E,subject:j,target:f,identifier:S,active:F,x:M[0]+$,y:M[1]+R,dx:M[0]-V[0],dy:M[1]-V[1],dispatch:P}),_)}}return f.filter=function(b){return arguments.length?(t=typeof b=="function"?b:Lr(!!b),f):t},f.container=function(b){return arguments.length?(e=typeof b=="function"?b:Lr(b),f):e},f.subject=function(b){return arguments.length?(n=typeof b=="function"?b:Lr(b),f):n},f.touchable=function(b){return arguments.length?(r=typeof b=="function"?b:Lr(!!b),f):r},f.on=function(){var b=s.on.apply(s,arguments);return b===s?f:b},f.clickDistance=function(b){return arguments.length?(h=(b=+b)*b,f):Math.sqrt(h)},f}function uo(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Dc(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Ar(){}var yr=.7,fi=1/yr,An="\\s*([+-]?\\d+)\\s*",vr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ce="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Tm=/^#([0-9a-f]{3,8})$/,Mm=new RegExp(`^rgb\\(${An},${An},${An}\\)$`),Am=new RegExp(`^rgb\\(${ce},${ce},${ce}\\)$`),Em=new RegExp(`^rgba\\(${An},${An},${An},${vr}\\)$`),Rm=new RegExp(`^rgba\\(${ce},${ce},${ce},${vr}\\)$`),$m=new RegExp(`^hsl\\(${vr},${ce},${ce}\\)$`),Om=new RegExp(`^hsla\\(${vr},${ce},${ce},${vr}\\)$`),ga={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};uo(Ar,br,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:xa,formatHex:xa,formatHex8:zm,formatHsl:Dm,formatRgb:ya,toString:ya});function xa(){return this.rgb().formatHex()}function zm(){return this.rgb().formatHex8()}function Dm(){return Nc(this).formatHsl()}function ya(){return this.rgb().formatRgb()}function br(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Tm.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?va(e):n===3?new Lt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Fr(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Fr(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Mm.exec(t))?new Lt(e[1],e[2],e[3],1):(e=Am.exec(t))?new Lt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Em.exec(t))?Fr(e[1],e[2],e[3],e[4]):(e=Rm.exec(t))?Fr(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=$m.exec(t))?ja(e[1],e[2]/100,e[3]/100,1):(e=Om.exec(t))?ja(e[1],e[2]/100,e[3]/100,e[4]):ga.hasOwnProperty(t)?va(ga[t]):t==="transparent"?new Lt(NaN,NaN,NaN,0):null}function va(t){return new Lt(t>>16&255,t>>8&255,t&255,1)}function Fr(t,e,n,r){return r<=0&&(t=e=n=NaN),new Lt(t,e,n,r)}function Nm(t){return t instanceof Ar||(t=br(t)),t?(t=t.rgb(),new Lt(t.r,t.g,t.b,t.opacity)):new Lt}function Ss(t,e,n,r){return arguments.length===1?Nm(t):new Lt(t,e,n,r??1)}function Lt(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}uo(Lt,Ss,Dc(Ar,{brighter(t){return t=t==null?fi:Math.pow(fi,t),new Lt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?yr:Math.pow(yr,t),new Lt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Lt(un(this.r),un(this.g),un(this.b),pi(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ba,formatHex:ba,formatHex8:Lm,formatRgb:wa,toString:wa}));function ba(){return`#${rn(this.r)}${rn(this.g)}${rn(this.b)}`}function Lm(){return`#${rn(this.r)}${rn(this.g)}${rn(this.b)}${rn((isNaN(this.opacity)?1:this.opacity)*255)}`}function wa(){const t=pi(this.opacity);return`${t===1?"rgb(":"rgba("}${un(this.r)}, ${un(this.g)}, ${un(this.b)}${t===1?")":`, ${t})`}`}function pi(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function un(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function rn(t){return t=un(t),(t<16?"0":"")+t.toString(16)}function ja(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ee(t,e,n,r)}function Nc(t){if(t instanceof ee)return new ee(t.h,t.s,t.l,t.opacity);if(t instanceof Ar||(t=br(t)),!t)return new ee;if(t instanceof ee)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,a=s-i,c=(s+i)/2;return a?(e===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-e)/a+2:o=(e-n)/a+4,a/=c<.5?s+i:2-s-i,o*=60):a=c>0&&c<1?0:o,new ee(o,a,c,t.opacity)}function Fm(t,e,n,r){return arguments.length===1?Nc(t):new ee(t,e,n,r??1)}function ee(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}uo(ee,Fm,Dc(Ar,{brighter(t){return t=t==null?fi:Math.pow(fi,t),new ee(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?yr:Math.pow(yr,t),new ee(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Lt(es(t>=240?t-240:t+120,i,r),es(t,i,r),es(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new ee(_a(this.h),Br(this.s),Br(this.l),pi(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=pi(this.opacity);return`${t===1?"hsl(":"hsla("}${_a(this.h)}, ${Br(this.s)*100}%, ${Br(this.l)*100}%${t===1?")":`, ${t})`}`}}));function _a(t){return t=(t||0)%360,t<0?t+360:t}function Br(t){return Math.max(0,Math.min(1,t||0))}function es(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Lc=t=>()=>t;function Bm(t,e){return function(n){return t+n*e}}function Vm(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Hm(t){return(t=+t)==1?Fc:function(e,n){return n-e?Vm(e,n,t):Lc(isNaN(e)?n:e)}}function Fc(t,e){var n=e-t;return n?Bm(t,n):Lc(isNaN(t)?e:t)}const Sa=function t(e){var n=Hm(e);function r(i,s){var o=n((i=Ss(i)).r,(s=Ss(s)).r),a=n(i.g,s.g),c=n(i.b,s.b),l=Fc(i.opacity,s.opacity);return function(d){return i.r=o(d),i.g=a(d),i.b=c(d),i.opacity=l(d),i+""}}return r.gamma=t,r}(1);function ze(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Cs=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ns=new RegExp(Cs.source,"g");function Wm(t){return function(){return t}}function Xm(t){return function(e){return t(e)+""}}function Ym(t,e){var n=Cs.lastIndex=ns.lastIndex=0,r,i,s,o=-1,a=[],c=[];for(t=t+"",e=e+"";(r=Cs.exec(t))&&(i=ns.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,c.push({i:o,x:ze(r,i)})),n=ns.lastIndex;return n<e.length&&(s=e.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?c[0]?Xm(c[0].x):Wm(e):(e=c.length,function(l){for(var d=0,h;d<e;++d)a[(h=c[d]).i]=h.x(l);return a.join("")})}var Ca=180/Math.PI,ks={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Bc(t,e,n,r,i,s){var o,a,c;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,c/=a),t*r<e*n&&(t=-t,e=-e,c=-c,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*Ca,skewX:Math.atan(c)*Ca,scaleX:o,scaleY:a}}var Vr;function Um(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?ks:Bc(e.a,e.b,e.c,e.d,e.e,e.f)}function qm(t){return t==null||(Vr||(Vr=document.createElementNS("http://www.w3.org/2000/svg","g")),Vr.setAttribute("transform",t),!(t=Vr.transform.baseVal.consolidate()))?ks:(t=t.matrix,Bc(t.a,t.b,t.c,t.d,t.e,t.f))}function Vc(t,e,n,r){function i(l){return l.length?l.pop()+" ":""}function s(l,d,h,f,p,m){if(l!==h||d!==f){var x=p.push("translate(",null,e,null,n);m.push({i:x-4,x:ze(l,h)},{i:x-2,x:ze(d,f)})}else(h||f)&&p.push("translate("+h+e+f+n)}function o(l,d,h,f){l!==d?(l-d>180?d+=360:d-l>180&&(l+=360),f.push({i:h.push(i(h)+"rotate(",null,r)-2,x:ze(l,d)})):d&&h.push(i(h)+"rotate("+d+r)}function a(l,d,h,f){l!==d?f.push({i:h.push(i(h)+"skewX(",null,r)-2,x:ze(l,d)}):d&&h.push(i(h)+"skewX("+d+r)}function c(l,d,h,f,p,m){if(l!==h||d!==f){var x=p.push(i(p)+"scale(",null,",",null,")");m.push({i:x-4,x:ze(l,h)},{i:x-2,x:ze(d,f)})}else(h!==1||f!==1)&&p.push(i(p)+"scale("+h+","+f+")")}return function(l,d){var h=[],f=[];return l=t(l),d=t(d),s(l.translateX,l.translateY,d.translateX,d.translateY,h,f),o(l.rotate,d.rotate,h,f),a(l.skewX,d.skewX,h,f),c(l.scaleX,l.scaleY,d.scaleX,d.scaleY,h,f),l=d=null,function(p){for(var m=-1,x=f.length,y;++m<x;)h[(y=f[m]).i]=y.x(p);return h.join("")}}}var Gm=Vc(Um,"px, ","px)","deg)"),Km=Vc(qm,", ",")",")"),Zm=1e-12;function ka(t){return((t=Math.exp(t))+1/t)/2}function Qm(t){return((t=Math.exp(t))-1/t)/2}function Jm(t){return((t=Math.exp(2*t))-1)/(t+1)}const tg=function t(e,n,r){function i(s,o){var a=s[0],c=s[1],l=s[2],d=o[0],h=o[1],f=o[2],p=d-a,m=h-c,x=p*p+m*m,y,g;if(x<Zm)g=Math.log(f/l)/e,y=function(_){return[a+_*p,c+_*m,l*Math.exp(e*_*g)]};else{var v=Math.sqrt(x),w=(f*f-l*l+r*x)/(2*l*n*v),b=(f*f-l*l-r*x)/(2*f*n*v),C=Math.log(Math.sqrt(w*w+1)-w),A=Math.log(Math.sqrt(b*b+1)-b);g=(A-C)/e,y=function(_){var S=_*g,T=ka(C),P=l/(n*v)*(T*Jm(e*S+C)-Qm(C));return[a+P*p,c+P*m,l*T/ka(e*S+C)]}}return y.duration=g*1e3*e/Math.SQRT2,y}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,c=a*a;return t(o,a,c)},i}(Math.SQRT2,2,4);var zn=0,er=0,Gn=0,Hc=1e3,mi,nr,gi=0,hn=0,Ei=0,wr=typeof performance=="object"&&performance.now?performance:Date,Wc=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function ho(){return hn||(Wc(eg),hn=wr.now()+Ei)}function eg(){hn=0}function xi(){this._call=this._time=this._next=null}xi.prototype=fo.prototype={constructor:xi,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?ho():+n)+(e==null?0:+e),!this._next&&nr!==this&&(nr?nr._next=this:mi=this,nr=this),this._call=t,this._time=n,Is()},stop:function(){this._call&&(this._call=null,this._time=1/0,Is())}};function fo(t,e,n){var r=new xi;return r.restart(t,e,n),r}function ng(){ho(),++zn;for(var t=mi,e;t;)(e=hn-t._time)>=0&&t._call.call(void 0,e),t=t._next;--zn}function Ia(){hn=(gi=wr.now())+Ei,zn=er=0;try{ng()}finally{zn=0,ig(),hn=0}}function rg(){var t=wr.now(),e=t-gi;e>Hc&&(Ei-=e,gi=t)}function ig(){for(var t,e=mi,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:mi=n);nr=t,Is(r)}function Is(t){if(!zn){er&&(er=clearTimeout(er));var e=t-hn;e>24?(t<1/0&&(er=setTimeout(Ia,t-wr.now()-Ei)),Gn&&(Gn=clearInterval(Gn))):(Gn||(gi=wr.now(),Gn=setInterval(rg,Hc)),zn=1,Wc(Ia))}}function Pa(t,e,n){var r=new xi;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var sg=Tr("start","end","cancel","interrupt"),og=[],Xc=0,Ta=1,Ps=2,Gr=3,Ma=4,Ts=5,Kr=6;function Ri(t,e,n,r,i,s){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;ag(t,n,{name:e,index:r,group:i,on:sg,tween:og,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Xc})}function po(t,e){var n=ie(t,e);if(n.state>Xc)throw new Error("too late; already scheduled");return n}function ue(t,e){var n=ie(t,e);if(n.state>Gr)throw new Error("too late; already running");return n}function ie(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function ag(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=fo(s,0,n.time);function s(l){n.state=Ta,n.timer.restart(o,n.delay,n.time),n.delay<=l&&o(l-n.delay)}function o(l){var d,h,f,p;if(n.state!==Ta)return c();for(d in r)if(p=r[d],p.name===n.name){if(p.state===Gr)return Pa(o);p.state===Ma?(p.state=Kr,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete r[d]):+d<e&&(p.state=Kr,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete r[d])}if(Pa(function(){n.state===Gr&&(n.state=Ma,n.timer.restart(a,n.delay,n.time),a(l))}),n.state=Ps,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Ps){for(n.state=Gr,i=new Array(f=n.tween.length),d=0,h=-1;d<f;++d)(p=n.tween[d].value.call(t,t.__data__,n.index,n.group))&&(i[++h]=p);i.length=h+1}}function a(l){for(var d=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(c),n.state=Ts,1),h=-1,f=i.length;++h<f;)i[h].call(t,d);n.state===Ts&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){n.state=Kr,n.timer.stop(),delete r[e];for(var l in r)return;delete t.__transition}}function Zr(t,e){var n=t.__transition,r,i,s=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){s=!1;continue}i=r.state>Ps&&r.state<Ts,r.state=Kr,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}s&&delete t.__transition}}function lg(t){return this.each(function(){Zr(this,t)})}function cg(t,e){var n,r;return function(){var i=ue(this,t),s=i.tween;if(s!==n){r=n=s;for(var o=0,a=r.length;o<a;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function ug(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var s=ue(this,t),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:e,value:n},c=0,l=i.length;c<l;++c)if(i[c].name===e){i[c]=a;break}c===l&&i.push(a)}s.tween=i}}function dg(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=ie(this.node(),n).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?cg:ug)(n,t,e))}function mo(t,e,n){var r=t._id;return t.each(function(){var i=ue(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return ie(i,r).value[e]}}function Yc(t,e){var n;return(typeof e=="number"?ze:e instanceof br?Sa:(n=br(e))?(e=n,Sa):Ym)(t,e)}function hg(t){return function(){this.removeAttribute(t)}}function fg(t){return function(){this.removeAttributeNS(t.space,t.local)}}function pg(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttribute(t);return o===i?null:o===r?s:s=e(r=o,n)}}function mg(t,e,n){var r,i=n+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?s:s=e(r=o,n)}}function gg(t,e,n){var r,i,s;return function(){var o,a=n(this),c;return a==null?void this.removeAttribute(t):(o=this.getAttribute(t),c=a+"",o===c?null:o===r&&c===i?s:(i=c,s=e(r=o,a)))}}function xg(t,e,n){var r,i,s;return function(){var o,a=n(this),c;return a==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),c=a+"",o===c?null:o===r&&c===i?s:(i=c,s=e(r=o,a)))}}function yg(t,e){var n=Ai(t),r=n==="transform"?Km:Yc;return this.attrTween(t,typeof e=="function"?(n.local?xg:gg)(n,r,mo(this,"attr."+t,e)):e==null?(n.local?fg:hg)(n):(n.local?mg:pg)(n,r,e))}function vg(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function bg(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function wg(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&bg(t,s)),n}return i._value=e,i}function jg(t,e){var n,r;function i(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&vg(t,s)),n}return i._value=e,i}function _g(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Ai(t);return this.tween(n,(r.local?wg:jg)(r,e))}function Sg(t,e){return function(){po(this,t).delay=+e.apply(this,arguments)}}function Cg(t,e){return e=+e,function(){po(this,t).delay=e}}function kg(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Sg:Cg)(e,t)):ie(this.node(),e).delay}function Ig(t,e){return function(){ue(this,t).duration=+e.apply(this,arguments)}}function Pg(t,e){return e=+e,function(){ue(this,t).duration=e}}function Tg(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Ig:Pg)(e,t)):ie(this.node(),e).duration}function Mg(t,e){if(typeof e!="function")throw new Error;return function(){ue(this,t).ease=e}}function Ag(t){var e=this._id;return arguments.length?this.each(Mg(e,t)):ie(this.node(),e).ease}function Eg(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;ue(this,t).ease=n}}function Rg(t){if(typeof t!="function")throw new Error;return this.each(Eg(this._id,t))}function $g(t){typeof t!="function"&&(t=Cc(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s=e[i],o=s.length,a=r[i]=[],c,l=0;l<o;++l)(c=s[l])&&t.call(c,c.__data__,l,s)&&a.push(c);return new we(r,this._parents,this._name,this._id)}function Og(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var c=e[a],l=n[a],d=c.length,h=o[a]=new Array(d),f,p=0;p<d;++p)(f=c[p]||l[p])&&(h[p]=f);for(;a<r;++a)o[a]=e[a];return new we(o,this._parents,this._name,this._id)}function zg(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Dg(t,e,n){var r,i,s=zg(e)?po:ue;return function(){var o=s(this,t),a=o.on;a!==r&&(i=(r=a).copy()).on(e,n),o.on=i}}function Ng(t,e){var n=this._id;return arguments.length<2?ie(this.node(),n).on.on(t):this.each(Dg(n,t,e))}function Lg(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Fg(){return this.on("end.remove",Lg(this._id))}function Bg(t){var e=this._name,n=this._id;typeof t!="function"&&(t=lo(t));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a=r[o],c=a.length,l=s[o]=new Array(c),d,h,f=0;f<c;++f)(d=a[f])&&(h=t.call(d,d.__data__,f,a))&&("__data__"in d&&(h.__data__=d.__data__),l[f]=h,Ri(l[f],e,n,f,l,ie(d,n)));return new we(s,this._parents,e,n)}function Vg(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Sc(t));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var c=r[a],l=c.length,d,h=0;h<l;++h)if(d=c[h]){for(var f=t.call(d,d.__data__,h,c),p,m=ie(d,n),x=0,y=f.length;x<y;++x)(p=f[x])&&Ri(p,e,n,x,f,m);s.push(f),o.push(d)}return new we(s,o,e,n)}var Hg=Mr.prototype.constructor;function Wg(){return new Hg(this._groups,this._parents)}function Xg(t,e){var n,r,i;return function(){var s=On(this,t),o=(this.style.removeProperty(t),On(this,t));return s===o?null:s===n&&o===r?i:i=e(n=s,r=o)}}function Uc(t){return function(){this.style.removeProperty(t)}}function Yg(t,e,n){var r,i=n+"",s;return function(){var o=On(this,t);return o===i?null:o===r?s:s=e(r=o,n)}}function Ug(t,e,n){var r,i,s;return function(){var o=On(this,t),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(t),On(this,t))),o===c?null:o===r&&c===i?s:(i=c,s=e(r=o,a))}}function qg(t,e){var n,r,i,s="style."+e,o="end."+s,a;return function(){var c=ue(this,t),l=c.on,d=c.value[s]==null?a||(a=Uc(e)):void 0;(l!==n||i!==d)&&(r=(n=l).copy()).on(o,i=d),c.on=r}}function Gg(t,e,n){var r=(t+="")=="transform"?Gm:Yc;return e==null?this.styleTween(t,Xg(t,r)).on("end.style."+t,Uc(t)):typeof e=="function"?this.styleTween(t,Ug(t,r,mo(this,"style."+t,e))).each(qg(this._id,t)):this.styleTween(t,Yg(t,r,e),n).on("end.style."+t,null)}function Kg(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Zg(t,e,n){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&Kg(t,o,n)),r}return s._value=e,s}function Qg(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Zg(t,e,n??""))}function Jg(t){return function(){this.textContent=t}}function tx(t){return function(){var e=t(this);this.textContent=e??""}}function ex(t){return this.tween("text",typeof t=="function"?tx(mo(this,"text",t)):Jg(t==null?"":t+""))}function nx(t){return function(e){this.textContent=t.call(this,e)}}function rx(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&nx(i)),e}return r._value=t,r}function ix(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,rx(t))}function sx(){for(var t=this._name,e=this._id,n=qc(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,c,l=0;l<a;++l)if(c=o[l]){var d=ie(c,e);Ri(c,t,n,l,o,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new we(r,this._parents,t,n)}function ox(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(s,o){var a={value:o},c={value:function(){--i===0&&s()}};n.each(function(){var l=ue(this,r),d=l.on;d!==t&&(e=(t=d).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(c)),l.on=e}),i===0&&s()})}var ax=0;function we(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function qc(){return++ax}var fe=Mr.prototype;we.prototype={constructor:we,select:Bg,selectAll:Vg,selectChild:fe.selectChild,selectChildren:fe.selectChildren,filter:$g,merge:Og,selection:Wg,transition:sx,call:fe.call,nodes:fe.nodes,node:fe.node,size:fe.size,empty:fe.empty,each:fe.each,on:Ng,attr:yg,attrTween:_g,style:Gg,styleTween:Qg,text:ex,textTween:ix,remove:Fg,tween:dg,delay:kg,duration:Tg,ease:Ag,easeVarying:Rg,end:ox,[Symbol.iterator]:fe[Symbol.iterator]};function lx(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var cx={time:null,delay:0,duration:250,ease:lx};function ux(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function dx(t){var e,n;t instanceof we?(e=t._id,t=t._name):(e=qc(),(n=cx).time=ho(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,c,l=0;l<a;++l)(c=o[l])&&Ri(c,t,e,l,o,n||ux(c,e));return new we(r,this._parents,t,e)}Mr.prototype.interrupt=lg;Mr.prototype.transition=dx;const Ms=Math.PI,As=2*Ms,en=1e-6,hx=As-en;function Gc(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function fx(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return Gc;const n=10**e;return function(r){this._+=r[0];for(let i=1,s=r.length;i<s;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}class Kc{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?Gc:fx(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,i){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,n,r,i,s,o){this._append`C${+e},${+n},${+r},${+i},${this._x1=+s},${this._y1=+o}`}arcTo(e,n,r,i,s){if(e=+e,n=+n,r=+r,i=+i,s=+s,s<0)throw new Error(`negative radius: ${s}`);let o=this._x1,a=this._y1,c=r-e,l=i-n,d=o-e,h=a-n,f=d*d+h*h;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(f>en)if(!(Math.abs(h*c-l*d)>en)||!s)this._append`L${this._x1=e},${this._y1=n}`;else{let p=r-o,m=i-a,x=c*c+l*l,y=p*p+m*m,g=Math.sqrt(x),v=Math.sqrt(f),w=s*Math.tan((Ms-Math.acos((x+f-y)/(2*g*v)))/2),b=w/v,C=w/g;Math.abs(b-1)>en&&this._append`L${e+b*d},${n+b*h}`,this._append`A${s},${s},0,0,${+(h*p>d*m)},${this._x1=e+C*c},${this._y1=n+C*l}`}}arc(e,n,r,i,s,o){if(e=+e,n=+n,r=+r,o=!!o,r<0)throw new Error(`negative radius: ${r}`);let a=r*Math.cos(i),c=r*Math.sin(i),l=e+a,d=n+c,h=1^o,f=o?i-s:s-i;this._x1===null?this._append`M${l},${d}`:(Math.abs(this._x1-l)>en||Math.abs(this._y1-d)>en)&&this._append`L${l},${d}`,r&&(f<0&&(f=f%As+As),f>hx?this._append`A${r},${r},0,1,${h},${e-a},${n-c}A${r},${r},0,1,${h},${this._x1=l},${this._y1=d}`:f>en&&this._append`A${r},${r},0,${+(f>=Ms)},${h},${this._x1=e+r*Math.cos(s)},${this._y1=n+r*Math.sin(s)}`)}rect(e,n,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}function Sn(){return new Kc}Sn.prototype=Kc.prototype;function px(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return Zc(this.cover(e,n),e,n,t)}function Zc(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s=t._root,o={data:r},a=t._x0,c=t._y0,l=t._x1,d=t._y1,h,f,p,m,x,y,g,v;if(!s)return t._root=o,t;for(;s.length;)if((x=e>=(h=(a+l)/2))?a=h:l=h,(y=n>=(f=(c+d)/2))?c=f:d=f,i=s,!(s=s[g=y<<1|x]))return i[g]=o,t;if(p=+t._x.call(null,s.data),m=+t._y.call(null,s.data),e===p&&n===m)return o.next=s,i?i[g]=o:t._root=o,t;do i=i?i[g]=new Array(4):t._root=new Array(4),(x=e>=(h=(a+l)/2))?a=h:l=h,(y=n>=(f=(c+d)/2))?c=f:d=f;while((g=y<<1|x)===(v=(m>=f)<<1|p>=h));return i[v]=s,i[g]=o,t}function mx(t){var e,n,r=t.length,i,s,o=new Array(r),a=new Array(r),c=1/0,l=1/0,d=-1/0,h=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(s=+this._y.call(null,e))||(o[n]=i,a[n]=s,i<c&&(c=i),i>d&&(d=i),s<l&&(l=s),s>h&&(h=s));if(c>d||l>h)return this;for(this.cover(c,l).cover(d,h),n=0;n<r;++n)Zc(this,o[n],a[n],t[n]);return this}function gx(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o=i-n||1,a=this._root,c,l;n>t||t>=i||r>e||e>=s;)switch(l=(e<r)<<1|t<n,c=new Array(4),c[l]=a,a=c,o*=2,l){case 0:i=n+o,s=r+o;break;case 1:n=i-o,s=r+o;break;case 2:i=n+o,r=s-o;break;case 3:n=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this}function xx(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function yx(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Et(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function vx(t,e,n){var r,i=this._x0,s=this._y0,o,a,c,l,d=this._x1,h=this._y1,f=[],p=this._root,m,x;for(p&&f.push(new Et(p,i,s,d,h)),n==null?n=1/0:(i=t-n,s=e-n,d=t+n,h=e+n,n*=n);m=f.pop();)if(!(!(p=m.node)||(o=m.x0)>d||(a=m.y0)>h||(c=m.x1)<i||(l=m.y1)<s))if(p.length){var y=(o+c)/2,g=(a+l)/2;f.push(new Et(p[3],y,g,c,l),new Et(p[2],o,g,y,l),new Et(p[1],y,a,c,g),new Et(p[0],o,a,y,g)),(x=(e>=g)<<1|t>=y)&&(m=f[f.length-1],f[f.length-1]=f[f.length-1-x],f[f.length-1-x]=m)}else{var v=t-+this._x.call(null,p.data),w=e-+this._y.call(null,p.data),b=v*v+w*w;if(b<n){var C=Math.sqrt(n=b);i=t-C,s=e-C,d=t+C,h=e+C,r=p.data}}return r}function bx(t){if(isNaN(d=+this._x.call(null,t))||isNaN(h=+this._y.call(null,t)))return this;var e,n=this._root,r,i,s,o=this._x0,a=this._y0,c=this._x1,l=this._y1,d,h,f,p,m,x,y,g;if(!n)return this;if(n.length)for(;;){if((m=d>=(f=(o+c)/2))?o=f:c=f,(x=h>=(p=(a+l)/2))?a=p:l=p,e=n,!(n=n[y=x<<1|m]))return this;if(!n.length)break;(e[y+1&3]||e[y+2&3]||e[y+3&3])&&(r=e,g=y)}for(;n.data!==t;)if(i=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,i?(s?i.next=s:delete i.next,this):e?(s?e[y]=s:delete e[y],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(r?r[g]=n:this._root=n),this):(this._root=s,this)}function wx(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function jx(){return this._root}function _x(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function Sx(t){var e=[],n,r=this._root,i,s,o,a,c;for(r&&e.push(new Et(r,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(r=n.node,s=n.x0,o=n.y0,a=n.x1,c=n.y1)&&r.length){var l=(s+a)/2,d=(o+c)/2;(i=r[3])&&e.push(new Et(i,l,d,a,c)),(i=r[2])&&e.push(new Et(i,s,d,l,c)),(i=r[1])&&e.push(new Et(i,l,o,a,d)),(i=r[0])&&e.push(new Et(i,s,o,l,d))}return this}function Cx(t){var e=[],n=[],r;for(this._root&&e.push(new Et(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,a=r.y0,c=r.x1,l=r.y1,d=(o+c)/2,h=(a+l)/2;(s=i[0])&&e.push(new Et(s,o,a,d,h)),(s=i[1])&&e.push(new Et(s,d,a,c,h)),(s=i[2])&&e.push(new Et(s,o,h,d,l)),(s=i[3])&&e.push(new Et(s,d,h,c,l))}n.push(r)}for(;r=n.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function kx(t){return t[0]}function Ix(t){return arguments.length?(this._x=t,this):this._x}function Px(t){return t[1]}function Tx(t){return arguments.length?(this._y=t,this):this._y}function go(t,e,n){var r=new xo(e??kx,n??Px,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function xo(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function Aa(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var $t=go.prototype=xo.prototype;$t.copy=function(){var t=new xo(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,r;if(!e)return t;if(!e.length)return t._root=Aa(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var i=0;i<4;++i)(r=e.source[i])&&(r.length?n.push({source:r,target:e.target[i]=new Array(4)}):e.target[i]=Aa(r));return t};$t.add=px;$t.addAll=mx;$t.cover=gx;$t.data=xx;$t.extent=yx;$t.find=vx;$t.remove=bx;$t.removeAll=wx;$t.root=jx;$t.size=_x;$t.visit=Sx;$t.visitAfter=Cx;$t.x=Ix;$t.y=Tx;function Rt(t){return function(){return t}}function Be(t){return(t()-.5)*1e-6}function Mx(t){return t.x+t.vx}function Ax(t){return t.y+t.vy}function Ex(t){var e,n,r,i=1,s=1;typeof t!="function"&&(t=Rt(t==null?1:+t));function o(){for(var l,d=e.length,h,f,p,m,x,y,g=0;g<s;++g)for(h=go(e,Mx,Ax).visitAfter(a),l=0;l<d;++l)f=e[l],x=n[f.index],y=x*x,p=f.x+f.vx,m=f.y+f.vy,h.visit(v);function v(w,b,C,A,_){var S=w.data,T=w.r,P=x+T;if(S){if(S.index>f.index){var M=p-S.x-S.vx,$=m-S.y-S.vy,R=M*M+$*$;R<P*P&&(M===0&&(M=Be(r),R+=M*M),$===0&&($=Be(r),R+=$*$),R=(P-(R=Math.sqrt(R)))/R*i,f.vx+=(M*=R)*(P=(T*=T)/(y+T)),f.vy+=($*=R)*P,S.vx-=M*(P=1-P),S.vy-=$*P)}return}return b>p+P||A<p-P||C>m+P||_<m-P}}function a(l){if(l.data)return l.r=n[l.data.index];for(var d=l.r=0;d<4;++d)l[d]&&l[d].r>l.r&&(l.r=l[d].r)}function c(){if(e){var l,d=e.length,h;for(n=new Array(d),l=0;l<d;++l)h=e[l],n[h.index]=+t(h,l,e)}}return o.initialize=function(l,d){e=l,r=d,c()},o.iterations=function(l){return arguments.length?(s=+l,o):s},o.strength=function(l){return arguments.length?(i=+l,o):i},o.radius=function(l){return arguments.length?(t=typeof l=="function"?l:Rt(+l),c(),o):t},o}function Rx(t){return t.index}function Ea(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function $x(t){var e=Rx,n=h,r,i=Rt(30),s,o,a,c,l,d=1;t==null&&(t=[]);function h(y){return 1/Math.min(a[y.source.index],a[y.target.index])}function f(y){for(var g=0,v=t.length;g<d;++g)for(var w=0,b,C,A,_,S,T,P;w<v;++w)b=t[w],C=b.source,A=b.target,_=A.x+A.vx-C.x-C.vx||Be(l),S=A.y+A.vy-C.y-C.vy||Be(l),T=Math.sqrt(_*_+S*S),T=(T-s[w])/T*y*r[w],_*=T,S*=T,A.vx-=_*(P=c[w]),A.vy-=S*P,C.vx+=_*(P=1-P),C.vy+=S*P}function p(){if(o){var y,g=o.length,v=t.length,w=new Map(o.map((C,A)=>[e(C,A,o),C])),b;for(y=0,a=new Array(g);y<v;++y)b=t[y],b.index=y,typeof b.source!="object"&&(b.source=Ea(w,b.source)),typeof b.target!="object"&&(b.target=Ea(w,b.target)),a[b.source.index]=(a[b.source.index]||0)+1,a[b.target.index]=(a[b.target.index]||0)+1;for(y=0,c=new Array(v);y<v;++y)b=t[y],c[y]=a[b.source.index]/(a[b.source.index]+a[b.target.index]);r=new Array(v),m(),s=new Array(v),x()}}function m(){if(o)for(var y=0,g=t.length;y<g;++y)r[y]=+n(t[y],y,t)}function x(){if(o)for(var y=0,g=t.length;y<g;++y)s[y]=+i(t[y],y,t)}return f.initialize=function(y,g){o=y,l=g,p()},f.links=function(y){return arguments.length?(t=y,p(),f):t},f.id=function(y){return arguments.length?(e=y,f):e},f.iterations=function(y){return arguments.length?(d=+y,f):d},f.strength=function(y){return arguments.length?(n=typeof y=="function"?y:Rt(+y),m(),f):n},f.distance=function(y){return arguments.length?(i=typeof y=="function"?y:Rt(+y),x(),f):i},f}const Ox=1664525,zx=1013904223,Ra=4294967296;function Dx(){let t=1;return()=>(t=(Ox*t+zx)%Ra)/Ra}function Nx(t){return t.x}function Lx(t){return t.y}var Fx=10,Bx=Math.PI*(3-Math.sqrt(5));function Vx(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,a=new Map,c=fo(h),l=Tr("tick","end"),d=Dx();t==null&&(t=[]);function h(){f(),l.call("tick",e),n<r&&(c.stop(),l.call("end",e))}function f(x){var y,g=t.length,v;x===void 0&&(x=1);for(var w=0;w<x;++w)for(n+=(s-n)*i,a.forEach(function(b){b(n)}),y=0;y<g;++y)v=t[y],v.fx==null?v.x+=v.vx*=o:(v.x=v.fx,v.vx=0),v.fy==null?v.y+=v.vy*=o:(v.y=v.fy,v.vy=0);return e}function p(){for(var x=0,y=t.length,g;x<y;++x){if(g=t[x],g.index=x,g.fx!=null&&(g.x=g.fx),g.fy!=null&&(g.y=g.fy),isNaN(g.x)||isNaN(g.y)){var v=Fx*Math.sqrt(.5+x),w=x*Bx;g.x=v*Math.cos(w),g.y=v*Math.sin(w)}(isNaN(g.vx)||isNaN(g.vy))&&(g.vx=g.vy=0)}}function m(x){return x.initialize&&x.initialize(t,d),x}return p(),e={tick:f,restart:function(){return c.restart(h),e},stop:function(){return c.stop(),e},nodes:function(x){return arguments.length?(t=x,p(),a.forEach(m),e):t},alpha:function(x){return arguments.length?(n=+x,e):n},alphaMin:function(x){return arguments.length?(r=+x,e):r},alphaDecay:function(x){return arguments.length?(i=+x,e):+i},alphaTarget:function(x){return arguments.length?(s=+x,e):s},velocityDecay:function(x){return arguments.length?(o=1-x,e):1-o},randomSource:function(x){return arguments.length?(d=x,a.forEach(m),e):d},force:function(x,y){return arguments.length>1?(y==null?a.delete(x):a.set(x,m(y)),e):a.get(x)},find:function(x,y,g){var v=0,w=t.length,b,C,A,_,S;for(g==null?g=1/0:g*=g,v=0;v<w;++v)_=t[v],b=x-_.x,C=y-_.y,A=b*b+C*C,A<g&&(S=_,g=A);return S},on:function(x,y){return arguments.length>1?(l.on(x,y),e):l.on(x)}}}function Hx(){var t,e,n,r,i=Rt(-30),s,o=1,a=1/0,c=.81;function l(p){var m,x=t.length,y=go(t,Nx,Lx).visitAfter(h);for(r=p,m=0;m<x;++m)e=t[m],y.visit(f)}function d(){if(t){var p,m=t.length,x;for(s=new Array(m),p=0;p<m;++p)x=t[p],s[x.index]=+i(x,p,t)}}function h(p){var m=0,x,y,g=0,v,w,b;if(p.length){for(v=w=b=0;b<4;++b)(x=p[b])&&(y=Math.abs(x.value))&&(m+=x.value,g+=y,v+=y*x.x,w+=y*x.y);p.x=v/g,p.y=w/g}else{x=p,x.x=x.data.x,x.y=x.data.y;do m+=s[x.data.index];while(x=x.next)}p.value=m}function f(p,m,x,y){if(!p.value)return!0;var g=p.x-e.x,v=p.y-e.y,w=y-m,b=g*g+v*v;if(w*w/c<b)return b<a&&(g===0&&(g=Be(n),b+=g*g),v===0&&(v=Be(n),b+=v*v),b<o&&(b=Math.sqrt(o*b)),e.vx+=g*p.value*r/b,e.vy+=v*p.value*r/b),!0;if(p.length||b>=a)return;(p.data!==e||p.next)&&(g===0&&(g=Be(n),b+=g*g),v===0&&(v=Be(n),b+=v*v),b<o&&(b=Math.sqrt(o*b)));do p.data!==e&&(w=s[p.data.index]*r/b,e.vx+=g*w,e.vy+=v*w);while(p=p.next)}return l.initialize=function(p,m){t=p,n=m,d()},l.strength=function(p){return arguments.length?(i=typeof p=="function"?p:Rt(+p),d(),l):i},l.distanceMin=function(p){return arguments.length?(o=p*p,l):Math.sqrt(o)},l.distanceMax=function(p){return arguments.length?(a=p*p,l):Math.sqrt(a)},l.theta=function(p){return arguments.length?(c=p*p,l):Math.sqrt(c)},l}function Wx(t){var e=Rt(.1),n,r,i;typeof t!="function"&&(t=Rt(t==null?0:+t));function s(a){for(var c=0,l=n.length,d;c<l;++c)d=n[c],d.vx+=(i[c]-d.x)*r[c]*a}function o(){if(n){var a,c=n.length;for(r=new Array(c),i=new Array(c),a=0;a<c;++a)r[a]=isNaN(i[a]=+t(n[a],a,n))?0:+e(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(e=typeof a=="function"?a:Rt(+a),o(),s):e},s.x=function(a){return arguments.length?(t=typeof a=="function"?a:Rt(+a),o(),s):t},s}function Xx(t){var e=Rt(.1),n,r,i;typeof t!="function"&&(t=Rt(t==null?0:+t));function s(a){for(var c=0,l=n.length,d;c<l;++c)d=n[c],d.vy+=(i[c]-d.y)*r[c]*a}function o(){if(n){var a,c=n.length;for(r=new Array(c),i=new Array(c),a=0;a<c;++a)r[a]=isNaN(i[a]=+t(n[a],a,n))?0:+e(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(e=typeof a=="function"?a:Rt(+a),o(),s):e},s.y=function(a){return arguments.length?(t=typeof a=="function"?a:Rt(+a),o(),s):t},s}const Hr=t=>()=>t;function Yx(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function xe(t,e,n){this.k=t,this.x=e,this.y=n}xe.prototype={constructor:xe,scale:function(t){return t===1?this:new xe(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new xe(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var $i=new xe(1,0,0);Qc.prototype=xe.prototype;function Qc(t){for(;!t.__zoom;)if(!(t=t.parentNode))return $i;return t.__zoom}function rs(t){t.stopImmediatePropagation()}function Kn(t){t.preventDefault(),t.stopImmediatePropagation()}function Ux(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function qx(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function $a(){return this.__zoom||$i}function Gx(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Kx(){return navigator.maxTouchPoints||"ontouchstart"in this}function Zx(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function Qx(){var t=Ux,e=qx,n=Zx,r=Gx,i=Kx,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,c=tg,l=Tr("start","zoom","end"),d,h,f,p=500,m=150,x=0,y=10;function g(j){j.property("__zoom",$a).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",T).on("dblclick.zoom",P).filter(i).on("touchstart.zoom",M).on("touchmove.zoom",$).on("touchend.zoom touchcancel.zoom",R).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}g.transform=function(j,I,k,E){var N=j.selection?j.selection():j;N.property("__zoom",$a),j!==N?C(j,I,k,E):N.interrupt().each(function(){A(this,arguments).event(E).start().zoom(null,typeof I=="function"?I.apply(this,arguments):I).end()})},g.scaleBy=function(j,I,k,E){g.scaleTo(j,function(){var N=this.__zoom.k,V=typeof I=="function"?I.apply(this,arguments):I;return N*V},k,E)},g.scaleTo=function(j,I,k,E){g.transform(j,function(){var N=e.apply(this,arguments),V=this.__zoom,F=k==null?b(N):typeof k=="function"?k.apply(this,arguments):k,H=V.invert(F),K=typeof I=="function"?I.apply(this,arguments):I;return n(w(v(V,K),F,H),N,o)},k,E)},g.translateBy=function(j,I,k,E){g.transform(j,function(){return n(this.__zoom.translate(typeof I=="function"?I.apply(this,arguments):I,typeof k=="function"?k.apply(this,arguments):k),e.apply(this,arguments),o)},null,E)},g.translateTo=function(j,I,k,E,N){g.transform(j,function(){var V=e.apply(this,arguments),F=this.__zoom,H=E==null?b(V):typeof E=="function"?E.apply(this,arguments):E;return n($i.translate(H[0],H[1]).scale(F.k).translate(typeof I=="function"?-I.apply(this,arguments):-I,typeof k=="function"?-k.apply(this,arguments):-k),V,o)},E,N)};function v(j,I){return I=Math.max(s[0],Math.min(s[1],I)),I===j.k?j:new xe(I,j.x,j.y)}function w(j,I,k){var E=I[0]-k[0]*j.k,N=I[1]-k[1]*j.k;return E===j.x&&N===j.y?j:new xe(j.k,E,N)}function b(j){return[(+j[0][0]+ +j[1][0])/2,(+j[0][1]+ +j[1][1])/2]}function C(j,I,k,E){j.on("start.zoom",function(){A(this,arguments).event(E).start()}).on("interrupt.zoom end.zoom",function(){A(this,arguments).event(E).end()}).tween("zoom",function(){var N=this,V=arguments,F=A(N,V).event(E),H=e.apply(N,V),K=k==null?b(H):typeof k=="function"?k.apply(N,V):k,D=Math.max(H[1][0]-H[0][0],H[1][1]-H[0][1]),B=N.__zoom,Y=typeof I=="function"?I.apply(N,V):I,q=c(B.invert(K).concat(D/B.k),Y.invert(K).concat(D/Y.k));return function(G){if(G===1)G=Y;else{var Z=q(G),it=D/Z[2];G=new xe(it,K[0]-Z[0]*it,K[1]-Z[1]*it)}F.zoom(null,G)}})}function A(j,I,k){return!k&&j.__zooming||new _(j,I)}function _(j,I){this.that=j,this.args=I,this.active=0,this.sourceEvent=null,this.extent=e.apply(j,I),this.taps=0}_.prototype={event:function(j){return j&&(this.sourceEvent=j),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(j,I){return this.mouse&&j!=="mouse"&&(this.mouse[1]=I.invert(this.mouse[0])),this.touch0&&j!=="touch"&&(this.touch0[1]=I.invert(this.touch0[0])),this.touch1&&j!=="touch"&&(this.touch1[1]=I.invert(this.touch1[0])),this.that.__zoom=I,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(j){var I=te(this.that).datum();l.call(j,this.that,new Yx(j,{sourceEvent:this.sourceEvent,target:g,transform:this.that.__zoom,dispatch:l}),I)}};function S(j,...I){if(!t.apply(this,arguments))return;var k=A(this,I).event(j),E=this.__zoom,N=Math.max(s[0],Math.min(s[1],E.k*Math.pow(2,r.apply(this,arguments)))),V=pe(j);if(k.wheel)(k.mouse[0][0]!==V[0]||k.mouse[0][1]!==V[1])&&(k.mouse[1]=E.invert(k.mouse[0]=V)),clearTimeout(k.wheel);else{if(E.k===N)return;k.mouse=[V,E.invert(V)],Zr(this),k.start()}Kn(j),k.wheel=setTimeout(F,m),k.zoom("mouse",n(w(v(E,N),k.mouse[0],k.mouse[1]),k.extent,o));function F(){k.wheel=null,k.end()}}function T(j,...I){if(f||!t.apply(this,arguments))return;var k=j.currentTarget,E=A(this,I,!0).event(j),N=te(j.view).on("mousemove.zoom",K,!0).on("mouseup.zoom",D,!0),V=pe(j,k),F=j.clientX,H=j.clientY;Oc(j.view),rs(j),E.mouse=[V,this.__zoom.invert(V)],Zr(this),E.start();function K(B){if(Kn(B),!E.moved){var Y=B.clientX-F,q=B.clientY-H;E.moved=Y*Y+q*q>x}E.event(B).zoom("mouse",n(w(E.that.__zoom,E.mouse[0]=pe(B,k),E.mouse[1]),E.extent,o))}function D(B){N.on("mousemove.zoom mouseup.zoom",null),zc(B.view,E.moved),Kn(B),E.event(B).end()}}function P(j,...I){if(t.apply(this,arguments)){var k=this.__zoom,E=pe(j.changedTouches?j.changedTouches[0]:j,this),N=k.invert(E),V=k.k*(j.shiftKey?.5:2),F=n(w(v(k,V),E,N),e.apply(this,I),o);Kn(j),a>0?te(this).transition().duration(a).call(C,F,E,j):te(this).call(g.transform,F,E,j)}}function M(j,...I){if(t.apply(this,arguments)){var k=j.touches,E=k.length,N=A(this,I,j.changedTouches.length===E).event(j),V,F,H,K;for(rs(j),F=0;F<E;++F)H=k[F],K=pe(H,this),K=[K,this.__zoom.invert(K),H.identifier],N.touch0?!N.touch1&&N.touch0[2]!==K[2]&&(N.touch1=K,N.taps=0):(N.touch0=K,V=!0,N.taps=1+!!d);d&&(d=clearTimeout(d)),V&&(N.taps<2&&(h=K[0],d=setTimeout(function(){d=null},p)),Zr(this),N.start())}}function $(j,...I){if(this.__zooming){var k=A(this,I).event(j),E=j.changedTouches,N=E.length,V,F,H,K;for(Kn(j),V=0;V<N;++V)F=E[V],H=pe(F,this),k.touch0&&k.touch0[2]===F.identifier?k.touch0[0]=H:k.touch1&&k.touch1[2]===F.identifier&&(k.touch1[0]=H);if(F=k.that.__zoom,k.touch1){var D=k.touch0[0],B=k.touch0[1],Y=k.touch1[0],q=k.touch1[1],G=(G=Y[0]-D[0])*G+(G=Y[1]-D[1])*G,Z=(Z=q[0]-B[0])*Z+(Z=q[1]-B[1])*Z;F=v(F,Math.sqrt(G/Z)),H=[(D[0]+Y[0])/2,(D[1]+Y[1])/2],K=[(B[0]+q[0])/2,(B[1]+q[1])/2]}else if(k.touch0)H=k.touch0[0],K=k.touch0[1];else return;k.zoom("touch",n(w(F,H,K),k.extent,o))}}function R(j,...I){if(this.__zooming){var k=A(this,I).event(j),E=j.changedTouches,N=E.length,V,F;for(rs(j),f&&clearTimeout(f),f=setTimeout(function(){f=null},p),V=0;V<N;++V)F=E[V],k.touch0&&k.touch0[2]===F.identifier?delete k.touch0:k.touch1&&k.touch1[2]===F.identifier&&delete k.touch1;if(k.touch1&&!k.touch0&&(k.touch0=k.touch1,delete k.touch1),k.touch0)k.touch0[1]=this.__zoom.invert(k.touch0[0]);else if(k.end(),k.taps===2&&(F=pe(F,this),Math.hypot(h[0]-F[0],h[1]-F[1])<y)){var H=te(this).on("dblclick.zoom");H&&H.apply(this,arguments)}}}return g.wheelDelta=function(j){return arguments.length?(r=typeof j=="function"?j:Hr(+j),g):r},g.filter=function(j){return arguments.length?(t=typeof j=="function"?j:Hr(!!j),g):t},g.touchable=function(j){return arguments.length?(i=typeof j=="function"?j:Hr(!!j),g):i},g.extent=function(j){return arguments.length?(e=typeof j=="function"?j:Hr([[+j[0][0],+j[0][1]],[+j[1][0],+j[1][1]]]),g):e},g.scaleExtent=function(j){return arguments.length?(s[0]=+j[0],s[1]=+j[1],g):[s[0],s[1]]},g.translateExtent=function(j){return arguments.length?(o[0][0]=+j[0][0],o[1][0]=+j[1][0],o[0][1]=+j[0][1],o[1][1]=+j[1][1],g):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},g.constrain=function(j){return arguments.length?(n=j,g):n},g.duration=function(j){return arguments.length?(a=+j,g):a},g.interpolate=function(j){return arguments.length?(c=j,g):c},g.on=function(){var j=l.on.apply(l,arguments);return j===l?g:j},g.clickDistance=function(j){return arguments.length?(x=(j=+j)*j,g):Math.sqrt(x)},g.tapDistance=function(j){return arguments.length?(y=+j,g):y},g}const kt=50;let Jx=class rr{constructor(e,n,r,i,s){Yt(this,"_svg");Yt(this,"_content");Yt(this,"_zoom");Yt(this,"_proteinsSelection");Yt(this,"_crosslinksSelection");Yt(this,"_tooltip");Yt(this,"onUpdatePositions");Yt(this,"_classNames");Yt(this,"_categories");Yt(this,"_data",{proteins:[],crosslinks:[]});Yt(this,"_isMouseDown",!1);this._svg=te(e),this._svg.selectChildren().remove(),this._svg.on("mousedown",()=>{this._isMouseDown=!0}).on("mouseup",()=>{this._isMouseDown=!1}),this._content=this._svg.append("g"),this._zoom=Qx().scaleExtent([.01,3]).on("zoom",({transform:o})=>this._content.attr("transform",o)).filter(o=>o.type==="wheel"?o.ctrlKey:!0).on("end",()=>{this._isMouseDown=!1}),this._svg.call(this._zoom),this._proteinsSelection=this._content.append("g").selectAll("g"),this._crosslinksSelection=this._content.append("g").selectAll("path"),this._classNames=n,this._tooltip=this._svg.select(function(){return this.parentElement}).append("div").classed(this._classNames.tooltip,!0).style("position","absolute").style("opacity",0).style("pointer-events","none"),this.onUpdatePositions=i,this._categories=s,r&&this.updateData(r,0,!1)}_showTooltip(e){return n=>{const r=()=>{n.style("cursor",null),this._tooltip.transition().duration(100).style("opacity",0)},i=(s,o)=>{if(this._isMouseDown){r();return}n.style("cursor","crosshair"),e(s,o),this._tooltip.style("top",s.layerY+20+"px").style("left",s.layerX+20+"px"),this._tooltip.transition().duration(100).style("opacity",1)};n.on("mouseover",i),n.on("mousemove",i),n.on("mousedown",r),n.on("mouseleave",r)}}_showCrosslinkTooltip(){return this._showTooltip((e,{fromProtein:n,fromPosition:r,fromAminoAcid:i,toProtein:s,toPosition:o,toAminoAcid:a,category:c})=>{var p,m;const l=((p=this._data.proteins.find(({id:x})=>x===n))==null?void 0:p.name)??"",d=n===s?"":`${((m=this._data.proteins.find(({id:x})=>x===s))==null?void 0:m.name)??""} `,h=`${l} ${i??""}${r}`,f=`${d}${a??""}${o}`;this._tooltip.html(`${h} to ${f}`+(c!==void 0?`<br/>${c}`:""))})}updateData(e,n,r){var s;this._data={proteins:e.proteins.map(o=>({...this._data.proteins.find(({id:a})=>a===o.id),...o})),crosslinks:e.crosslinks};const i=this._simulateProteinsPositions();i&&((s=this.onUpdatePositions)==null||s.call(this,i)),this._proteinsSelection=this._proteinsSelection.data(this._data.proteins,({id:o})=>o).join(o=>{const a=o.append("g").attr("id",({id:c})=>`protein-${c}`).classed(this._classNames.protein_from_other_experiment,({isFromCurrentExperiment:c})=>!c).attr("transform",c=>`translate(${rr._getProteinPosition(c).join()})`).call(Pm().subject(()=>this).on("start",rr._proteinDragStarted));return a.append("rect").classed(this._classNames.protein,!0).attr("width",({length:c})=>c).attr("height",kt).call(this._showTooltip((c,{name:l})=>this._tooltip.html(l))),a.selectAll(`rect.${this._classNames.domain}`).data(c=>(c.domains??[]).map(l=>({...l,protein:c}))).join("rect").classed(this._classNames.domain,!0).attr("pointer-events","fill").attr("x",({startPosition:c})=>c).attr("y",0).attr("width",({startPosition:c,endPosition:l})=>l-c).attr("height",kt).call(this._showTooltip((c,{name:l,protein:d})=>this._tooltip.html(`${d.name}: ${l}`))),a.selectAll(`text.${this._classNames.domain}`).data(c=>c.domains??[]).join("text").classed(this._classNames.domain,!0).attr("x",({startPosition:c})=>c).attr("y",kt).attr("dominant-baseline","text-before-edge").attr("text-anchor","start").text(({name:c})=>c),a.append("path").classed(this._classNames.known_protein_borders,!0).attr("pointer-events","none").attr("d",({length:c,isEstimatedLength:l})=>{const d=Sn();return d.moveTo(c,0),d.lineTo(0,0),d.lineTo(0,kt),d.lineTo(c,kt),l||d.closePath(),d.toString()}),a.append("path").classed(this._classNames.unknown_protein_borders,!0).attr("pointer-events","none").attr("d",({isEstimatedLength:c,length:l})=>{const d=Sn();return c&&(d.moveTo(l,0),d.lineTo(l,kt)),d.toString()}),a.append("text").classed(this._classNames.protein_name,!0).attr("x",-20).attr("y",kt/2).attr("dominant-baseline","central").attr("text-anchor","end").text(({name:c})=>c),a},o=>(o.select(`rect.${this._classNames.protein}`).attr("width",({length:a})=>a),o.selectAll(`rect.${this._classNames.domain}`).data(a=>a.domains??[]).join("rect").classed(this._classNames.domain,!0).attr("x",({startPosition:a})=>a).attr("y",0).attr("width",({startPosition:a,endPosition:c})=>c-a).attr("height",kt),o.selectAll(`text.${this._classNames.domain}`).data(a=>a.domains??[]).join("text").classed(this._classNames.domain,!0).attr("x",({startPosition:a})=>a).attr("y",kt).attr("dominant-baseline","text-before-edge").attr("text-anchor","start").text(({name:a})=>a),o.select(`path.${this._classNames.known_protein_borders}`).attr("d",({length:a,isEstimatedLength:c})=>{const l=Sn();return l.moveTo(a,0),l.lineTo(0,0),l.lineTo(0,kt),l.lineTo(a,kt),c||l.closePath(),l.toString()}),o.select(`path.${this._classNames.unknown_protein_borders}`).attr("d",({isEstimatedLength:a,length:c})=>{const l=Sn();return a&&(l.moveTo(c,0),l.lineTo(c,kt)),l.toString()}),o.select(`text.${this._classNames.protein_name}`).text(({name:a})=>a),o)),this._crosslinksSelection=this._crosslinksSelection.data(this._data.crosslinks,({id:o})=>o).join(o=>o.append("path").classed(this._classNames.xlinks,!0).classed(this._classNames.interprotein,({fromProtein:a,toProtein:c})=>a!==c).classed(this._classNames.intraprotein,({fromProtein:a,toProtein:c})=>a===c).attr("pointer-events","visibleStroke").call(this._showCrosslinkTooltip())),this._redrawCrosslinks(),this.zoomToFit(void 0,n,r)}zoomToFit(e,n=100,r=!1,i=0){e||(e=this._content.node().getBBox());const s=this._svg.node().getBoundingClientRect(),o=this._zoom.scaleExtent(),a=r?Qc(this._svg.node()).k:o[1],c=$i.scale(Math.max(o[0],Math.min(a,s.width/(e.width+i),s.height/(e.height+i)))).translate(-(e.x+e.width/2),-(e.y+e.height/2));this._svg.transition().duration(n).call(this._zoom.transform,c)}_simulateProteinsPositions(){for(const s of this._data.proteins)s.fx=s.x,s.fy=s.y;const e=new Set(this._data.proteins.filter(({fx:s,fy:o})=>s===void 0||o===void 0).map(({id:s})=>s));if(e.size===0)return;const n=this._data.crosslinks.filter(({fromProtein:s,toProtein:o})=>s!==o).map(({fromProtein:s,toProtein:o})=>({source:this._data.proteins.findIndex(({id:a})=>a===s),target:this._data.proteins.findIndex(({id:a})=>a===o)})),r=Vx(this._data.proteins).stop().force("collide",Ex(({length:s})=>s/2)).force("x",Wx().strength(.01)).force("y",Xx().strength(.01)).force("charge",Hx()).force("link",$x(n));r.tick(Math.ceil(Math.log(r.alphaMin())/Math.log(1-r.alphaDecay())));const i={};for(const s of this._data.proteins)s.fx=s.x,s.fy=s.y,s.vx=void 0,s.vy=void 0,e.has(s.id)&&s.x!==void 0&&s.y!==void 0&&(i[s.id]={x:s.x,y:s.y});return i}static _getProteinPosition({x:e,y:n,length:r}){return[(e??0)-r/2,(n??0)-kt/2]}_redrawCrosslinks(){const e=Object.fromEntries(this._data.proteins.map(n=>[n.id,rr._getProteinPosition(n)]));this._crosslinksSelection.classed(this._classNames.homomultimeric,({homoMultimeric:n})=>n).call(n=>{var r;(r=this._categories)==null||r.forEach(i=>{n.classed(this._classNames[i],s=>s.category===i)})}).attr("d",n=>{if(!(n.fromProtein in e)||!(n.toProtein in e))return null;const r=n.fromPosition==="ntd"?1:n.fromPosition,i=n.toPosition==="ntd"?1:n.toPosition,[s,o]=e[n.fromProtein],[a,c]=e[n.toProtein],l=Sn();return l.moveTo(s+r,o+kt/2),n.fromProtein===n.toProtein&&(l.lineTo(s+r,o),l.bezierCurveTo(s+r,o-kt-.3*Math.abs(a+i-(s+r)),a+i,c-kt-.3*Math.abs(a+i-(s+r)),a+i,c)),l.lineTo(a+i,c+kt/2),l.toString()})}static _proteinDragStarted(e){const n=e.subject._classNames.dragging,r=te(this).classed(n,!0).raise();e.subject._isMouseDown=!0,e.on("drag",(i,s)=>{s.x=(s.x??0)+i.dx,s.y=(s.y??0)+i.dy,r.attr("transform",o=>`translate(${rr._getProteinPosition(o).join()})`),i.subject._redrawCrosslinks()}).on("end",(i,{id:s,x:o,y:a})=>{var c,l;r.classed(n,!1),o!==void 0&&a!==void 0&&((l=(c=i.subject).onUpdatePositions)==null||l.call(c,{[s]:{x:o,y:a}})),i.subject._isMouseDown=!1})}};const ty="_xlmap_1qgca_1",ey="_grid_1qgca_5",ny="_protein_from_other_experiment_1qgca_12",ry="_tooltip_1qgca_16",iy="_protein_1qgca_12",sy="_known_protein_borders_1qgca_26",oy="_domain_1qgca_30",ay="_unknown_protein_borders_1qgca_40",ly="_dragging_1qgca_51",cy="_xlinks_1qgca_56",uy="_intraprotein_1qgca_65",dy="_interprotein_1qgca_69",hy="_homomultimeric_1qgca_69",fy="_over_1qgca_73",py="_ok_1qgca_77",my="_under_1qgca_81",gy="_unmapped_1qgca_85",xy="_protein_name_1qgca_97",is={xlmap:ty,grid:ey,protein_from_other_experiment:ny,tooltip:ry,protein:iy,known_protein_borders:sy,domain:oy,unknown_protein_borders:ay,dragging:ly,xlinks:cy,intraprotein:uy,interprotein:dy,homomultimeric:hy,over:fy,ok:py,under:my,unmapped:gy,"partially-ok":"_partially-ok_1qgca_89","violated-mixed":"_violated-mixed_1qgca_93",protein_name:xy},yy=(t,e,n)=>{const{referenceProteinsById:r,structures:i,experimentIdToGroupedStructureIds:s,experimentIdToThresholds:o,aminoAcidsMustMatch:a}=mt(O),c=s[t.id],l=L(()=>{if(n.colorCrosslinksBy!=="distance")return[];const p=new Set(c.flat());return i.filter(({id:m})=>p.has(m))},[n.colorCrosslinksBy,i,c]),d=o[t.id],h=L(()=>{const p=[];for(const m of t.crosslinks){if(m.from.linkPosition===void 0||m.to.linkPosition===void 0||!e.has(m.id))continue;const x=n.colorCrosslinksBy!=="distance"?void 0:l.length>0?mc(Bn(m,l,a),d??{})??"unmapped":"unmapped";p.push({id:m.id,homoMultimeric:m.homoMultimeric===!0,fromProtein:m.from.proteinId,fromPosition:m.from.linkPosition,fromAminoAcid:m.from.aminoAcid,toProtein:m.to.proteinId,toPosition:m.to.linkPosition,toAminoAcid:m.to.aminoAcid,category:x})}return p},[t.crosslinks,n.colorCrosslinksBy,d,l,e,a]);return{proteins:L(()=>{const p=[];for(const{id:m,name:x,sequence:y,domains:g,isFromCurrentExperiment:v}of[...t.proteins.map(w=>({...w,isFromCurrentExperiment:!0})),...n.showProteinsFromOtherExperiments?Object.values(r).map(w=>({...w,isFromCurrentExperiment:!1})):[]]){if(p.some(b=>b.id===m)||!n.showProteinsWithoutCrosslinks&&!t.crosslinks.some(b=>e.has(b.id)&&(b.from.proteinId===m||b.to.proteinId===m)))continue;const w=(y==null?void 0:y.length)??50+Math.max(0,...t.crosslinks.flatMap(({from:b,to:C})=>[...b.proteinId===m&&typeof b.linkPosition=="number"?[b.linkPosition]:[],...C.proteinId===m&&typeof C.linkPosition=="number"?[C.linkPosition]:[]]));p.push({id:m,name:x,length:w,isEstimatedLength:y===void 0,domains:g,isFromCurrentExperiment:v,...O.proteinIdToXLMapPosition[m]??{}})}return p},[t,e,r,n.showProteinsFromOtherExperiments,n.showProteinsWithoutCrosslinks]),crosslinks:h}},vy=t=>{for(const[e,{x:n,y:r}]of Object.entries(t))O.proteinIdToXLMapPosition[e]={x:n,y:r}},by=({experiment:t,visibleCrosslinkIds:e})=>{const n=at(null),r=at(null),i=mt(O).xlMapSettings??{},{experimentIdToGroupedStructureIds:s}=mt(O),o=s[t.id].flat().length>0,a=yy(t,e,i);return St(()=>{if(r.current)r.current.updateData(a);else{if(!n.current)return;r.current=new Jx(n.current,is,a,vy,["under","ok","over","partially-ok","mixed-violated","unmapped"])}return()=>{r.current&&(r.current.onUpdatePositions=void 0,r.current=null)}},[a]),u.jsxs(At,{children:[u.jsxs(Fe,{size:"sm",positioning:{gutter:2},onSelect:({value:c})=>{},children:[u.jsx(nn,{asChild:!0,children:u.jsx(ot,{size:"2xs",variant:"ghost",position:"absolute",mt:3,ml:3,children:u.jsx(xl,{})})}),u.jsxs(Le,{children:[u.jsx(ar,{value:"showBackgroundGrid",checked:i.showBackgroundGrid,onCheckedChange:c=>{O.xlMapSettings.showBackgroundGrid=c},children:"Show Background Grid"}),u.jsx(ar,{value:"showProteinsFromOtherExperiments",checked:i.showProteinsFromOtherExperiments,onCheckedChange:c=>{O.xlMapSettings.showProteinsFromOtherExperiments=c},children:"Show All Reference Proteins"}),u.jsx(ar,{value:"showProteinsWithoutCrosslinks",checked:i.showProteinsWithoutCrosslinks,onCheckedChange:c=>{O.xlMapSettings.showProteinsWithoutCrosslinks=c},children:"Show Proteins Without Crosslinks"}),u.jsx(Tn,{}),u.jsxs(bs,{value:i.colorCrosslinksBy,onValueChange:({value:c})=>O.xlMapSettings.colorCrosslinksBy=c,children:[u.jsx(Il,{fontSize:"xs",pt:0,userSelect:"none",cursor:"default",children:"Color crosslinks by"}),u.jsx(kn,{value:"type",children:"Type"}),u.jsx(kn,{value:"distance",disabled:!o,children:"Distance"})]}),u.jsx(Tn,{}),u.jsxs(Jt,{value:"export",disabled:!0,children:[u.jsx(pl,{}),"Export..."]})]})]}),u.jsx("svg",{className:[is.xlmap,...i.showBackgroundGrid?[is.grid]:[]].join(" "),width:"100%",height:"300px",viewBox:"-250 -250 500 500",ref:n})]})};ve.register(Ks,Si,Zs,Ze);Ze.positioners.top=t=>{if(t.length===0)return!1;const e=t[0].element.x,n=t.reduce((r,{element:i})=>Math.min(r,i.y),1/0);return{x:e,y:n,yAlign:"bottom"}};const wy=({distances:t,view:e,thresholds:n})=>{const r=Fp();e==="thresholds"&&r.domain([0,1/0]).thresholds([n!=null&&n.lower?[n.lower]:[],n!=null&&n.upper?[n.upper]:[]].flat());const i=r(t),s={plugins:{legend:{display:!1},tooltip:{position:"top",titleAlign:"center",callbacks:{title:a=>{const c=i[a[0].dataIndex].length;return`${yt(c,"distance")} ${c===1?"is":"are"}`},afterTitle:a=>{const{x0:c,x1:l}=i[a[0].dataIndex];return a[0].dataIndex===0?`below ${l} Å`:a[0].dataIndex===i.length-1?`above ${c} Å`:`between ${c} Å and ${l} Å`},label:()=>""}}},scales:{x:{display:!1,max:i[i.length-1].x0},x2:{display:!0,offset:!1,grid:{offset:!1},title:{display:!0,text:"Distance [Å]"}},y:{title:{display:!0,text:"Count"}}},responsive:!0,maintainAspectRatio:!1,interaction:{mode:"x",intersect:!1},layout:{padding:{top:40}}},o={labels:[void 0,...i.flatMap(({x0:a},c)=>c===0?[]:[a]),void 0],datasets:[{data:i.map(a=>{if(!(a.x0===void 0||a.x1===void 0))return{x:a.x0+(a.x1-a.x0)/2,y:a.length}}),backgroundColor:a=>{const c=(n==null?void 0:n.lower)??0,l=(n==null?void 0:n.upper)??1/0;if(i[a.dataIndex]===void 0)return;const{x0:d,x1:h}=i[a.dataIndex];return d===void 0||h===void 0?"green":d<c&&h<=c?"orange":d>=l&&h>l?"red":d>=c&&h<=l?"green":"darkgreen"},barPercentage:1,categoryPercentage:1}]};return u.jsx(kr,{children:u.jsx("div",{style:{position:"relative",height:"300px",width:"100%"},children:u.jsx(ao,{options:s,data:o})})})};/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Er(t){return t+.5|0}const Ve=(t,e,n)=>Math.max(Math.min(t,n),e);function ir(t){return Ve(Er(t*2.55),0,255)}function Xe(t){return Ve(Er(t*255),0,255)}function me(t){return Ve(Er(t/2.55)/100,0,1)}function Oa(t){return Ve(Er(t*100),0,100)}const qt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Es=[..."0123456789ABCDEF"],jy=t=>Es[t&15],_y=t=>Es[(t&240)>>4]+Es[t&15],Wr=t=>(t&240)>>4===(t&15),Sy=t=>Wr(t.r)&&Wr(t.g)&&Wr(t.b)&&Wr(t.a);function Cy(t){var e=t.length,n;return t[0]==="#"&&(e===4||e===5?n={r:255&qt[t[1]]*17,g:255&qt[t[2]]*17,b:255&qt[t[3]]*17,a:e===5?qt[t[4]]*17:255}:(e===7||e===9)&&(n={r:qt[t[1]]<<4|qt[t[2]],g:qt[t[3]]<<4|qt[t[4]],b:qt[t[5]]<<4|qt[t[6]],a:e===9?qt[t[7]]<<4|qt[t[8]]:255})),n}const ky=(t,e)=>t<255?e(t):"";function Iy(t){var e=Sy(t)?jy:_y;return t?"#"+e(t.r)+e(t.g)+e(t.b)+ky(t.a,e):void 0}const Py=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Jc(t,e,n){const r=e*Math.min(n,1-n),i=(s,o=(s+t/30)%12)=>n-r*Math.max(Math.min(o-3,9-o,1),-1);return[i(0),i(8),i(4)]}function Ty(t,e,n){const r=(i,s=(i+t/60)%6)=>n-n*e*Math.max(Math.min(s,4-s,1),0);return[r(5),r(3),r(1)]}function My(t,e,n){const r=Jc(t,1,.5);let i;for(e+n>1&&(i=1/(e+n),e*=i,n*=i),i=0;i<3;i++)r[i]*=1-e-n,r[i]+=e;return r}function Ay(t,e,n,r,i){return t===i?(e-n)/r+(e<n?6:0):e===i?(n-t)/r+2:(t-e)/r+4}function yo(t){const n=t.r/255,r=t.g/255,i=t.b/255,s=Math.max(n,r,i),o=Math.min(n,r,i),a=(s+o)/2;let c,l,d;return s!==o&&(d=s-o,l=a>.5?d/(2-s-o):d/(s+o),c=Ay(n,r,i,d,s),c=c*60+.5),[c|0,l||0,a]}function vo(t,e,n,r){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,r)).map(Xe)}function bo(t,e,n){return vo(Jc,t,e,n)}function Ey(t,e,n){return vo(My,t,e,n)}function Ry(t,e,n){return vo(Ty,t,e,n)}function tu(t){return(t%360+360)%360}function $y(t){const e=Py.exec(t);let n=255,r;if(!e)return;e[5]!==r&&(n=e[6]?ir(+e[5]):Xe(+e[5]));const i=tu(+e[2]),s=+e[3]/100,o=+e[4]/100;return e[1]==="hwb"?r=Ey(i,s,o):e[1]==="hsv"?r=Ry(i,s,o):r=bo(i,s,o),{r:r[0],g:r[1],b:r[2],a:n}}function Oy(t,e){var n=yo(t);n[0]=tu(n[0]+e),n=bo(n),t.r=n[0],t.g=n[1],t.b=n[2]}function zy(t){if(!t)return;const e=yo(t),n=e[0],r=Oa(e[1]),i=Oa(e[2]);return t.a<255?`hsla(${n}, ${r}%, ${i}%, ${me(t.a)})`:`hsl(${n}, ${r}%, ${i}%)`}const za={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Da={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Dy(){const t={},e=Object.keys(Da),n=Object.keys(za);let r,i,s,o,a;for(r=0;r<e.length;r++){for(o=a=e[r],i=0;i<n.length;i++)s=n[i],a=a.replace(s,za[s]);s=parseInt(Da[o],16),t[a]=[s>>16&255,s>>8&255,s&255]}return t}let Xr;function Ny(t){Xr||(Xr=Dy(),Xr.transparent=[0,0,0,0]);const e=Xr[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const Ly=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Fy(t){const e=Ly.exec(t);let n=255,r,i,s;if(e){if(e[7]!==r){const o=+e[7];n=e[8]?ir(o):Ve(o*255,0,255)}return r=+e[1],i=+e[3],s=+e[5],r=255&(e[2]?ir(r):Ve(r,0,255)),i=255&(e[4]?ir(i):Ve(i,0,255)),s=255&(e[6]?ir(s):Ve(s,0,255)),{r,g:i,b:s,a:n}}}function By(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${me(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}const ss=t=>t<=.0031308?t*12.92:Math.pow(t,1/2.4)*1.055-.055,_n=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function Vy(t,e,n){const r=_n(me(t.r)),i=_n(me(t.g)),s=_n(me(t.b));return{r:Xe(ss(r+n*(_n(me(e.r))-r))),g:Xe(ss(i+n*(_n(me(e.g))-i))),b:Xe(ss(s+n*(_n(me(e.b))-s))),a:t.a+n*(e.a-t.a)}}function Yr(t,e,n){if(t){let r=yo(t);r[e]=Math.max(0,Math.min(r[e]+r[e]*n,e===0?360:1)),r=bo(r),t.r=r[0],t.g=r[1],t.b=r[2]}}function eu(t,e){return t&&Object.assign(e||{},t)}function Na(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=Xe(t[3]))):(e=eu(t,{r:0,g:0,b:0,a:1}),e.a=Xe(e.a)),e}function Hy(t){return t.charAt(0)==="r"?Fy(t):$y(t)}class yi{constructor(e){if(e instanceof yi)return e;const n=typeof e;let r;n==="object"?r=Na(e):n==="string"&&(r=Cy(e)||Ny(e)||Hy(e)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var e=eu(this._rgb);return e&&(e.a=me(e.a)),e}set rgb(e){this._rgb=Na(e)}rgbString(){return this._valid?By(this._rgb):void 0}hexString(){return this._valid?Iy(this._rgb):void 0}hslString(){return this._valid?zy(this._rgb):void 0}mix(e,n){if(e){const r=this.rgb,i=e.rgb;let s;const o=n===s?.5:n,a=2*o-1,c=r.a-i.a,l=((a*c===-1?a:(a+c)/(1+a*c))+1)/2;s=1-l,r.r=255&l*r.r+s*i.r+.5,r.g=255&l*r.g+s*i.g+.5,r.b=255&l*r.b+s*i.b+.5,r.a=o*r.a+(1-o)*i.a,this.rgb=r}return this}interpolate(e,n){return e&&(this._rgb=Vy(this._rgb,e._rgb,n)),this}clone(){return new yi(this.rgb)}alpha(e){return this._rgb.a=Xe(e),this}clearer(e){const n=this._rgb;return n.a*=1-e,this}greyscale(){const e=this._rgb,n=Er(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=n,this}opaquer(e){const n=this._rgb;return n.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Yr(this._rgb,2,e),this}darken(e){return Yr(this._rgb,2,-e),this}saturate(e){return Yr(this._rgb,1,e),this}desaturate(e){return Yr(this._rgb,1,-e),this}rotate(e){return Oy(this._rgb,e),this}}/*!
 * Chart.js v4.4.8
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function La(t){return t==null}function je(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function Bt(t){return t!==null&&Object.prototype.toString.call(t)==="[object Object]"}function nu(t){return(typeof t=="number"||t instanceof Number)&&isFinite(+t)}function Zt(t,e){return typeof t>"u"?e:t}function wo(t,e,n){if(t&&typeof t.call=="function")return t.apply(n,e)}function Rs(t){if(je(t))return t.map(Rs);if(Bt(t)){const e=Object.create(null),n=Object.keys(t),r=n.length;let i=0;for(;i<r;++i)e[n[i]]=Rs(t[n[i]]);return e}return t}function Wy(t){return["__proto__","prototype","constructor"].indexOf(t)===-1}function Xy(t,e,n,r){if(!Wy(t))return;const i=e[t],s=n[t];Bt(i)&&Bt(s)?$s(i,s,r):e[t]=Rs(s)}function $s(t,e,n){const r=je(e)?e:[e],i=r.length;if(!Bt(t))return t;n=n||{};const s=n.merger||Xy;let o;for(let a=0;a<i;++a){if(o=r[a],!Bt(o))continue;const c=Object.keys(o);for(let l=0,d=c.length;l<d;++l)s(c[l],t,o,n)}return t}const _e=t=>typeof t<"u",En=t=>typeof t=="function",gt=Math.PI,jo=2*gt,ru=gt/180,sn=gt/2,Zn=gt/4,Fa=gt*2/3;function Yy(t){return typeof t=="symbol"||typeof t=="object"&&t!==null&&!(Symbol.toPrimitive in t||"toString"in t||"valueOf"in t)}function Ba(t){return!Yy(t)&&!isNaN(parseFloat(t))&&isFinite(t)}function Me(t){return t*(gt/180)}function Uy(t){return t*(180/gt)}function Va(t,e){const n=e.x-t.x,r=e.y-t.y,i=Math.sqrt(n*n+r*r);let s=Math.atan2(r,n);return s<-.5*gt&&(s+=jo),{angle:s,distance:i}}function _o(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function qy(t){if(t&&typeof t=="object"){const e=t.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function os(t){return qy(t)?t:new yi(t).saturate(.5).darken(.1).hexString()}const Gy=["x","y","borderWidth","radius","tension"],Ky=["color","borderColor","backgroundColor"];function Zy(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),t.set("animations",{colors:{type:"color",properties:Ky},numbers:{type:"number",properties:Gy}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function Qy(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Jy={values(t){return je(t)?t:""+t}};var t1={formatters:Jy};function e1(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,n)=>n.lineWidth,tickColor:(e,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:t1.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const n1=Object.create(null),r1=Object.create(null);function lr(t,e){if(!e)return t;const n=e.split(".");for(let r=0,i=n.length;r<i;++r){const s=n[r];t=t[s]||(t[s]=Object.create(null))}return t}function as(t,e,n){return typeof e=="string"?$s(lr(t,e),n):$s(lr(t,""),e)}class i1{constructor(e,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,i)=>os(i.backgroundColor),this.hoverBorderColor=(r,i)=>os(i.borderColor),this.hoverColor=(r,i)=>os(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(n)}set(e,n){return as(this,e,n)}get(e){return lr(this,e)}describe(e,n){return as(r1,e,n)}override(e,n){return as(n1,e,n)}route(e,n,r,i){const s=lr(this,e),o=lr(this,r),a="_"+n;Object.defineProperties(s,{[a]:{value:s[n],writable:!0},[n]:{enumerable:!0,get(){const c=this[a],l=o[i];return Bt(c)?Object.assign({},l,c):Zt(c,l)},set(c){this[a]=c}}})}apply(e){e.forEach(n=>n(this))}}var s1=new i1({_scriptable:t=>!t.startsWith("on"),_indexable:t=>t!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Zy,Qy,e1]);function o1(t){return!t||La(t.size)||La(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function a1(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function l1(t){t.restore()}function c1(t,e){const{x:n,y:r,w:i,h:s,radius:o}=e;t.arc(n+o.topLeft,r+o.topLeft,o.topLeft,1.5*gt,gt,!0),t.lineTo(n,r+s-o.bottomLeft),t.arc(n+o.bottomLeft,r+s-o.bottomLeft,o.bottomLeft,gt,sn,!0),t.lineTo(n+i-o.bottomRight,r+s),t.arc(n+i-o.bottomRight,r+s-o.bottomRight,o.bottomRight,sn,0,!0),t.lineTo(n+i,r+o.topRight),t.arc(n+i-o.topRight,r+o.topRight,o.topRight,0,-sn,!0),t.lineTo(n+o.topLeft,r)}const u1=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,d1=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function h1(t,e){const n=(""+t).match(u1);if(!n||n[1]==="normal")return e*1.2;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100;break}return e*t}const f1=t=>+t||0;function iu(t,e){const n={},r=Bt(e),i=r?Object.keys(e):e,s=Bt(t)?r?o=>Zt(t[o],t[e[o]]):o=>t[o]:()=>t;for(const o of i)n[o]=f1(s(o));return n}function p1(t){return iu(t,{top:"y",right:"x",bottom:"y",left:"x"})}function m1(t){return iu(t,["topLeft","topRight","bottomLeft","bottomRight"])}function Oi(t){const e=p1(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function ls(t,e){t=t||{},e=e||s1.font;let n=Zt(t.size,e.size);typeof n=="string"&&(n=parseInt(n,10));let r=Zt(t.style,e.style);r&&!(""+r).match(d1)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);const i={family:Zt(t.family,e.family),lineHeight:h1(Zt(t.lineHeight,e.lineHeight),n),size:n,style:r,weight:Zt(t.weight,e.weight),string:""};return i.string=o1(i),i}function g1(){return typeof window<"u"&&typeof document<"u"}(function(){let t=!1;try{const e={get passive(){return t=!0,!1}};g1()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return t})();/*!
* chartjs-plugin-annotation v3.1.0
* https://www.chartjs.org/chartjs-plugin-annotation/index
 * (c) 2024 chartjs-plugin-annotation Contributors
 * Released under the MIT License
 */const Ha={modes:{point(t,e){return Qr(t,e,{intersect:!0})},nearest(t,e,n){return v1(t,e,n)},x(t,e,n){return Qr(t,e,{intersect:n.intersect,axis:"x"})},y(t,e,n){return Qr(t,e,{intersect:n.intersect,axis:"y"})}}};function So(t,e,n){return(Ha.modes[n.mode]||Ha.modes.nearest)(t,e,n)}function x1(t,e,n){return n!=="x"&&n!=="y"?t.inRange(e.x,e.y,"x",!0)||t.inRange(e.x,e.y,"y",!0):t.inRange(e.x,e.y,n,!0)}function y1(t,e,n){return n==="x"?{x:t.x,y:e.y}:n==="y"?{x:e.x,y:t.y}:e}function Qr(t,e,n){return t.filter(r=>n.intersect?r.inRange(e.x,e.y):x1(r,e,n.axis))}function v1(t,e,n){let r=Number.POSITIVE_INFINITY;return Qr(t,e,n).reduce((i,s)=>{const o=s.getCenterPoint(),a=y1(e,o,n.axis),c=_o(e,a);return c<r?(i=[s],r=c):c===r&&i.push(s),i},[]).sort((i,s)=>i._index-s._index).slice(0,1)}function xn(t,e,n){const r=Math.cos(n),i=Math.sin(n),s=e.x,o=e.y;return{x:s+r*(t.x-s)-i*(t.y-o),y:o+i*(t.x-s)+r*(t.y-o)}}const b1=(t,e)=>e>t||t.length>e.length&&t.slice(0,e.length)===e,on=.001,zi=(t,e,n)=>Math.min(n,Math.max(e,t)),su=(t,e)=>t.value>=t.start-e&&t.value<=t.end+e;function w1(t,e,n){for(const r of Object.keys(t))t[r]=zi(t[r],e,n);return t}function j1(t,e,n,r){return!t||!e||n<=0?!1:Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<=Math.pow(n+r,2)}function ou(t,{x:e,y:n,x2:r,y2:i},s,{borderWidth:o,hitTolerance:a}){const c=(o+a)/2,l=t.x>=e-c-on&&t.x<=r+c+on,d=t.y>=n-c-on&&t.y<=i+c+on;return s==="x"?l:(s==="y"||l)&&d}function au(t,{rect:e,center:n},r,{rotation:i,borderWidth:s,hitTolerance:o}){const a=xn(t,n,Me(-i));return ou(a,e,r,{borderWidth:s,hitTolerance:o})}function yn(t,e){const{centerX:n,centerY:r}=t.getProps(["centerX","centerY"],e);return{x:n,y:r}}function _1(t,e,n,r=!0){const i=n.split(".");let s=0;for(const o of e.split(".")){const a=i[s++];if(parseInt(o,10)<parseInt(a,10))break;if(b1(a,o)){if(r)throw new Error(`${t} v${n} is not supported. v${e} or newer is required.`);return!1}}return!0}const lu=t=>typeof t=="string"&&t.endsWith("%"),cu=t=>parseFloat(t)/100,uu=t=>zi(cu(t),0,1),Qn=(t,e)=>({x:t,y:e,x2:t,y2:e,width:0,height:0}),S1={box:t=>Qn(t.centerX,t.centerY),doughnutLabel:t=>Qn(t.centerX,t.centerY),ellipse:t=>({centerX:t.centerX,centerY:t.centerX,radius:0,width:0,height:0}),label:t=>Qn(t.centerX,t.centerY),line:t=>Qn(t.x,t.y),point:t=>({centerX:t.centerX,centerY:t.centerY,radius:0,width:0,height:0}),polygon:t=>Qn(t.centerX,t.centerY)};function Co(t,e){return e==="start"?0:e==="end"?t:lu(e)?uu(e)*t:t/2}function qe(t,e,n=!0){return typeof e=="number"?e:lu(e)?(n?uu(e):cu(e))*t:t}function C1(t,e){const{x:n,width:r}=t,i=e.textAlign;return i==="center"?n+r/2:i==="end"||i==="right"?n+r:n}function du(t,e,{borderWidth:n,position:r,xAdjust:i,yAdjust:s},o){const a=Bt(o),c=e.width+(a?o.width:0)+n,l=e.height+(a?o.height:0)+n,d=ko(r),h=Wa(t.x,c,i,d.x),f=Wa(t.y,l,s,d.y);return{x:h,y:f,x2:h+c,y2:f+l,width:c,height:l,centerX:h+c/2,centerY:f+l/2}}function ko(t,e="center"){return Bt(t)?{x:Zt(t.x,e),y:Zt(t.y,e)}:(t=Zt(t,e),{x:t,y:t})}const hu=(t,e)=>t&&t.autoFit&&e<1;function fu(t,e){const n=t.font,r=je(n)?n:[n];return hu(t,e)?r.map(function(i){const s=ls(i);return s.size=Math.floor(i.size*e),s.lineHeight=i.lineHeight,ls(s)}):r.map(i=>ls(i))}function pu(t){return t&&(_e(t.xValue)||_e(t.yValue))}function Wa(t,e,n=0,r){return t-Co(e,r)+n}function Vn(t,e,n){const r=n.init;if(r){if(r===!0)return gu(e,n)}else return;return k1(t,e,n)}function mu(t,e,n){let r=!1;return e.forEach(i=>{En(t[i])?(r=!0,n[i]=t[i]):_e(n[i])&&delete n[i]}),r}function gu(t,e){const n=e.type||"line";return S1[n](t)}function k1(t,e,n){const r=wo(n.init,[{chart:t,properties:e,options:n}]);if(r===!0)return gu(e,n);if(Bt(r))return r}const cs=new Map,I1=t=>isNaN(t)||t<=0,P1=t=>t.reduce(function(e,n){return e+=n.string,e},"");function Di(t){if(t&&typeof t=="object"){const e=t.toString();return e==="[object HTMLImageElement]"||e==="[object HTMLCanvasElement]"}}function Ni(t,{x:e,y:n},r){r&&(t.translate(e,n),t.rotate(Me(r)),t.translate(-e,-n))}function Se(t,e){if(e&&e.borderWidth)return t.lineCap=e.borderCapStyle||"butt",t.setLineDash(e.borderDash),t.lineDashOffset=e.borderDashOffset,t.lineJoin=e.borderJoinStyle||"miter",t.lineWidth=e.borderWidth,t.strokeStyle=e.borderColor,!0}function Hn(t,e){t.shadowColor=e.backgroundShadowColor,t.shadowBlur=e.shadowBlur,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY}function Li(t,e){const n=e.content;if(Di(n))return{width:qe(n.width,e.width),height:qe(n.height,e.height)};const r=fu(e),i=e.textStrokeWidth,s=je(n)?n:[n],o=s.join()+P1(r)+i+(t._measureText?"-spriting":"");return cs.has(o)||cs.set(o,E1(t,s,r,i)),cs.get(o)}function xu(t,e,n){const{x:r,y:i,width:s,height:o}=e;t.save(),Hn(t,n);const a=Se(t,n);t.fillStyle=n.backgroundColor,t.beginPath(),c1(t,{x:r,y:i,w:s,h:o,radius:w1(m1(n.borderRadius),0,Math.min(s,o)/2)}),t.closePath(),t.fill(),a&&(t.shadowColor=n.borderShadowColor,t.stroke()),t.restore()}function yu(t,e,n,r){const i=n.content;if(Di(i)){t.save(),t.globalAlpha=O1(n.opacity,i.style.opacity),t.drawImage(i,e.x,e.y,e.width,e.height),t.restore();return}const s=je(i)?i:[i],o=fu(n,r),a=n.color,c=je(a)?a:[a],l=C1(e,n),d=e.y+n.textStrokeWidth/2;t.save(),t.textBaseline="middle",t.textAlign=n.textAlign,T1(t,n)&&R1(t,{x:l,y:d},s,o),$1(t,{x:l,y:d},s,{fonts:o,colors:c}),t.restore()}function T1(t,e){if(e.textStrokeWidth>0)return t.lineJoin="round",t.miterLimit=2,t.lineWidth=e.textStrokeWidth,t.strokeStyle=e.textStrokeColor,!0}function M1(t,e,n,r){const{radius:i,options:s}=e,o=s.pointStyle,a=s.rotation;let c=(a||0)*ru;if(Di(o)){t.save(),t.translate(n,r),t.rotate(c),t.drawImage(o,-o.width/2,-o.height/2,o.width,o.height),t.restore();return}I1(i)||A1(t,{x:n,y:r,radius:i,rotation:a,style:o,rad:c})}function A1(t,{x:e,y:n,radius:r,rotation:i,style:s,rad:o}){let a,c,l,d;switch(t.beginPath(),s){default:t.arc(e,n,r,0,jo),t.closePath();break;case"triangle":t.moveTo(e+Math.sin(o)*r,n-Math.cos(o)*r),o+=Fa,t.lineTo(e+Math.sin(o)*r,n-Math.cos(o)*r),o+=Fa,t.lineTo(e+Math.sin(o)*r,n-Math.cos(o)*r),t.closePath();break;case"rectRounded":d=r*.516,l=r-d,a=Math.cos(o+Zn)*l,c=Math.sin(o+Zn)*l,t.arc(e-a,n-c,d,o-gt,o-sn),t.arc(e+c,n-a,d,o-sn,o),t.arc(e+a,n+c,d,o,o+sn),t.arc(e-c,n+a,d,o+sn,o+gt),t.closePath();break;case"rect":if(!i){l=Math.SQRT1_2*r,t.rect(e-l,n-l,2*l,2*l);break}o+=Zn;case"rectRot":a=Math.cos(o)*r,c=Math.sin(o)*r,t.moveTo(e-a,n-c),t.lineTo(e+c,n-a),t.lineTo(e+a,n+c),t.lineTo(e-c,n+a),t.closePath();break;case"crossRot":o+=Zn;case"cross":a=Math.cos(o)*r,c=Math.sin(o)*r,t.moveTo(e-a,n-c),t.lineTo(e+a,n+c),t.moveTo(e+c,n-a),t.lineTo(e-c,n+a);break;case"star":a=Math.cos(o)*r,c=Math.sin(o)*r,t.moveTo(e-a,n-c),t.lineTo(e+a,n+c),t.moveTo(e+c,n-a),t.lineTo(e-c,n+a),o+=Zn,a=Math.cos(o)*r,c=Math.sin(o)*r,t.moveTo(e-a,n-c),t.lineTo(e+a,n+c),t.moveTo(e+c,n-a),t.lineTo(e-c,n+a);break;case"line":a=Math.cos(o)*r,c=Math.sin(o)*r,t.moveTo(e-a,n-c),t.lineTo(e+a,n+c);break;case"dash":t.moveTo(e,n),t.lineTo(e+Math.cos(o)*r,n+Math.sin(o)*r);break}t.fill()}function E1(t,e,n,r){t.save();const i=e.length;let s=0,o=r;for(let a=0;a<i;a++){const c=n[Math.min(a,n.length-1)];t.font=c.string;const l=e[a];s=Math.max(s,t.measureText(l).width+r),o+=c.lineHeight}return t.restore(),{width:s,height:o}}function R1(t,{x:e,y:n},r,i){t.beginPath();let s=0;r.forEach(function(o,a){const c=i[Math.min(a,i.length-1)],l=c.lineHeight;t.font=c.string,t.strokeText(o,e,n+l/2+s),s+=l}),t.stroke()}function $1(t,{x:e,y:n},r,{fonts:i,colors:s}){let o=0;r.forEach(function(a,c){const l=s[Math.min(c,s.length-1)],d=i[Math.min(c,i.length-1)],h=d.lineHeight;t.beginPath(),t.font=d.string,t.fillStyle=l,t.fillText(a,e,n+h/2+o),o+=h,t.fill()})}function O1(t,e){const n=Ba(t)?t:e;return Ba(n)?zi(n,0,1):1}const vu=["left","bottom","top","right"];function z1(t,e){const{pointX:n,pointY:r,options:i}=e,s=i.callout,o=s&&s.display&&B1(e,s);if(!o||H1(e,s,o))return;if(t.save(),t.beginPath(),!Se(t,s))return t.restore();const{separatorStart:c,separatorEnd:l}=D1(e,o),{sideStart:d,sideEnd:h}=L1(e,o,c);(s.margin>0||i.borderWidth===0)&&(t.moveTo(c.x,c.y),t.lineTo(l.x,l.y)),t.moveTo(d.x,d.y),t.lineTo(h.x,h.y);const f=xn({x:n,y:r},e.getCenterPoint(),Me(-e.rotation));t.lineTo(f.x,f.y),t.stroke(),t.restore()}function D1(t,e){const{x:n,y:r,x2:i,y2:s}=t,o=N1(t,e);let a,c;return e==="left"||e==="right"?(a={x:n+o,y:r},c={x:a.x,y:s}):(a={x:n,y:r+o},c={x:i,y:a.y}),{separatorStart:a,separatorEnd:c}}function N1(t,e){const{width:n,height:r,options:i}=t,s=i.callout.margin+i.borderWidth/2;return e==="right"?n+s:e==="bottom"?r+s:-s}function L1(t,e,n){const{y:r,width:i,height:s,options:o}=t,a=o.callout.start,c=F1(e,o.callout);let l,d;return e==="left"||e==="right"?(l={x:n.x,y:r+qe(s,a)},d={x:l.x+c,y:l.y}):(l={x:n.x+qe(i,a),y:n.y},d={x:l.x,y:l.y+c}),{sideStart:l,sideEnd:d}}function F1(t,e){const n=e.side;return t==="left"||t==="top"?-n:n}function B1(t,e){const n=e.position;return vu.includes(n)?n:V1(t,e)}function V1(t,e){const{x:n,y:r,x2:i,y2:s,width:o,height:a,pointX:c,pointY:l,centerX:d,centerY:h,rotation:f}=t,p={x:d,y:h},m=e.start,x=qe(o,m),y=qe(a,m),g=[n,n+x,n+x,i],v=[r+y,s,r,s],w=[];for(let b=0;b<4;b++){const C=xn({x:g[b],y:v[b]},p,Me(f));w.push({position:vu[b],distance:_o(C,{x:c,y:l})})}return w.sort((b,C)=>b.distance-C.distance)[0].position}function H1(t,e,n){const{pointX:r,pointY:i}=t,s=e.margin;let o=r,a=i;return n==="left"?o+=s:n==="right"?o-=s:n==="top"?a+=s:n==="bottom"&&(a-=s),t.inRange(o,a)}const Xa={xScaleID:{min:"xMin",max:"xMax",start:"left",end:"right",startProp:"x",endProp:"x2"},yScaleID:{min:"yMin",max:"yMax",start:"bottom",end:"top",startProp:"y",endProp:"y2"}};function Dn(t,e,n){return e=typeof e=="number"?e:t.parse(e),nu(e)?t.getPixelForValue(e):n}function fn(t,e,n){const r=e[n];if(r||n==="scaleID")return r;const i=n.charAt(0),s=Object.values(t).filter(o=>o.axis&&o.axis===i);return s.length?s[0].id:i}function bu(t,e){if(t){const n=t.options.reverse,r=Dn(t,e.min,n?e.end:e.start),i=Dn(t,e.max,n?e.start:e.end);return{start:r,end:i}}}function wu(t,e){const{chartArea:n,scales:r}=t,i=r[fn(r,e,"xScaleID")],s=r[fn(r,e,"yScaleID")];let o=n.width/2,a=n.height/2;return i&&(o=Dn(i,e.xValue,i.left+i.width/2)),s&&(a=Dn(s,e.yValue,s.top+s.height/2)),{x:o,y:a}}function Io(t,e){const n=t.scales,r=n[fn(n,e,"xScaleID")],i=n[fn(n,e,"yScaleID")];if(!r&&!i)return{};let{left:s,right:o}=r||t.chartArea,{top:a,bottom:c}=i||t.chartArea;const l=Ya(r,{min:e.xMin,max:e.xMax,start:s,end:o});s=l.start,o=l.end;const d=Ya(i,{min:e.yMin,max:e.yMax,start:c,end:a});return a=d.start,c=d.end,{x:s,y:a,x2:o,y2:c,width:o-s,height:c-a,centerX:s+(o-s)/2,centerY:a+(c-a)/2}}function ju(t,e){if(!pu(e)){const n=Io(t,e);let r=e.radius;(!r||isNaN(r))&&(r=Math.min(n.width,n.height)/2,e.radius=r);const i=r*2,s=n.centerX+e.xAdjust,o=n.centerY+e.yAdjust;return{x:s-r,y:o-r,x2:s+r,y2:o+r,centerX:s,centerY:o,width:i,height:i,radius:r}}return X1(t,e)}function W1(t,e){const{scales:n,chartArea:r}=t,i=n[e.scaleID],s={x:r.left,y:r.top,x2:r.right,y2:r.bottom};return i?Y1(i,s,e):U1(n,s,e),s}function _u(t,e){const n=Io(t,e);return n.initProperties=Vn(t,n,e),n.elements=[{type:"label",optionScope:"label",properties:K1(t,n,e),initProperties:n.initProperties}],n}function X1(t,e){const n=wu(t,e),r=e.radius*2;return{x:n.x-e.radius+e.xAdjust,y:n.y-e.radius+e.yAdjust,x2:n.x+e.radius+e.xAdjust,y2:n.y+e.radius+e.yAdjust,centerX:n.x+e.xAdjust,centerY:n.y+e.yAdjust,radius:e.radius,width:r,height:r}}function Ya(t,e){const n=bu(t,e)||e;return{start:Math.min(n.start,n.end),end:Math.max(n.start,n.end)}}function Y1(t,e,n){const r=Dn(t,n.value,NaN),i=Dn(t,n.endValue,r);t.isHorizontal()?(e.x=r,e.x2=i):(e.y=r,e.y2=i)}function U1(t,e,n){for(const r of Object.keys(Xa)){const i=t[fn(t,n,r)];if(i){const{min:s,max:o,start:a,end:c,startProp:l,endProp:d}=Xa[r],h=bu(i,{min:n[s],max:n[o],start:i[a],end:i[c]});e[l]=h.start,e[d]=h.end}}}function q1({properties:t,options:e},n,r,i){const{x:s,x2:o,width:a}=t;return Su({start:s,end:o,borderWidth:e.borderWidth},{position:r.x,padding:{start:i.left,end:i.right},adjust:e.label.xAdjust,size:n.width})}function G1({properties:t,options:e},n,r,i){const{y:s,y2:o,height:a}=t;return Su({start:s,end:o,borderWidth:e.borderWidth},{position:r.y,padding:{start:i.top,end:i.bottom},adjust:e.label.yAdjust,size:n.height})}function Su(t,e){const{start:n,end:r,borderWidth:i}=t,{position:s,padding:{start:o,end:a},adjust:c}=e,l=r-i-n-o-a-e.size;return n+i/2+c+Co(l,s)}function K1(t,e,n){const r=n.label;r.backgroundColor="transparent",r.callout.display=!1;const i=ko(r.position),s=Oi(r.padding),o=Li(t.ctx,r),a=q1({properties:e,options:n},o,i,s),c=G1({properties:e,options:n},o,i,s),l=o.width+s.width,d=o.height+s.height;return{x:a,y:c,x2:a+l,y2:c+d,width:l,height:d,centerX:a+l/2,centerY:c+d/2,rotation:r.rotation}}const Os=["enter","leave"],Po=Os.concat("click");function Z1(t,e,n){e.listened=mu(n,Po,e.listeners),e.moveListened=!1,Os.forEach(r=>{En(n[r])&&(e.moveListened=!0)}),(!e.listened||!e.moveListened)&&e.annotations.forEach(r=>{!e.listened&&En(r.click)&&(e.listened=!0),e.moveListened||Os.forEach(i=>{En(r[i])&&(e.listened=!0,e.moveListened=!0)})})}function Q1(t,e,n){if(t.listened)switch(e.type){case"mousemove":case"mouseout":return J1(t,e,n);case"click":return tv(t,e,n)}}function J1(t,e,n){if(!t.moveListened)return;let r;e.type==="mousemove"?r=So(t.visibleElements,e,n.interaction):r=[];const i=t.hovered;t.hovered=r;const s={state:t,event:e};let o=Ua(s,"leave",i,r);return Ua(s,"enter",r,i)||o}function Ua({state:t,event:e},n,r,i){let s;for(const o of r)i.indexOf(o)<0&&(s=Cu(o.options[n]||t.listeners[n],o,e)||s);return s}function tv(t,e,n){const r=t.listeners,i=So(t.visibleElements,e,n.interaction);let s;for(const o of i)s=Cu(o.options.click||r.click,o,e)||s;return s}function Cu(t,e,n){return wo(t,[e.$context,n])===!0}const vi=["afterDraw","beforeDraw"];function ev(t,e,n){const r=e.visibleElements;e.hooked=mu(n,vi,e.hooks),e.hooked||r.forEach(i=>{e.hooked||vi.forEach(s=>{En(i.options[s])&&(e.hooked=!0)})})}function qa(t,e,n){if(t.hooked){const r=e.options[n]||t.hooks[n];return wo(r,[e.$context])}}function nv(t,e,n){const r=av(t.scales,e,n);let i=Ga(e,r,"min","suggestedMin");i=Ga(e,r,"max","suggestedMax")||i,i&&En(e.handleTickRangeOptions)&&e.handleTickRangeOptions()}function rv(t,e){for(const n of t)sv(n,e)}function Ga(t,e,n,r){if(nu(e[n])&&!iv(t.options,n,r)){const i=t[n]!==e[n];return t[n]=e[n],i}}function iv(t,e,n){return _e(t[e])||_e(t[n])}function sv(t,e){for(const n of["scaleID","xScaleID","yScaleID"]){const r=fn(e,t,n);r&&!e[r]&&ov(t,n)&&console.warn(`No scale found with id '${r}' for annotation '${t.id}'`)}}function ov(t,e){if(e==="scaleID")return!0;const n=e.charAt(0);for(const r of["Min","Max","Value"])if(_e(t[n+r]))return!0;return!1}function av(t,e,n){const r=e.axis,i=e.id,s=r+"ScaleID",o={min:Zt(e.min,Number.NEGATIVE_INFINITY),max:Zt(e.max,Number.POSITIVE_INFINITY)};for(const a of n)a.scaleID===i?Ka(a,e,["value","endValue"],o):fn(t,a,s)===i&&Ka(a,e,[r+"Min",r+"Max",r+"Value"],o);return o}function Ka(t,e,n,r){for(const i of n){const s=t[i];if(_e(s)){const o=e.parse(s);r.min=Math.min(r.min,o),r.max=Math.max(r.max,o)}}}class Wn extends gn{inRange(e,n,r,i){const{x:s,y:o}=xn({x:e,y:n},this.getCenterPoint(i),Me(-this.options.rotation));return ou({x:s,y:o},this.getProps(["x","y","x2","y2"],i),r,this.options)}getCenterPoint(e){return yn(this,e)}draw(e){e.save(),Ni(e,this.getCenterPoint(),this.options.rotation),xu(e,this,this.options),e.restore()}get label(){return this.elements&&this.elements[0]}resolveElementProperties(e,n){return _u(e,n)}}Wn.id="boxAnnotation";Wn.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:0,borderShadowColor:"transparent",borderWidth:1,display:!0,init:void 0,hitTolerance:0,label:{backgroundColor:"transparent",borderWidth:0,callout:{display:!1},color:"black",content:null,display:!1,drawTime:void 0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:"bold"},height:void 0,hitTolerance:void 0,opacity:void 0,padding:6,position:"center",rotation:void 0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,width:void 0,xAdjust:0,yAdjust:0,z:void 0},rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xMax:void 0,xMin:void 0,xScaleID:void 0,yMax:void 0,yMin:void 0,yScaleID:void 0,z:0};Wn.defaultRoutes={borderColor:"color",backgroundColor:"color"};Wn.descriptors={label:{_fallback:!0}};class Fi extends gn{inRange(e,n,r,i){return au({x:e,y:n},{rect:this.getProps(["x","y","x2","y2"],i),center:this.getCenterPoint(i)},r,{rotation:this.rotation,borderWidth:0,hitTolerance:this.options.hitTolerance})}getCenterPoint(e){return yn(this,e)}draw(e){const n=this.options;!n.display||!n.content||(fv(e,this),e.save(),Ni(e,this.getCenterPoint(),this.rotation),yu(e,this,n,this._fitRatio),e.restore())}resolveElementProperties(e,n){const r=lv(e,n);if(!r)return{};const{controllerMeta:i,point:s,radius:o}=uv(e,n,r);let a=Li(e.ctx,n);const c=dv(a,o);hu(n,c)&&(a={width:a.width*c,height:a.height*c});const{position:l,xAdjust:d,yAdjust:h}=n,f=du(s,a,{borderWidth:0,position:l,xAdjust:d,yAdjust:h});return{initProperties:Vn(e,f,n),...f,...i,rotation:n.rotation,_fitRatio:c}}}Fi.id="doughnutLabelAnnotation";Fi.defaults={autoFit:!0,autoHide:!0,backgroundColor:"transparent",backgroundShadowColor:"transparent",borderColor:"transparent",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderShadowColor:"transparent",borderWidth:0,color:"black",content:null,display:!0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:void 0},height:void 0,hitTolerance:0,init:void 0,opacity:void 0,position:"center",rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,spacing:1,textAlign:"center",textStrokeColor:void 0,textStrokeWidth:0,width:void 0,xAdjust:0,yAdjust:0};Fi.defaultRoutes={};function lv(t,e){return t.getSortedVisibleDatasetMetas().reduce(function(n,r){const i=r.controller;return i instanceof Fd&&cv(t,e,r.data)&&(!n||i.innerRadius<n.controller.innerRadius)&&i.options.circumference>=90?r:n},void 0)}function cv(t,e,n){if(!e.autoHide)return!0;for(let r=0;r<n.length;r++)if(!n[r].hidden&&t.getDataVisibility(r))return!0}function uv({chartArea:t},e,n){const{left:r,top:i,right:s,bottom:o}=t,{innerRadius:a,offsetX:c,offsetY:l}=n.controller,d=(r+s)/2+c,h=(i+o)/2+l,f={left:Math.max(d-a,r),right:Math.min(d+a,s),top:Math.max(h-a,i),bottom:Math.min(h+a,o)},p={x:(f.left+f.right)/2,y:(f.top+f.bottom)/2},m=e.spacing+e.borderWidth/2,x=a-m,y=p.y>h,g=y?i+m:o-m,v=hv(g,d,h,x);return{controllerMeta:{_centerX:d,_centerY:h,_radius:x,_counterclockwise:y,...v},point:p,radius:Math.min(a,Math.min(f.right-f.left,f.bottom-f.top)/2)}}function dv({width:t,height:e},n){const r=Math.sqrt(Math.pow(t,2)+Math.pow(e,2));return n*2/r}function hv(t,e,n,r){const i=Math.pow(n-t,2),s=Math.pow(r,2),o=e*-2,a=Math.pow(e,2)+i-s,c=Math.pow(o,2)-4*a;if(c<=0)return{_startAngle:0,_endAngle:jo};const l=(-o-Math.sqrt(c))/2,d=(-o+Math.sqrt(c))/2;return{_startAngle:Va({x:e,y:n},{x:l,y:t}).angle,_endAngle:Va({x:e,y:n},{x:d,y:t}).angle}}function fv(t,e){const{_centerX:n,_centerY:r,_radius:i,_startAngle:s,_endAngle:o,_counterclockwise:a,options:c}=e;t.save();const l=Se(t,c);t.fillStyle=c.backgroundColor,t.beginPath(),t.arc(n,r,i,s,o,a),t.closePath(),t.fill(),l&&t.stroke(),t.restore()}class Rr extends gn{inRange(e,n,r,i){return au({x:e,y:n},{rect:this.getProps(["x","y","x2","y2"],i),center:this.getCenterPoint(i)},r,{rotation:this.rotation,borderWidth:this.options.borderWidth,hitTolerance:this.options.hitTolerance})}getCenterPoint(e){return yn(this,e)}draw(e){const n=this.options,r=!_e(this._visible)||this._visible;!n.display||!n.content||!r||(e.save(),Ni(e,this.getCenterPoint(),this.rotation),z1(e,this),xu(e,this,n),yu(e,pv(this),n),e.restore())}resolveElementProperties(e,n){let r;if(pu(n))r=wu(e,n);else{const{centerX:a,centerY:c}=Io(e,n);r={x:a,y:c}}const i=Oi(n.padding),s=Li(e.ctx,n),o=du(r,s,n,i);return{initProperties:Vn(e,o,n),pointX:r.x,pointY:r.y,...o,rotation:n.rotation}}}Rr.id="labelAnnotation";Rr.defaults={adjustScaleRange:!0,backgroundColor:"transparent",backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:0,borderShadowColor:"transparent",borderWidth:0,callout:{borderCapStyle:"butt",borderColor:void 0,borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:1,display:!1,margin:5,position:"auto",side:5,start:"50%"},color:"black",content:null,display:!0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:void 0},height:void 0,hitTolerance:0,init:void 0,opacity:void 0,padding:6,position:"center",rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textAlign:"center",textStrokeColor:void 0,textStrokeWidth:0,width:void 0,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:void 0,xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:void 0,yValue:void 0,z:0};Rr.defaultRoutes={borderColor:"color"};function pv({x:t,y:e,width:n,height:r,options:i}){const s=i.borderWidth/2,o=Oi(i.padding);return{x:t+o.left+s,y:e+o.top+s,width:n-o.left-o.right-i.borderWidth,height:r-o.top-o.bottom-i.borderWidth}}const To=(t,e,n)=>({x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}),zs=(t,e,n)=>To(e,n,Math.abs((t-e.y)/(n.y-e.y))).x,Za=(t,e,n)=>To(e,n,Math.abs((t-e.x)/(n.x-e.x))).y,sr=t=>t*t,mv=(t,e,{x:n,y:r,x2:i,y2:s},o)=>o==="y"?{start:Math.min(r,s),end:Math.max(r,s),value:e}:{start:Math.min(n,i),end:Math.max(n,i),value:t},Qa=(t,e,n,r)=>(1-r)*(1-r)*t+2*(1-r)*r*e+r*r*n,Ds=(t,e,n,r)=>({x:Qa(t.x,e.x,n.x,r),y:Qa(t.y,e.y,n.y,r)}),Ja=(t,e,n,r)=>2*(1-r)*(e-t)+2*r*(n-e),tl=(t,e,n,r)=>-Math.atan2(Ja(t.x,e.x,n.x,r),Ja(t.y,e.y,n.y,r))+.5*gt;class $r extends gn{inRange(e,n,r,i){const s=(this.options.borderWidth+this.options.hitTolerance)/2;if(r!=="x"&&r!=="y"){const o={mouseX:e,mouseY:n},{path:a,ctx:c}=this;if(a){Se(c,this.options),c.lineWidth+=this.options.hitTolerance;const{chart:d}=this.$context,h=e*d.currentDevicePixelRatio,f=n*d.currentDevicePixelRatio,p=c.isPointInStroke(a,h,f)||Ns(this,o,i);return c.restore(),p}const l=sr(s);return vv(this,o,l,i)||Ns(this,o,i)}return gv(this,{mouseX:e,mouseY:n},r,{hitSize:s,useFinalPosition:i})}getCenterPoint(e){return yn(this,e)}draw(e){const{x:n,y:r,x2:i,y2:s,cp:o,options:a}=this;if(e.save(),!Se(e,a))return e.restore();Hn(e,a);const c=Math.sqrt(Math.pow(i-n,2)+Math.pow(s-r,2));if(a.curve&&o)return Iv(e,this,o,c),e.restore();const{startOpts:l,endOpts:d,startAdjust:h,endAdjust:f}=ku(this),p=Math.atan2(s-r,i-n);e.translate(n,r),e.rotate(p),e.beginPath(),e.moveTo(0+h,0),e.lineTo(c-f,0),e.shadowColor=a.borderShadowColor,e.stroke(),Ls(e,0,h,l),Ls(e,c,-f,d),e.restore()}get label(){return this.elements&&this.elements[0]}resolveElementProperties(e,n){const r=W1(e,n),{x:i,y:s,x2:o,y2:a}=r,c=xv(r,e.chartArea),l=c?yv({x:i,y:s},{x:o,y:a},e.chartArea):{x:i,y:s,x2:o,y2:a,width:Math.abs(o-i),height:Math.abs(a-s)};if(l.centerX=(o+i)/2,l.centerY=(a+s)/2,l.initProperties=Vn(e,l,n),n.curve){const h={x:l.x,y:l.y},f={x:l.x2,y:l.y2};l.cp=kv(l,n,_o(h,f))}const d=bv(e,l,n.label);return d._visible=c,l.elements=[{type:"label",optionScope:"label",properties:d,initProperties:l.initProperties}],l}}$r.id="lineAnnotation";const el={backgroundColor:void 0,backgroundShadowColor:void 0,borderColor:void 0,borderDash:void 0,borderDashOffset:void 0,borderShadowColor:void 0,borderWidth:void 0,display:void 0,fill:void 0,length:void 0,shadowBlur:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,width:void 0};$r.defaults={adjustScaleRange:!0,arrowHeads:{display:!1,end:Object.assign({},el),fill:!1,length:12,start:Object.assign({},el),width:6},borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:2,curve:!1,controlPoint:{y:"-50%"},display:!0,endValue:void 0,init:void 0,hitTolerance:0,label:{backgroundColor:"rgba(0,0,0,0.8)",backgroundShadowColor:"transparent",borderCapStyle:"butt",borderColor:"black",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderRadius:6,borderShadowColor:"transparent",borderWidth:0,callout:Object.assign({},Rr.defaults.callout),color:"#fff",content:null,display:!1,drawTime:void 0,font:{family:void 0,lineHeight:void 0,size:void 0,style:void 0,weight:"bold"},height:void 0,hitTolerance:void 0,opacity:void 0,padding:6,position:"center",rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,textAlign:"center",textStrokeColor:void 0,textStrokeWidth:0,width:void 0,xAdjust:0,yAdjust:0,z:void 0},scaleID:void 0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,value:void 0,xMax:void 0,xMin:void 0,xScaleID:void 0,yMax:void 0,yMin:void 0,yScaleID:void 0,z:0};$r.descriptors={arrowHeads:{start:{_fallback:!0},end:{_fallback:!0},_fallback:!0}};$r.defaultRoutes={borderColor:"color"};function gv(t,{mouseX:e,mouseY:n},r,{hitSize:i,useFinalPosition:s}){const o=mv(e,n,t.getProps(["x","y","x2","y2"],s),r);return su(o,i)||Ns(t,{mouseX:e,mouseY:n},s,r)}function xv({x:t,y:e,x2:n,y2:r},{top:i,right:s,bottom:o,left:a}){return!(t<a&&n<a||t>s&&n>s||e<i&&r<i||e>o&&r>o)}function nl({x:t,y:e},n,{top:r,right:i,bottom:s,left:o}){return t<o&&(e=Za(o,{x:t,y:e},n),t=o),t>i&&(e=Za(i,{x:t,y:e},n),t=i),e<r&&(t=zs(r,{x:t,y:e},n),e=r),e>s&&(t=zs(s,{x:t,y:e},n),e=s),{x:t,y:e}}function yv(t,e,n){const{x:r,y:i}=nl(t,e,n),{x:s,y:o}=nl(e,t,n);return{x:r,y:i,x2:s,y2:o,width:Math.abs(s-r),height:Math.abs(o-i)}}function vv(t,{mouseX:e,mouseY:n},r=on,i){const{x:s,y:o,x2:a,y2:c}=t.getProps(["x","y","x2","y2"],i),l=a-s,d=c-o,h=sr(l)+sr(d),f=h===0?-1:((e-s)*l+(n-o)*d)/h;let p,m;return f<0?(p=s,m=o):f>1?(p=a,m=c):(p=s+f*l,m=o+f*d),sr(e-p)+sr(n-m)<=r}function Ns(t,{mouseX:e,mouseY:n},r,i){const s=t.label;return s.options.display&&s.inRange(e,n,i,r)}function bv(t,e,n){const r=n.borderWidth,i=Oi(n.padding),s=Li(t.ctx,n),o=s.width+i.width+r,a=s.height+i.height+r;return jv(e,n,{width:o,height:a,padding:i},t.chartArea)}function wv(t){const{x:e,y:n,x2:r,y2:i}=t,s=Math.atan2(i-n,r-e);return s>gt/2?s-gt:s<gt/-2?s+gt:s}function jv(t,e,n,r){const{width:i,height:s,padding:o}=n,{xAdjust:a,yAdjust:c}=e,l={x:t.x,y:t.y},d={x:t.x2,y:t.y2},h=e.rotation==="auto"?wv(t):Me(e.rotation),f=_v(i,s,h),p=Sv(t,e,{labelSize:f,padding:o},r),m=t.cp?Ds(l,t.cp,d,p):To(l,d,p),x={size:f.w,min:r.left,max:r.right,padding:o.left},y={size:f.h,min:r.top,max:r.bottom,padding:o.top},g=il(m.x,x)+a,v=il(m.y,y)+c;return{x:g-i/2,y:v-s/2,x2:g+i/2,y2:v+s/2,centerX:g,centerY:v,pointX:m.x,pointY:m.y,width:i,height:s,rotation:Uy(h)}}function _v(t,e,n){const r=Math.cos(n),i=Math.sin(n);return{w:Math.abs(t*r)+Math.abs(e*i),h:Math.abs(t*i)+Math.abs(e*r)}}function Sv(t,e,n,r){let i;const s=Cv(t,r);return e.position==="start"?i=rl({w:t.x2-t.x,h:t.y2-t.y},n,e,s):e.position==="end"?i=1-rl({w:t.x-t.x2,h:t.y-t.y2},n,e,s):i=Co(1,e.position),i}function rl(t,e,n,r){const{labelSize:i,padding:s}=e,o=t.w*r.dx,a=t.h*r.dy,c=o>0&&(i.w/2+s.left-r.x)/o,l=a>0&&(i.h/2+s.top-r.y)/a;return zi(Math.max(c,l),0,.25)}function Cv(t,e){const{x:n,x2:r,y:i,y2:s}=t,o=Math.min(i,s)-e.top,a=Math.min(n,r)-e.left,c=e.bottom-Math.max(i,s),l=e.right-Math.max(n,r);return{x:Math.min(a,l),y:Math.min(o,c),dx:a<=l?1:-1,dy:o<=c?1:-1}}function il(t,e){const{size:n,min:r,max:i,padding:s}=e,o=n/2;return n>i-r?(i+r)/2:(r>=t-s-o&&(t=r+s+o),i<=t+s+o&&(t=i-s-o),t)}function ku(t){const e=t.options,n=e.arrowHeads&&e.arrowHeads.start,r=e.arrowHeads&&e.arrowHeads.end;return{startOpts:n,endOpts:r,startAdjust:sl(t,n),endAdjust:sl(t,r)}}function sl(t,e){if(!e||!e.display)return 0;const{length:n,width:r}=e,i=t.options.borderWidth/2,s={x:n,y:r+i};return Math.abs(zs(0,s,{x:0,y:i}))}function Ls(t,e,n,r){if(!r||!r.display)return;const{length:i,width:s,fill:o,backgroundColor:a,borderColor:c}=r,l=Math.abs(e-i)+n;t.beginPath(),Hn(t,r),Se(t,r),t.moveTo(l,-s),t.lineTo(e+n,0),t.lineTo(l,s),o===!0?(t.fillStyle=a||c,t.closePath(),t.fill(),t.shadowColor="transparent"):t.shadowColor=r.borderShadowColor,t.stroke()}function kv(t,e,n){const{x:r,y:i,x2:s,y2:o,centerX:a,centerY:c}=t,l=Math.atan2(o-i,s-r),d=ko(e.controlPoint,0),h={x:a+qe(n,d.x,!1),y:c+qe(n,d.y,!1)};return xn(h,{x:a,y:c},l)}function ol(t,{x:e,y:n},{angle:r,adjust:i},s){!s||!s.display||(t.save(),t.translate(e,n),t.rotate(r),Ls(t,0,-i,s),t.restore())}function Iv(t,e,n,r){const{x:i,y:s,x2:o,y2:a,options:c}=e,{startOpts:l,endOpts:d,startAdjust:h,endAdjust:f}=ku(e),p={x:i,y:s},m={x:o,y:a},x=tl(p,n,m,0),y=tl(p,n,m,1)-gt,g=Ds(p,n,m,h/r),v=Ds(p,n,m,1-f/r),w=new Path2D;t.beginPath(),w.moveTo(g.x,g.y),w.quadraticCurveTo(n.x,n.y,v.x,v.y),t.shadowColor=c.borderShadowColor,t.stroke(w),e.path=w,e.ctx=t,ol(t,g,{angle:x,adjust:h},l),ol(t,v,{angle:y,adjust:f},d)}class Or extends gn{inRange(e,n,r,i){const s=this.options.rotation,o=(this.options.borderWidth+this.options.hitTolerance)/2;if(r!=="x"&&r!=="y")return Pv({x:e,y:n},this.getProps(["width","height","centerX","centerY"],i),s,o);const{x:a,y:c,x2:l,y2:d}=this.getProps(["x","y","x2","y2"],i),h=r==="y"?{start:c,end:d}:{start:a,end:l},f=xn({x:e,y:n},this.getCenterPoint(i),Me(-s));return f[r]>=h.start-o-on&&f[r]<=h.end+o+on}getCenterPoint(e){return yn(this,e)}draw(e){const{width:n,height:r,centerX:i,centerY:s,options:o}=this;e.save(),Ni(e,this.getCenterPoint(),o.rotation),Hn(e,this.options),e.beginPath(),e.fillStyle=o.backgroundColor;const a=Se(e,o);e.ellipse(i,s,r/2,n/2,gt/2,0,2*gt),e.fill(),a&&(e.shadowColor=o.borderShadowColor,e.stroke()),e.restore()}get label(){return this.elements&&this.elements[0]}resolveElementProperties(e,n){return _u(e,n)}}Or.id="ellipseAnnotation";Or.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:1,display:!0,hitTolerance:0,init:void 0,label:Object.assign({},Wn.defaults.label),rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xMax:void 0,xMin:void 0,xScaleID:void 0,yMax:void 0,yMin:void 0,yScaleID:void 0,z:0};Or.defaultRoutes={borderColor:"color",backgroundColor:"color"};Or.descriptors={label:{_fallback:!0}};function Pv(t,e,n,r){const{width:i,height:s,centerX:o,centerY:a}=e,c=i/2,l=s/2;if(c<=0||l<=0)return!1;const d=Me(n||0),h=Math.cos(d),f=Math.sin(d),p=Math.pow(h*(t.x-o)+f*(t.y-a),2),m=Math.pow(f*(t.x-o)-h*(t.y-a),2);return p/Math.pow(c+r,2)+m/Math.pow(l+r,2)<=1.0001}class Bi extends gn{inRange(e,n,r,i){const{x:s,y:o,x2:a,y2:c,width:l}=this.getProps(["x","y","x2","y2","width"],i),d=(this.options.borderWidth+this.options.hitTolerance)/2;return r!=="x"&&r!=="y"?j1({x:e,y:n},this.getCenterPoint(i),l/2,d):su(r==="y"?{start:o,end:c,value:n}:{start:s,end:a,value:e},d)}getCenterPoint(e){return yn(this,e)}draw(e){const n=this.options,r=n.borderWidth;if(n.radius<.1)return;e.save(),e.fillStyle=n.backgroundColor,Hn(e,n);const i=Se(e,n);M1(e,this,this.centerX,this.centerY),i&&!Di(n.pointStyle)&&(e.shadowColor=n.borderShadowColor,e.stroke()),e.restore(),n.borderWidth=r}resolveElementProperties(e,n){const r=ju(e,n);return r.initProperties=Vn(e,r,n),r}}Bi.id="pointAnnotation";Bi.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderDash:[],borderDashOffset:0,borderShadowColor:"transparent",borderWidth:1,display:!0,hitTolerance:0,init:void 0,pointStyle:"circle",radius:10,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:void 0,xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:void 0,yValue:void 0,z:0};Bi.defaultRoutes={borderColor:"color",backgroundColor:"color"};class Vi extends gn{inRange(e,n,r,i){if(r!=="x"&&r!=="y")return this.options.radius>=.1&&this.elements.length>1&&Mv(this.elements,e,n,i);const s=xn({x:e,y:n},this.getCenterPoint(i),Me(-this.options.rotation)),o=this.elements.map(l=>r==="y"?l.bY:l.bX),a=Math.min(...o),c=Math.max(...o);return s[r]>=a&&s[r]<=c}getCenterPoint(e){return yn(this,e)}draw(e){const{elements:n,options:r}=this;e.save(),e.beginPath(),e.fillStyle=r.backgroundColor,Hn(e,r);const i=Se(e,r);let s=!0;for(const o of n)s?(e.moveTo(o.x,o.y),s=!1):e.lineTo(o.x,o.y);e.closePath(),e.fill(),i&&(e.shadowColor=r.borderShadowColor,e.stroke()),e.restore()}resolveElementProperties(e,n){const r=ju(e,n),{sides:i,rotation:s}=n,o=[],a=2*gt/i;let c=s*ru;for(let l=0;l<i;l++,c+=a){const d=Tv(r,n,c);d.initProperties=Vn(e,r,n),o.push(d)}return r.elements=o,r}}Vi.id="polygonAnnotation";Vi.defaults={adjustScaleRange:!0,backgroundShadowColor:"transparent",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderShadowColor:"transparent",borderWidth:1,display:!0,hitTolerance:0,init:void 0,point:{radius:0},radius:10,rotation:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,sides:3,xAdjust:0,xMax:void 0,xMin:void 0,xScaleID:void 0,xValue:void 0,yAdjust:0,yMax:void 0,yMin:void 0,yScaleID:void 0,yValue:void 0,z:0};Vi.defaultRoutes={borderColor:"color",backgroundColor:"color"};function Tv({centerX:t,centerY:e},{radius:n,borderWidth:r,hitTolerance:i},s){const o=(r+i)/2,a=Math.sin(s),c=Math.cos(s),l={x:t+a*n,y:e-c*n};return{type:"point",optionScope:"point",properties:{x:l.x,y:l.y,centerX:l.x,centerY:l.y,bX:t+a*(n+o),bY:e-c*(n+o)}}}function Mv(t,e,n,r){let i=!1,s=t[t.length-1].getProps(["bX","bY"],r);for(const o of t){const a=o.getProps(["bX","bY"],r);a.bY>n!=s.bY>n&&e<(s.bX-a.bX)*(n-a.bY)/(s.bY-a.bY)+a.bX&&(i=!i),s=a}return i}const Ye={box:Wn,doughnutLabel:Fi,ellipse:Or,label:Rr,line:$r,point:Bi,polygon:Vi};Object.keys(Ye).forEach(t=>{Vd.describe(`elements.${Ye[t].id}`,{_fallback:"plugins.annotation.common"})});const Av={update:Object.assign},Ev=Po.concat(vi),al=(t,e)=>Bt(e)?Bs(t,e):t,Fs=t=>t==="color"||t==="font";function Mo(t="line"){return Ye[t]?t:(console.warn(`Unknown annotation type: '${t}', defaulting to 'line'`),"line")}function Rv(t,e,n,r){const i=Ov(t,n.animations,r),s=e.annotations,o=Nv(e.elements,s);for(let a=0;a<s.length;a++){const c=s[a],l=Iu(o,a,c.type),d=c.setContext(Dv(t,l,o,c)),h=l.resolveElementProperties(t,d);h.skip=$v(h),"elements"in h&&(zv(l,h.elements,d,i),delete h.elements),_e(l.x)||Object.assign(l,h),Object.assign(l,h.initProperties),h.options=Pu(d),i.update(l,h)}}function $v(t){return isNaN(t.x)||isNaN(t.y)}function Ov(t,e,n){return n==="reset"||n==="none"||n==="resize"?Av:new Bd(t,e)}function zv(t,e,n,r){const i=t.elements||(t.elements=[]);i.length=e.length;for(let s=0;s<e.length;s++){const o=e[s],a=o.properties,c=Iu(i,s,o.type,o.initProperties),l=n[o.optionScope].override(o);a.options=Pu(l),r.update(c,a)}}function Iu(t,e,n,r){const i=Ye[Mo(n)];let s=t[e];return(!s||!(s instanceof i))&&(s=t[e]=new i,Object.assign(s,r)),s}function Pu(t){const e=Ye[Mo(t.type)],n={};n.id=t.id,n.type=t.type,n.drawTime=t.drawTime,Object.assign(n,Bs(t,e.defaults),Bs(t,e.defaultRoutes));for(const r of Ev)n[r]=t[r];return n}function Bs(t,e){const n={};for(const r of Object.keys(e)){const i=e[r],s=t[r];Fs(r)&&je(s)?n[r]=s.map(o=>al(o,i)):n[r]=al(s,i)}return n}function Dv(t,e,n,r){return e.$context||(e.$context=Object.assign(Object.create(t.getContext()),{element:e,get elements(){return n.filter(i=>i&&i.options)},id:r.id,type:"annotation"}))}function Nv(t,e){const n=e.length,r=t.length;if(r<n){const i=n-r;t.splice(r,0,...new Array(i))}else r>n&&t.splice(n,r-n);return t}var Lv="3.1.0";const $e=new Map,ll=t=>t.type!=="doughnutLabel",Fv=Po.concat(vi);var Bv={id:"annotation",version:Lv,beforeRegister(){_1("chart.js","4.0",ve.version)},afterRegister(){ve.register(Ye)},afterUnregister(){ve.unregister(Ye)},beforeInit(t){$e.set(t,{annotations:[],elements:[],visibleElements:[],listeners:{},listened:!1,moveListened:!1,hooks:{},hooked:!1,hovered:[]})},beforeUpdate(t,e,n){const r=$e.get(t),i=r.annotations=[];let s=n.annotations;Bt(s)?Object.keys(s).forEach(o=>{const a=s[o];Bt(a)&&(a.id=o,i.push(a))}):je(s)&&i.push(...s),rv(i.filter(ll),t.scales)},afterDataLimits(t,e){const n=$e.get(t);nv(t,e.scale,n.annotations.filter(ll).filter(r=>r.display&&r.adjustScaleRange))},afterUpdate(t,e,n){const r=$e.get(t);Z1(t,r,n),Rv(t,r,n,e.mode),r.visibleElements=r.elements.filter(i=>!i.skip&&i.options.display),ev(t,r,n)},beforeDatasetsDraw(t,e,n){Jn(t,"beforeDatasetsDraw",n.clip)},afterDatasetsDraw(t,e,n){Jn(t,"afterDatasetsDraw",n.clip)},beforeDatasetDraw(t,e,n){Jn(t,e.index,n.clip)},beforeDraw(t,e,n){Jn(t,"beforeDraw",n.clip)},afterDraw(t,e,n){Jn(t,"afterDraw",n.clip)},beforeEvent(t,e,n){const r=$e.get(t);Q1(r,e.event,n)&&(e.changed=!0)},afterDestroy(t){$e.delete(t)},getAnnotations(t){const e=$e.get(t);return e?e.elements:[]},_getAnnotationElementsAtEventForMode(t,e,n){return So(t,e,n)},defaults:{animations:{numbers:{properties:["x","y","x2","y2","width","height","centerX","centerY","pointX","pointY","radius"],type:"number"},colors:{properties:["backgroundColor","borderColor"],type:"color"}},clip:!0,interaction:{mode:void 0,axis:void 0,intersect:void 0},common:{drawTime:"afterDatasetsDraw",init:!1,label:{}}},descriptors:{_indexable:!1,_scriptable:t=>!Fv.includes(t)&&t!=="init",annotations:{_allKeys:!1,_fallback:(t,e)=>`elements.${Ye[Mo(e.type)].id}`},interaction:{_fallback:!0},common:{label:{_indexable:Fs,_fallback:!0},_indexable:Fs}},additionalOptionScopes:[""]};function Jn(t,e,n){const{ctx:r,chartArea:i}=t,s=$e.get(t);n&&a1(r,i);const o=Vv(s.visibleElements,e).sort((a,c)=>a.element.options.z-c.element.options.z);for(const a of o)Hv(r,i,s,a);n&&l1(r)}function Vv(t,e){const n=[];for(const r of t)if(r.options.drawTime===e&&n.push({element:r,main:!0}),r.elements&&r.elements.length)for(const i of r.elements)i.options.display&&i.options.drawTime===e&&n.push({element:i});return n}function Hv(t,e,n,r){const i=r.element;r.main?(qa(n,i,"beforeDraw"),i.draw(t,e),qa(n,i,"afterDraw")):i.draw(t,e)}const Wv=(t,e,n,r,i)=>{const s=Gt(e,[]),o=Gt(n,[]),a=Gt(i,!0),c=!Object.is(s,e)||!Object.is(o,n)||!Object.is(a,i),l=L(()=>s.map(h=>Bn(h,o,a)),[s,o,a]),d=L(()=>t.map(h=>Mi(l,{lower:r==="lower"?h:void 0,upper:r==="upper"?h:void 0})),[t,l,r]);return{isStale:c,value:d}};ve.register(Si,Hd,Ze,Wd,Bv);Ze.positioners.top=t=>{if(t.length===0)return!1;const e=t[0].element.x,n=t.reduce((r,{element:i})=>Math.min(r,i.y),1/0);return{x:e,y:n,yAlign:"bottom"}};const cl=jc(0,60,30),Xv=rt(({crosslinks:t,structures:e,kind:n,currentThresholds:r,aminoAcidsMustMatch:i})=>{const{value:s,isStale:o}=Wv(cl,t,e,n,i);let a;n==="lower"?(r==null?void 0:r.lower)!==void 0&&(a=r.lower):n==="upper"&&(r==null?void 0:r.upper)!==void 0&&(a=r.upper);const c={plugins:{legend:{display:!1},annotation:{annotations:a!==void 0?[{type:"line",xMin:a,xMax:a,borderColor:"gray",borderWidth:2,drawTime:"beforeDatasetsDraw"}]:[]},tooltip:{position:"top"}},responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{x:{type:"linear",title:{display:!0,text:"Distance [Å]"}},y:{type:"linear",title:{display:!0,text:"Count"}}},layout:{padding:{top:40}}},l=(()=>{const d=(h,f,p)=>({label:h,data:(s==null?void 0:s.map(m=>m[f]??0))??[],backgroundColor:p,borderColor:p});return{labels:cl,datasets:[d("Satisfied","ok","green"),d("Partially Satisfied","partially-ok","#14b8a6"),...n==="upper"?[d("Above Threshold","over","red")]:[],...n==="lower"?[d("Below Threshold","under","orange")]:[]]}})();return u.jsx(kr,{style:{opacity:o?.5:1,transition:o?"opacity 0.3s 0.5s linear":"opacity 0.2s 0s linear"},children:u.jsx("div",{style:{position:"relative",height:"300px",width:"100%"},children:u.jsx(jp,{options:c,data:l})})})}),Yv=rt(({experiment:t,groupDuplicates:e,visibleCrosslinkIds:n,structures:r,groupedStructureIds:i,thresholds:s,aminoAcidsMustMatch:o})=>{const a=L(()=>pr([t.crosslinks.filter(({id:b})=>n.has(b))],Object.fromEntries(t.proteins.map(b=>[b.id,b]))),[t.crosslinks,n,t.proteins]),c=L(()=>{const b=[];for(const{rows:C,...A}of a){const _=new Set(C.flatMap(({ids:S})=>S.flatMap(T=>e?T[0]:T.flat())));b.push({groupHeader:A,crosslinks:t.crosslinks.filter(({id:S})=>_.has(S))})}return b},[a,e,t.crosslinks]),l=L(()=>{const b=new Set(zl(a,e));return t.crosslinks.filter(({id:C})=>b.has(C))},[a,e,t.crosslinks]),d=L(()=>{const b=i.map(C=>C.map(A=>r.find(_=>_.id===A)).filter(A=>A!==void 0&&A.loading===!1)).filter(C=>C.length>0);return b.length===1?b[0].map(C=>[C]):b},[i,r]),h=L(()=>l.flatMap(b=>Bn(b,r,o).map(C=>Dl(C,s??{})).filter(C=>C!==void 0)),[l,r,o,s]),f={xlmap:"2D Map",overview:"Crosslinks Distribution",byProtein:"Crosslinks Distribution by Protein",byStructure:"Crosslinks Distribution by Structure",upperThresholdExplorer:"Crosslinks Distribution for Different Upper Distance Thresholds",lowerThresholdExplorer:"Crosslinks Distribution for Different Lower Distance Thresholds",histogram:"Distances Distribution",thresholds:"Distances Distribution"},[p,m]=Ud("xlmap"),x=d.flat().length,y=l.length>0&&x>0,g=y&&h.length>0,v=g&&((s==null?void 0:s.lower)!==void 0||(s==null?void 0:s.upper)!==void 0),w=!y||!g&&["histogram","thresholds","upperThresholdExplorer","lowerThresholdExplorer"].includes(p)||!v&&p==="thresholds"?"xlmap":p;return w!==p&&m(w),u.jsxs(u.Fragment,{children:[u.jsxs(jr,{gap:0,children:[u.jsxs(U.Root,{positioning:{placement:"bottom",gutter:2},size:"sm",children:[u.jsx(U.Trigger,{asChild:!0,children:u.jsxs(_i,{ml:"1rem",children:[u.jsx(ds,{children:f[w]}),u.jsx(Cr,{size:"xs",children:u.jsx(Ju,{})})]})}),u.jsx(U.Positioner,{children:u.jsx(U.Content,{children:u.jsxs(U.RadioItemGroup,{value:w,onValueChange:({value:b})=>Ys(()=>{m(b)}),children:[u.jsxs(U.RadioItem,{value:"xlmap",children:["2D Map",u.jsx(U.ItemIndicator,{})]}),u.jsx(U.Separator,{}),u.jsx(U.ItemGroupLabel,{children:"Crosslinks Distribution"}),u.jsxs(U.RadioItem,{value:"overview",disabled:!y,children:["Overview",u.jsx(U.ItemIndicator,{})]}),u.jsxs(U.RadioItem,{value:"byProtein",disabled:!y,children:["By Protein",u.jsx(U.ItemIndicator,{})]}),u.jsxs(U.RadioItem,{value:"byStructure",disabled:!y,children:["By Structure",u.jsx(U.ItemIndicator,{})]}),u.jsx(U.Separator,{}),u.jsxs(U.ItemGroupLabel,{children:["Distance Threshold Explorer",u.jsx("br",{}),u.jsx(Ft,{fontSize:"xs",fontWeight:"light",color:"fg.muted",children:"Explore crosslink distribution for"})]}),u.jsxs(U.RadioItem,{value:"upperThresholdExplorer",disabled:!g,children:["Different Upper Thresholds",u.jsx(U.ItemIndicator,{})]}),u.jsxs(U.RadioItem,{value:"lowerThresholdExplorer",disabled:!g,children:["Different Lower Thresholds",u.jsx(U.ItemIndicator,{})]}),u.jsx(U.Separator,{}),u.jsx(U.ItemGroupLabel,{children:"Distances Distribution"}),u.jsxs(U.RadioItem,{value:"histogram",disabled:!g,children:["Histogram",u.jsx(U.ItemIndicator,{})]}),u.jsxs(U.RadioItem,{value:"thresholds",disabled:!v,children:["Thresholds",u.jsx(U.ItemIndicator,{})]})]})})})]}),u.jsxs(ds,{size:"sm",color:"gray",children:[w==="histogram"||w==="thresholds"?yt(h.length,"distance"):yt(l.length,"crosslink"),w!=="xlmap"&&` in ${yt(x,"structure")}`]})]}),w==="xlmap"&&u.jsx(by,{experiment:t,visibleCrosslinkIds:n}),w!=="xlmap"&&u.jsxs(Fn,{maxW:"3xl",mt:"-40px",children:[w==="overview"&&u.jsx(Cp,{crosslinks:l,structures:r,thresholds:s,aminoAcidsMustMatch:o}),w==="byProtein"&&u.jsx(_p,{groupedCrosslinks:c,structures:r,thresholds:s,aminoAcidsMustMatch:o}),w==="byStructure"&&u.jsx(Sp,{crosslinks:l,groupedStructures:d,thresholds:s,aminoAcidsMustMatch:o}),(w==="upperThresholdExplorer"||w==="lowerThresholdExplorer")&&u.jsx(Xv,{crosslinks:l,structures:r,currentThresholds:s,aminoAcidsMustMatch:o,kind:w==="lowerThresholdExplorer"?"lower":"upper"}),(w==="histogram"||w==="thresholds")&&u.jsx(wy,{distances:h,view:w,thresholds:s})]})]})}),Uv=t=>Object.entries(t).forEach(([e,n])=>n&&ai(e,!1,new Set(n))),qv=rt(({experiment:t,ref:e,...n})=>{const{experimentIdToThresholds:r,aminoAcidsMustMatch:i}=mt(O),s=r[t.id],[o,a]=Tf(t),c=hf(t),l=L(()=>new Set(c.crosslinks.filter(({from:v,to:w})=>v.linkPosition===void 0||w.linkPosition===void 0).map(({id:v})=>v)),[c.crosslinks]),d=L(()=>o.some(({loading:v})=>v),[o]),h=L(()=>si(o,c.crosslinks,i,s),[o,c.crosslinks,i,s]),f=L(()=>new Set(t.crosslinks.map(({id:v})=>v)),[t.crosslinks]),{experimentIdToVisibleCrosslinkIds:p,groupDuplicatedCrosslinks:m}=mt(O),x=p[t.id],y=L(()=>[{experiment:c,structureToXlinkIdToStatus:h,visibleCrosslinkIds:x,groupedStructureIds:a}],[c,h,x,a]),g=tt(()=>wf(t.id),[t.id]);return u.jsx(u.Fragment,{children:u.jsxs(dn,{ref:e,...n,children:[u.jsx(Fn,{maxW:"5xl",children:u.jsxs(dn,{gap:5,children:[u.jsx(_f,{experiment:t,resolvedExperiment:c}),u.jsx(Yv,{experiment:c,groupDuplicates:m,visibleCrosslinkIds:x,structures:o,groupedStructureIds:a,thresholds:s,aminoAcidsMustMatch:i}),u.jsx(Sf,{w:"fit-content",experimentId:t.id,structureToXlinkIdToStatus:d?"loading":h,allCrosslinkIds:f,visibleCrosslinkIds:x,unmappedCrosslinkIds:l,numOfDistanceConstraints:(s!=null&&s.lower?1:0)+(s!=null&&s.upper?1:0)}),o.length>0&&u.jsx(Dh,{experimentId:t.id,thresholds:s})]})}),u.jsx(pc,{experiments:y,structures:o,groupDuplicates:m,resetFilters:g,hideCrosslinks:Uv})]})})}),Ao=rt(({children:t,hideButtonUnlessHover:e=!1,hideButtonUnlessSelected:n=!1,buttonProps:r,ref:i,...s})=>{const o=L(()=>!e&&!n?null:{opacity:0,...e?{_hover:{opacity:1},_peerHover:{opacity:1}}:{},...n?{css:{".peer:is([aria-selected=true], [data-selected]) ~ &":{opacity:1}}}:{}},[e,n]);return u.jsxs(lt,{children:[u.jsx(Ee.Trigger,{pr:`${.75+2}rem`,className:"peer",flexGrow:1,justifyContent:"center",ref:i,...s,children:t}),u.jsx(mn,{size:"2xs",alignSelf:"center",variant:"ghost",colorPalette:"bg",ml:"-2rem",mr:"0.5rem",...o,...r})]})}),Gv=rt(({experimentId:t,experimentName:e,ref:n,...r})=>{const i=wi({defaultValue:e,placeholder:{preview:"File",edit:""},onValueCommit:({value:s})=>{if(!(s.trim()===""?void 0:s.trim())){e&&i.setValue(e);return}const a=O.experiments.find(({id:c})=>c===t);a&&(a.name=s)},activationMode:"dblclick",autoResize:!0});return u.jsxs(Fe,{size:"sm",onSelect:({value:s})=>s==="close"?zo(t):s==="rename"?i.edit():null,children:[u.jsx(qf,{as:"div",children:u.jsxs(Ao,{value:t,hideButtonUnlessHover:!0,hideButtonUnlessSelected:!0,buttonProps:{children:u.jsx(fl,{}),onClick:()=>zo(t)},ref:n,...r,children:[u.jsx(Cr,{children:u.jsx(Ti,{})}),u.jsx(ne.RootProvider,{value:i,size:"sm",children:u.jsxs(ne.Area,{children:[u.jsx(ne.Preview,{cursor:"unset",_hover:{bg:"unset"}}),u.jsx(ne.Input,{focusRing:"none",onClick:s=>s.stopPropagation(),onKeyDown:s=>s.stopPropagation(),onKeyUp:s=>s.preventDefault()})]})})]})}),u.jsxs(Le,{children:[u.jsx(Jt,{value:"rename",children:"Rename"}),u.jsx(Jt,{value:"close",children:"Close"})]})]},t)});function Kv(t,e,n){var r=this,i=at(null),s=at(0),o=at(null),a=at([]),c=at(),l=at(),d=at(t),h=at(!0);d.current=t;var f=typeof window<"u",p=!e&&e!==0&&f;if(typeof t!="function")throw new TypeError("Expected a function");e=+e||0;var m=!!(n=n||{}).leading,x=!("trailing"in n)||!!n.trailing,y="maxWait"in n,g="debounceOnServer"in n&&!!n.debounceOnServer,v=y?Math.max(+n.maxWait||0,e):null;St(function(){return h.current=!0,function(){h.current=!1}},[]);var w=L(function(){var b=function(P){var M=a.current,$=c.current;return a.current=c.current=null,s.current=P,l.current=d.current.apply($,M)},C=function(P,M){p&&cancelAnimationFrame(o.current),o.current=p?requestAnimationFrame(P):setTimeout(P,M)},A=function(P){if(!h.current)return!1;var M=P-i.current;return!i.current||M>=e||M<0||y&&P-s.current>=v},_=function(P){return o.current=null,x&&a.current?b(P):(a.current=c.current=null,l.current)},S=function P(){var M=Date.now();if(A(M))return _(M);if(h.current){var $=e-(M-i.current),R=y?Math.min($,v-(M-s.current)):$;C(P,R)}},T=function(){if(f||g){var P=Date.now(),M=A(P);if(a.current=[].slice.call(arguments),c.current=r,i.current=P,M){if(!o.current&&h.current)return s.current=i.current,C(S,e),m?b(i.current):l.current;if(y)return C(S,e),b(i.current)}return o.current||C(S,e),l.current}};return T.cancel=function(){o.current&&(p?cancelAnimationFrame(o.current):clearTimeout(o.current)),s.current=0,a.current=i.current=c.current=o.current=null},T.isPending=function(){return!!o.current},T.flush=function(){return o.current?_(Date.now()):l.current},T},[m,y,e,v,x,p,f,g]);return w}function Zv(t,e){return t===e}function Tu(t,e,n){var r=Zv,i=at(t),s=ct({})[1],o=Kv(tt(function(c){i.current=c,s({})},[s]),e,n),a=at(t);return r(a.current,t)||(o(t),a.current=t),[i.current,o]}const Qv=t=>{const e=t.split("-",2);return{pdbId:e[0],assemblyId:e.length>0?e[1]:void 0}},Jv=t=>/^[A-Za-z0-9_]{4,15}$/.test(t),tb=t=>/^\d+|deposited$/.test(t),eb=to(async({query:t},e)=>Promise.all(t.split(",").map(async n=>{var a,c,l;const{pdbId:r,assemblyId:i}=Qv(n.trim());if(!Jv(r))throw new Error(`PDB ID ${r} is invalid`);if(i!==void 0&&!tb(i))throw new Error(`PDB ID ${r}-${i} is invalid`);const{data:s}=await Gs.post("https://data.rcsb.org/graphql",{query:"query ($pdbId: String!) { entry(entry_id: $pdbId) { struct { title } assemblies { rcsb_assembly_info { assembly_id } } rcsb_comp_model_provenance { source_db source_url } } }",variables:{pdbId:r}},{signal:e});if(!((a=s.data)!=null&&a.entry)||s.data.entry.assemblies.length===0)throw new Error(`PDB ID ${r} doesn't exist`);const o=s.data.entry.assemblies.map(({rcsb_assembly_info:d})=>d.assembly_id);if(i&&!o.includes(i))throw new Error(`Assembly ${i} doesn't exist in ${r}`);return{title:s.data.entry.struct.title,sourceDb:(c=s.data.entry.rcsb_comp_model_provenance)==null?void 0:c.source_db,sourceUrl:(l=s.data.entry.rcsb_comp_model_provenance)==null?void 0:l.source_url,pdbId:r,assemblyId:i}}))),Mu=t=>e=>{const[n,r]=ct({});return St(()=>{if(e===n.query)return;if(e===void 0){r({});return}const i=new AbortController;return r({query:e}),t(e,i.signal).then(s=>{r({query:e,data:s})}).catch(s=>{s.name!=="CanceledError"&&r({query:e,error:s})}),()=>{i.abort()}},e&&Object.values(e)),n},nb=Mu(Ll),rb=Mu(eb),ib=_t(({autoFocus:t,onAddedStructures:e,inputRef:n,...r},i)=>{const[s,o]=ct(""),[a,{isPending:c}]=Tu(s,300),{query:l,data:d,error:h}=rb({query:a}),[f,p]=ct(!1),m=!!s&&!c()&&(l==null?void 0:l.query)===s,x=m&&an(d),y=m&&!!h,g=f||!!s&&!x&&!y;return u.jsx(cr,{ref:i,...r,invalid:y,errorText:y&&h.message,colorPalette:x?"green":void 0,helperText:x&&(d.length===1?u.jsxs(u.Fragment,{children:[d[0].sourceDb&&u.jsxs(u.Fragment,{children:[u.jsxs("b",{children:[d[0].sourceDb,":"]})," "]}),d[0].title]}):yt(d.length,"structure")),disabled:f,children:u.jsx(Ws,{flex:"1",w:"full",startElement:u.jsx(vl,{}),endElement:g?u.jsx(Ue,{}):x?u.jsx(yl,{}):void 0,children:u.jsx(ln,{placeholder:"PDB ID",ref:n,value:s,onChange:v=>o(v.target.value),autoFocus:t,spellCheck:"false",autoCorrect:"false",onKeyDown:v=>{v.key==="Enter"&&x&&(e(d.filter(w=>!!w).map(w=>({name:w.pdbId+(w.assemblyId?`-${w.assemblyId}`:""),type:"url",...w.sourceUrl?{url:w.sourceUrl}:{url:`https://models.rcsb.org/${w.pdbId}.bcif.gz`,format:{isCompressed:!0,type:"mmCIF",isBinary:!0}},...w.assemblyId?{assemblyIds:[w.assemblyId]}:{}}))),p(!0))}})})})}),sb=_t(({autoFocus:t,...e},n)=>{const[r,i]=ct(""),[s,{isPending:o}]=Tu(r,300),{query:a,data:c,error:l}=nb({accession:s}),d=!!r&&!o()&&(a==null?void 0:a.accession)===r,h=d&&!!c,f=d&&!!l,p=!!r&&!h&&!f;return u.jsx(cr,{ref:n,...e,invalid:f,errorText:f&&l.message,colorPalette:h?"green":void 0,children:u.jsx(Ws,{flex:"1",w:"full",startElement:u.jsx(vl,{}),endElement:p?u.jsx(Ue,{}):h?u.jsx(yl,{}):void 0,children:u.jsx(ln,{placeholder:"UniProt accession",value:r,maxLength:Wh,onChange:m=>i(m.target.value.toUpperCase()),autoFocus:t,spellCheck:"false",autoCorrect:"false"})})})}),ob=[["mmCIF",{stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"]}],["PDB",{stringExtensions:["pdb","ent"]}]];function ab(t){const e=t.endsWith(".gz");e&&(t=t.replace(/\.gz$/,""));for(const[n,{stringExtensions:r,binaryExtensions:i}]of ob){if(i!=null&&i.some(s=>t.endsWith(s)))return{isCompressed:e,type:n,isBinary:!0};if(r!=null&&r.some(s=>t.endsWith(s)))return{isCompressed:e,type:n,isBinary:!1}}}const lb=({onAddedStructures:t})=>{const[e,n]=fd(),r=Od({maxFiles:1/0,disabled:e,validate:i=>ab(i.name)!==void 0?null:["FILE_INVALID_TYPE"],onFileChange:({acceptedFiles:i,rejectedFiles:s})=>{if(s.length>0){He.error({title:`Failed to process ${Ht(s.map(({file:o})=>o.name))}`}),r.clearFiles();return}i.length>0&&n(()=>t(i.map(o=>({name:o.name.split(".",1)[0],type:"file",file:o}))))}});return u.jsx(td,{value:r,gap:"1",children:u.jsx(Ws,{w:"full",startElement:u.jsx(nd,{}),endElement:e&&u.jsx(Ue,{}),children:u.jsx(ed,{placeholder:"Upload structure(s) (mmCIF or PDB)"})})})},cb=({value:t,...e})=>u.jsx(Ge,{value:t,placement:"top",lazyMount:!0,unmountOnExit:!0,...e,children:u.jsxs(be,{children:[u.jsxs(Ie,{flexDir:"column",children:[u.jsx(Te,{children:"Add structures to the project"}),u.jsx(Pr,{children:"using one of the following options:"}),u.jsx(Ce,{})]}),u.jsx(Pe,{children:u.jsxs(dn,{gap:"4",children:[u.jsx(ib,{autoFocus:!0,onAddedStructures:n=>{t.setOpen(!1),na(n)}}),u.jsx(sb,{disabled:!0,onKeyDown:n=>n.key==="Enter"&&console.log("enter uniprot")}),u.jsx(lb,{onAddedStructures:n=>{t.setOpen(!1),na(n)}})]})}),u.jsx(ke,{})]})}),ub=({ref:t,...e})=>{const n=ye({restoreFocus:!1});return u.jsxs(u.Fragment,{children:[u.jsx(cb,{value:n}),u.jsx(Ao,{buttonProps:{children:u.jsx(Rn,{}),onClick:()=>n.setOpen(!0)},ref:t,...e,children:"Structures"})]})},db=({ref:t,...e})=>{const n=eo(),{experiments:r,proteinIdToReferenceProtein:i}=mt(O),s=Object.groupBy(r.flatMap(o=>o.proteins.flatMap(a=>({experiment:o,protein:a}))),({protein:o})=>{var a;return((a=i.get(o.id))==null?void 0:a.id)??o.id});return u.jsxs(Fn,{maxW:"5xl",pt:6,ref:t,...e,children:[n.length===0&&u.jsx(kr,{children:"No reference proteins"}),u.jsx(Qt.Root,{gap:5,children:n.map(o=>{const a=s[o.id],c=a?Object.groupBy(a,({protein:d})=>d.name):{},l=Object.keys(c).toSorted((d,h)=>{var f,p;return(((f=c[h])==null?void 0:f.length)??0)-(((p=c[d])==null?void 0:p.length)??0)}).map(d=>{var h;return[d,((h=c[d])==null?void 0:h.flatMap(({experiment:{name:f}})=>f?[f]:[]))??[]]});return u.jsxs(Qt.Item,{children:[u.jsx(Ir,{fontSize:"lg",fontWeight:"semibold",wordBreak:"break-word",name:o.name,onRename:d=>oi(o.id,{name:d}),autoResize:!0,w:"fit-content"})," ","is"," ",l.length===0?"not referenced by any protein.":l.length===1?`referenced by ${l[0][0]} in ${Ht(l[0][1])}.`:"referenced by the proteins:",u.jsxs(Qt.Root,{ps:5,children:[l.length>1?l.map(([d,h])=>u.jsxs(Fo,{children:[d," in ",Ht(h)]},d)):null,u.jsx(Fo,{children:u.jsxs(ot,{size:"2xs",colorPalette:"red",onClick:()=>af(o.id),children:[u.jsx(bl,{}),"Delete protein"]})})]})]},o.id)})})]})},hb=({ref:t,...e})=>{const n=at(null);return u.jsxs(u.Fragment,{children:[u.jsx(Xl,{dialogRef:n}),u.jsx(Ao,{buttonProps:{children:u.jsx(Rn,{}),onClick:()=>{var r;return(r=n.current)==null?void 0:r.setOpen(!0)}},ref:t,...e,children:"Proteins"})]})},fb=rt(({fileId:t,fileName:e,visible:n,structureId:r,toggle:i,ref:s,...o})=>u.jsxs(ot,{size:"2xs",variant:n?"solid":"outline",className:"group",onClick:()=>i(n,t,r),ref:s,...o,children:[u.jsx(Ti,{}),e,u.jsx(Cr,{visibility:"hidden",_groupHover:{visibility:"visible"},children:n?u.jsx(rd,{}):u.jsx(Rn,{})})]})),pb=({ref:t,...e})=>{const{experiments:n,structures:r,experimentIdToGroupedStructureIds:i}=mt(O),s=L(()=>Object.fromEntries(r.map(({id:o})=>[o,n.map(a=>{var c;return{fileId:a.id,fileName:a.name,structureId:o,visible:((c=i[a.id])==null?void 0:c.some(l=>l.includes(o)))??!1}})])),[r,n,i]);return u.jsxs(Fn,{maxW:"5xl",pt:6,ref:t,...e,children:[r.length===0&&u.jsx(kr,{children:"No structures"}),u.jsx(Qt.Root,{gap:5,children:r.map(o=>u.jsxs(Qt.Item,{children:[u.jsx(Ir,{fontSize:"lg",fontWeight:"semibold",wordBreak:"break-word",name:o.name,onRename:a=>ql(o.id,{name:a}),autoResize:!0,disabled:o.loading}),o.loading?u.jsx(Ue,{ml:2,size:"sm"}):u.jsxs(Qt.Root,{ms:6,children:[u.jsxs(Qt.Item,{children:["Appears in"," ",s[o.id].filter(({visible:a})=>a).length,"/",yt(n.length,"file"),":",s[o.id].map(({fileId:a,fileName:c,visible:l})=>u.jsx(fb,{ml:2,fileId:a,fileName:c,structureId:o.id,visible:l,toggle:(d,h,f)=>{d?no(h,[f]):vf(h,[f])}},a))]}),u.jsx(Qt.Item,{children:u.jsxs(ot,{size:"2xs",colorPalette:"red",onClick:()=>vs([o.id]),children:[u.jsx(bl,{}),"Delete structure"]})})]})]},o.id))})]})},mb=({protein:t,stats:e,domainNameToStats:n,toggleVisibility:r,hideMultiProteinToggles:i,ref:s,...o})=>{const a=e.interprotein.visible+e.intraprotein.visible>0;return u.jsxs(De.Root,{borderColor:a?"colorPalette.solid":void 0,ref:s,...o,children:[u.jsxs(De.Header,{children:[u.jsxs(lt,{flexDir:"row",alignItems:"center",children:[u.jsx(Ir,{name:t.name,onRename:c=>oi(t.id,{name:c}),size:"lg",fontWeight:"semibold"}),u.jsx(re,{stat:e.interprotein,stat2:e.intraprotein,toggleVisibility:r,dir:"rtl"})]}),u.jsx(Yl,{protein:{isReferenceProtein:!0,...t},domainNameToStats:n,toggleVisibility:r,experimentId:null,w:"fit-content",mt:-2})]}),u.jsx(De.Body,{p:i&&e.homomultimeric.total===0?0:void 0,children:u.jsxs(Sr,{children:[!i&&u.jsxs(u.Fragment,{children:[u.jsx(re,{name:"Inter-protein",info:"Crosslinks that occur between two different proteins",stat:e.interprotein,toggleVisibility:r}),u.jsx(re,{name:"Intra-protein",info:"Crosslinks that occur within the same protein",stat:e.intraprotein,toggleVisibility:r})]}),e.homomultimeric.total>0&&u.jsx(re,{ms:i?void 0:6,name:"Homo-multimeric",stat:e.homomultimeric,toggleVisibility:r})]})}),u.jsx(De.Footer,{})]})},gb=rt(mb),xb=rt(({name:t="File",ref:e,...n})=>u.jsxs(lt,{flexDir:"column",h:"100%",justifyContent:"space-between",alignItems:"center",gap:1,ref:e,...n,children:[u.jsx(Cr,{children:u.jsx(Ti,{})}),u.jsx(Ft,{display:"inline-flex",fontSize:"xs",writingMode:"vertical-lr",minH:"fit",flexGrow:1,justifyContent:"end",me:2,children:us(t,13)})]})),yb=rt(({experiments:t,referenceProteinsById:e,groupedCrosslinkIds:n,groupDuplicates:r,hideCrosslinks:i})=>{var F,H,K;const s=Gt(t),o=Gt(e),a=Gt(n),c=Gt(r),l=s!==t||o!==e||a!==n||c!==r,d=at(null),h=L(()=>{const D=[void 0];return a.forEach(({rows:B},Y)=>{Y!==0&&D.push(void 0);const q=c?B.length:B.reduce((G,{ids:Z})=>G+Math.max(...Z.map(it=>it.length)),0);D.push(Y),D.push(...Array(q-1).fill(void 0))}),D},[c,a]),f=L(()=>{const D=[void 0];return a.forEach(({rows:B},Y)=>{Y!==0&&D.push(void 0);for(const q of B)c?D.push(q):D.push(...In(...q.ids).map(G=>({...q,ids:G.map(Z=>Z!==void 0?[Z]:[])})).flat())}),D},[c,a]),p=D=>{if(D===0)return"header";const B=f[D];return B===void 0?`gap-after-${p(D-1)}`:B.ids.map(Y=>Y.length>0?Y.join("-"):"X").join(":")},m=ec({enabled:a.length>0,count:f.length,estimateSize:D=>D===0?30:f[D]===void 0?5:26,scrollMargin:((F=d.current)==null?void 0:F.offsetTop)??0,getItemKey:p,overscan:20,rangeExtractor:D=>new Set([0,...ro(D),...f.flatMap((B,Y)=>B===void 0&&Y+1<f.length?[Y+1]:[])]).values().toArray()}),x=s.length,y=L(()=>[void 0,...Array(x).keys()],[x]),g=tc({enabled:a.length>0,horizontal:!0,count:y.length,getScrollElement:()=>d.current,estimateSize:D=>D===0?237:26,overscan:20,getItemKey:D=>D===0?"header":s[y[D]].id}),v=g.getVirtualItems(),[w,b]=v.length>0?[v[0].start,g.getTotalSize()-v[v.length-1].end]:[0,0];let C=((H=g.measurementsCache[0])==null?void 0:H.size)??0;const A=D=>{!g.options.enabled||!D||D.dataset.index!=="0"||C<D.getBoundingClientRect().width&&(C=D.getBoundingClientRect().width,g.resizeItem(0,Math.ceil(D.getBoundingClientRect().width)))};St(()=>{g.measure()},[a,o,g]);let _=((K=m.measurementsCache[0])==null?void 0:K.size)??0;const S=D=>{!m.options.enabled||!D||D.dataset.index!=="0"||_<D.getBoundingClientRect().height&&(_=D.getBoundingClientRect().height,m.resizeItem(0,Math.ceil(D.getBoundingClientRect().height)))};St(()=>{m.measure()},[s,m]);const T=L(()=>u.jsxs(u.Fragment,{children:[u.jsx(ei,{styles:{".xlink":{cursor:"pointer",color:"transparent",fontSize:"0.8rem",alignContent:"center",textAlign:"center",":hover":{boxShadow:"inset 0px 0px 0px 1px var(--chakra-colors-fg-inverted)",color:"var(--chakra-colors-fg-inverted)"}}}}),u.jsx(ei,{styles:Object.fromEntries(a.flatMap(({fromProteinId:D,fromDomainName:B,toProteinId:Y,toDomainName:q})=>[D,...B?[D+B]:[],Y,...q?[Y+q]:[]].map(G=>[`html:has(.xlp${dr(G)}:hover) .xlp${dr(G)}`,{boxShadow:"inset 0px 0px 0px 1px var(--chakra-colors-fg-info)"}])))})]}),[a]),P=ye({}),{selectedCrosslinkIds:M,rowIndexToCheckedState:$,rowIndexToGroupCheckedState:R,numOfSelectedCrosslinks:j,numOfSelectedRows:I,onRowToggle:k,onGroupToggle:E,clearSelectedRows:N}=dc(L(()=>s.map(({id:D})=>D),[s]),a,f,h),V=tt(D=>Ii(ki(s,a.map(({rows:B,...Y})=>({rows:B.map(({ids:q,...G})=>({ids:q.map((Z,it)=>Z.filter(nt=>{var Ot;return((Ot=D[s[it].id])==null?void 0:Ot.includes(nt))===!0})),...G})),...Y}))),`${s.length===1?s[0].name??"XLinkUp":"Experiments"}-xlinks`),[s,a]);return u.jsxs(u.Fragment,{children:[T,u.jsx(uc,{dialog:P,dialogProps:{exportBasename:s.length===1?s[0].name??"XLinkUp":"Experiments",gridProps:{experiments:s.map(D=>({experiment:D,structureToXlinkIdToStatus:{[D.id]:Object.fromEntries(D.crosslinks.map(({id:B})=>[B,"ok"]))},groupedStructureIds:[[D.id]]})),groupedCrosslinkIds:a,proteinsById:o,structureNameById:Object.fromEntries(s.map(({id:D,name:B})=>[D,B??"Experiment"]))}}}),u.jsx("div",{ref:d,style:{overflowY:"auto",opacity:l?.5:1,transition:l?"opacity 0.2s 0.2s linear":"opacity 0s 0s linear",userSelect:"none",WebkitUserSelect:"none",display:"flex",justifyContent:"center",marginLeft:"1rem",marginRight:"1rem"},children:u.jsx("div",{style:{height:m.getTotalSize(),position:"relative",width:g.getTotalSize()},children:m.getVirtualItems().map(D=>{const B=D.index===0,Y=f[D.index];if(!B&&Y===void 0)return null;const q=!B&&h[D.index]!==void 0?a[h[D.index]]:void 0;return u.jsxs("div",{"data-index":D.index,ref:D.index===0?S:void 0,style:{position:"absolute",top:0,left:0,transform:`translateY(${D.start-m.options.scrollMargin}px)`,display:"flex"},children:[u.jsx("div",{style:{width:`${w}px`}}),v.map(G=>{const Z=G.index===0,it=y[G.index],nt=it!==void 0?{file:s[it],crosslinkIds:Y==null?void 0:Y.ids[it]}:void 0;return u.jsxs("div",{"data-index":G.index,ref:G.index===0?A:void 0,className:an(nt==null?void 0:nt.crosslinkIds)?"xlink":void 0,onClick:()=>{if(nt!=null&&nt.crosslinkIds&&nt.crosslinkIds.length>0)throw new Error("TODO")},style:{minHeight:D.size,maxHeight:150,minWidth:G.size,maxWidth:500,flexShrink:0,...nt!=null&&nt.crosslinkIds?nt.crosslinkIds.length>0?{backgroundColor:ae("ok")}:{backgroundColor:"transparent"}:{}},children:[B&&Z&&u.jsx(oc,{viewName:s.length===1?s[0].name??"XLinkUp":"Experiments",experiments:s,groupedCrosslinkIds:a,exportFigureDialog:P,showingStructures:!1,disableMenus:!1}),B&&!Z&&nt!==void 0&&u.jsx(xb,{name:nt.file.name}),Z&&!B&&Y!==void 0&&u.jsx(Kl,{rowHeader:Y,groupHeader:q,checked:$[D.index],groupedChecked:R[D.index],toggle:k,toggleGroup:E}),(nt==null?void 0:nt.crosslinkIds)&&(nt.crosslinkIds.length??0)>1&&`x${nt.crosslinkIds.length}`]},G.key)}),u.jsx("div",{style:{width:`${b}px`}})]},D.key)})})}),u.jsx(hc,{selectedCrosslinkIds:M,numOfSelectedCrosslinks:j,numOfSelectedRows:I,clearSelectedRows:N,saveCrosslinksTable:V,hideCrosslinks:i})]})}),vb=({ref:t,...e})=>{const{experimentIdToGroupedStructureIds:n,experimentIdToVisibleCrosslinkIds:r,experiments:i,referenceProteinsById:s,proteinIdToReferenceProtein:o,groupDuplicatedCrosslinks:a}=mt(O),[c,l]=ct(),d=Object.values(n).some(M=>M.some($=>$.length>0)),h=d&&c!==!1,f=Hl(i),p=L(()=>pr(f.map(({id:M,crosslinks:$})=>$.filter(({id:R,from:j,to:I})=>r[M].has(R)&&j.proteinId in s&&I.proteinId in s)),s),[f,r,s]),m=p.some(({rows:M})=>M.length>0),x=L(()=>{const M=()=>({total:0,data:[]}),$=Object.fromEntries(Object.values(s).map(({id:j,domains:I})=>[j,{stats:{interprotein:M(),intraprotein:M(),homomultimeric:M()},domainNameToStats:Object.fromEntries((I==null?void 0:I.map(({name:k})=>[k,{interdomain:M(),intradomain:M()}]))??[])}])),R=(j,I)=>{j.total+=I.length,j.data.push(...I)};for(const{fromProteinId:j,fromDomainName:I,toProteinId:k,toDomainName:E,rows:N}of p)j===k?(R($[j].stats.intraprotein,N),R($[j].stats.homomultimeric,N.filter(({homoMultimeric:V})=>V.flat().some(F=>F)))):(R($[j].stats.interprotein,N),R($[k].stats.interprotein,N)),I&&E&&I===E&&j===k?R($[j].domainNameToStats[I].intradomain,N):[[j,I],[k,E]].forEach(([V,F])=>{F&&R($[V].domainNameToStats[F].interdomain,N)});return $},[p,s]),[y,g]=ct({}),v=L(()=>{const M=j=>{let I=0;for(const{ids:k}of j)k.some((N,V)=>{const F=i[V].id;return y[F]===void 0||N.some(H=>!y[F].includes(H))})&&(I+=1);return I},$=j=>ur(Object.entries(j).map(([I,{data:k,...E}])=>[I,{visible:M(k),data:k,...E}])),R={};for(const[j,{stats:I,domainNameToStats:k}]of Object.entries(x))R[j]={stats:$(I),domainNameToStats:ur(Object.entries(k).map(([E,N])=>[E,$(N)]))};return R},[x,i,y]),w=tt((M,$=!1)=>{g($?R=>Object.fromEntries(Object.entries(R).map(([j,I])=>[j,I==null?void 0:I.filter(k=>{var E;return((E=M[j])==null?void 0:E.includes(k))!==!0})])):R=>Object.fromEntries(Object.values(Object.groupBy([...Object.entries(R),...Object.entries(M)].flatMap(([j,I])=>I?[[j,I]]:[]),([j])=>j)).filter(j=>j!==void 0).map(j=>[j[0][0],j.flatMap(([I,k])=>k)])))},[g]),b=tt((M,...$)=>w(Object.fromEntries(In(...$.flat().map(({ids:R})=>R)).map((R,j)=>[i[j].id,R.flatMap(I=>I??[])])),M),[w,i]),C=L(()=>pr(f.map(({id:M,crosslinks:$})=>$.filter(({id:R,from:j,to:I})=>{var k;return r[M].has(R)&&j.proteinId in s&&I.proteinId in s&&((k=y[M])==null?void 0:k.includes(R))!==!0})),s),[f,r,s,y]),{structures:A,experimentIdToThresholds:_,aminoAcidsMustMatch:S}=mt(O),T=L(()=>A.filter(({id:M})=>Object.values(n).some($=>$.flat().includes(M))),[A,n]),P=L(()=>f.map(M=>({experiment:M,structureToXlinkIdToStatus:si(T??[],M.crosslinks,S,_[M.id]),visibleCrosslinkIds:new Set(M.crosslinks.filter(({id:$,from:R,to:j})=>{var I;return r[M.id].has($)&&R.proteinId in s&&j.proteinId in s&&((I=y[M.id])==null?void 0:I.includes($))!==!0}).map(({id:$})=>$)),groupedStructureIds:n[M.id]})),[f,T,S,_,r,s,y,n]);return u.jsxs(dn,{ref:t,...e,children:[u.jsxs(Fn,{maxW:"5xl",children:[!m&&u.jsxs(Kt.Root,{status:"warning",my:5,children:[u.jsx(Kt.Indicator,{}),u.jsxs(Kt.Content,{children:[u.jsx(Kt.Title,{children:"No data available"}),u.jsx(Kt.Description,{children:Object.keys(s).length===0||o.size===0?"Ensure that proteins in your experiments are mapped to a reference protein.":"All crosslinks were filtered out in the experiment pages."})]})]}),u.jsx(At,{position:"relative",children:u.jsx(lt,{gapY:5,gapX:10,wrap:"wrap",children:Object.values(s).toSorted((M,$)=>M.name.localeCompare($.name)).map(M=>u.jsx(gb,{protein:M,stats:v[M.id].stats,domainNameToStats:v[M.id].domainNameToStats,toggleVisibility:b,hideMultiProteinToggles:Object.keys(s).length<=1,w:"30%",overflow:"clip",size:"sm"},M.id))})}),u.jsx(cn,{my:5}),m&&u.jsxs(u.Fragment,{children:[u.jsx(dn,{children:d&&u.jsx(cc,{checked:!!h,onCheckedChange:({checked:M})=>l(!!M),children:"Show structures"})}),u.jsx(cn,{my:5})]})]}),m&&(C.length===0?u.jsx(fc,{resetFilters:()=>g({}),loading:!1}):h?u.jsx(pc,{experiments:P,structures:T??[],resetFilters:()=>g({}),hideCrosslinks:w,groupDuplicates:a}):u.jsx(yb,{experiments:f,groupedCrosslinkIds:C,referenceProteinsById:s,groupDuplicates:a,hideCrosslinks:w}))]})},bb=rt(({value:t,onConfirm:e,ref:n,...r})=>u.jsx(Ge,{value:t,role:"alertdialog",...r,children:u.jsxs(be,{ref:n,children:[u.jsxs(Ie,{children:[u.jsx(Te,{children:"Close Project?"}),u.jsx(Ce,{})]}),u.jsx(Pe,{children:"Are you sure you want to close this project? Any unsaved data will be lost."}),u.jsxs(ke,{children:[u.jsx(gs,{asChild:!0,children:u.jsx(ot,{variant:"outline",children:"Cancel"})}),u.jsx(ot,{colorPalette:"red",onClick:()=>e(),children:"Close Project"})]})]})}));function wb(t){return Nn({attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M12 10v-2h-5v-2h5v-2l3 3zM11 9v4h-5v3l-6-3v-13h11v5h-1v-4h-8l4 2v9h4v-3z"},child:[]}]})(t)}const jb=rt(({confirmBeforeClosing:t=!0,saveProject:e,closeProject:n,ref:r,...i})=>{const{colorMode:s,theme:o,toggleColorMode:a,setColorMode:c}=id(),{key:l}=oo(),d=ye({closeOnInteractOutside:!0,restoreFocus:!1}),{groupDuplicatedCrosslinks:h,aminoAcidsMustMatch:f}=mt(O);return u.jsxs(u.Fragment,{children:[t&&u.jsx(bb,{value:d,onConfirm:n}),u.jsxs(Fe,{onSelect:({value:p})=>p==="close"?t?d.setOpen(!0):n():p==="save"?e():p==="color-mode"?a():null,lazyMount:!0,unmountOnExit:!0,children:[u.jsx(nn,{asChild:!0,children:u.jsx(mn,{...i,ref:r,children:u.jsx(xl,{})})}),u.jsxs(Le,{children:[u.jsxs(Jt,{value:"save",children:[u.jsx(sd,{}),"Save Project (.","xlinkup",")"]}),u.jsxs(Fe,{positioning:{placement:"right-start",gutter:2},children:[u.jsx(nn,{asChild:!0,children:u.jsxs(Gi,{value:"bla",children:[u.jsx(od,{}),"Project Options"]})}),u.jsxs(Le,{children:[u.jsx(ar,{value:"group-duplicates",checked:h,onCheckedChange:p=>{O.groupDuplicatedCrosslinks=p},children:"Group Identical Crosslinks"}),u.jsx(ar,{value:"amino-acids-must-match",checked:f,onCheckedChange:p=>{O.aminoAcidsMustMatch=p},children:"Amino Acids Must Match"})]})]}),u.jsx(Tn,{}),u.jsxs(Fe,{positioning:{placement:"right-start",gutter:2},children:[u.jsx(nn,{asChild:!0,children:u.jsxs(Gi,{value:"color-mode",children:[s==="light"?u.jsx(ad,{}):u.jsx(ld,{}),"Color Mode"]})}),u.jsx(Le,{children:u.jsxs(bs,{value:o??"system",onValueChange:({value:p})=>c(p),children:[u.jsx(kn,{value:"light",children:"Light"}),u.jsx(kn,{value:"dark",children:"Dark"}),u.jsx(Tn,{}),u.jsx(kn,{value:"system",children:"System"})]})})]}),u.jsxs(Fe,{positioning:{placement:"right-start",gutter:2},children:[u.jsx(nn,{asChild:!0,children:u.jsxs(Gi,{value:"bla",children:[u.jsx(cd,{}),"Preferred Visualization Tool"]})}),u.jsx(Le,{children:u.jsx(bs,{value:l,onValueChange:({value:p})=>Jf(p),children:so.map(({key:p,name:m})=>u.jsx(kn,{value:p,children:m},p))})})]}),u.jsxs(Jt,{value:"cite",disabled:!0,children:[u.jsx(ud,{}),"Cite"]}),u.jsx(Tn,{}),u.jsxs(Jt,{value:"close",color:"fg.error",children:[u.jsx(wb,{}),"Close Project"]})]})]})]})}),ul=t=>{const e=document.createElement("a"),n=new Blob([jd(_d(t))],{type:"application/octet-stream"});e.href=URL.createObjectURL(n),e.download="project.xlinkup",e.click()};let dl;const _b=({closeProject:t,ref:e,...n})=>{const{experiments:r}=mt(O),i=zd({defaultValue:r.length===0?"empty":r[0].id,activationMode:"manual"}),s=L(()=>r.find(({id:d})=>d===i.value),[r,i.value]),o=r.length>1;(i.value!=="compare"||!o)&&i.value!=="proteins"&&i.value!=="structures"&&(r.length===0?i.setValue("empty"):s||i.setValue(r[0].id));const a=!vd();Vs("beforeunload",tt(d=>{a&&(d.preventDefault(),dl=jt(dl,{title:"Download a copy of the project?",description:"Any unsaved data will be lost.",type:"warning",action:{label:"Save Project",onClick:()=>ul(JSON.stringify(Do()))}}))},[a]));const c=at(i.setValue);c.current=i.setValue;const l=tt(()=>{const d=document.createElement("input");d.type="file",d.accept="text/csv,.zhrm",d.multiple=!0,d.onchange=h=>{d.remove();const f=Array.from(d.files??[]);if(f.length===0)return;const p=He.create({type:"loading",title:`Loading ${yt(f.length,"file")}...`});Ys(()=>{Promise.all(f.map(bd)).then(m=>{wd(m),He.success({id:p,title:`Added ${yt(f.length,"experiment")}`,description:null}),c.current(m[0].id)}).catch(m=>{He.error({id:p,title:"Error",description:m.message})})})},d.click()},[]);return u.jsxs(Ee.RootProvider,{size:"sm",value:i,lazyMount:!0,unmountOnExit:!0,my:5,variant:"subtle",ref:e,...n,children:[u.jsxs(Fn,{maxW:"5xl",children:[u.jsxs(Ee.List,{w:"full",alignItems:"center",pb:1,children:[u.jsx(lt,{flexDirection:"column",alignSelf:"stretch",mb:-1,children:u.jsx(jb,{variant:"ghost",size:"md",pb:1,flexGrow:1,borderRadius:0,confirmBeforeClosing:a,saveProject:()=>ul(JSON.stringify(Do())),closeProject:t})}),u.jsx(cn,{orientation:"vertical",alignSelf:"stretch",mr:1,mb:-1}),u.jsxs(lt,{wrap:"wrap",grow:1,children:[r.map((d,h)=>u.jsxs(ti,{gap:0,children:[u.jsx(Gv,{experimentId:d.id,experimentName:d.name}),h===r.length-1&&u.jsx(mn,{size:"xs",variant:"ghost",alignSelf:"center",ml:2,onClick:l,children:u.jsx(Rn,{})})]},d.id)),r.length===0&&u.jsxs(ot,{variant:"outline",size:"sm",onClick:l,children:[u.jsx(Rn,{}),"Add experiments to the project"]})]}),u.jsx(cn,{orientation:"vertical",alignSelf:"stretch",mx:1,mb:-1}),o&&u.jsx(Ee.Trigger,{value:"compare",flexShrink:0,height:"4.5rem",children:"Compare"}),u.jsxs(ti,{flexShrink:0,orientation:"vertical",gap:0,alignItems:"stretch",children:[u.jsx(hb,{value:"proteins"}),u.jsx(ub,{value:"structures"})]})]}),u.jsx(cn,{})]}),u.jsx(Ee.Content,{value:"compare",children:u.jsx(vb,{})}),u.jsx(Ee.Content,{value:"proteins",children:u.jsx(db,{})}),u.jsx(Ee.Content,{value:"structures",children:u.jsx(pb,{})}),r.map(d=>u.jsx(Ee.Content,{value:d.id,children:u.jsx(qv,{experiment:d})},d.id))]})},Ob=({initProps:t,closeProject:e})=>{const n=at(!1);return n.current||(Sd(t),n.current=!0),u.jsx(_b,{closeProject:e})};export{Ob as XLAppWrapper};
