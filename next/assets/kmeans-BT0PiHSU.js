import{bC as Qt,aB as Ve}from"./index-DD997Ml2.js";function Nt(d,y){let p=0;for(let b=0;b<d.length;b++)p+=(d[b]-y[b])*(d[b]-y[b]);return p}const qt={distanceFunction:Nt};function Pe(d,y,p=qt){const b=p.distanceFunction||qt.distanceFunction,T=p.similarityFunction||qt.similarityFunction;let D=-1;if(typeof T=="function"){let C=Number.MIN_VALUE;for(let N=0;N<d.length;N++){const P=T(y,d[N]);P>C&&(C=P,D=N)}}else if(typeof b=="function"){let C=Number.MAX_VALUE;for(let N=0;N<d.length;N++){const P=b(y,d[N]);P<C&&(C=P,D=N)}}else throw new Error("A similarity or distance function it's required");return D}function Ue(d,y){let p=new Array(d.length);for(let b=0;b<d.length;++b)for(let T=b;T<d.length;++T){p[b]||(p[b]=new Array(d.length)),p[T]||(p[T]=new Array(d.length));const D=y(d[b],d[T]);p[b][T]=D,p[T][b]=D}return p}function Wt(d,y,p,b){for(let T=0;T<d.length;T++)p[T]=Pe(y,d[T],{distanceFunction:b});return p}function Oe(d,y,p,b){const T=y[0].length;let D=new Array(b),C=new Array(b);for(let N=0;N<b;N++){D[N]=new Array(T),C[N]=0;for(let P=0;P<T;P++)D[N][P]=0}for(let N=0;N<y.length;N++){C[p[N]]++;for(let P=0;P<T;P++)D[p[N]][P]+=y[N][P]}for(let N=0;N<b;N++)for(let P=0;P<T;P++)C[N]?D[N][P]/=C[N]:D[N][P]=d[N][P];return D}function Be(d,y,p,b){for(let T=0;T<d.length;T++)if(p(d[T],y[T])>b)return!1;return!0}class _e{constructor(y,p,b,T,D){this.clusters=y,this.centroids=p,this.converged=b,this.iterations=T,this.distance=D}nearest(y){const p=new Array(y.length);return Wt(y,this.centroids,p,this.distance)}computeInformation(y){let p=this.centroids.map(b=>({centroid:b,error:0,size:0}));for(let b=0;b<y.length;b++)p[this.clusters[b]].error+=this.distance(y[b],this.centroids[this.clusters[b]]),p[this.clusters[b]].size++;for(let b=0;b<this.centroids.length;b++){let T=p[b].error;p[b].size&&T!==-1?T/=p[b].size:p[b].error=-1}return p}}function Ge(d,y){throw new Error(`${y}: "${String(d)}"`)}function Qe(d,y){if(y<=0||y>d.length||!Number.isInteger(y))throw new Error("K should be a positive integer smaller than the number of points")}var U={};const We=Object.prototype.toString;function bt(d){const y=We.call(d);return y.endsWith("Array]")&&!y.includes("Big")}const Ye=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:bt},Symbol.toStringTag,{value:"Module"})),Xe=Qt(Ye);function Je(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!bt(d))throw new TypeError("input must be an array");if(d.length===0)throw new TypeError("input must not be empty");var p=y.fromIndex,b=p===void 0?0:p,T=y.toIndex,D=T===void 0?d.length:T;if(b<0||b>=d.length||!Number.isInteger(b))throw new Error("fromIndex must be a positive integer smaller than length");if(D<=b||D>d.length||!Number.isInteger(D))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var C=d[b],N=b+1;N<D;N++)d[N]>C&&(C=d[N]);return C}function Ze(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!bt(d))throw new TypeError("input must be an array");if(d.length===0)throw new TypeError("input must not be empty");var p=y.fromIndex,b=p===void 0?0:p,T=y.toIndex,D=T===void 0?d.length:T;if(b<0||b>=d.length||!Number.isInteger(b))throw new Error("fromIndex must be a positive integer smaller than length");if(D<=b||D>d.length||!Number.isInteger(D))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var C=d[b],N=b+1;N<D;N++)d[N]<C&&(C=d[N]);return C}function Ke(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(bt(d)){if(d.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var p;if(y.output!==void 0){if(!bt(y.output))throw new TypeError("output option must be an array if specified");p=y.output}else p=new Array(d.length);var b=Ze(d),T=Je(d);if(b===T)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var D=y.min,C=D===void 0?y.autoMinMax?b:0:D,N=y.max,P=N===void 0?y.autoMinMax?T:1:N;if(C>=P)throw new RangeError("min option must be smaller than max option");for(var G=(P-C)/(T-b),B=0;B<d.length;B++)p[B]=(d[B]-b)*G+C;return p}const xe=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"})),Ae=Qt(xe);var Ut;function He(){if(Ut)return U;Ut=1,Object.defineProperty(U,"__esModule",{value:!0});var d=Xe,y=Ae;const p=" ".repeat(2),b=" ".repeat(4);function T(){return D(this)}function D(n,e={}){const{maxRows:s=15,maxColumns:t=10,maxNumSize:r=8,padMinus:o="auto"}=e;return`${n.constructor.name} {
${p}[
${b}${C(n,s,t,r,o)}
${p}]
${p}rows: ${n.rows}
${p}columns: ${n.columns}
}`}function C(n,e,s,t,r){const{rows:o,columns:i}=n,l=Math.min(o,e),h=Math.min(i,s),u=[];if(r==="auto"){r=!1;t:for(let g=0;g<l;g++)for(let f=0;f<h;f++)if(n.get(g,f)<0){r=!0;break t}}for(let g=0;g<l;g++){let f=[];for(let w=0;w<h;w++)f.push(N(n.get(g,w),t,r));u.push(`${f.join(" ")}`)}return h!==i&&(u[u.length-1]+=` ... ${i-s} more columns`),l!==o&&u.push(`... ${o-e} more rows`),u.join(`
${b}`)}function N(n,e,s){return(n>=0&&s?` ${P(n,e-1)}`:P(n,e)).padEnd(e)}function P(n,e){let s=n.toString();if(s.length<=e)return s;let t=n.toFixed(e);if(t.length>e&&(t=n.toFixed(Math.max(0,e-(t.length-e)))),t.length<=e&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let r=n.toExponential(e);return r.length>e&&(r=n.toExponential(Math.max(0,e-(r.length-e)))),r.slice(0)}function G(n,e){n.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},n.prototype.addS=function(t){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)+t);return this},n.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)+t.get(r,o));return this},n.add=function(t,r){return new e(t).add(r)},n.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},n.prototype.subS=function(t){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)-t);return this},n.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)-t.get(r,o));return this},n.sub=function(t,r){return new e(t).sub(r)},n.prototype.subtract=n.prototype.sub,n.prototype.subtractS=n.prototype.subS,n.prototype.subtractM=n.prototype.subM,n.subtract=n.sub,n.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},n.prototype.mulS=function(t){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)*t);return this},n.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)*t.get(r,o));return this},n.mul=function(t,r){return new e(t).mul(r)},n.prototype.multiply=n.prototype.mul,n.prototype.multiplyS=n.prototype.mulS,n.prototype.multiplyM=n.prototype.mulM,n.multiply=n.mul,n.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},n.prototype.divS=function(t){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)/t);return this},n.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)/t.get(r,o));return this},n.div=function(t,r){return new e(t).div(r)},n.prototype.divide=n.prototype.div,n.prototype.divideS=n.prototype.divS,n.prototype.divideM=n.prototype.divM,n.divide=n.div,n.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},n.prototype.modS=function(t){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)%t);return this},n.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)%t.get(r,o));return this},n.mod=function(t,r){return new e(t).mod(r)},n.prototype.modulus=n.prototype.mod,n.prototype.modulusS=n.prototype.modS,n.prototype.modulusM=n.prototype.modM,n.modulus=n.mod,n.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},n.prototype.andS=function(t){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)&t);return this},n.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)&t.get(r,o));return this},n.and=function(t,r){return new e(t).and(r)},n.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},n.prototype.orS=function(t){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)|t);return this},n.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)|t.get(r,o));return this},n.or=function(t,r){return new e(t).or(r)},n.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},n.prototype.xorS=function(t){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)^t);return this},n.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)^t.get(r,o));return this},n.xor=function(t,r){return new e(t).xor(r)},n.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},n.prototype.leftShiftS=function(t){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)<<t);return this},n.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)<<t.get(r,o));return this},n.leftShift=function(t,r){return new e(t).leftShift(r)},n.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},n.prototype.signPropagatingRightShiftS=function(t){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)>>t);return this},n.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)>>t.get(r,o));return this},n.signPropagatingRightShift=function(t,r){return new e(t).signPropagatingRightShift(r)},n.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},n.prototype.rightShiftS=function(t){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)>>>t);return this},n.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)>>>t.get(r,o));return this},n.rightShift=function(t,r){return new e(t).rightShift(r)},n.prototype.zeroFillRightShift=n.prototype.rightShift,n.prototype.zeroFillRightShiftS=n.prototype.rightShiftS,n.prototype.zeroFillRightShiftM=n.prototype.rightShiftM,n.zeroFillRightShift=n.rightShift,n.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,~this.get(t,r));return this},n.not=function(t){return new e(t).not()},n.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.abs(this.get(t,r)));return this},n.abs=function(t){return new e(t).abs()},n.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.acos(this.get(t,r)));return this},n.acos=function(t){return new e(t).acos()},n.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.acosh(this.get(t,r)));return this},n.acosh=function(t){return new e(t).acosh()},n.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.asin(this.get(t,r)));return this},n.asin=function(t){return new e(t).asin()},n.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.asinh(this.get(t,r)));return this},n.asinh=function(t){return new e(t).asinh()},n.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.atan(this.get(t,r)));return this},n.atan=function(t){return new e(t).atan()},n.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.atanh(this.get(t,r)));return this},n.atanh=function(t){return new e(t).atanh()},n.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.cbrt(this.get(t,r)));return this},n.cbrt=function(t){return new e(t).cbrt()},n.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.ceil(this.get(t,r)));return this},n.ceil=function(t){return new e(t).ceil()},n.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.clz32(this.get(t,r)));return this},n.clz32=function(t){return new e(t).clz32()},n.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.cos(this.get(t,r)));return this},n.cos=function(t){return new e(t).cos()},n.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.cosh(this.get(t,r)));return this},n.cosh=function(t){return new e(t).cosh()},n.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.exp(this.get(t,r)));return this},n.exp=function(t){return new e(t).exp()},n.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.expm1(this.get(t,r)));return this},n.expm1=function(t){return new e(t).expm1()},n.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.floor(this.get(t,r)));return this},n.floor=function(t){return new e(t).floor()},n.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.fround(this.get(t,r)));return this},n.fround=function(t){return new e(t).fround()},n.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.log(this.get(t,r)));return this},n.log=function(t){return new e(t).log()},n.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.log1p(this.get(t,r)));return this},n.log1p=function(t){return new e(t).log1p()},n.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.log10(this.get(t,r)));return this},n.log10=function(t){return new e(t).log10()},n.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.log2(this.get(t,r)));return this},n.log2=function(t){return new e(t).log2()},n.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.round(this.get(t,r)));return this},n.round=function(t){return new e(t).round()},n.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.sign(this.get(t,r)));return this},n.sign=function(t){return new e(t).sign()},n.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.sin(this.get(t,r)));return this},n.sin=function(t){return new e(t).sin()},n.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.sinh(this.get(t,r)));return this},n.sinh=function(t){return new e(t).sinh()},n.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.sqrt(this.get(t,r)));return this},n.sqrt=function(t){return new e(t).sqrt()},n.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.tan(this.get(t,r)));return this},n.tan=function(t){return new e(t).tan()},n.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.tanh(this.get(t,r)));return this},n.tanh=function(t){return new e(t).tanh()},n.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.set(t,r,Math.trunc(this.get(t,r)));return this},n.trunc=function(t){return new e(t).trunc()},n.pow=function(t,r){return new e(t).pow(r)},n.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},n.prototype.powS=function(t){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)**t);return this},n.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)**t.get(r,o));return this}}function B(n,e,s){let t=s?n.rows:n.rows-1;if(e<0||e>t)throw new RangeError("Row index out of range")}function Z(n,e,s){let t=s?n.columns:n.columns-1;if(e<0||e>t)throw new RangeError("Column index out of range")}function it(n,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==n.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function tt(n,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==n.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function mt(n,e){if(!d.isAnyArray(e))throw new TypeError("row indices must be an array");for(let s=0;s<e.length;s++)if(e[s]<0||e[s]>=n.rows)throw new RangeError("row indices are out of range")}function yt(n,e){if(!d.isAnyArray(e))throw new TypeError("column indices must be an array");for(let s=0;s<e.length;s++)if(e[s]<0||e[s]>=n.columns)throw new RangeError("column indices are out of range")}function Mt(n,e,s,t,r){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(gt("startRow",e),gt("endRow",s),gt("startColumn",t),gt("endColumn",r),e>s||t>r||e<0||e>=n.rows||s<0||s>=n.rows||t<0||t>=n.columns||r<0||r>=n.columns)throw new RangeError("Submatrix indices are out of range")}function at(n,e=0){let s=[];for(let t=0;t<n;t++)s.push(e);return s}function gt(n,e){if(typeof e!="number")throw new TypeError(`${n} must be a number`)}function lt(n){if(n.isEmpty())throw new Error("Empty matrix has no elements to index")}function wt(n){let e=at(n.rows);for(let s=0;s<n.rows;++s)for(let t=0;t<n.columns;++t)e[s]+=n.get(s,t);return e}function St(n){let e=at(n.columns);for(let s=0;s<n.rows;++s)for(let t=0;t<n.columns;++t)e[t]+=n.get(s,t);return e}function jt(n){let e=0;for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)e+=n.get(s,t);return e}function Yt(n){let e=at(n.rows,1);for(let s=0;s<n.rows;++s)for(let t=0;t<n.columns;++t)e[s]*=n.get(s,t);return e}function Xt(n){let e=at(n.columns,1);for(let s=0;s<n.rows;++s)for(let t=0;t<n.columns;++t)e[t]*=n.get(s,t);return e}function Jt(n){let e=1;for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)e*=n.get(s,t);return e}function Zt(n,e,s){const t=n.rows,r=n.columns,o=[];for(let i=0;i<t;i++){let l=0,h=0,u=0;for(let g=0;g<r;g++)u=n.get(i,g)-s[i],l+=u,h+=u*u;e?o.push((h-l*l/r)/(r-1)):o.push((h-l*l/r)/r)}return o}function Kt(n,e,s){const t=n.rows,r=n.columns,o=[];for(let i=0;i<r;i++){let l=0,h=0,u=0;for(let g=0;g<t;g++)u=n.get(g,i)-s[i],l+=u,h+=u*u;e?o.push((h-l*l/t)/(t-1)):o.push((h-l*l/t)/t)}return o}function xt(n,e,s){const t=n.rows,r=n.columns,o=t*r;let i=0,l=0,h=0;for(let u=0;u<t;u++)for(let g=0;g<r;g++)h=n.get(u,g)-s,i+=h,l+=h*h;return e?(l-i*i/o)/(o-1):(l-i*i/o)/o}function At(n,e){for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)n.set(s,t,n.get(s,t)-e[s])}function Ht(n,e){for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)n.set(s,t,n.get(s,t)-e[t])}function te(n,e){for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)n.set(s,t,n.get(s,t)-e)}function ee(n){const e=[];for(let s=0;s<n.rows;s++){let t=0;for(let r=0;r<n.columns;r++)t+=n.get(s,r)**2/(n.columns-1);e.push(Math.sqrt(t))}return e}function se(n,e){for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)n.set(s,t,n.get(s,t)/e[s])}function re(n){const e=[];for(let s=0;s<n.columns;s++){let t=0;for(let r=0;r<n.rows;r++)t+=n.get(r,s)**2/(n.rows-1);e.push(Math.sqrt(t))}return e}function oe(n,e){for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)n.set(s,t,n.get(s,t)/e[t])}function ne(n){const e=n.size-1;let s=0;for(let t=0;t<n.columns;t++)for(let r=0;r<n.rows;r++)s+=n.get(r,t)**2/e;return Math.sqrt(s)}function ie(n,e){for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)n.set(s,t,n.get(s,t)/e)}class V{static from1DArray(e,s,t){if(e*s!==t.length)throw new RangeError("data length does not match given dimensions");let o=new v(e,s);for(let i=0;i<e;i++)for(let l=0;l<s;l++)o.set(i,l,t[i*s+l]);return o}static rowVector(e){let s=new v(1,e.length);for(let t=0;t<e.length;t++)s.set(0,t,e[t]);return s}static columnVector(e){let s=new v(e.length,1);for(let t=0;t<e.length;t++)s.set(t,0,e[t]);return s}static zeros(e,s){return new v(e,s)}static ones(e,s){return new v(e,s).fill(1)}static rand(e,s,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:r=Math.random}=t;let o=new v(e,s);for(let i=0;i<e;i++)for(let l=0;l<s;l++)o.set(i,l,r());return o}static randInt(e,s,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:r=0,max:o=1e3,random:i=Math.random}=t;if(!Number.isInteger(r))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(r>=o)throw new RangeError("min must be smaller than max");let l=o-r,h=new v(e,s);for(let u=0;u<e;u++)for(let g=0;g<s;g++){let f=r+Math.round(i()*l);h.set(u,g,f)}return h}static eye(e,s,t){s===void 0&&(s=e),t===void 0&&(t=1);let r=Math.min(e,s),o=this.zeros(e,s);for(let i=0;i<r;i++)o.set(i,i,t);return o}static diag(e,s,t){let r=e.length;s===void 0&&(s=r),t===void 0&&(t=s);let o=Math.min(r,s,t),i=this.zeros(s,t);for(let l=0;l<o;l++)i.set(l,l,e[l]);return i}static min(e,s){e=this.checkMatrix(e),s=this.checkMatrix(s);let t=e.rows,r=e.columns,o=new v(t,r);for(let i=0;i<t;i++)for(let l=0;l<r;l++)o.set(i,l,Math.min(e.get(i,l),s.get(i,l)));return o}static max(e,s){e=this.checkMatrix(e),s=this.checkMatrix(s);let t=e.rows,r=e.columns,o=new this(t,r);for(let i=0;i<t;i++)for(let l=0;l<r;l++)o.set(i,l,Math.max(e.get(i,l),s.get(i,l)));return o}static checkMatrix(e){return V.isMatrix(e)?e:new v(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)e.call(this,s,t);return this}to1DArray(){let e=[];for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)e.push(this.get(s,t));return e}to2DArray(){let e=[];for(let s=0;s<this.rows;s++){e.push([]);for(let t=0;t<this.columns;t++)e[s].push(this.get(s,t))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let s=0;s<=e;s++)if(this.get(e,s)!==this.get(s,e))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let e=0;e<this.rows;e++)if(this.get(e,e)!==0)return!1;return!0}isEchelonForm(){let e=0,s=0,t=-1,r=!0,o=!1;for(;e<this.rows&&r;){for(s=0,o=!1;s<this.columns&&o===!1;)this.get(e,s)===0?s++:this.get(e,s)===1&&s>t?(o=!0,t=s):(r=!1,o=!0);e++}return r}isReducedEchelonForm(){let e=0,s=0,t=-1,r=!0,o=!1;for(;e<this.rows&&r;){for(s=0,o=!1;s<this.columns&&o===!1;)this.get(e,s)===0?s++:this.get(e,s)===1&&s>t?(o=!0,t=s):(r=!1,o=!0);for(let i=s+1;i<this.rows;i++)this.get(e,i)!==0&&(r=!1);e++}return r}echelonForm(){let e=this.clone(),s=0,t=0;for(;s<e.rows&&t<e.columns;){let r=s;for(let o=s;o<e.rows;o++)e.get(o,t)>e.get(r,t)&&(r=o);if(e.get(r,t)===0)t++;else{e.swapRows(s,r);let o=e.get(s,t);for(let i=t;i<e.columns;i++)e.set(s,i,e.get(s,i)/o);for(let i=s+1;i<e.rows;i++){let l=e.get(i,t)/e.get(s,t);e.set(i,t,0);for(let h=t+1;h<e.columns;h++)e.set(i,h,e.get(i,h)-e.get(s,h)*l)}s++,t++}}return e}reducedEchelonForm(){let e=this.echelonForm(),s=e.columns,t=e.rows,r=t-1;for(;r>=0;)if(e.maxRow(r)===0)r--;else{let o=0,i=!1;for(;o<t&&i===!1;)e.get(r,o)===1?i=!0:o++;for(let l=0;l<r;l++){let h=e.get(l,o);for(let u=o;u<s;u++){let g=e.get(l,u)-h*e.get(r,u);e.set(l,u,g)}}r--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:s=1,columns:t=1}=e;if(!Number.isInteger(s)||s<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let r=new v(this.rows*s,this.columns*t);for(let o=0;o<s;o++)for(let i=0;i<t;i++)r.setSubMatrix(this,this.rows*o,this.columns*i);return r}fill(e){for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,e);return this}neg(){return this.mulS(-1)}getRow(e){B(this,e);let s=[];for(let t=0;t<this.columns;t++)s.push(this.get(e,t));return s}getRowVector(e){return v.rowVector(this.getRow(e))}setRow(e,s){B(this,e),s=it(this,s);for(let t=0;t<this.columns;t++)this.set(e,t,s[t]);return this}swapRows(e,s){B(this,e),B(this,s);for(let t=0;t<this.columns;t++){let r=this.get(e,t);this.set(e,t,this.get(s,t)),this.set(s,t,r)}return this}getColumn(e){Z(this,e);let s=[];for(let t=0;t<this.rows;t++)s.push(this.get(t,e));return s}getColumnVector(e){return v.columnVector(this.getColumn(e))}setColumn(e,s){Z(this,e),s=tt(this,s);for(let t=0;t<this.rows;t++)this.set(t,e,s[t]);return this}swapColumns(e,s){Z(this,e),Z(this,s);for(let t=0;t<this.rows;t++){let r=this.get(t,e);this.set(t,e,this.get(t,s)),this.set(t,s,r)}return this}addRowVector(e){e=it(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)+e[t]);return this}subRowVector(e){e=it(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)-e[t]);return this}mulRowVector(e){e=it(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)*e[t]);return this}divRowVector(e){e=it(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)/e[t]);return this}addColumnVector(e){e=tt(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)+e[s]);return this}subColumnVector(e){e=tt(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)-e[s]);return this}mulColumnVector(e){e=tt(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)*e[s]);return this}divColumnVector(e){e=tt(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)/e[s]);return this}mulRow(e,s){B(this,e);for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*s);return this}mulColumn(e,s){Z(this,e);for(let t=0;t<this.rows;t++)this.set(t,e,this.get(t,e)*s);return this}max(e){if(this.isEmpty())return NaN;switch(e){case"row":{const s=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.get(t,r)>s[t]&&(s[t]=this.get(t,r));return s}case"column":{const s=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.get(t,r)>s[r]&&(s[r]=this.get(t,r));return s}case void 0:{let s=this.get(0,0);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.get(t,r)>s&&(s=this.get(t,r));return s}default:throw new Error(`invalid option: ${e}`)}}maxIndex(){lt(this);let e=this.get(0,0),s=[0,0];for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r),s[0]=t,s[1]=r);return s}min(e){if(this.isEmpty())return NaN;switch(e){case"row":{const s=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.get(t,r)<s[t]&&(s[t]=this.get(t,r));return s}case"column":{const s=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.get(t,r)<s[r]&&(s[r]=this.get(t,r));return s}case void 0:{let s=this.get(0,0);for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.get(t,r)<s&&(s=this.get(t,r));return s}default:throw new Error(`invalid option: ${e}`)}}minIndex(){lt(this);let e=this.get(0,0),s=[0,0];for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r),s[0]=t,s[1]=r);return s}maxRow(e){if(B(this,e),this.isEmpty())return NaN;let s=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)>s&&(s=this.get(e,t));return s}maxRowIndex(e){B(this,e),lt(this);let s=this.get(e,0),t=[e,0];for(let r=1;r<this.columns;r++)this.get(e,r)>s&&(s=this.get(e,r),t[1]=r);return t}minRow(e){if(B(this,e),this.isEmpty())return NaN;let s=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)<s&&(s=this.get(e,t));return s}minRowIndex(e){B(this,e),lt(this);let s=this.get(e,0),t=[e,0];for(let r=1;r<this.columns;r++)this.get(e,r)<s&&(s=this.get(e,r),t[1]=r);return t}maxColumn(e){if(Z(this,e),this.isEmpty())return NaN;let s=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)>s&&(s=this.get(t,e));return s}maxColumnIndex(e){Z(this,e),lt(this);let s=this.get(0,e),t=[0,e];for(let r=1;r<this.rows;r++)this.get(r,e)>s&&(s=this.get(r,e),t[0]=r);return t}minColumn(e){if(Z(this,e),this.isEmpty())return NaN;let s=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)<s&&(s=this.get(t,e));return s}minColumnIndex(e){Z(this,e),lt(this);let s=this.get(0,e),t=[0,e];for(let r=1;r<this.rows;r++)this.get(r,e)<s&&(s=this.get(r,e),t[0]=r);return t}diag(){let e=Math.min(this.rows,this.columns),s=[];for(let t=0;t<e;t++)s.push(this.get(t,t));return s}norm(e="frobenius"){switch(e){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${e}`)}}cumulativeSum(){let e=0;for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)e+=this.get(s,t),this.set(s,t,e);return this}dot(e){V.isMatrix(e)&&(e=e.to1DArray());let s=this.to1DArray();if(s.length!==e.length)throw new RangeError("vectors do not have the same size");let t=0;for(let r=0;r<s.length;r++)t+=s[r]*e[r];return t}mmul(e){e=v.checkMatrix(e);let s=this.rows,t=this.columns,r=e.columns,o=new v(s,r),i=new Float64Array(t);for(let l=0;l<r;l++){for(let h=0;h<t;h++)i[h]=e.get(h,l);for(let h=0;h<s;h++){let u=0;for(let g=0;g<t;g++)u+=this.get(h,g)*i[g];o.set(h,l,u)}}return o}mpow(e){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(e)||e<0)throw new RangeError("Exponent must be a non-negative integer");let s=v.eye(this.rows),t=this;for(let r=e;r>1;r/=2)(r&1)!==0&&(s=s.mmul(t)),t=t.mmul(t);return s}strassen2x2(e){e=v.checkMatrix(e);let s=new v(2,2);const t=this.get(0,0),r=e.get(0,0),o=this.get(0,1),i=e.get(0,1),l=this.get(1,0),h=e.get(1,0),u=this.get(1,1),g=e.get(1,1),f=(t+u)*(r+g),w=(l+u)*r,k=t*(i-g),m=u*(h-r),M=(t+o)*g,R=(l-t)*(r+i),c=(o-u)*(h+g),E=f+m-M+c,q=k+M,$=w+m,L=f-w+k+R;return s.set(0,0,E),s.set(0,1,q),s.set(1,0,$),s.set(1,1,L),s}strassen3x3(e){e=v.checkMatrix(e);let s=new v(3,3);const t=this.get(0,0),r=this.get(0,1),o=this.get(0,2),i=this.get(1,0),l=this.get(1,1),h=this.get(1,2),u=this.get(2,0),g=this.get(2,1),f=this.get(2,2),w=e.get(0,0),k=e.get(0,1),m=e.get(0,2),M=e.get(1,0),R=e.get(1,1),c=e.get(1,2),E=e.get(2,0),q=e.get(2,1),$=e.get(2,2),L=(t+r+o-i-l-g-f)*R,Y=(t-i)*(-k+R),F=l*(-w+k+M-R-c-E+$),z=(-t+i+l)*(w-k+R),Q=(i+l)*(-w+k),a=t*w,S=(-t+u+g)*(w-m+c),I=(-t+u)*(m-c),j=(u+g)*(-w+m),X=(t+r+o-l-h-u-g)*c,_=g*(-w+m+M-R-c-E+q),W=(-o+g+f)*(R+E-q),J=(o-f)*(R-q),A=o*E,ot=(g+f)*(-E+q),K=(-o+l+h)*(c+E-$),nt=(o-h)*(c-$),ft=(l+h)*(-E+$),O=r*M,H=h*q,st=i*m,rt=u*k,x=f*$,Ne=a+A+O,Te=L+z+Q+a+W+A+ot,qe=a+S+j+X+A+K+ft,Fe=Y+F+z+a+A+K+nt,De=Y+z+Q+a+H,ze=A+K+nt+ft+st,Ce=a+S+I+_+W+J+A,$e=W+J+A+ot+rt,Le=a+S+I+j+x;return s.set(0,0,Ne),s.set(0,1,Te),s.set(0,2,qe),s.set(1,0,Fe),s.set(1,1,De),s.set(1,2,ze),s.set(2,0,Ce),s.set(2,1,$e),s.set(2,2,Le),s}mmulStrassen(e){e=v.checkMatrix(e);let s=this.clone(),t=s.rows,r=s.columns,o=e.rows,i=e.columns;r!==o&&console.warn(`Multiplying ${t} x ${r} and ${o} x ${i} matrix: dimensions do not match.`);function l(f,w,k){let m=f.rows,M=f.columns;if(m===w&&M===k)return f;{let R=V.zeros(w,k);return R=R.setSubMatrix(f,0,0),R}}let h=Math.max(t,o),u=Math.max(r,i);s=l(s,h,u),e=l(e,h,u);function g(f,w,k,m){if(k<=512||m<=512)return f.mmul(w);k%2===1&&m%2===1?(f=l(f,k+1,m+1),w=l(w,k+1,m+1)):k%2===1?(f=l(f,k+1,m),w=l(w,k+1,m)):m%2===1&&(f=l(f,k,m+1),w=l(w,k,m+1));let M=parseInt(f.rows/2,10),R=parseInt(f.columns/2,10),c=f.subMatrix(0,M-1,0,R-1),E=w.subMatrix(0,M-1,0,R-1),q=f.subMatrix(0,M-1,R,f.columns-1),$=w.subMatrix(0,M-1,R,w.columns-1),L=f.subMatrix(M,f.rows-1,0,R-1),Y=w.subMatrix(M,w.rows-1,0,R-1),F=f.subMatrix(M,f.rows-1,R,f.columns-1),z=w.subMatrix(M,w.rows-1,R,w.columns-1),Q=g(V.add(c,F),V.add(E,z),M,R),a=g(V.add(L,F),E,M,R),S=g(c,V.sub($,z),M,R),I=g(F,V.sub(Y,E),M,R),j=g(V.add(c,q),z,M,R),X=g(V.sub(L,c),V.add(E,$),M,R),_=g(V.sub(q,F),V.add(Y,z),M,R),W=V.add(Q,I);W.sub(j),W.add(_);let J=V.add(S,j),A=V.add(a,I),ot=V.sub(Q,a);ot.add(S),ot.add(X);let K=V.zeros(2*W.rows,2*W.columns);return K=K.setSubMatrix(W,0,0),K=K.setSubMatrix(J,W.rows,0),K=K.setSubMatrix(A,0,W.columns),K=K.setSubMatrix(ot,W.rows,W.columns),K.subMatrix(0,k-1,0,m-1)}return g(s,e,h,u)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:s=0,max:t=1}=e;if(!Number.isFinite(s))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(s>=t)throw new RangeError("min must be smaller than max");let r=new v(this.rows,this.columns);for(let o=0;o<this.rows;o++){const i=this.getRow(o);i.length>0&&y(i,{min:s,max:t,output:i}),r.setRow(o,i)}return r}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:s=0,max:t=1}=e;if(!Number.isFinite(s))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(s>=t)throw new RangeError("min must be smaller than max");let r=new v(this.rows,this.columns);for(let o=0;o<this.columns;o++){const i=this.getColumn(o);i.length&&y(i,{min:s,max:t,output:i}),r.setColumn(o,i)}return r}flipRows(){const e=Math.ceil(this.columns/2);for(let s=0;s<this.rows;s++)for(let t=0;t<e;t++){let r=this.get(s,t),o=this.get(s,this.columns-1-t);this.set(s,t,o),this.set(s,this.columns-1-t,r)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let s=0;s<this.columns;s++)for(let t=0;t<e;t++){let r=this.get(t,s),o=this.get(this.rows-1-t,s);this.set(t,s,o),this.set(this.rows-1-t,s,r)}return this}kroneckerProduct(e){e=v.checkMatrix(e);let s=this.rows,t=this.columns,r=e.rows,o=e.columns,i=new v(s*r,t*o);for(let l=0;l<s;l++)for(let h=0;h<t;h++)for(let u=0;u<r;u++)for(let g=0;g<o;g++)i.set(r*l+u,o*h+g,this.get(l,h)*e.get(u,g));return i}kroneckerSum(e){if(e=v.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let s=this.rows,t=e.rows,r=this.kroneckerProduct(v.eye(t,t)),o=v.eye(s,s).kroneckerProduct(e);return r.add(o)}transpose(){let e=new v(this.columns,this.rows);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)e.set(t,s,this.get(s,t));return e}sortRows(e=zt){for(let s=0;s<this.rows;s++)this.setRow(s,this.getRow(s).sort(e));return this}sortColumns(e=zt){for(let s=0;s<this.columns;s++)this.setColumn(s,this.getColumn(s).sort(e));return this}subMatrix(e,s,t,r){Mt(this,e,s,t,r);let o=new v(s-e+1,r-t+1);for(let i=e;i<=s;i++)for(let l=t;l<=r;l++)o.set(i-e,l-t,this.get(i,l));return o}subMatrixRow(e,s,t){if(s===void 0&&(s=0),t===void 0&&(t=this.columns-1),s>t||s<0||s>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let r=new v(e.length,t-s+1);for(let o=0;o<e.length;o++)for(let i=s;i<=t;i++){if(e[o]<0||e[o]>=this.rows)throw new RangeError(`Row index out of range: ${e[o]}`);r.set(o,i-s,this.get(e[o],i))}return r}subMatrixColumn(e,s,t){if(s===void 0&&(s=0),t===void 0&&(t=this.rows-1),s>t||s<0||s>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let r=new v(t-s+1,e.length);for(let o=0;o<e.length;o++)for(let i=s;i<=t;i++){if(e[o]<0||e[o]>=this.columns)throw new RangeError(`Column index out of range: ${e[o]}`);r.set(i-s,o,this.get(i,e[o]))}return r}setSubMatrix(e,s,t){if(e=v.checkMatrix(e),e.isEmpty())return this;let r=s+e.rows-1,o=t+e.columns-1;Mt(this,s,r,t,o);for(let i=0;i<e.rows;i++)for(let l=0;l<e.columns;l++)this.set(s+i,t+l,e.get(i,l));return this}selection(e,s){mt(this,e),yt(this,s);let t=new v(e.length,s.length);for(let r=0;r<e.length;r++){let o=e[r];for(let i=0;i<s.length;i++){let l=s[i];t.set(r,i,this.get(o,l))}}return t}trace(){let e=Math.min(this.rows,this.columns),s=0;for(let t=0;t<e;t++)s+=this.get(t,t);return s}clone(){return this.constructor.copy(this,new v(this.rows,this.columns))}static copy(e,s){for(const[t,r,o]of e.entries())s.set(t,r,o);return s}sum(e){switch(e){case"row":return wt(this);case"column":return St(this);case void 0:return jt(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return Yt(this);case"column":return Xt(this);case void 0:return Jt(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const s=this.sum(e);switch(e){case"row":{for(let t=0;t<this.rows;t++)s[t]/=this.columns;return s}case"column":{for(let t=0;t<this.columns;t++)s[t]/=this.rows;return s}case void 0:return s/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,s={}){if(typeof e=="object"&&(s=e,e=void 0),typeof s!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:r=this.mean(e)}=s;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!d.isAnyArray(r))throw new TypeError("mean must be an array");return Zt(this,t,r)}case"column":{if(!d.isAnyArray(r))throw new TypeError("mean must be an array");return Kt(this,t,r)}case void 0:{if(typeof r!="number")throw new TypeError("mean must be a number");return xt(this,t,r)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,s){typeof e=="object"&&(s=e,e=void 0);const t=this.variance(e,s);if(e===void 0)return Math.sqrt(t);for(let r=0;r<t.length;r++)t[r]=Math.sqrt(t[r]);return t}center(e,s={}){if(typeof e=="object"&&(s=e,e=void 0),typeof s!="object")throw new TypeError("options must be an object");const{center:t=this.mean(e)}=s;switch(e){case"row":{if(!d.isAnyArray(t))throw new TypeError("center must be an array");return At(this,t),this}case"column":{if(!d.isAnyArray(t))throw new TypeError("center must be an array");return Ht(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return te(this,t),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,s={}){if(typeof e=="object"&&(s=e,e=void 0),typeof s!="object")throw new TypeError("options must be an object");let t=s.scale;switch(e){case"row":{if(t===void 0)t=ee(this);else if(!d.isAnyArray(t))throw new TypeError("scale must be an array");return se(this,t),this}case"column":{if(t===void 0)t=re(this);else if(!d.isAnyArray(t))throw new TypeError("scale must be an array");return oe(this,t),this}case void 0:{if(t===void 0)t=ne(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return ie(this,t),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return D(this,e)}[Symbol.iterator](){return this.entries()}*entries(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)yield[e,s,this.get(e,s)]}*values(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)yield this.get(e,s)}}V.prototype.klass="Matrix",typeof Symbol<"u"&&(V.prototype[Symbol.for("nodejs.util.inspect.custom")]=T);function zt(n,e){return n-e}function le(n){return n.every(e=>typeof e=="number")}V.random=V.rand,V.randomInt=V.randInt,V.diagonal=V.diag,V.prototype.diagonal=V.prototype.diag,V.identity=V.eye,V.prototype.negate=V.prototype.neg,V.prototype.tensorProduct=V.prototype.kroneckerProduct;class v extends V{data;#t(e,s){if(this.data=[],Number.isInteger(s)&&s>=0)for(let t=0;t<e;t++)this.data.push(new Float64Array(s));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=s}constructor(e,s){if(super(),v.isMatrix(e))this.#t(e.rows,e.columns),v.copy(e,this);else if(Number.isInteger(e)&&e>=0)this.#t(e,s);else if(d.isAnyArray(e)){const t=e;if(e=t.length,s=e?t[0].length:0,typeof s!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let r=0;r<e;r++){if(t[r].length!==s)throw new RangeError("Inconsistent array dimensions");if(!le(t[r]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(t[r]))}this.rows=e,this.columns=s}else throw new TypeError("First argument must be a positive number or an array")}set(e,s,t){return this.data[e][s]=t,this}get(e,s){return this.data[e][s]}removeRow(e){return B(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,s){return s===void 0&&(s=e,e=this.rows),B(this,e,!0),s=Float64Array.from(it(this,s)),this.data.splice(e,0,s),this.rows+=1,this}removeColumn(e){Z(this,e);for(let s=0;s<this.rows;s++){const t=new Float64Array(this.columns-1);for(let r=0;r<e;r++)t[r]=this.data[s][r];for(let r=e+1;r<this.columns;r++)t[r-1]=this.data[s][r];this.data[s]=t}return this.columns-=1,this}addColumn(e,s){typeof s>"u"&&(s=e,e=this.columns),Z(this,e,!0),s=tt(this,s);for(let t=0;t<this.rows;t++){const r=new Float64Array(this.columns+1);let o=0;for(;o<e;o++)r[o]=this.data[t][o];for(r[o++]=s[t];o<this.columns+1;o++)r[o]=this.data[t][o-1];this.data[t]=r}return this.columns+=1,this}}G(V,v);class ct extends V{#t;get size(){return this.#t.size}get rows(){return this.#t.rows}get columns(){return this.#t.columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return v.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}constructor(e){if(super(),v.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");this.#t=v.copy(e,new v(e.rows,e.rows))}else if(Number.isInteger(e)&&e>=0)this.#t=new v(e,e);else if(this.#t=new v(e),!this.isSymmetric())throw new TypeError("not symmetric data")}clone(){const e=new ct(this.diagonalSize);for(const[s,t,r]of this.upperRightEntries())e.set(s,t,r);return e}toMatrix(){return new v(this)}get(e,s){return this.#t.get(e,s)}set(e,s,t){return this.#t.set(e,s,t),this.#t.set(s,e,t),this}removeCross(e){return this.#t.removeRow(e),this.#t.removeColumn(e),this}addCross(e,s){s===void 0&&(s=e,e=this.diagonalSize);const t=s.slice();return t.splice(e,1),this.#t.addRow(e,t),this.#t.addColumn(e,s),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const s=[];for(const[t,r]of e.entries())r||s.push(t);s.reverse();for(const t of s)this.removeCross(t);return this}toCompact(){const{diagonalSize:e}=this,s=new Array(e*(e+1)/2);for(let t=0,r=0,o=0;o<s.length;o++)s[o]=this.get(r,t),++t>=e&&(t=++r);return s}static fromCompact(e){const s=e.length,t=(Math.sqrt(8*s+1)-1)/2;if(!Number.isInteger(t))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const r=new ct(t);for(let o=0,i=0,l=0;l<s;l++)r.set(o,i,e[l]),++o>=t&&(o=++i);return r}*upperRightEntries(){for(let e=0,s=0;e<this.diagonalSize;void 0){const t=this.get(e,s);yield[e,s,t],++s>=this.diagonalSize&&(s=++e)}}*upperRightValues(){for(let e=0,s=0;e<this.diagonalSize;void 0)yield this.get(e,s),++s>=this.diagonalSize&&(s=++e)}}ct.prototype.klassType="SymmetricMatrix";class Et extends ct{static isDistanceMatrix(e){return ct.isSymmetricMatrix(e)&&e.klassSubType==="DistanceMatrix"}constructor(e){if(super(e),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(e,s,t){return e===s&&(t=0),super.set(e,s,t)}addCross(e,s){return s===void 0&&(s=e,e=this.diagonalSize),s=s.slice(),s[e]=0,super.addCross(e,s)}toSymmetricMatrix(){return new ct(this)}clone(){const e=new Et(this.diagonalSize);for(const[s,t,r]of this.upperRightEntries())s!==t&&e.set(s,t,r);return e}toCompact(){const{diagonalSize:e}=this,s=(e-1)*e/2,t=new Array(s);for(let r=1,o=0,i=0;i<t.length;i++)t[i]=this.get(o,r),++r>=e&&(r=++o+1);return t}static fromCompact(e){const s=e.length;if(s===0)return new this(0);const t=(Math.sqrt(8*s+1)+1)/2;if(!Number.isInteger(t))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(e)}`);const r=new this(t);for(let o=1,i=0,l=0;l<s;l++)r.set(o,i,e[l]),++o>=t&&(o=++i+1);return r}}Et.prototype.klassSubType="DistanceMatrix";class ht extends V{constructor(e,s,t){super(),this.matrix=e,this.rows=s,this.columns=t}}class he extends ht{constructor(e,s){Z(e,s),super(e,e.rows,1),this.column=s}set(e,s,t){return this.matrix.set(e,this.column,t),this}get(e){return this.matrix.get(e,this.column)}}class ue extends ht{constructor(e,s){yt(e,s),super(e,e.rows,s.length),this.columnIndices=s}set(e,s,t){return this.matrix.set(e,this.columnIndices[s],t),this}get(e,s){return this.matrix.get(e,this.columnIndices[s])}}class fe extends ht{constructor(e){super(e,e.rows,e.columns)}set(e,s,t){return this.matrix.set(e,this.columns-s-1,t),this}get(e,s){return this.matrix.get(e,this.columns-s-1)}}class ce extends ht{constructor(e){super(e,e.rows,e.columns)}set(e,s,t){return this.matrix.set(this.rows-e-1,s,t),this}get(e,s){return this.matrix.get(this.rows-e-1,s)}}class ae extends ht{constructor(e,s){B(e,s),super(e,1,e.columns),this.row=s}set(e,s,t){return this.matrix.set(this.row,s,t),this}get(e,s){return this.matrix.get(this.row,s)}}class ge extends ht{constructor(e,s){mt(e,s),super(e,s.length,e.columns),this.rowIndices=s}set(e,s,t){return this.matrix.set(this.rowIndices[e],s,t),this}get(e,s){return this.matrix.get(this.rowIndices[e],s)}}class kt extends ht{constructor(e,s,t){mt(e,s),yt(e,t),super(e,s.length,t.length),this.rowIndices=s,this.columnIndices=t}set(e,s,t){return this.matrix.set(this.rowIndices[e],this.columnIndices[s],t),this}get(e,s){return this.matrix.get(this.rowIndices[e],this.columnIndices[s])}}class me extends ht{constructor(e,s,t,r,o){Mt(e,s,t,r,o),super(e,t-s+1,o-r+1),this.startRow=s,this.startColumn=r}set(e,s,t){return this.matrix.set(this.startRow+e,this.startColumn+s,t),this}get(e,s){return this.matrix.get(this.startRow+e,this.startColumn+s)}}class we extends ht{constructor(e){super(e,e.columns,e.rows)}set(e,s,t){return this.matrix.set(s,e,t),this}get(e,s){return this.matrix.get(s,e)}}class Ct extends V{constructor(e,s={}){const{rows:t=1}=s;if(e.length%t!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=t,this.columns=e.length/t,this.data=e}set(e,s,t){let r=this._calculateIndex(e,s);return this.data[r]=t,this}get(e,s){let t=this._calculateIndex(e,s);return this.data[t]}_calculateIndex(e,s){return e*this.columns+s}}class et extends V{constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,s,t){return this.data[e][s]=t,this}get(e,s){return this.data[e][s]}}function pe(n,e){if(d.isAnyArray(n))return n[0]&&d.isAnyArray(n[0])?new et(n):new Ct(n,e);throw new Error("the argument is not an array")}class vt{constructor(e){e=et.checkMatrix(e);let s=e.clone(),t=s.rows,r=s.columns,o=new Float64Array(t),i=1,l,h,u,g,f,w,k,m,M;for(l=0;l<t;l++)o[l]=l;for(m=new Float64Array(t),h=0;h<r;h++){for(l=0;l<t;l++)m[l]=s.get(l,h);for(l=0;l<t;l++){for(M=Math.min(l,h),f=0,u=0;u<M;u++)f+=s.get(l,u)*m[u];m[l]-=f,s.set(l,h,m[l])}for(g=h,l=h+1;l<t;l++)Math.abs(m[l])>Math.abs(m[g])&&(g=l);if(g!==h){for(u=0;u<r;u++)w=s.get(g,u),s.set(g,u,s.get(h,u)),s.set(h,u,w);k=o[g],o[g]=o[h],o[h]=k,i=-i}if(h<t&&s.get(h,h)!==0)for(l=h+1;l<t;l++)s.set(l,h,s.get(l,h)/s.get(h,h))}this.LU=s,this.pivotVector=o,this.pivotSign=i}isSingular(){let e=this.LU,s=e.columns;for(let t=0;t<s;t++)if(e.get(t,t)===0)return!0;return!1}solve(e){e=v.checkMatrix(e);let s=this.LU;if(s.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r=e.columns,o=e.subMatrixRow(this.pivotVector,0,r-1),i=s.columns,l,h,u;for(u=0;u<i;u++)for(l=u+1;l<i;l++)for(h=0;h<r;h++)o.set(l,h,o.get(l,h)-o.get(u,h)*s.get(l,u));for(u=i-1;u>=0;u--){for(h=0;h<r;h++)o.set(u,h,o.get(u,h)/s.get(u,u));for(l=0;l<u;l++)for(h=0;h<r;h++)o.set(l,h,o.get(l,h)-o.get(u,h)*s.get(l,u))}return o}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let s=this.pivotSign,t=e.columns;for(let r=0;r<t;r++)s*=e.get(r,r);return s}get lowerTriangularMatrix(){let e=this.LU,s=e.rows,t=e.columns,r=new v(s,t);for(let o=0;o<s;o++)for(let i=0;i<t;i++)o>i?r.set(o,i,e.get(o,i)):o===i?r.set(o,i,1):r.set(o,i,0);return r}get upperTriangularMatrix(){let e=this.LU,s=e.rows,t=e.columns,r=new v(s,t);for(let o=0;o<s;o++)for(let i=0;i<t;i++)o<=i?r.set(o,i,e.get(o,i)):r.set(o,i,0);return r}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function ut(n,e){let s=0;return Math.abs(n)>Math.abs(e)?(s=e/n,Math.abs(n)*Math.sqrt(1+s*s)):e!==0?(s=n/e,Math.abs(e)*Math.sqrt(1+s*s)):0}class Tt{constructor(e){e=et.checkMatrix(e);let s=e.clone(),t=e.rows,r=e.columns,o=new Float64Array(r),i,l,h,u;for(h=0;h<r;h++){let g=0;for(i=h;i<t;i++)g=ut(g,s.get(i,h));if(g!==0){for(s.get(h,h)<0&&(g=-g),i=h;i<t;i++)s.set(i,h,s.get(i,h)/g);for(s.set(h,h,s.get(h,h)+1),l=h+1;l<r;l++){for(u=0,i=h;i<t;i++)u+=s.get(i,h)*s.get(i,l);for(u=-u/s.get(h,h),i=h;i<t;i++)s.set(i,l,s.get(i,l)+u*s.get(i,h))}}o[h]=-g}this.QR=s,this.Rdiag=o}solve(e){e=v.checkMatrix(e);let s=this.QR,t=s.rows;if(e.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let r=e.columns,o=e.clone(),i=s.columns,l,h,u,g;for(u=0;u<i;u++)for(h=0;h<r;h++){for(g=0,l=u;l<t;l++)g+=s.get(l,u)*o.get(l,h);for(g=-g/s.get(u,u),l=u;l<t;l++)o.set(l,h,o.get(l,h)+g*s.get(l,u))}for(u=i-1;u>=0;u--){for(h=0;h<r;h++)o.set(u,h,o.get(u,h)/this.Rdiag[u]);for(l=0;l<u;l++)for(h=0;h<r;h++)o.set(l,h,o.get(l,h)-o.get(u,h)*s.get(l,u))}return o.subMatrix(0,i-1,0,r-1)}isFullRank(){let e=this.QR.columns;for(let s=0;s<e;s++)if(this.Rdiag[s]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,s=e.columns,t=new v(s,s),r,o;for(r=0;r<s;r++)for(o=0;o<s;o++)r<o?t.set(r,o,e.get(r,o)):r===o?t.set(r,o,this.Rdiag[r]):t.set(r,o,0);return t}get orthogonalMatrix(){let e=this.QR,s=e.rows,t=e.columns,r=new v(s,t),o,i,l,h;for(l=t-1;l>=0;l--){for(o=0;o<s;o++)r.set(o,l,0);for(r.set(l,l,1),i=l;i<t;i++)if(e.get(l,l)!==0){for(h=0,o=l;o<s;o++)h+=e.get(o,l)*r.get(o,i);for(h=-h/e.get(l,l),o=l;o<s;o++)r.set(o,i,r.get(o,i)+h*e.get(o,l))}}return r}}class pt{constructor(e,s={}){if(e=et.checkMatrix(e),e.isEmpty())throw new Error("Matrix must be non-empty");let t=e.rows,r=e.columns;const{computeLeftSingularVectors:o=!0,computeRightSingularVectors:i=!0,autoTranspose:l=!1}=s;let h=!!o,u=!!i,g=!1,f;if(t<r)if(!l)f=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{f=e.transpose(),t=f.rows,r=f.columns,g=!0;let a=h;h=u,u=a}else f=e.clone();let w=Math.min(t,r),k=Math.min(t+1,r),m=new Float64Array(k),M=new v(t,w),R=new v(r,r),c=new Float64Array(r),E=new Float64Array(t),q=new Float64Array(k);for(let a=0;a<k;a++)q[a]=a;let $=Math.min(t-1,r),L=Math.max(0,Math.min(r-2,t)),Y=Math.max($,L);for(let a=0;a<Y;a++){if(a<$){m[a]=0;for(let S=a;S<t;S++)m[a]=ut(m[a],f.get(S,a));if(m[a]!==0){f.get(a,a)<0&&(m[a]=-m[a]);for(let S=a;S<t;S++)f.set(S,a,f.get(S,a)/m[a]);f.set(a,a,f.get(a,a)+1)}m[a]=-m[a]}for(let S=a+1;S<r;S++){if(a<$&&m[a]!==0){let I=0;for(let j=a;j<t;j++)I+=f.get(j,a)*f.get(j,S);I=-I/f.get(a,a);for(let j=a;j<t;j++)f.set(j,S,f.get(j,S)+I*f.get(j,a))}c[S]=f.get(a,S)}if(h&&a<$)for(let S=a;S<t;S++)M.set(S,a,f.get(S,a));if(a<L){c[a]=0;for(let S=a+1;S<r;S++)c[a]=ut(c[a],c[S]);if(c[a]!==0){c[a+1]<0&&(c[a]=0-c[a]);for(let S=a+1;S<r;S++)c[S]/=c[a];c[a+1]+=1}if(c[a]=-c[a],a+1<t&&c[a]!==0){for(let S=a+1;S<t;S++)E[S]=0;for(let S=a+1;S<t;S++)for(let I=a+1;I<r;I++)E[S]+=c[I]*f.get(S,I);for(let S=a+1;S<r;S++){let I=-c[S]/c[a+1];for(let j=a+1;j<t;j++)f.set(j,S,f.get(j,S)+I*E[j])}}if(u)for(let S=a+1;S<r;S++)R.set(S,a,c[S])}}let F=Math.min(r,t+1);if($<r&&(m[$]=f.get($,$)),t<F&&(m[F-1]=0),L+1<F&&(c[L]=f.get(L,F-1)),c[F-1]=0,h){for(let a=$;a<w;a++){for(let S=0;S<t;S++)M.set(S,a,0);M.set(a,a,1)}for(let a=$-1;a>=0;a--)if(m[a]!==0){for(let S=a+1;S<w;S++){let I=0;for(let j=a;j<t;j++)I+=M.get(j,a)*M.get(j,S);I=-I/M.get(a,a);for(let j=a;j<t;j++)M.set(j,S,M.get(j,S)+I*M.get(j,a))}for(let S=a;S<t;S++)M.set(S,a,-M.get(S,a));M.set(a,a,1+M.get(a,a));for(let S=0;S<a-1;S++)M.set(S,a,0)}else{for(let S=0;S<t;S++)M.set(S,a,0);M.set(a,a,1)}}if(u)for(let a=r-1;a>=0;a--){if(a<L&&c[a]!==0)for(let S=a+1;S<r;S++){let I=0;for(let j=a+1;j<r;j++)I+=R.get(j,a)*R.get(j,S);I=-I/R.get(a+1,a);for(let j=a+1;j<r;j++)R.set(j,S,R.get(j,S)+I*R.get(j,a))}for(let S=0;S<r;S++)R.set(S,a,0);R.set(a,a,1)}let z=F-1,Q=Number.EPSILON;for(;F>0;){let a,S;for(a=F-2;a>=-1&&a!==-1;a--){const I=Number.MIN_VALUE+Q*Math.abs(m[a]+Math.abs(m[a+1]));if(Math.abs(c[a])<=I||Number.isNaN(c[a])){c[a]=0;break}}if(a===F-2)S=4;else{let I;for(I=F-1;I>=a&&I!==a;I--){let j=(I!==F?Math.abs(c[I]):0)+(I!==a+1?Math.abs(c[I-1]):0);if(Math.abs(m[I])<=Q*j){m[I]=0;break}}I===a?S=3:I===F-1?S=1:(S=2,a=I)}switch(a++,S){case 1:{let I=c[F-2];c[F-2]=0;for(let j=F-2;j>=a;j--){let X=ut(m[j],I),_=m[j]/X,W=I/X;if(m[j]=X,j!==a&&(I=-W*c[j-1],c[j-1]=_*c[j-1]),u)for(let J=0;J<r;J++)X=_*R.get(J,j)+W*R.get(J,F-1),R.set(J,F-1,-W*R.get(J,j)+_*R.get(J,F-1)),R.set(J,j,X)}break}case 2:{let I=c[a-1];c[a-1]=0;for(let j=a;j<F;j++){let X=ut(m[j],I),_=m[j]/X,W=I/X;if(m[j]=X,I=-W*c[j],c[j]=_*c[j],h)for(let J=0;J<t;J++)X=_*M.get(J,j)+W*M.get(J,a-1),M.set(J,a-1,-W*M.get(J,j)+_*M.get(J,a-1)),M.set(J,j,X)}break}case 3:{const I=Math.max(Math.abs(m[F-1]),Math.abs(m[F-2]),Math.abs(c[F-2]),Math.abs(m[a]),Math.abs(c[a])),j=m[F-1]/I,X=m[F-2]/I,_=c[F-2]/I,W=m[a]/I,J=c[a]/I,A=((X+j)*(X-j)+_*_)/2,ot=j*_*(j*_);let K=0;(A!==0||ot!==0)&&(A<0?K=0-Math.sqrt(A*A+ot):K=Math.sqrt(A*A+ot),K=ot/(A+K));let nt=(W+j)*(W-j)+K,ft=W*J;for(let O=a;O<F-1;O++){let H=ut(nt,ft);H===0&&(H=Number.MIN_VALUE);let st=nt/H,rt=ft/H;if(O!==a&&(c[O-1]=H),nt=st*m[O]+rt*c[O],c[O]=st*c[O]-rt*m[O],ft=rt*m[O+1],m[O+1]=st*m[O+1],u)for(let x=0;x<r;x++)H=st*R.get(x,O)+rt*R.get(x,O+1),R.set(x,O+1,-rt*R.get(x,O)+st*R.get(x,O+1)),R.set(x,O,H);if(H=ut(nt,ft),H===0&&(H=Number.MIN_VALUE),st=nt/H,rt=ft/H,m[O]=H,nt=st*c[O]+rt*m[O+1],m[O+1]=-rt*c[O]+st*m[O+1],ft=rt*c[O+1],c[O+1]=st*c[O+1],h&&O<t-1)for(let x=0;x<t;x++)H=st*M.get(x,O)+rt*M.get(x,O+1),M.set(x,O+1,-rt*M.get(x,O)+st*M.get(x,O+1)),M.set(x,O,H)}c[F-2]=nt;break}case 4:{if(m[a]<=0&&(m[a]=m[a]<0?-m[a]:0,u))for(let I=0;I<=z;I++)R.set(I,a,-R.get(I,a));for(;a<z&&!(m[a]>=m[a+1]);){let I=m[a];if(m[a]=m[a+1],m[a+1]=I,u&&a<r-1)for(let j=0;j<r;j++)I=R.get(j,a+1),R.set(j,a+1,R.get(j,a)),R.set(j,a,I);if(h&&a<t-1)for(let j=0;j<t;j++)I=M.get(j,a+1),M.set(j,a+1,M.get(j,a)),M.set(j,a,I);a++}F--;break}}}if(g){let a=R;R=M,M=a}this.m=t,this.n=r,this.s=m,this.U=M,this.V=R}solve(e){let s=e,t=this.threshold,r=this.s.length,o=v.zeros(r,r);for(let w=0;w<r;w++)Math.abs(this.s[w])<=t?o.set(w,w,0):o.set(w,w,1/this.s[w]);let i=this.U,l=this.rightSingularVectors,h=l.mmul(o),u=l.rows,g=i.rows,f=v.zeros(u,g);for(let w=0;w<u;w++)for(let k=0;k<g;k++){let m=0;for(let M=0;M<r;M++)m+=h.get(w,M)*i.get(k,M);f.set(w,k,m)}return f.mmul(s)}solveForDiagonal(e){return this.solve(v.diag(e))}inverse(){let e=this.V,s=this.threshold,t=e.rows,r=e.columns,o=new v(t,this.s.length);for(let g=0;g<t;g++)for(let f=0;f<r;f++)Math.abs(this.s[f])>s&&o.set(g,f,e.get(g,f)/this.s[f]);let i=this.U,l=i.rows,h=i.columns,u=new v(t,l);for(let g=0;g<t;g++)for(let f=0;f<l;f++){let w=0;for(let k=0;k<h;k++)w+=o.get(g,k)*i.get(f,k);u.set(g,f,w)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,s=0,t=this.s;for(let r=0,o=t.length;r<o;r++)t[r]>e&&s++;return s}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return v.diag(this.s)}}function de(n,e=!1){return n=et.checkMatrix(n),e?new pt(n).inverse():$t(n,v.eye(n.rows))}function $t(n,e,s=!1){return n=et.checkMatrix(n),e=et.checkMatrix(e),s?new pt(n).solve(e):n.isSquare()?new vt(n).solve(e):new Tt(n).solve(e)}function Rt(n){if(n=v.checkMatrix(n),n.isSquare()){if(n.columns===0)return 1;let e,s,t,r;if(n.columns===2)return e=n.get(0,0),s=n.get(0,1),t=n.get(1,0),r=n.get(1,1),e*r-s*t;if(n.columns===3){let o,i,l;return o=new kt(n,[1,2],[1,2]),i=new kt(n,[1,2],[0,2]),l=new kt(n,[1,2],[0,1]),e=n.get(0,0),s=n.get(0,1),t=n.get(0,2),e*Rt(o)-s*Rt(i)+t*Rt(l)}else return new vt(n).determinant}else throw Error("determinant can only be calculated for a square matrix")}function ye(n,e){let s=[];for(let t=0;t<n;t++)t!==e&&s.push(t);return s}function Me(n,e,s,t=1e-9,r=1e-9){if(n>r)return new Array(e.rows+1).fill(0);{let o=e.addRow(s,[0]);for(let i=0;i<o.rows;i++)Math.abs(o.get(i,0))<t&&o.set(i,0,0);return o.to1DArray()}}function be(n,e={}){const{thresholdValue:s=1e-9,thresholdError:t=1e-9}=e;n=v.checkMatrix(n);let r=n.rows,o=new v(r,r);for(let i=0;i<r;i++){let l=v.columnVector(n.getRow(i)),h=n.subMatrixRow(ye(r,i)).transpose(),g=new pt(h).solve(l),f=v.sub(l,h.mmul(g)).abs().max();o.setRow(i,Me(f,g,i,s,t))}return o}function Se(n,e=Number.EPSILON){if(n=v.checkMatrix(n),n.isEmpty())return n.transpose();let s=new pt(n,{autoTranspose:!0}),t=s.leftSingularVectors,r=s.rightSingularVectors,o=s.diagonal;for(let i=0;i<o.length;i++)Math.abs(o[i])>e?o[i]=1/o[i]:o[i]=0;return r.mmul(v.diag(o).mmul(t.transpose()))}function je(n,e=n,s={}){n=new v(n);let t=!1;if(typeof e=="object"&&!v.isMatrix(e)&&!d.isAnyArray(e)?(s=e,e=n,t=!0):e=new v(e),n.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:r=!0}=s;r&&(n=n.center("column"),t||(e=e.center("column")));const o=n.transpose().mmul(e);for(let i=0;i<o.rows;i++)for(let l=0;l<o.columns;l++)o.set(i,l,o.get(i,l)*(1/(n.rows-1)));return o}function Ee(n,e=n,s={}){n=new v(n);let t=!1;if(typeof e=="object"&&!v.isMatrix(e)&&!d.isAnyArray(e)?(s=e,e=n,t=!0):e=new v(e),n.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:r=!0,scale:o=!0}=s;r&&(n.center("column"),t||e.center("column")),o&&(n.scale("column"),t||e.scale("column"));const i=n.standardDeviation("column",{unbiased:!0}),l=t?i:e.standardDeviation("column",{unbiased:!0}),h=n.transpose().mmul(e);for(let u=0;u<h.rows;u++)for(let g=0;g<h.columns;g++)h.set(u,g,h.get(u,g)*(1/(i[u]*l[g]))*(1/(n.rows-1)));return h}class Lt{constructor(e,s={}){const{assumeSymmetric:t=!1}=s;if(e=et.checkMatrix(e),!e.isSquare())throw new Error("Matrix is not a square matrix");if(e.isEmpty())throw new Error("Matrix must be non-empty");let r=e.columns,o=new v(r,r),i=new Float64Array(r),l=new Float64Array(r),h=e,u,g,f=!1;if(t?f=!0:f=e.isSymmetric(),f){for(u=0;u<r;u++)for(g=0;g<r;g++)o.set(u,g,h.get(u,g));ke(r,l,i,o),ve(r,l,i,o)}else{let w=new v(r,r),k=new Float64Array(r);for(g=0;g<r;g++)for(u=0;u<r;u++)w.set(u,g,h.get(u,g));Re(r,w,k,o),Ie(r,l,i,o,w)}this.n=r,this.e=l,this.d=i,this.V=o}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let e=this.n,s=this.e,t=this.d,r=new v(e,e),o,i;for(o=0;o<e;o++){for(i=0;i<e;i++)r.set(o,i,0);r.set(o,o,t[o]),s[o]>0?r.set(o,o+1,s[o]):s[o]<0&&r.set(o,o-1,s[o])}return r}}function ke(n,e,s,t){let r,o,i,l,h,u,g,f;for(h=0;h<n;h++)s[h]=t.get(n-1,h);for(l=n-1;l>0;l--){for(f=0,i=0,u=0;u<l;u++)f=f+Math.abs(s[u]);if(f===0)for(e[l]=s[l-1],h=0;h<l;h++)s[h]=t.get(l-1,h),t.set(l,h,0),t.set(h,l,0);else{for(u=0;u<l;u++)s[u]/=f,i+=s[u]*s[u];for(r=s[l-1],o=Math.sqrt(i),r>0&&(o=-o),e[l]=f*o,i=i-r*o,s[l-1]=r-o,h=0;h<l;h++)e[h]=0;for(h=0;h<l;h++){for(r=s[h],t.set(h,l,r),o=e[h]+t.get(h,h)*r,u=h+1;u<=l-1;u++)o+=t.get(u,h)*s[u],e[u]+=t.get(u,h)*r;e[h]=o}for(r=0,h=0;h<l;h++)e[h]/=i,r+=e[h]*s[h];for(g=r/(i+i),h=0;h<l;h++)e[h]-=g*s[h];for(h=0;h<l;h++){for(r=s[h],o=e[h],u=h;u<=l-1;u++)t.set(u,h,t.get(u,h)-(r*e[u]+o*s[u]));s[h]=t.get(l-1,h),t.set(l,h,0)}}s[l]=i}for(l=0;l<n-1;l++){if(t.set(n-1,l,t.get(l,l)),t.set(l,l,1),i=s[l+1],i!==0){for(u=0;u<=l;u++)s[u]=t.get(u,l+1)/i;for(h=0;h<=l;h++){for(o=0,u=0;u<=l;u++)o+=t.get(u,l+1)*t.get(u,h);for(u=0;u<=l;u++)t.set(u,h,t.get(u,h)-o*s[u])}}for(u=0;u<=l;u++)t.set(u,l+1,0)}for(h=0;h<n;h++)s[h]=t.get(n-1,h),t.set(n-1,h,0);t.set(n-1,n-1,1),e[0]=0}function ve(n,e,s,t){let r,o,i,l,h,u,g,f,w,k,m,M,R,c,E,q;for(i=1;i<n;i++)e[i-1]=e[i];e[n-1]=0;let $=0,L=0,Y=Number.EPSILON;for(u=0;u<n;u++){for(L=Math.max(L,Math.abs(s[u])+Math.abs(e[u])),g=u;g<n&&!(Math.abs(e[g])<=Y*L);)g++;if(g>u)do{for(r=s[u],f=(s[u+1]-r)/(2*e[u]),w=ut(f,1),f<0&&(w=-w),s[u]=e[u]/(f+w),s[u+1]=e[u]*(f+w),k=s[u+1],o=r-s[u],i=u+2;i<n;i++)s[i]-=o;for($=$+o,f=s[g],m=1,M=m,R=m,c=e[u+1],E=0,q=0,i=g-1;i>=u;i--)for(R=M,M=m,q=E,r=m*e[i],o=m*f,w=ut(f,e[i]),e[i+1]=E*w,E=e[i]/w,m=f/w,f=m*s[i]-E*r,s[i+1]=o+E*(m*r+E*s[i]),h=0;h<n;h++)o=t.get(h,i+1),t.set(h,i+1,E*t.get(h,i)+m*o),t.set(h,i,m*t.get(h,i)-E*o);f=-E*q*R*c*e[u]/k,e[u]=E*f,s[u]=m*f}while(Math.abs(e[u])>Y*L);s[u]=s[u]+$,e[u]=0}for(i=0;i<n-1;i++){for(h=i,f=s[i],l=i+1;l<n;l++)s[l]<f&&(h=l,f=s[l]);if(h!==i)for(s[h]=s[i],s[i]=f,l=0;l<n;l++)f=t.get(l,i),t.set(l,i,t.get(l,h)),t.set(l,h,f)}}function Re(n,e,s,t){let r=0,o=n-1,i,l,h,u,g,f,w;for(f=r+1;f<=o-1;f++){for(w=0,u=f;u<=o;u++)w=w+Math.abs(e.get(u,f-1));if(w!==0){for(h=0,u=o;u>=f;u--)s[u]=e.get(u,f-1)/w,h+=s[u]*s[u];for(l=Math.sqrt(h),s[f]>0&&(l=-l),h=h-s[f]*l,s[f]=s[f]-l,g=f;g<n;g++){for(i=0,u=o;u>=f;u--)i+=s[u]*e.get(u,g);for(i=i/h,u=f;u<=o;u++)e.set(u,g,e.get(u,g)-i*s[u])}for(u=0;u<=o;u++){for(i=0,g=o;g>=f;g--)i+=s[g]*e.get(u,g);for(i=i/h,g=f;g<=o;g++)e.set(u,g,e.get(u,g)-i*s[g])}s[f]=w*s[f],e.set(f,f-1,w*l)}}for(u=0;u<n;u++)for(g=0;g<n;g++)t.set(u,g,u===g?1:0);for(f=o-1;f>=r+1;f--)if(e.get(f,f-1)!==0){for(u=f+1;u<=o;u++)s[u]=e.get(u,f-1);for(g=f;g<=o;g++){for(l=0,u=f;u<=o;u++)l+=s[u]*t.get(u,g);for(l=l/s[f]/e.get(f,f-1),u=f;u<=o;u++)t.set(u,g,t.get(u,g)+l*s[u])}}}function Ie(n,e,s,t,r){let o=n-1,i=0,l=n-1,h=Number.EPSILON,u=0,g=0,f=0,w=0,k=0,m=0,M=0,R=0,c,E,q,$,L,Y,F,z,Q,a,S,I,j,X,_;for(c=0;c<n;c++)for((c<i||c>l)&&(s[c]=r.get(c,c),e[c]=0),E=Math.max(c-1,0);E<n;E++)g=g+Math.abs(r.get(c,E));for(;o>=i;){for($=o;$>i&&(m=Math.abs(r.get($-1,$-1))+Math.abs(r.get($,$)),m===0&&(m=g),!(Math.abs(r.get($,$-1))<h*m));)$--;if($===o)r.set(o,o,r.get(o,o)+u),s[o]=r.get(o,o),e[o]=0,o--,R=0;else if($===o-1){if(F=r.get(o,o-1)*r.get(o-1,o),f=(r.get(o-1,o-1)-r.get(o,o))/2,w=f*f+F,M=Math.sqrt(Math.abs(w)),r.set(o,o,r.get(o,o)+u),r.set(o-1,o-1,r.get(o-1,o-1)+u),z=r.get(o,o),w>=0){for(M=f>=0?f+M:f-M,s[o-1]=z+M,s[o]=s[o-1],M!==0&&(s[o]=z-F/M),e[o-1]=0,e[o]=0,z=r.get(o,o-1),m=Math.abs(z)+Math.abs(M),f=z/m,w=M/m,k=Math.sqrt(f*f+w*w),f=f/k,w=w/k,E=o-1;E<n;E++)M=r.get(o-1,E),r.set(o-1,E,w*M+f*r.get(o,E)),r.set(o,E,w*r.get(o,E)-f*M);for(c=0;c<=o;c++)M=r.get(c,o-1),r.set(c,o-1,w*M+f*r.get(c,o)),r.set(c,o,w*r.get(c,o)-f*M);for(c=i;c<=l;c++)M=t.get(c,o-1),t.set(c,o-1,w*M+f*t.get(c,o)),t.set(c,o,w*t.get(c,o)-f*M)}else s[o-1]=z+f,s[o]=z+f,e[o-1]=M,e[o]=-M;o=o-2,R=0}else{if(z=r.get(o,o),Q=0,F=0,$<o&&(Q=r.get(o-1,o-1),F=r.get(o,o-1)*r.get(o-1,o)),R===10){for(u+=z,c=i;c<=o;c++)r.set(c,c,r.get(c,c)-z);m=Math.abs(r.get(o,o-1))+Math.abs(r.get(o-1,o-2)),z=Q=.75*m,F=-.4375*m*m}if(R===30&&(m=(Q-z)/2,m=m*m+F,m>0)){for(m=Math.sqrt(m),Q<z&&(m=-m),m=z-F/((Q-z)/2+m),c=i;c<=o;c++)r.set(c,c,r.get(c,c)-m);u+=m,z=Q=F=.964}for(R=R+1,L=o-2;L>=$&&(M=r.get(L,L),k=z-M,m=Q-M,f=(k*m-F)/r.get(L+1,L)+r.get(L,L+1),w=r.get(L+1,L+1)-M-k-m,k=r.get(L+2,L+1),m=Math.abs(f)+Math.abs(w)+Math.abs(k),f=f/m,w=w/m,k=k/m,!(L===$||Math.abs(r.get(L,L-1))*(Math.abs(w)+Math.abs(k))<h*(Math.abs(f)*(Math.abs(r.get(L-1,L-1))+Math.abs(M)+Math.abs(r.get(L+1,L+1))))));)L--;for(c=L+2;c<=o;c++)r.set(c,c-2,0),c>L+2&&r.set(c,c-3,0);for(q=L;q<=o-1&&(X=q!==o-1,q!==L&&(f=r.get(q,q-1),w=r.get(q+1,q-1),k=X?r.get(q+2,q-1):0,z=Math.abs(f)+Math.abs(w)+Math.abs(k),z!==0&&(f=f/z,w=w/z,k=k/z)),z!==0);q++)if(m=Math.sqrt(f*f+w*w+k*k),f<0&&(m=-m),m!==0){for(q!==L?r.set(q,q-1,-m*z):$!==L&&r.set(q,q-1,-r.get(q,q-1)),f=f+m,z=f/m,Q=w/m,M=k/m,w=w/f,k=k/f,E=q;E<n;E++)f=r.get(q,E)+w*r.get(q+1,E),X&&(f=f+k*r.get(q+2,E),r.set(q+2,E,r.get(q+2,E)-f*M)),r.set(q,E,r.get(q,E)-f*z),r.set(q+1,E,r.get(q+1,E)-f*Q);for(c=0;c<=Math.min(o,q+3);c++)f=z*r.get(c,q)+Q*r.get(c,q+1),X&&(f=f+M*r.get(c,q+2),r.set(c,q+2,r.get(c,q+2)-f*k)),r.set(c,q,r.get(c,q)-f),r.set(c,q+1,r.get(c,q+1)-f*w);for(c=i;c<=l;c++)f=z*t.get(c,q)+Q*t.get(c,q+1),X&&(f=f+M*t.get(c,q+2),t.set(c,q+2,t.get(c,q+2)-f*k)),t.set(c,q,t.get(c,q)-f),t.set(c,q+1,t.get(c,q+1)-f*w)}}}if(g!==0){for(o=n-1;o>=0;o--)if(f=s[o],w=e[o],w===0)for($=o,r.set(o,o,1),c=o-1;c>=0;c--){for(F=r.get(c,c)-f,k=0,E=$;E<=o;E++)k=k+r.get(c,E)*r.get(E,o);if(e[c]<0)M=F,m=k;else if($=c,e[c]===0?r.set(c,o,F!==0?-k/F:-k/(h*g)):(z=r.get(c,c+1),Q=r.get(c+1,c),w=(s[c]-f)*(s[c]-f)+e[c]*e[c],Y=(z*m-M*k)/w,r.set(c,o,Y),r.set(c+1,o,Math.abs(z)>Math.abs(M)?(-k-F*Y)/z:(-m-Q*Y)/M)),Y=Math.abs(r.get(c,o)),h*Y*Y>1)for(E=c;E<=o;E++)r.set(E,o,r.get(E,o)/Y)}else if(w<0)for($=o-1,Math.abs(r.get(o,o-1))>Math.abs(r.get(o-1,o))?(r.set(o-1,o-1,w/r.get(o,o-1)),r.set(o-1,o,-(r.get(o,o)-f)/r.get(o,o-1))):(_=It(0,-r.get(o-1,o),r.get(o-1,o-1)-f,w),r.set(o-1,o-1,_[0]),r.set(o-1,o,_[1])),r.set(o,o-1,0),r.set(o,o,1),c=o-2;c>=0;c--){for(a=0,S=0,E=$;E<=o;E++)a=a+r.get(c,E)*r.get(E,o-1),S=S+r.get(c,E)*r.get(E,o);if(F=r.get(c,c)-f,e[c]<0)M=F,k=a,m=S;else if($=c,e[c]===0?(_=It(-a,-S,F,w),r.set(c,o-1,_[0]),r.set(c,o,_[1])):(z=r.get(c,c+1),Q=r.get(c+1,c),I=(s[c]-f)*(s[c]-f)+e[c]*e[c]-w*w,j=(s[c]-f)*2*w,I===0&&j===0&&(I=h*g*(Math.abs(F)+Math.abs(w)+Math.abs(z)+Math.abs(Q)+Math.abs(M))),_=It(z*k-M*a+w*S,z*m-M*S-w*a,I,j),r.set(c,o-1,_[0]),r.set(c,o,_[1]),Math.abs(z)>Math.abs(M)+Math.abs(w)?(r.set(c+1,o-1,(-a-F*r.get(c,o-1)+w*r.get(c,o))/z),r.set(c+1,o,(-S-F*r.get(c,o)-w*r.get(c,o-1))/z)):(_=It(-k-Q*r.get(c,o-1),-m-Q*r.get(c,o),M,w),r.set(c+1,o-1,_[0]),r.set(c+1,o,_[1]))),Y=Math.max(Math.abs(r.get(c,o-1)),Math.abs(r.get(c,o))),h*Y*Y>1)for(E=c;E<=o;E++)r.set(E,o-1,r.get(E,o-1)/Y),r.set(E,o,r.get(E,o)/Y)}for(c=0;c<n;c++)if(c<i||c>l)for(E=c;E<n;E++)t.set(c,E,r.get(c,E));for(E=n-1;E>=i;E--)for(c=i;c<=l;c++){for(M=0,q=i;q<=Math.min(E,l);q++)M=M+t.get(c,q)*r.get(q,E);t.set(c,E,M)}}}function It(n,e,s,t){let r,o;return Math.abs(s)>Math.abs(t)?(r=t/s,o=s+r*t,[(n+r*e)/o,(e-r*n)/o]):(r=s/t,o=t+r*s,[(r*n+e)/o,(r*e-n)/o])}class Vt{constructor(e){if(e=et.checkMatrix(e),!e.isSymmetric())throw new Error("Matrix is not symmetric");let s=e,t=s.rows,r=new v(t,t),o=!0,i,l,h;for(l=0;l<t;l++){let u=0;for(h=0;h<l;h++){let g=0;for(i=0;i<h;i++)g+=r.get(h,i)*r.get(l,i);g=(s.get(l,h)-g)/r.get(h,h),r.set(l,h,g),u=u+g*g}for(u=s.get(l,l)-u,o&&=u>0,r.set(l,l,Math.sqrt(Math.max(u,0))),h=l+1;h<t;h++)r.set(l,h,0)}this.L=r,this.positiveDefinite=o}isPositiveDefinite(){return this.positiveDefinite}solve(e){e=et.checkMatrix(e);let s=this.L,t=s.rows;if(e.rows!==t)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let r=e.columns,o=e.clone(),i,l,h;for(h=0;h<t;h++)for(l=0;l<r;l++){for(i=0;i<h;i++)o.set(h,l,o.get(h,l)-o.get(i,l)*s.get(h,i));o.set(h,l,o.get(h,l)/s.get(h,h))}for(h=t-1;h>=0;h--)for(l=0;l<r;l++){for(i=h+1;i<t;i++)o.set(h,l,o.get(h,l)-o.get(i,l)*s.get(i,h));o.set(h,l,o.get(h,l)/s.get(h,h))}return o}get lowerTriangularMatrix(){return this.L}}class Pt{constructor(e,s={}){e=et.checkMatrix(e);let{Y:t}=s;const{scaleScores:r=!1,maxIterations:o=1e3,terminationCriteria:i=1e-10}=s;let l;if(t){if(d.isAnyArray(t)&&typeof t[0]=="number"?t=v.columnVector(t):t=et.checkMatrix(t),t.rows!==e.rows)throw new Error("Y should have the same number of rows as X");l=t.getColumnVector(0)}else l=e.getColumnVector(0);let h=1,u,g,f,w;for(let k=0;k<o&&h>i;k++)f=e.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),f=f.div(f.norm()),u=e.mmul(f).div(f.transpose().mmul(f).get(0,0)),k>0&&(h=u.clone().sub(w).pow(2).sum()),w=u.clone(),t?(g=t.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),g=g.div(g.norm()),l=t.mmul(g).div(g.transpose().mmul(g).get(0,0))):l=u;if(t){let k=e.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0));k=k.div(k.norm());let m=e.clone().sub(u.clone().mmul(k.transpose())),M=l.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),R=t.clone().sub(u.clone().mulS(M.get(0,0)).mmul(g.transpose()));this.t=u,this.p=k.transpose(),this.w=f.transpose(),this.q=g,this.u=l,this.s=u.transpose().mmul(u),this.xResidual=m,this.yResidual=R,this.betas=M}else this.w=f.transpose(),this.s=u.transpose().mmul(u).sqrt(),r?this.t=u.clone().div(this.s.get(0,0)):this.t=u,this.xResidual=e.sub(u.mmul(f.transpose()))}}return U.AbstractMatrix=V,U.CHO=Vt,U.CholeskyDecomposition=Vt,U.DistanceMatrix=Et,U.EVD=Lt,U.EigenvalueDecomposition=Lt,U.LU=vt,U.LuDecomposition=vt,U.Matrix=v,U.MatrixColumnSelectionView=ue,U.MatrixColumnView=he,U.MatrixFlipColumnView=fe,U.MatrixFlipRowView=ce,U.MatrixRowSelectionView=ge,U.MatrixRowView=ae,U.MatrixSelectionView=kt,U.MatrixSubView=me,U.MatrixTransposeView=we,U.NIPALS=Pt,U.Nipals=Pt,U.QR=Tt,U.QrDecomposition=Tt,U.SVD=pt,U.SingularValueDecomposition=pt,U.SymmetricMatrix=ct,U.WrapperMatrix1D=Ct,U.WrapperMatrix2D=et,U.correlation=Ee,U.covariance=je,U.default=v,U.determinant=Rt,U.inverse=de,U.linearDependencies=be,U.pseudoInverse=Se,U.solve=$t,U.wrap=pe,U}var Ft=He();const Ot=Ve(Ft),dt=Ft.Matrix;Ot.Matrix?Ot.Matrix:Ft.Matrix;const Bt=8,ts=1/16777216,es=15,ss=18,rs=11;function os(d,y){d>>>=0,y>>>=0;const p=d&65535;return((d-p)*y>>>0)+p*y>>>0}class ns{constructor(y=Date.now()){this.state=new Uint32Array(4),this.init(y),this.random=this.getFloat.bind(this)}getUint32(){return this.nextState(),this.state[3]+this.state[2]>>>0}getFloat(){return(this.getUint32()>>>8)*ts}init(y){if(!Number.isInteger(y))throw new TypeError("seed must be an integer");this.state[0]=y,this.state[1]=0,this.state[2]=0,this.state[3]=0;for(let p=1;p<Bt;p++)this.state[p&3]^=p+os(1812433253,this.state[p-1&3]^this.state[p-1&3]>>>30>>>0)>>>0;this.periodCertification();for(let p=0;p<Bt;p++)this.nextState()}periodCertification(){this.state[0]===0&&this.state[1]===0&&this.state[2]===0&&this.state[3]===0&&(this.state[0]=88,this.state[1]=83,this.state[2]=65,this.state[3]=68)}nextState(){let y=this.state[0];y^=y<<es,y^=y>>>ss,y^=this.state[3]<<rs,this.state[0]=this.state[1],this.state[1]=this.state[2],this.state[2]=this.state[3],this.state[3]=y}}const is=1e-8;function _t(d,y={},p=Math.random){const{size:b=1,replace:T=!1,probabilities:D}=y;let C,N;if(typeof d=="number"?C=ls(d):C=d.slice(),D){if(!T)throw new Error("choice with probabilities and no replacement is not implemented");if(D.length!==C.length)throw new Error("the length of probabilities option should be equal to the number of choices");N=[D[0]];for(let G=1;G<D.length;G++)N[G]=N[G-1]+D[G];if(Math.abs(1-N[N.length-1])>is)throw new Error(`probabilities should sum to 1, but instead sums to ${N[N.length-1]}`)}if(T===!1&&b>C.length)throw new Error("size option is too large");const P=[];for(let G=0;G<b;G++){const B=hs(C.length,p,N);P.push(C[B]),T||C.splice(B,1)}return P}function ls(d){const y=[];for(let p=0;p<d;p++)y.push(p);return y}function hs(d,y,p){const b=y();if(p){let T=0;for(;b>p[T];)T++;return T}else return Math.floor(b*d)}class Dt{constructor(y=Math.random){if(typeof y=="number"){const p=new ns(y);this.randomGenerator=p.random}else this.randomGenerator=y}choice(y,p){return typeof y=="number"?_t(y,p,this.randomGenerator):_t(y,p,this.randomGenerator)}random(){return this.randomGenerator()}randInt(y,p){return p===void 0&&(p=y,y=0),y+Math.floor(this.randomGenerator()*(p-y))}randomSample(y){const p=[];for(let b=0;b<y;b++)p.push(this.random());return p}}function us(d,y,p){return new Dt(p).choice(d,{size:y})}function fs(d,y,p,b){const T=new Dt(b);let D=new Array(y);if(D[0]=Math.floor(T.random()*d.length),y>1){let C={dist:-1,index:-1};for(let N=0;N<d.length;++N)p[D[0]][N]>C.dist&&(C.dist=p[D[0]][N],C.index=N);if(D[1]=C.index,y>2)for(let N=2;N<y;++N){let P={dist:-1,index:-1};for(let G=0;G<d.length;++G){let B={dist:Number.MAX_VALUE,index:-1};for(let Z=0;Z<N;++Z)p[Z][G]<B.dist&&!D.includes(G)&&(B={dist:p[Z][G],index:G});B.dist!==Number.MAX_VALUE&&B.dist>P.dist&&(P={...B})}D[N]=P.index}}return D.map(C=>d[C])}function cs(d,y,p={}){const b=new dt(d),T=b.rows,D=new Dt(p.seed),C=[],N=p.localTrials||2+Math.floor(Math.log(y)),P=D.randInt(T);C.push(b.getRow(P));let G=new dt(1,b.rows);for(let tt=0;tt<b.rows;tt++)G.set(0,tt,Nt(b.getRow(tt),C[0]));let B=[Gt(G.getRow(0))];const Z=1/B[0][T-1];let it=dt.mul(G,Z);for(let tt=1;tt<y;tt++){const mt=D.choice(T,{replace:!0,size:N,probabilities:it.getRow(0)}),yt=b.selection(mt,gs(b.columns)),Mt=as(yt,b);let at=1/0,gt=1/0,lt=G;for(let wt=0;wt<N;wt++){const St=dt.min(G,[Mt.getRow(wt)]),jt=St.sum();jt<gt&&(at=mt[wt],gt=jt,lt=St)}C[tt]=b.getRow(at),G=lt,B=[Gt(G.getRow(0))],it=dt.mul(G,1/B[0][T-1])}return C}function as(d,y){const p=new dt(d.rows,y.rows);for(let b=0;b<d.rows;b++)for(let T=0;T<y.rows;T++)p.set(b,T,Nt(d.getRow(b),y.getRow(T)));return p}function gs(d){let y=[];for(let p=0;p<d;p++)y.push(p);return y}function Gt(d){let y=[d[0]];for(let p=1;p<d.length;p++)y[p]=y[p-1]+d[p];return y}const ms={maxIterations:100,tolerance:1e-6,initialization:"kmeans++",distanceFunction:Nt};function ws(d,y,p,b,T,D){p=Wt(y,d,p,T.distanceFunction);let C=Oe(d,y,p,b),N=Be(C,d,T.distanceFunction,T.tolerance);return new _e(p,C,N,D,T.distanceFunction)}function Ms(d,y,p){const b=ds(p);Qe(d,y);let T=ps(d,y,b);b.maxIterations===0&&(b.maxIterations=Number.MAX_VALUE);let D=new Array(d.length),C=!1,N=0,P;for(;!C&&N<b.maxIterations;)P=ws(T,d,D,y,b,++N),C=P.converged,T=P.centroids;if(!P)throw new Error("unreachable: no kmeans step executed");return P}function ps(d,y,p){let b;if(Array.isArray(p.initialization)){if(p.initialization.length!==y)throw new Error("The initial centers should have the same length as K");b=p.initialization}else switch(p.initialization){case"kmeans++":b=cs(d,y,p);break;case"random":b=us(d,y,p.seed);break;case"mostDistant":b=fs(d,y,Ue(d,p.distanceFunction),p.seed);break;default:Ge(p.initialization,"Unknown initialization method")}return b}function ds(d){return{...ms,...d}}export{Ms as kmeans};
